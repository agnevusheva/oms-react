var CM=Object.defineProperty;var V0=e=>{throw TypeError(e)};var TM=(e,t,n)=>t in e?CM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var d=(e,t,n)=>TM(e,typeof t!="symbol"?t+"":t,n),L_=(e,t,n)=>t.has(e)||V0("Cannot "+n);var Pe=(e,t,n)=>(L_(e,t,"read from private field"),n?n.call(e):t.get(e)),Mr=(e,t,n)=>t.has(e)?V0("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Vd=(e,t,n,r)=>(L_(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),Ze=(e,t,n)=>(L_(e,t,"access private method"),n);const IM=e=>typeof e=="function",y=function(e,t){if(typeof e=="function")return function(){return e(arguments)?t.apply(this,arguments):n=>t(n,...arguments)};switch(e){case 0:case 1:throw new RangeError(`Invalid arity ${e}`);case 2:return function(n,r){return arguments.length>=2?t(n,r):function(s){return t(s,n)}};case 3:return function(n,r,s){return arguments.length>=3?t(n,r,s):function(o){return t(o,n,r)}};case 4:return function(n,r,s,o){return arguments.length>=4?t(n,r,s,o):function(a){return t(a,n,r,s)}};case 5:return function(n,r,s,o,a){return arguments.length>=5?t(n,r,s,o,a):function(u){return t(u,n,r,s,o)}};default:return function(){if(arguments.length>=e)return t.apply(this,arguments);const n=arguments;return function(r){return t(r,...n)}}}},ie=e=>e,fp=e=>()=>e,W0=fp(!0),Hn=fp(!1),o1=fp(void 0),Nl=o1;function v(e,t,n,r,s,o,a,u,f){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return n(t(e));case 4:return r(n(t(e)));case 5:return s(r(n(t(e))));case 6:return o(s(r(n(t(e)))));case 7:return a(o(s(r(n(t(e))))));case 8:return u(a(o(s(r(n(t(e)))))));case 9:return f(u(a(o(s(r(n(t(e))))))));default:{let h=arguments[0];for(let p=1;p<arguments.length;p++)h=arguments[p](h);return h}}}const Lf=e=>(t,n)=>t===n||e(t,n),RM=(e,t)=>e===t,OM=()=>RM,qM=OM(),i1=y(2,(e,t)=>Lf((n,r)=>e(t(n),t(r)))),AM=i1(qM,e=>e.getTime()),PM=e=>Lf((t,n)=>{if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(!e(t[r],n[r]))return!1;return!0});let FM="3.15.5";const dp=()=>FM,Wd=`effect/GlobalValue/globalStoreId/${dp()}`;let Gu;const Ee=(e,t)=>(Gu||(globalThis[Wd]??(globalThis[Wd]=new Map),Gu=globalThis[Wd]),Gu.has(e)||Gu.set(e,t()),Gu.get(e)),xM=e=>e instanceof Set,Tn=e=>typeof e=="string",oo=e=>typeof e=="number",Gi=e=>typeof e=="boolean",hp=e=>typeof e=="bigint",Bh=e=>typeof e=="symbol",iu=IM,NM=e=>e===void 0,DM=e=>!1,PS=e=>typeof e=="object"&&e!==null,qs=e=>PS(e)||iu(e),ne=y(2,(e,t)=>qs(e)&&t in e),mp=y(2,(e,t)=>ne(e,"_tag")&&e._tag===t),Ba=e=>e==null,MM=e=>e!=null,LM=e=>e instanceof Uint8Array,a1=e=>e instanceof Date,FS=e=>ne(e,Symbol.iterator),jM=e=>PS(e)&&!Array.isArray(e),c1=e=>ne(e,"then")&&iu(e.then),pp=e=>`BUG: ${e} - please report an issue at https://github.com/Effect-TS/effect/issues`;let u1=class l1{constructor(t){d(this,"self");d(this,"called",!1);this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new l1(this.self)}};const UM=335903614,zM=4150755663,BM=1481765933,HM=1284865837,VM=9007199254740992,WM=134217728;class KM{constructor(t,n,r,s){d(this,"_state");return Ba(n)&&Ba(t)?(n=Math.random()*4294967295>>>0,t=0):Ba(n)&&(n=t,t=0),Ba(s)&&Ba(r)?(s=this._state?this._state[3]:zM,r=this._state?this._state[2]:UM):Ba(s)&&(s=r,r=0),this._state=new Int32Array([0,0,r>>>0,((s||0)|1)>>>0]),this._next(),K0(this._state,this._state[0],this._state[1],t>>>0,n>>>0),this._next(),this}getState(){return[this._state[0],this._state[1],this._state[2],this._state[3]]}setState(t){this._state[0]=t[0],this._state[1]=t[1],this._state[2]=t[2],this._state[3]=t[3]|1}integer(t){return Math.round(this.number()*Number.MAX_SAFE_INTEGER)%t}number(){const t=(this._next()&67108863)*1,n=(this._next()&134217727)*1;return(t*WM+n)/VM}_next(){const t=this._state[0]>>>0,n=this._state[1]>>>0;JM(this._state,t,n,BM,HM),K0(this._state,this._state[0],this._state[1],this._state[2],this._state[3]);let r=t>>>18,s=(n>>>18|t<<14)>>>0;r=(r^t)>>>0,s=(s^n)>>>0;const o=(s>>>27|r<<5)>>>0,a=t>>>27,u=(-a>>>0&31)>>>0;return(o>>>a|o<<u)>>>0}}function JM(e,t,n,r,s){let o=(n>>>16)*(s&65535)>>>0,a=(n&65535)*(s>>>16)>>>0,u=(n&65535)*(s&65535)>>>0,f=(n>>>16)*(s>>>16)+((a>>>16)+(o>>>16))>>>0;a=a<<16>>>0,u=u+a>>>0,u>>>0<a>>>0&&(f=f+1>>>0),o=o<<16>>>0,u=u+o>>>0,u>>>0<o>>>0&&(f=f+1>>>0),f=f+Math.imul(n,r)>>>0,f=f+Math.imul(t,s)>>>0,e[0]=f,e[1]=u}function K0(e,t,n,r,s){let o=t+r>>>0;const a=n+s>>>0;a>>>0<n>>>0&&(o=o+1|0),e[0]=o,e[1]=a}const Oy=Symbol.for("effect/Utils/YieldWrap");var Df;class au{constructor(t){Mr(this,Df);Vd(this,Df,t)}[Oy](){return Pe(this,Df)}}Df=new WeakMap;function f1(e){if(typeof e=="object"&&e!==null&&Oy in e)return e[Oy]();throw new Error(pp("yieldWrapGet"))}const gr=Ee("effect/Utils/isStructuralRegion",()=>({enabled:!1,tester:void 0})),d1={effect_internal_function:e=>e()},GM={effect_internal_function:e=>{try{return e()}finally{}}};var fT;const QM=((fT=d1.effect_internal_function(()=>new Error().stack))==null?void 0:fT.includes("effect_internal_function"))===!0,mt=QM?d1.effect_internal_function:GM.effect_internal_function,YM=(function*(){}).constructor,XM=e=>qs(e)&&e.constructor===YM,j_=Ee(Symbol.for("effect/Hash/randomHashCache"),()=>new WeakMap),pe=Symbol.for("effect/Hash"),Q=e=>{if(gr.enabled===!0)return 0;switch(typeof e){case"number":return xS(e);case"bigint":return $t(e.toString(10));case"boolean":return $t(String(e));case"symbol":return $t(String(e));case"string":return $t(e);case"undefined":return $t("undefined");case"function":case"object":return e===null?$t("null"):e instanceof Date?Q(e.toISOString()):e instanceof URL?Q(e.href):ZM(e)?e[pe]():gp(e);default:throw new Error(`BUG: unhandled typeof ${typeof e} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},gp=e=>(j_.has(e)||j_.set(e,xS(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),j_.get(e)),ue=e=>t=>t*53^e,_p=e=>e&3221225471|e>>>1&1073741824,ZM=e=>ne(e,pe),xS=e=>{if(e!==e||e===1/0)return 0;let t=e|0;for(t!==e&&(t^=e*4294967295);e>4294967295;)t^=e/=4294967295;return _p(t)},$t=e=>{let t=5381,n=e.length;for(;n;)t=t*33^e.charCodeAt(--n);return _p(t)},eL=(e,t)=>{let n=12289;for(let r=0;r<t.length;r++)n^=v($t(t[r]),ue(Q(e[t[r]])));return _p(n)},h1=e=>eL(e,Object.keys(e)),jf=e=>{let t=6151;for(let n=0;n<e.length;n++)t=v(t,ue(Q(e[n])));return _p(t)},it=function(){if(arguments.length===1){const n=arguments[0];return function(r){return Object.defineProperty(n,pe,{value(){return r},enumerable:!1}),r}}const e=arguments[0],t=arguments[1];return Object.defineProperty(e,pe,{value(){return t},enumerable:!1}),t},ge=Symbol.for("effect/Equal");function de(){return arguments.length===1?e=>Hh(e,arguments[0]):Hh(arguments[0],arguments[1])}function Hh(e,t){if(e===t)return!0;const n=typeof e;if(n!==typeof t)return!1;if(n==="object"||n==="function"){if(e!==null&&t!==null){if(Dl(e)&&Dl(t))return Q(e)===Q(t)&&e[ge](t)?!0:gr.enabled&&gr.tester?gr.tester(e,t):!1;if(e instanceof Date&&t instanceof Date)return e.toISOString()===t.toISOString();if(e instanceof URL&&t instanceof URL)return e.href===t.href}if(gr.enabled){if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every((r,s)=>Hh(r,t[s]));if(Object.getPrototypeOf(e)===Object.prototype&&Object.getPrototypeOf(e)===Object.prototype){const r=Object.keys(e),s=Object.keys(t);if(r.length===s.length){for(const o of r)if(!(o in t&&Hh(e[o],t[o])))return gr.tester?gr.tester(e,t):!1;return!0}}return gr.tester?gr.tester(e,t):!1}}return gr.enabled&&gr.tester?gr.tester(e,t):!1}const Dl=e=>ne(e,ge),NS=()=>de,Ue=Symbol.for("nodejs.util.inspect.custom"),It=e=>{try{if(ne(e,"toJSON")&&iu(e.toJSON)&&e.toJSON.length===0)return e.toJSON();if(Array.isArray(e))return e.map(It)}catch{return{}}return Yi(e)},lt=e=>JSON.stringify(e,null,2),yp={toJSON(){return It(this)},[Ue](){return this.toJSON()},toString(){return lt(this.toJSON())}};let tL=class{[Ue](){return this.toJSON()}toString(){return lt(this.toJSON())}};const Qi=(e,t=2)=>{if(typeof e=="string")return e;try{return typeof e=="object"?m1(e,t):String(e)}catch{return String(e)}},m1=(e,t)=>{let n=[];const r=JSON.stringify(e,(s,o)=>typeof o=="object"&&o!==null?n.includes(o)?void 0:n.push(o)&&(Mi.fiberRefs!==void 0&&p1(o)?o[bp](Mi.fiberRefs):o):o,t);return n=void 0,r},bp=Symbol.for("effect/Inspectable/Redactable"),p1=e=>typeof e=="object"&&e!==null&&bp in e,Mi=Ee("effect/Inspectable/redactableState",()=>({fiberRefs:void 0})),nL=(e,t)=>{const n=Mi.fiberRefs;Mi.fiberRefs=e;try{return t()}finally{Mi.fiberRefs=n}},Yi=e=>p1(e)&&Mi.fiberRefs!==void 0?e[bp](Mi.fiberRefs):e,Z=(e,t)=>{switch(t.length){case 0:return e;case 1:return t[0](e);case 2:return t[1](t[0](e));case 3:return t[2](t[1](t[0](e)));case 4:return t[3](t[2](t[1](t[0](e))));case 5:return t[4](t[3](t[2](t[1](t[0](e)))));case 6:return t[5](t[4](t[3](t[2](t[1](t[0](e))))));case 7:return t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))));case 8:return t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e))))))));case 9:return t[8](t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))))));default:{let n=e;for(let r=0,s=t.length;r<s;r++)n=t[r](n);return n}}},bl="Async",Uf="Commit",an="Failure",mh="OnFailure",Vh="OnSuccess",Wh="OnSuccessAndFailure",cn="Success",g1="Sync",rL="Tag",cu="UpdateRuntimeFlags",Kh="While",Sl="Iterator",_1="WithRuntime",ph="Yield",DS="RevertFlags",sL=Symbol.for("effect/Effect"),qy=Symbol.for("effect/Stream"),oL=Symbol.for("effect/Sink"),iL=Symbol.for("effect/Channel"),Xi={_R:e=>e,_E:e=>e,_A:e=>e,_V:dp()},aL={_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e},cL={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},zf={[sL]:Xi,[qy]:Xi,[oL]:aL,[iL]:cL,[ge](e){return this===e},[pe](){return it(this,gp(this))},[Symbol.iterator](){return new u1(new au(this))},pipe(){return Z(this,arguments)}},MS={[pe](){return it(this,h1(this))},[ge](e){const t=Object.keys(this),n=Object.keys(e);if(t.length!==n.length)return!1;for(const r of t)if(!(r in e&&de(this[r],e[r])))return!1;return!0}},Bf={...zf,_op:Uf},uL={...Bf,...MS},lL=function(){function e(){}return e.prototype=Bf,e}(),y1=Symbol.for("effect/Option"),b1={...zf,[y1]:{_A:e=>e},[Ue](){return this.toJSON()},toString(){return lt(this.toJSON())}},fL=Object.assign(Object.create(b1),{_tag:"Some",_op:"Some",[ge](e){return LS(e)&&w1(e)&&de(this.value,e.value)},[pe](){return it(this,ue(Q(this._tag))(Q(this.value)))},toJSON(){return{_id:"Option",_tag:this._tag,value:It(this.value)}}}),dL=Q("None"),hL=Object.assign(Object.create(b1),{_tag:"None",_op:"None",[ge](e){return LS(e)&&S1(e)},[pe](){return dL},toJSON(){return{_id:"Option",_tag:this._tag}}}),LS=e=>ne(e,y1),S1=e=>e._tag==="None",w1=e=>e._tag==="Some",v1=Object.create(hL),Ay=e=>{const t=Object.create(fL);return t.value=e,t},E1=Symbol.for("effect/Either"),k1={...zf,[E1]:{_R:e=>e},[Ue](){return this.toJSON()},toString(){return lt(this.toJSON())}},mL=Object.assign(Object.create(k1),{_tag:"Right",_op:"Right",[ge](e){return jS(e)&&C1(e)&&de(this.right,e.right)},[pe](){return ue(Q(this._tag))(Q(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:It(this.right)}}}),pL=Object.assign(Object.create(k1),{_tag:"Left",_op:"Left",[ge](e){return jS(e)&&$1(e)&&de(this.left,e.left)},[pe](){return ue(Q(this._tag))(Q(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:It(this.left)}}}),jS=e=>ne(e,E1),$1=e=>e._tag==="Left",C1=e=>e._tag==="Right",gL=e=>{const t=Object.create(pL);return t.left=e,t},_L=e=>{const t=Object.create(mL);return t.right=e,t},ce=_L,oe=gL,US=e=>{if(iu(e))try{return ce(e())}catch(t){return oe(t)}else try{return ce(e.try())}catch(t){return oe(e.catch(t))}},T1=jS,en=$1,ds=C1,yL=y(2,(e,{onLeft:t,onRight:n})=>en(e)?oe(t(e.left)):ce(n(e.right))),Zi=y(2,(e,t)=>en(e)?oe(t(e.left)):ce(e.right)),bL=y(2,(e,t)=>ds(e)?ce(t(e.right)):oe(e.left)),rn=y(2,(e,{onLeft:t,onRight:n})=>en(e)?t(e.left):n(e.right)),SL=rn({onLeft:ie,onRight:ie}),I1=y(2,(e,t)=>{if(ds(e))return e.right;throw t(e.left)}),wL=I1(()=>new Error("getOrThrow called on a Left")),zS=e=>e.length>0,R1=e=>(t,n)=>t===n?0:e(t,n),vL=R1((e,t)=>e<t?-1:1),O1=y(2,(e,t)=>R1((n,r)=>e(t(n),t(r)))),EL=e=>y(2,(t,n)=>e(t,n)===1),V=()=>v1,W=Ay,kL=LS,At=S1,ct=w1,rt=y(2,(e,{onNone:t,onSome:n})=>At(e)?t():n(e.value)),gt=y(2,(e,t)=>At(e)?t():e.value),Gs=y(2,(e,t)=>At(e)?t():e),$L=y(2,(e,t)=>At(e)?W(t()):e),wa=e=>e==null?V():W(e),or=gt(o1),CL=e=>(...t)=>{try{return W(e(...t))}catch{return V()}},Wo=y(2,(e,t)=>At(e)?V():W(t(e.value))),uu=y(2,(e,t)=>At(e)?V():t(e.value)),TL=y(2,(e,t)=>At(e)?V():wa(t(e.value))),IL=uu(ie),RL=e=>Lf((t,n)=>At(t)?At(n):At(n)?!1:e(t.value,n.value)),OL=e=>y(2,(t,n)=>At(t)?!1:e(t.value,n)),qL=NS(),AL=OL(qL),PL=y(2,(e,t)=>At(e)?!1:t(e.value)),J0=e=>(t,n)=>At(t)?n:At(n)?t:W(e(t.value,n.value)),FL=(...e)=>e,xL=e=>{const n=e[Symbol.iterator]().next();if(n.done)throw new Error("unsafeHead: empty iterable");return n.value},NL=y(2,(e,t)=>{let n=0;for(const r of e){const s=t(r,n);if(Gi(s)){if(s)return W(r)}else if(ct(s))return s;n++}return V()}),DL={[Symbol.iterator](){return ML}},ML={next(){return{done:!0,value:void 0}}},q1=()=>DL,LL=y(2,(e,t)=>({[Symbol.iterator](){const n=e[Symbol.iterator]();let r=0;return{next(){const s=n.next();return s.done?{done:!0,value:void 0}:{done:!1,value:t(s.value,r++)}}}}})),jL=y(2,(e,t)=>{const n={...e};for(const r of UL(e))n[r]=t(e[r],r);return n}),UL=e=>Object.keys(e),Sp=e=>new Array(e),zL=y(2,(e,t)=>{const n=Math.max(1,Math.floor(e)),r=new Array(n);for(let s=0;s<n;s++)r[s]=t(s);return r}),je=e=>Array.isArray(e)?e:Array.from(e),BS=e=>Array.isArray(e)?e:[e],BL=y(2,(e,{onEmpty:t,onNonEmpty:n})=>yt(e)?n(e):t()),HL=y(2,(e,{onEmpty:t,onNonEmpty:n})=>yt(e)?n(xn(e),ea(e)):t()),Jh=y(2,(e,t)=>[t,...e]),VL=y(2,(e,t)=>[...e,t]),wp=y(2,(e,t)=>je(e).concat(je(t))),WL=Array.isArray,KL=e=>e.length===0,JL=KL,gh=zS,yt=zS,A1=(e,t)=>e<0||e>=t.length,GL=(e,t)=>Math.floor(Math.min(Math.max(0,e),t.length)),QL=y(2,(e,t)=>{const n=Math.floor(t);return A1(n,e)?V():W(e[n])}),P1=y(2,(e,t)=>{const n=Math.floor(t);if(A1(n,e))throw new Error(`Index ${n} out of bounds`);return e[n]}),dc=QL(0),xn=P1(0),YL=e=>yt(e)?W(F1(e)):V(),F1=e=>e[e.length-1],ea=e=>e.slice(1),x1=(e,t)=>{let n=0;for(const r of e){if(!t(r,n))break;n++}return n},N1=y(2,(e,t)=>M1(e,x1(e,t))),XL=y(2,(e,t)=>{const n=je(e);return n.slice(GL(t,n),n.length)}),ZL=y(2,(e,t)=>je(e).slice(x1(e,t))),ej=NL,G0=e=>Array.from(e).reverse(),Ml=y(2,(e,t)=>{const n=Array.from(e);return n.sort(t),n}),Q0=y(2,(e,t)=>tj(e,t,FL)),tj=y(3,(e,t,n)=>{const r=je(e),s=je(t);if(yt(r)&&yt(s)){const o=[n(xn(r),xn(s))],a=Math.min(r.length,s.length);for(let u=1;u<a;u++)o[u]=n(r[u],s[u]);return o}return[]}),nj=e=>{const t=je(e);if(yt(t)){const n=[t[0][0]],r=[t[0][1]];for(let s=1;s<t.length;s++)n[s]=t[s][0],r[s]=t[s][1];return[n,r]}return[[],[]]},rj=e=>y(2,(t,n)=>{for(const r of t)if(e(n,r))return!0;return!1}),D1=NS(),sj=y(2,(e,t)=>{const n=je(e);if(yt(n)){const[r,s]=t(n),o=[r];let a=s;for(;zS(a);){const[u,f]=t(a);o.push(u),a=f}return o}return[]}),M1=y(2,(e,t)=>{const n=Array.from(e),r=Math.floor(t);return yt(n)?r>=1?L1(n,r):[[],n]:[n,[]]}),L1=y(2,(e,t)=>{const n=Math.max(1,Math.floor(t));return n>=e.length?[ol(e),[]]:[Jh(e.slice(1,n),xn(e)),e.slice(n)]}),j1=y(2,(e,t)=>N1(e,(n,r)=>!t(n,r))),ol=e=>e.slice(),oj=y(2,(e,t)=>{const n=je(e);return yt(n)?sj(n,L1(t)):[]}),ij=y(3,(e,t,n)=>{const r=je(e),s=je(t);return yt(r)?yt(s)?B1(n)(wp(r,s)):r:s}),_h=y(2,(e,t)=>ij(e,t,D1)),aj=e=>{const t=rj(e);return y(2,(n,r)=>je(n).filter(s=>t(r,s)))},cj=aj(D1),Xo=()=>[],rr=e=>[e],Qs=y(2,(e,t)=>e.map(t)),Gh=y(2,(e,t)=>{if(JL(e))return[];const n=[];for(let r=0;r<e.length;r++){const s=t(e[r],r);for(let o=0;o<s.length;o++)n.push(s[o])}return n}),uj=Gh(ie),U1=y(2,(e,t)=>{const n=je(e),r=[];for(let s=0;s<n.length;s++){const o=t(n[s],s);ct(o)&&r.push(o.value)}return r}),z1=y(2,(e,t)=>{const n=je(e),r=[];for(let s=0;s<n.length;s++)t(n[s],s)&&r.push(n[s]);return r}),HS=y(3,(e,t,n)=>je(e).reduce((r,s,o)=>n(r,s,o),t)),Y0=(e,t)=>{const n=[];let r=e,s;for(;ct(s=t(r));){const[o,a]=s.value;n.push(o),r=a}return n},Hf=PM,B1=y(2,(e,t)=>{const n=je(e);if(yt(n)){const r=[xn(n)],s=ea(n);for(const o of s)r.every(a=>!t(o,a))&&r.push(o);return r}return[]}),lj=e=>B1(e,NS()),va=y(2,(e,t)=>je(e).join(t)),H1=(e,t)=>{switch(t._tag){case"StringKeyword":case"TemplateLiteral":return Object.keys(e);case"SymbolKeyword":return Object.getOwnPropertySymbols(e);case"Refinement":return H1(e,t.from)}},gs=e=>Object.keys(e).concat(Object.getOwnPropertySymbols(e)),V1=e=>{let t=!1,n;return()=>(t||(n=e(),t=!0),n)},W1=e=>{try{return e.toISOString()}catch{return String(e)}},Cr=(e,t=!0)=>{if(Array.isArray(e))return`[${e.map(n=>Cr(n,t)).join(",")}]`;if(a1(e))return W1(e);if(ne(e,"toString")&&iu(e.toString)&&e.toString!==Object.prototype.toString)return e.toString();if(Tn(e))return JSON.stringify(e);if(oo(e)||e==null||Gi(e)||Bh(e))return String(e);if(hp(e))return String(e)+"n";if(FS(e))return`${e.constructor.name}(${Cr(Array.from(e),t)})`;try{t&&JSON.stringify(e);const n=`{${gs(e).map(s=>`${Tn(s)?JSON.stringify(s):String(s)}:${Cr(e[s],!1)}`).join(",")}}`,r=e.constructor.name;return e.constructor!==Object.prototype.constructor?`${r}(${n})`:n}catch{return"<circular structure>"}},VS=e=>typeof e=="string"?JSON.stringify(e):String(e),K1=e=>Array.isArray(e),fj=e=>!Array.isArray(e),X0=e=>`[${VS(e)}]`,J1=e=>K1(e)?e.map(X0).join(""):X0(e),vo=(e,t,n,r)=>{let s=e;return n&&yt(n)&&(s+=`
at path: ${J1(n)}`),t!==void 0&&(s+=`
details: ${t}`),r&&(s+=`
schema (${r._tag}): ${r}`),s},dj=(e,t,n)=>vo("Unsupported schema",e,t,n),G1=(e,t,n)=>vo("Unsupported schema or overlapping types",`cannot extend ${e} with ${t}`,n),Ll=e=>dj(void 0,void 0,e),hj=e=>vo("Unsupported key schema",void 0,void 0,e),mj=e=>vo("Unsupported literal",`literal value: ${Cr(e)}`),Z0=e=>vo("Duplicate index signature",`${e} index signature`),pj=vo("Unsupported index signature parameter","An index signature parameter type must be `string`, `symbol`, a template literal type or a refinement of the previous types"),gj=vo("Invalid element","A required element cannot follow an optional element. ts(1257)"),ek=e=>vo("Duplicate property signature transformation",`Duplicate key ${Cr(e)}`),Q1=e=>vo("Duplicate property signature",`Duplicate key ${Cr(e)}`),_j=Symbol.for("effect/SchemaId/DateFromSelf"),yj=Symbol.for("effect/SchemaId/GreaterThanOrEqualTo"),bj=Symbol.for("effect/SchemaId/Int"),Sj=Symbol.for("effect/SchemaId/Between"),Ic=vL,Qh=e=>e.replace(/[/\\^$*+?.()|[\]{}]/g,"\\$&"),Y1=Symbol.for("effect/annotation/Brand"),wj=Symbol.for("effect/annotation/SchemaId"),X1=Symbol.for("effect/annotation/Message"),WS=Symbol.for("effect/annotation/MissingMessage"),KS=Symbol.for("effect/annotation/Identifier"),As=Symbol.for("effect/annotation/Title"),hc=Symbol.for("effect/annotation/AutoTitle"),Vf=Symbol.for("effect/annotation/Description"),Z1=Symbol.for("effect/annotation/Examples"),eR=Symbol.for("effect/annotation/Default"),tR=Symbol.for("effect/annotation/JSONSchema"),nR=Symbol.for("effect/annotation/Arbitrary"),rR=Symbol.for("effect/annotation/Pretty"),sR=Symbol.for("effect/annotation/Equivalence"),vj=Symbol.for("effect/annotation/Documentation"),oR=Symbol.for("effect/annotation/Concurrency"),iR=Symbol.for("effect/annotation/Batching"),aR=Symbol.for("effect/annotation/ParseIssueTitle"),cR=Symbol.for("effect/annotation/ParseOptions"),uR=Symbol.for("effect/annotation/DecodingFallback"),Yh=Symbol.for("effect/annotation/Surrogate"),Ej=Symbol.for("effect/annotation/StableFilter"),jn=y(2,(e,t)=>Object.prototype.hasOwnProperty.call(e.annotations,t)?W(e.annotations[t]):V()),lR=jn(Y1),kj=jn(X1),$j=jn(WS),fR=jn(As),dR=jn(hc),vp=jn(KS),hR=jn(Vf),Cj=jn(oR),Tj=jn(iR),Ij=jn(aR),Rj=jn(cR),Oj=jn(uR),lu=jn(Yh),qj=jn(Ej),Aj=e=>PL(qj(e),t=>t===!0),Ep=Symbol.for("effect/annotation/JSONIdentifier"),Pj=jn(Ep),Fj=e=>Gs(Pj(e),()=>vp(e)),xj=Symbol.for("effect/schema/ParseJson");class kp{constructor(t,n,r,s={}){d(this,"typeParameters");d(this,"decodeUnknown");d(this,"encodeUnknown");d(this,"annotations");d(this,"_tag","Declaration");this.typeParameters=t,this.decodeUnknown=n,this.encodeUnknown=r,this.annotations=s}toString(){return gt(Gr(this),()=>"<declaration schema>")}toJSON(){return{_tag:this._tag,typeParameters:this.typeParameters.map(t=>t.toJSON()),annotations:Jt(this.annotations)}}}const Ps=e=>t=>t._tag===e;let Xh=class{constructor(t,n={}){d(this,"literal");d(this,"annotations");d(this,"_tag","Literal");this.literal=t,this.annotations=n}toString(){return gt(Gr(this),()=>Cr(this.literal))}toJSON(){return{_tag:this._tag,literal:hp(this.literal)?String(this.literal):this.literal,annotations:Jt(this.annotations)}}};const wl=Ps("Literal"),Nj=new Xh(null);class mR{constructor(t,n={}){d(this,"symbol");d(this,"annotations");d(this,"_tag","UniqueSymbol");this.symbol=t,this.annotations=n}toString(){return gt(Gr(this),()=>Cr(this.symbol))}toJSON(){return{_tag:this._tag,symbol:String(this.symbol),annotations:Jt(this.annotations)}}}class Dj{constructor(t={}){d(this,"annotations");d(this,"_tag","UndefinedKeyword");this.annotations=t}toString(){return ui(this)}toJSON(){return{_tag:this._tag,annotations:Jt(this.annotations)}}}const Rc=new Dj({[As]:"undefined"});class Mj{constructor(t={}){d(this,"annotations");d(this,"_tag","VoidKeyword");this.annotations=t}toString(){return ui(this)}toJSON(){return{_tag:this._tag,annotations:Jt(this.annotations)}}}const Lj=new Mj({[As]:"void"});class jj{constructor(t={}){d(this,"annotations");d(this,"_tag","NeverKeyword");this.annotations=t}toString(){return ui(this)}toJSON(){return{_tag:this._tag,annotations:Jt(this.annotations)}}}const $p=new jj({[As]:"never"}),Uj=Ps("NeverKeyword");class zj{constructor(t={}){d(this,"annotations");d(this,"_tag","UnknownKeyword");this.annotations=t}toString(){return ui(this)}toJSON(){return{_tag:this._tag,annotations:Jt(this.annotations)}}}const pR=new zj({[As]:"unknown"});class Bj{constructor(t={}){d(this,"annotations");d(this,"_tag","AnyKeyword");this.annotations=t}toString(){return ui(this)}toJSON(){return{_tag:this._tag,annotations:Jt(this.annotations)}}}const gR=new Bj({[As]:"any"});class Hj{constructor(t={}){d(this,"annotations");d(this,"_tag","StringKeyword");this.annotations=t}toString(){return ui(this)}toJSON(){return{_tag:this._tag,annotations:Jt(this.annotations)}}}const Py=new Hj({[As]:"string",[Vf]:"a string"}),Fy=Ps("StringKeyword");class Vj{constructor(t={}){d(this,"annotations");d(this,"_tag","NumberKeyword");this.annotations=t}toString(){return ui(this)}toJSON(){return{_tag:this._tag,annotations:Jt(this.annotations)}}}const xy=new Vj({[As]:"number",[Vf]:"a number"}),tk=Ps("NumberKeyword");class Wj{constructor(t={}){d(this,"annotations");d(this,"_tag","BooleanKeyword");this.annotations=t}toString(){return ui(this)}toJSON(){return{_tag:this._tag,annotations:Jt(this.annotations)}}}const Ny=new Wj({[As]:"boolean",[Vf]:"a boolean"}),nk=Ps("BooleanKeyword"),_R=Ps("SymbolKeyword");let Kj=class{constructor(t,n={}){d(this,"enums");d(this,"annotations");d(this,"_tag","Enums");this.enums=t,this.annotations=n}toString(){return gt(Gr(this),()=>`<enum ${this.enums.length} value(s): ${this.enums.map(([t,n])=>JSON.stringify(n)).join(" | ")}>`)}toJSON(){return{_tag:this._tag,enums:this.enums,annotations:Jt(this.annotations)}}},Wf=class{constructor(t,n={}){d(this,"type");d(this,"annotations");this.type=t,this.annotations=n}toJSON(){return{type:this.type.toJSON(),annotations:Jt(this.annotations)}}toString(){return String(this.type)}};class ci extends Wf{constructor(n,r,s={}){super(n,s);d(this,"isOptional");this.isOptional=r}toJSON(){return{type:this.type.toJSON(),isOptional:this.isOptional,annotations:Jt(this.annotations)}}toString(){return String(this.type)+(this.isOptional?"?":"")}}const Cp=e=>e.map(t=>t.type);class Kf{constructor(t,n,r,s={}){d(this,"elements");d(this,"rest");d(this,"isReadonly");d(this,"annotations");d(this,"_tag","TupleType");this.elements=t,this.rest=n,this.isReadonly=r,this.annotations=s;let o=!1,a=!1;for(const u of t)if(u.isOptional)o=!0;else if(o){a=!0;break}if(a||o&&n.length>1)throw new Error(gj)}toString(){return gt(Gr(this),()=>Jj(this))}toJSON(){return{_tag:this._tag,elements:this.elements.map(t=>t.toJSON()),rest:this.rest.map(t=>t.toJSON()),isReadonly:this.isReadonly,annotations:Jt(this.annotations)}}}const Jj=e=>{const t=e.elements.map(String).join(", ");return HL(e.rest,{onEmpty:()=>`readonly [${t}]`,onNonEmpty:(n,r)=>{const s=String(n),o=s.includes(" | ")?`(${s})`:s;if(r.length>0){const a=r.map(String).join(", ");return e.elements.length>0?`readonly [${t}, ...${o}[], ${a}]`:`readonly [...${o}[], ${a}]`}else return e.elements.length>0?`readonly [${t}, ...${o}[]]`:`ReadonlyArray<${s}>`}})};class Pt extends ci{constructor(n,r,s,o,a){super(r,s,a);d(this,"name");d(this,"isReadonly");this.name=n,this.isReadonly=o}toString(){return(this.isReadonly?"readonly ":"")+String(this.name)+(this.isOptional?"?":"")+": "+this.type}toJSON(){return{name:String(this.name),type:this.type.toJSON(),isOptional:this.isOptional,isReadonly:this.isReadonly,annotations:Jt(this.annotations)}}}const yR=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return!0;case"Refinement":return yR(e.from)}return!1};class fu{constructor(t,n,r){d(this,"type");d(this,"isReadonly");d(this,"parameter");if(this.type=n,this.isReadonly=r,yR(t))this.parameter=t;else throw new Error(pj)}toString(){return(this.isReadonly?"readonly ":"")+`[x: ${this.parameter}]: ${this.type}`}toJSON(){return{parameter:this.parameter.toJSON(),type:this.type.toJSON(),isReadonly:this.isReadonly}}}class Tr{constructor(t,n,r={}){d(this,"annotations");d(this,"_tag","TypeLiteral");d(this,"propertySignatures");d(this,"indexSignatures");this.annotations=r;const s={};for(let a=0;a<t.length;a++){const u=t[a].name;if(Object.prototype.hasOwnProperty.call(s,u))throw new Error(Q1(u));s[u]=null}const o={string:!1,symbol:!1};for(let a=0;a<n.length;a++){const u=em(n[a].parameter);if(Fy(u)){if(o.string)throw new Error(Z0("string"));o.string=!0}else if(_R(u)){if(o.symbol)throw new Error(Z0("symbol"));o.symbol=!0}}this.propertySignatures=t,this.indexSignatures=n}toString(){return gt(Gr(this),()=>Gj(this))}toJSON(){return{_tag:this._tag,propertySignatures:this.propertySignatures.map(t=>t.toJSON()),indexSignatures:this.indexSignatures.map(t=>t.toJSON()),annotations:Jt(this.annotations)}}}const rk=e=>e.map(String).join("; "),Gj=e=>{if(e.propertySignatures.length>0){const t=e.propertySignatures.map(String).join("; ");return e.indexSignatures.length>0?`{ ${t}; ${rk(e.indexSignatures)} }`:`{ ${t} }`}else return e.indexSignatures.length>0?`{ ${rk(e.indexSignatures)} }`:"{}"},sk=Ps("TypeLiteral"),Qj=Ml(O1(Ic,e=>{switch(e._tag){case"AnyKeyword":return 0;case"UnknownKeyword":return 1;case"ObjectKeyword":return 2;case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":return 3}return 4})),Yj={string:"StringKeyword",number:"NumberKeyword",boolean:"BooleanKeyword",bigint:"BigIntKeyword"},bR=e=>Gh(e,t=>GS(t)?bR(t.types):[t]),Xj=e=>{const t=Qj(e),n=[],r={},s=[];for(const o of t)switch(o._tag){case"NeverKeyword":break;case"AnyKeyword":return[gR];case"UnknownKeyword":return[pR];case"ObjectKeyword":case"UndefinedKeyword":case"VoidKeyword":case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":{r[o._tag]||(r[o._tag]=o,n.push(o));break}case"Literal":{const a=typeof o.literal;switch(a){case"string":case"number":case"bigint":case"boolean":{const u=Yj[a];!r[u]&&!s.includes(o.literal)&&(s.push(o.literal),n.push(o));break}case"object":{s.includes(o.literal)||(s.push(o.literal),n.push(o));break}}break}case"UniqueSymbol":{!r.SymbolKeyword&&!s.includes(o.symbol)&&(s.push(o.symbol),n.push(o));break}case"TupleType":{r.ObjectKeyword||n.push(o);break}case"TypeLiteral":{o.propertySignatures.length===0&&o.indexSignatures.length===0?r["{}"]||(r["{}"]=o,n.push(o)):r.ObjectKeyword||n.push(o);break}default:n.push(o)}return n};var zs;let tn=(zs=class{constructor(t,n={}){d(this,"types");d(this,"annotations");d(this,"_tag","Union");this.types=t,this.annotations=n}toString(){return gt(Gr(this),()=>this.types.map(String).join(" | "))}toJSON(){return{_tag:this._tag,types:this.types.map(t=>t.toJSON()),annotations:Jt(this.annotations)}}},d(zs,"make",(t,n)=>JS(t)?new zs(t,n):t.length===1?t[0]:$p),d(zs,"unify",(t,n)=>zs.make(Xj(bR(t)),n)),zs);const Zj=(e,t)=>e.map(t),JS=e=>e.length>1,GS=Ps("Union"),U_=Ee(Symbol.for("effect/Schema/AST/toJSONMemoMap"),()=>new WeakMap);class ta{constructor(t,n={}){d(this,"f");d(this,"annotations");d(this,"_tag","Suspend");this.f=t,this.annotations=n,this.f=V1(t)}toString(){return Gr(this).pipe(Gs(()=>uu(CL(this.f)(),t=>Gr(t))),gt(()=>"<suspended schema>"))}toJSON(){const t=this.f();let n=U_.get(t);return n||(U_.set(t,{_tag:this._tag}),n={_tag:this._tag,ast:t.toJSON(),annotations:Jt(this.annotations)},U_.set(t,n),n)}}let Jf=class{constructor(t,n,r={}){d(this,"from");d(this,"filter");d(this,"annotations");d(this,"_tag","Refinement");this.from=t,this.filter=n,this.annotations=r}toString(){return vp(this).pipe(gt(()=>rt(CR(this),{onNone:()=>`{ ${this.from} | filter }`,onSome:t=>mc(this.from)?String(this.from)+" & "+t:t})))}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),annotations:Jt(this.annotations)}}};const mc=Ps("Refinement"),z_={};let vr=class{constructor(t,n,r,s={}){d(this,"from");d(this,"to");d(this,"transformation");d(this,"annotations");d(this,"_tag","Transformation");this.from=t,this.to=n,this.transformation=r,this.annotations=s}toString(){return gt(Gr(this),()=>`(${String(this.from)} <-> ${String(this.to)})`)}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),to:this.to.toJSON(),annotations:Jt(this.annotations)}}};const eU=Ps("Transformation");class SR{constructor(t,n){d(this,"decode");d(this,"encode");d(this,"_tag","FinalTransformation");this.decode=t,this.encode=n}}const tU=e=>t=>t._tag===e;class nU{constructor(){d(this,"_tag","ComposeTransformation")}}const QS=new nU;let rU=class{constructor(t,n,r,s){d(this,"from");d(this,"to");d(this,"decode");d(this,"encode");this.from=t,this.to=n,this.decode=r,this.encode=s}};const sU=e=>e.decode===ie&&e.encode===ie;class Zh{constructor(t){d(this,"propertySignatureTransformations");d(this,"_tag","TypeLiteralTransformation");this.propertySignatureTransformations=t;const n={},r={};for(const s of t){const o=s.from;if(n[o])throw new Error(ek(o));n[o]=!0;const a=s.to;if(r[a])throw new Error(ek(a));r[a]=!0}}}const Dy=tU("TypeLiteralTransformation"),na=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={...e.annotations,...t},s=lu(e);return ct(s)&&(r[Yh]=na(s.value,t)),n.annotations.value=r,Object.create(Object.getPrototypeOf(e),n)},oU="[\\s\\S]*",iU="[+-]?\\d*\\.?\\d+(?:[Ee][+-]?\\d+)?",wR=(e,t)=>{switch(e._tag){case"Literal":return Qh(String(e.literal));case"StringKeyword":return oU;case"NumberKeyword":return iU;case"TemplateLiteral":return vR(e);case"Union":return e.types.map(n=>wR(n)).join("|")}},aU=(e,t,n,r)=>GS(e)?`(${t})`:t,vR=(e,t,n)=>{let r="";if(e.head!==""){const s=Qh(e.head);r+=s}for(const s of e.spans){const o=wR(s.type);if(r+=aU(s.type,o),s.literal!==""){const a=Qh(s.literal);r+=a}}return r},ER=e=>new RegExp(`^${vR(e)}$`),yh=e=>{const t=lu(e);if(ct(t))return yh(t.value);switch(e._tag){case"TypeLiteral":return e.propertySignatures.slice();case"Suspend":return yh(e.f());case"Refinement":return yh(e.from)}return vi(e).map(n=>Ri(e,n))},bh=e=>{switch(e._tag){case"TupleType":{let t=!1,n=[];for(const r of e.elements)r.isOptional&&(t=!0),n.push(r.type);return t&&n.push(Rc),n=n.concat(Cp(e.rest)),tn.make(n)}case"Refinement":return bh(e.from);case"Union":return tn.make(e.types.map(bh));case"Suspend":return bh(e.f())}throw new Error(Ll(e))},kR=(e,t)=>{const n=ej(e.propertySignatures,r=>r.name===t);if(ct(n))return n.value;if(Tn(t)){let r;for(const s of e.indexSignatures){const o=em(s.parameter);switch(o._tag){case"TemplateLiteral":{if(ER(o).test(t))return new Pt(t,s.type,!1,!0);break}case"StringKeyword":r===void 0&&(r=new Pt(t,s.type,!1,!0))}}if(r)return r}else if(Bh(t))for(const r of e.indexSignatures){const s=em(r.parameter);if(_R(s))return new Pt(t,r.type,!1,!0)}},Ri=(e,t)=>{const n=lu(e);if(ct(n))return Ri(n.value,t);switch(e._tag){case"TypeLiteral":{const r=kR(e,t);if(r)return r;break}case"Union":return new Pt(t,tn.make(e.types.map(r=>Ri(r,t).type)),!1,!0);case"Suspend":return Ri(e.f(),t);case"Refinement":return Ri(e.from,t)}throw new Error(Ll(e))},vi=e=>{const t=lu(e);if(ct(t))return vi(t.value);switch(e._tag){case"TypeLiteral":return e.propertySignatures.map(n=>n.name);case"Union":return e.types.slice(1).reduce((n,r)=>cj(n,vi(r)),vi(e.types[0]));case"Suspend":return vi(e.f());case"Refinement":return vi(e.from);case"Transformation":return vi(e.to)}return[]},ok=(e,t)=>{const n=[],r=[],s=o=>{switch(o._tag){case"NeverKeyword":break;case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":case"Refinement":r.push(new fu(o,t,!0));break;case"Literal":if(Tn(o.literal)||oo(o.literal))n.push(new Pt(o.literal,t,!1,!0));else throw new Error(mj(o.literal));break;case"Enums":{for(const[a,u]of o.enums)n.push(new Pt(u,t,!1,!0));break}case"UniqueSymbol":n.push(new Pt(o.symbol,t,!1,!0));break;case"Union":o.types.forEach(s);break;default:throw new Error(hj(o))}};return s(e),{propertySignatures:n,indexSignatures:r}},Ls=(e,t)=>{const n=lu(e);if(ct(n))return Ls(n.value,t);switch(e._tag){case"TypeLiteral":{const r=[],s={};for(const o of e.propertySignatures)s[o.name]=null,t.includes(o.name)&&r.push(o);for(const o of t)if(!(o in s)){const a=kR(e,o);a&&r.push(a)}return new Tr(r,[])}case"Union":return new Tr(t.map(r=>Ri(e,r)),[]);case"Suspend":return Ls(e.f(),t);case"Refinement":return Ls(e.from,t);case"Transformation":switch(e.transformation._tag){case"ComposeTransformation":return new vr(Ls(e.from,t),Ls(e.to,t),QS);case"TypeLiteralTransformation":{const r=[],s=[];for(const o of t){const a=e.transformation.propertySignatureTransformations.find(u=>u.to===o);a?(r.push(a),s.push(a.from)):s.push(o)}return yt(r)?new vr(Ls(e.from,s),Ls(e.to,t),new Zh(r)):Ls(e.from,s)}}}throw new Error(Ll(e))},Sh=e=>tn.make([e,Rc]),il=(e,t)=>{switch(e._tag){case"TupleType":return new Kf(e.elements.map(n=>new ci(Sh(n.type),!0)),BL(e.rest,{onEmpty:()=>e.rest,onNonEmpty:n=>[new Wf(tn.make([...Cp(n),Rc]))]}),e.isReadonly);case"TypeLiteral":return new Tr(e.propertySignatures.map(n=>new Pt(n.name,Sh(n.type),!0,n.isReadonly,n.annotations)),e.indexSignatures.map(n=>new fu(n.parameter,Sh(n.type),n.isReadonly)));case"Union":return tn.make(e.types.map(n=>il(n)));case"Suspend":return new ta(()=>il(e.f()));case"Declaration":case"Refinement":throw new Error(Ll(e));case"Transformation":{if(Dy(e.transformation)&&e.transformation.propertySignatureTransformations.every(sU))return new vr(il(e.from),il(e.to),e.transformation);throw new Error(Ll(e))}}return e},Qa=e=>{switch(e._tag){case"TupleType":return e.isReadonly===!1?e:new Kf(e.elements,e.rest,!1,e.annotations);case"TypeLiteral":{const t=Fn(e.propertySignatures,r=>r.isReadonly===!1?r:new Pt(r.name,r.type,r.isOptional,!1,r.annotations)),n=Fn(e.indexSignatures,r=>r.isReadonly===!1?r:new fu(r.parameter,r.type,!1));return t===e.propertySignatures&&n===e.indexSignatures?e:new Tr(t,n,e.annotations)}case"Union":{const t=Fn(e.types,Qa);return t===e.types?e:tn.make(t,e.annotations)}case"Suspend":return new ta(()=>Qa(e.f()),e.annotations);case"Refinement":{const t=Qa(e.from);return t===e.from?e:new Jf(t,e.filter,e.annotations)}case"Transformation":{const t=Qa(e.from),n=Qa(e.to);return t===e.from&&n===e.to?e:new vr(t,n,e.transformation,e.annotations)}}return e},$R=e=>t=>{let n;for(const r of e)Object.prototype.hasOwnProperty.call(t.annotations,r)&&(n===void 0&&(n={}),n[r]=t.annotations[r]);return n},cU=e=>t=>{const n={...t.annotations};for(const r of e)delete n[r];return n},uU=$R([Z1,eR,tR,nR,rR,sR]),Ft=e=>{switch(e._tag){case"Declaration":{const t=Fn(e.typeParameters,Ft);return t===e.typeParameters?e:new kp(t,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{const t=Fn(e.elements,s=>{const o=Ft(s.type);return o===s.type?s:new ci(o,s.isOptional)}),n=Cp(e.rest),r=Fn(n,Ft);return t===e.elements&&r===n?e:new Kf(t,r.map(s=>new Wf(s)),e.isReadonly,e.annotations)}case"TypeLiteral":{const t=Fn(e.propertySignatures,r=>{const s=Ft(r.type);return s===r.type?r:new Pt(r.name,s,r.isOptional,r.isReadonly)}),n=Fn(e.indexSignatures,r=>{const s=Ft(r.type);return s===r.type?r:new fu(r.parameter,s,r.isReadonly)});return t===e.propertySignatures&&n===e.indexSignatures?e:new Tr(t,n,e.annotations)}case"Union":{const t=Fn(e.types,Ft);return t===e.types?e:tn.make(t,e.annotations)}case"Suspend":return new ta(()=>Ft(e.f()),e.annotations);case"Refinement":{const t=Ft(e.from);return t===e.from?e:new Jf(t,e.filter,e.annotations)}case"Transformation":{const t=uU(e);return Ft(t!==void 0?na(e.to,t):e.to)}}return e},Ha=e=>rt(Fj(e),{onNone:()=>{},onSome:t=>({[Ep]:t})});function Fn(e,t){let n=!1;const r=Sp(e.length);for(let s=0;s<e.length;s++){const o=e[s],a=t(o);a!==o&&(n=!0),r[s]=a}return n?r:e}const rs=(e,t)=>{switch(e._tag){case"Declaration":{const n=Fn(e.typeParameters,r=>rs(r));return n===e.typeParameters?e:new kp(n,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{const n=Fn(e.elements,o=>{const a=rs(o.type);return a===o.type?o:new ci(a,o.isOptional)}),r=Cp(e.rest),s=Fn(r,o=>rs(o));return n===e.elements&&s===r?e:new Kf(n,s.map(o=>new Wf(o)),e.isReadonly,Ha(e))}case"TypeLiteral":{const n=Fn(e.propertySignatures,s=>{const o=rs(s.type);return o===s.type?s:new Pt(s.name,o,s.isOptional,s.isReadonly)}),r=Fn(e.indexSignatures,s=>{const o=rs(s.type);return o===s.type?s:new fu(s.parameter,o,s.isReadonly)});return n===e.propertySignatures&&r===e.indexSignatures?e:new Tr(n,r,Ha(e))}case"Union":{const n=Fn(e.types,r=>rs(r));return n===e.types?e:tn.make(n,Ha(e))}case"Suspend":return new ta(()=>rs(e.f()),Ha(e));case"Refinement":{const n=rs(e.from),r=Ha(e);return r?na(n,r):n}case"Transformation":{const n=Ha(e);return rs(n?na(e.from,n):e.from)}}return e},My=e=>rs(e),Jt=e=>{const t={};for(const n of Object.getOwnPropertySymbols(e))t[String(n)]=e[n];return t},em=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return e;case"Refinement":return em(e.from)}},lU=(e,t)=>new vr(e,t,QS),ui=e=>gt(Gr(e),()=>e._tag);function fU(e){return rt(lR(e),{onNone:()=>"",onSome:t=>t.map(n=>` & Brand<${Cr(n)}>`).join("")})}const CR=e=>fR(e).pipe(Gs(()=>hR(e)),Gs(()=>dR(e)),Wo(t=>t+fU(e))),Gr=e=>Gs(vp(e),()=>CR(e)),dU=(e,t,n)=>{switch(e._tag){case"UndefinedKeyword":return $p;case"Union":{const r=[];let s=!1;for(const o of e.types){const a=t(o);a?(s=!0,Uj(a)||r.push(a)):r.push(o)}if(s)return tn.make(r);break}case"Suspend":return t(e.f());case"Transformation":return n(e)}},ik=Symbol.for("effect/Brand/Refined"),TR=()=>Object.assign(e=>e,{[ik]:ik,option:e=>W(e),either:e=>ce(e),is:e=>!0}),IR=Symbol.for("effect/Context/Tag"),tm=Symbol.for("effect/Context/Reference"),hU="effect/STM",mU=Symbol.for(hU),YS={...zf,_op:"Tag",[mU]:Xi,[IR]:{_Service:e=>e,_Identifier:e=>e},toString(){return lt(this.toJSON())},toJSON(){return{_id:"Tag",key:this.key,stack:this.stack}},[Ue](){return this.toJSON()},of(e){return e},context(e){return qR(this,e)}},pU={...YS,[tm]:tm},gU=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=t;const r=Object.create(YS);return Object.defineProperty(r,"stack",{get(){return n.stack}}),r.key=e,r},_U=e=>()=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=t;function r(){}return Object.setPrototypeOf(r,YS),r.key=e,Object.defineProperty(r,"stack",{get(){return n.stack}}),r},yU=()=>(e,t)=>{const n=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;Error.stackTraceLimit=n;function s(){}return Object.setPrototypeOf(s,pU),s.key=e,s.defaultValue=t.defaultValue,Object.defineProperty(s,"stack",{get(){return r.stack}}),s},RR=Symbol.for("effect/Context"),bU={[RR]:{_Services:e=>e},[ge](e){if(OR(e)&&this.unsafeMap.size===e.unsafeMap.size){for(const t of this.unsafeMap.keys())if(!e.unsafeMap.has(t)||!de(this.unsafeMap.get(t),e.unsafeMap.get(t)))return!1;return!0}return!1},[pe](){return it(this,xS(this.unsafeMap.size))},pipe(){return Z(this,arguments)},toString(){return lt(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(It)}},[Ue](){return this.toJSON()}},ra=e=>{const t=Object.create(bU);return t.unsafeMap=e,t},SU=e=>{const t=new Error(`Service not found${e.key?`: ${String(e.key)}`:""}`);if(e.stack){const n=e.stack.split(`
`);if(n.length>2){const r=n[2].match(/at (.*)/);r&&(t.message=t.message+` (defined at ${r[1]})`)}}if(t.stack){const n=t.stack.split(`
`);n.splice(1,3),t.stack=n.join(`
`)}return t},OR=e=>ne(e,RR),wU=e=>ne(e,IR),vU=e=>ne(e,tm),EU=ra(new Map),kU=()=>EU,qR=(e,t)=>ra(new Map([[e.key,t]])),$U=y(3,(e,t,n)=>{const r=new Map(e.unsafeMap);return r.set(t.key,n),ra(r)}),B_=Ee("effect/Context/defaultValueCache",()=>new Map),XS=e=>{if(B_.has(e.key))return B_.get(e.key);const t=e.defaultValue();return B_.set(e.key,t),t},CU=(e,t)=>e.unsafeMap.has(t.key)?e.unsafeMap.get(t.key):XS(t),AR=y(2,(e,t)=>{if(!e.unsafeMap.has(t.key)){if(tm in t)return XS(t);throw SU(t)}return e.unsafeMap.get(t.key)}),TU=AR,IU=y(2,(e,t)=>e.unsafeMap.has(t.key)?Ay(e.unsafeMap.get(t.key)):vU(t)?Ay(XS(t)):v1),RU=y(2,(e,t)=>{const n=new Map(e.unsafeMap);for(const[r,s]of t.unsafeMap)n.set(r,s);return ra(n)}),OU=(...e)=>t=>{const n=new Map(t.unsafeMap);for(const r of e)n.delete(r.key);return ra(n)},Yn=gU,qU=OR,Tp=wU,io=kU,Gf=qR,ls=$U,Vn=TU,Ip=AR,Or=IU,Eo=RU,AU=OU,ZS=_U,du=yU,PR=Symbol.for("effect/Chunk");function PU(e,t,n,r,s){for(let o=t;o<Math.min(e.length,t+s);o++)n[r+o-t]=e[o];return n}const FR=[],FU=e=>Lf((t,n)=>t.length===n.length&&ar(t).every((r,s)=>e(r,Ys(n,s)))),xU=FU(de),NU={[PR]:{_A:e=>e},toString(){return lt(this.toJSON())},toJSON(){return{_id:"Chunk",values:ar(this).map(It)}},[Ue](){return this.toJSON()},[ge](e){return Li(e)&&xU(this,e)},[pe](){return it(this,jf(ar(this)))},[Symbol.iterator](){switch(this.backing._tag){case"IArray":return this.backing.array[Symbol.iterator]();case"IEmpty":return FR[Symbol.iterator]();default:return ar(this)[Symbol.iterator]()}},pipe(){return Z(this,arguments)}},Lt=e=>{const t=Object.create(NU);switch(t.backing=e,e._tag){case"IEmpty":{t.length=0,t.depth=0,t.left=t,t.right=t;break}case"IConcat":{t.length=e.left.length+e.right.length,t.depth=1+Math.max(e.left.depth,e.right.depth),t.left=e.left,t.right=e.right;break}case"IArray":{t.length=e.array.length,t.depth=0,t.left=zr,t.right=zr;break}case"ISingleton":{t.length=1,t.depth=0,t.left=zr,t.right=zr;break}case"ISlice":{t.length=e.length,t.depth=e.chunk.depth+1,t.left=zr,t.right=zr;break}}return t},Li=e=>ne(e,PR),zr=Lt({_tag:"IEmpty"}),_t=()=>zr,H_=(...e)=>LU(e),ut=e=>Lt({_tag:"ISingleton",a:e}),ao=e=>Li(e)?e:jt(je(e)),Ly=(e,t,n)=>{switch(e.backing._tag){case"IArray":{PU(e.backing.array,0,t,n,e.length);break}case"IConcat":{Ly(e.left,t,n),Ly(e.right,t,n+e.left.length);break}case"ISingleton":{t[n]=e.backing.a;break}case"ISlice":{let r=0,s=n;for(;r<e.length;)t[s]=Ys(e,r),r+=1,s+=1;break}}},DU=e=>{switch(e.backing._tag){case"IEmpty":return FR;case"IArray":return e.backing.array;default:{const t=new Array(e.length);return Ly(e,t,0),e.backing={_tag:"IArray",array:t},e.left=zr,e.right=zr,e.depth=0,t}}},ar=DU,MU=e=>{switch(e.backing._tag){case"IEmpty":case"ISingleton":return e;case"IArray":return Lt({_tag:"IArray",array:G0(e.backing.array)});case"IConcat":return Lt({_tag:"IConcat",left:co(e.backing.right),right:co(e.backing.left)});case"ISlice":return jt(G0(ar(e)))}},co=MU,xR=y(2,(e,t)=>t<0||t>=e.length?V():W(Ys(e,t))),jt=e=>e.length===0?_t():e.length===1?ut(e[0]):Lt({_tag:"IArray",array:e}),LU=e=>jt(e),Ys=y(2,(e,t)=>{switch(e.backing._tag){case"IEmpty":throw new Error("Index out of bounds");case"ISingleton":{if(t!==0)throw new Error("Index out of bounds");return e.backing.a}case"IArray":{if(t>=e.length||t<0)throw new Error("Index out of bounds");return e.backing.array[t]}case"IConcat":return t<e.left.length?Ys(e.left,t):Ys(e.right,t-e.left.length);case"ISlice":return Ys(e.backing.chunk,t+e.backing.offset)}}),jl=y(2,(e,t)=>Tt(e,ut(t))),wn=y(2,(e,t)=>Tt(ut(t),e)),Oc=y(2,(e,t)=>{if(t<=0)return zr;if(t>=e.length)return e;switch(e.backing._tag){case"ISlice":return Lt({_tag:"ISlice",chunk:e.backing.chunk,length:t,offset:e.backing.offset});case"IConcat":return t>e.left.length?Lt({_tag:"IConcat",left:e.left,right:Oc(e.right,t-e.left.length)}):Oc(e.left,t);default:return Lt({_tag:"ISlice",chunk:e,offset:0,length:t})}}),Bs=y(2,(e,t)=>{if(t<=0)return e;if(t>=e.length)return zr;switch(e.backing._tag){case"ISlice":return Lt({_tag:"ISlice",chunk:e.backing.chunk,offset:e.backing.offset+t,length:e.backing.length-t});case"IConcat":return t>e.left.length?Bs(e.right,t-e.left.length):Lt({_tag:"IConcat",left:Bs(e.left,t),right:e.right});default:return Lt({_tag:"ISlice",chunk:e,offset:t,length:e.length-t})}}),Tt=y(2,(e,t)=>{if(e.backing._tag==="IEmpty")return t;if(t.backing._tag==="IEmpty")return e;const n=t.depth-e.depth;if(Math.abs(n)<=1)return Lt({_tag:"IConcat",left:e,right:t});if(n<-1)if(e.left.depth>=e.right.depth){const r=Tt(e.right,t);return Lt({_tag:"IConcat",left:e.left,right:r})}else{const r=Tt(e.right.right,t);if(r.depth===e.depth-3){const s=Lt({_tag:"IConcat",left:e.right.left,right:r});return Lt({_tag:"IConcat",left:e.left,right:s})}else{const s=Lt({_tag:"IConcat",left:e.left,right:e.right.left});return Lt({_tag:"IConcat",left:s,right:r})}}else if(t.right.depth>=t.left.depth){const r=Tt(e,t.left);return Lt({_tag:"IConcat",left:r,right:t.right})}else{const r=Tt(e,t.left.left);if(r.depth===t.depth-3){const s=Lt({_tag:"IConcat",left:r,right:t.left.right});return Lt({_tag:"IConcat",left:s,right:t.right})}else{const s=Lt({_tag:"IConcat",left:t.left.right,right:t.right});return Lt({_tag:"IConcat",left:r,right:s})}}}),NR=y(2,(e,t)=>jt(U1(e,t))),Rp=y(2,(e,t)=>jt(z1(e,t))),Qf=e=>e.length===0,uo=e=>e.length>0,Op=xR(0),qp=e=>Ys(e,0),hs=qp,jU=e=>xR(e,e.length-1),Va=e=>Ys(e,e.length-1),sc=y(2,(e,t)=>e.backing._tag==="ISingleton"?ut(t(e.backing.a,0)):jt(v(ar(e),Qs((n,r)=>t(n,r))))),DR=y(2,(e,t)=>[Oc(e,t),Bs(e,t)]),UU=y(2,(e,t)=>{let n=0;for(const r of ar(e)){if(t(r))break;n++}return DR(e,n)}),Hs=e=>Bs(e,1),zU=y(2,(e,t)=>Bs(e,e.length-t)),BU=HS,jy=Symbol.for("effect/Duration"),MR=BigInt(0),ak=BigInt(24),Kd=BigInt(60),Uy=BigInt(1e3),ck=BigInt(1e6),uk=BigInt(1e9),HU=/^(-?\d+(?:\.\d+)?)\s+(nanos?|micros?|millis?|seconds?|minutes?|hours?|days?|weeks?)$/,fr=e=>{if(ew(e))return e;if(oo(e))return sa(e);if(hp(e))return wh(e);if(Array.isArray(e)&&e.length===2&&e.every(oo))return e[0]===-1/0||e[1]===-1/0||Number.isNaN(e[0])||Number.isNaN(e[1])?LR:e[0]===1/0||e[1]===1/0?jR:wh(BigInt(Math.round(e[0]*1e9))+BigInt(Math.round(e[1])));if(Tn(e)){const t=HU.exec(e);if(t){const[n,r,s]=t,o=Number(r);switch(s){case"nano":case"nanos":return wh(BigInt(r));case"micro":case"micros":return JU(BigInt(r));case"milli":case"millis":return sa(o);case"second":case"seconds":return tw(o);case"minute":case"minutes":return UR(o);case"hour":case"hours":return GU(o);case"day":case"days":return QU(o);case"week":case"weeks":return YU(o)}}}throw new Error("Invalid DurationInput")},lk={_tag:"Millis",millis:0},VU={_tag:"Infinity"},WU={[jy]:jy,[pe](){return it(this,h1(this.value))},[ge](e){return ew(e)&&sz(this,e)},toString(){return`Duration(${HR(this)})`},toJSON(){switch(this.value._tag){case"Millis":return{_id:"Duration",_tag:"Millis",millis:this.value.millis};case"Nanos":return{_id:"Duration",_tag:"Nanos",hrtime:ZU(this)};case"Infinity":return{_id:"Duration",_tag:"Infinity"}}},[Ue](){return this.toJSON()},pipe(){return Z(this,arguments)}},Kn=e=>{const t=Object.create(WU);return oo(e)?isNaN(e)||e<=0?t.value=lk:Number.isFinite(e)?Number.isInteger(e)?t.value={_tag:"Millis",millis:e}:t.value={_tag:"Nanos",nanos:BigInt(Math.round(e*1e6))}:t.value=VU:e<=MR?t.value=lk:t.value={_tag:"Nanos",nanos:e},t},ew=e=>ne(e,jy),KU=e=>{switch(e.value._tag){case"Millis":return e.value.millis===0;case"Nanos":return e.value.nanos===MR;case"Infinity":return!1}},LR=Kn(0),jR=Kn(1/0),wh=e=>Kn(e),JU=e=>Kn(e*Uy),sa=e=>Kn(e),tw=e=>Kn(e*1e3),UR=e=>Kn(e*6e4),GU=e=>Kn(e*36e5),QU=e=>Kn(e*864e5),YU=e=>Kn(e*6048e5),qc=e=>zR(e,{onMillis:t=>t,onNanos:t=>Number(t)/1e6}),XU=e=>{const t=fr(e);switch(t.value._tag){case"Infinity":throw new Error("Cannot convert infinite duration to nanos");case"Nanos":return t.value.nanos;case"Millis":return BigInt(Math.round(t.value.millis*1e6))}},ZU=e=>{const t=fr(e);switch(t.value._tag){case"Infinity":return[1/0,0];case"Nanos":return[Number(t.value.nanos/uk),Number(t.value.nanos%uk)];case"Millis":return[Math.floor(t.value.millis/1e3),Math.round(t.value.millis%1e3*1e6)]}},zR=y(2,(e,t)=>{const n=fr(e);switch(n.value._tag){case"Nanos":return t.onNanos(n.value.nanos);case"Infinity":return t.onMillis(1/0);case"Millis":return t.onMillis(n.value.millis)}}),Ap=y(3,(e,t,n)=>{const r=fr(e),s=fr(t);if(r.value._tag==="Infinity"||s.value._tag==="Infinity")return n.onMillis(qc(r),qc(s));if(r.value._tag==="Nanos"||s.value._tag==="Nanos"){const o=r.value._tag==="Nanos"?r.value.nanos:BigInt(Math.round(r.value.millis*1e6)),a=s.value._tag==="Nanos"?s.value.nanos:BigInt(Math.round(s.value.millis*1e6));return n.onNanos(o,a)}return n.onMillis(r.value.millis,s.value.millis)}),BR=(e,t)=>Ap(e,t,{onMillis:(n,r)=>n===r,onNanos:(n,r)=>n===r}),ez=y(2,(e,t)=>zR(e,{onMillis:n=>Kn(n*t),onNanos:n=>Kn(n*BigInt(t))})),tz=y(2,(e,t)=>Ap(e,t,{onMillis:(n,r)=>Kn(n+r),onNanos:(n,r)=>Kn(n+r)})),nz=y(2,(e,t)=>Ap(e,t,{onMillis:(n,r)=>n<=r,onNanos:(n,r)=>n<=r})),rz=y(2,(e,t)=>Ap(e,t,{onMillis:(n,r)=>n>=r,onNanos:(n,r)=>n>=r})),sz=y(2,(e,t)=>BR(fr(e),fr(t))),oz=e=>{const t=fr(e);if(t.value._tag==="Infinity")return{days:1/0,hours:1/0,minutes:1/0,seconds:1/0,millis:1/0,nanos:1/0};const n=XU(t),r=n/ck,s=r/Uy,o=s/Kd,a=o/Kd,u=a/ak;return{days:Number(u),hours:Number(a%ak),minutes:Number(o%Kd),seconds:Number(s%Kd),millis:Number(r%Uy),nanos:Number(n%ck)}},HR=e=>{const t=fr(e);if(t.value._tag==="Infinity")return"Infinity";if(KU(t))return"0";const n=oz(t),r=[];return n.days!==0&&r.push(`${n.days}d`),n.hours!==0&&r.push(`${n.hours}h`),n.minutes!==0&&r.push(`${n.minutes}m`),n.seconds!==0&&r.push(`${n.seconds}s`),n.millis!==0&&r.push(`${n.millis}ms`),n.nanos!==0&&r.push(`${n.nanos}ns`),r.join(" ")},oa=5,nw=Math.pow(2,oa),iz=nw-1,az=nw/2,cz=nw/4;function uz(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function Ac(e,t){return t>>>e&iz}function oc(e){return 1<<e}function VR(e,t){return uz(e&t-1)}const lz=(e,t)=>({value:e,previous:t});function pc(e,t,n,r){let s=r;if(!e){const o=r.length;s=new Array(o);for(let a=0;a<o;++a)s[a]=r[a]}return s[t]=n,s}function WR(e,t,n){const r=n.length-1;let s=0,o=0,a=n;if(e)s=o=t;else for(a=new Array(r);s<t;)a[o++]=n[s++];for(++s;s<=r;)a[o++]=n[s++];return e&&(a.length=r),a}function fz(e,t,n,r){const s=r.length;if(e){let f=s;for(;f>=t;)r[f--]=r[f];return r[t]=n,r}let o=0,a=0;const u=new Array(s+1);for(;o<t;)u[a++]=r[o++];for(u[t]=n;o<s;)u[++a]=r[o++];return u}class Zo{constructor(){d(this,"_tag","EmptyNode")}modify(t,n,r,s,o,a){const u=r(V());return At(u)?new Zo:(++a.value,new ji(t,s,o,u))}}function Vr(e){return mp(e,"EmptyNode")}function dz(e){return Vr(e)||e._tag==="LeafNode"||e._tag==="CollisionNode"}function Pp(e,t){return Vr(e)?!1:t===e.edit}class ji{constructor(t,n,r,s){d(this,"edit");d(this,"hash");d(this,"key");d(this,"value");d(this,"_tag","LeafNode");this.edit=t,this.hash=n,this.key=r,this.value=s}modify(t,n,r,s,o,a){if(de(o,this.key)){const f=r(this.value);return f===this.value?this:At(f)?(--a.value,new Zo):Pp(this,t)?(this.value=f,this):new ji(t,s,o,f)}const u=r(V());return At(u)?this:(++a.value,KR(t,n,this.hash,this,s,new ji(t,s,o,u)))}}class rw{constructor(t,n,r){d(this,"edit");d(this,"hash");d(this,"children");d(this,"_tag","CollisionNode");this.edit=t,this.hash=n,this.children=r}modify(t,n,r,s,o,a){if(s===this.hash){const f=Pp(this,t),h=this.updateCollisionList(f,t,this.hash,this.children,r,o,a);return h===this.children?this:h.length>1?new rw(t,this.hash,h):h[0]}const u=r(V());return At(u)?this:(++a.value,KR(t,n,this.hash,this,s,new ji(t,s,o,u)))}updateCollisionList(t,n,r,s,o,a,u){const f=s.length;for(let p=0;p<f;++p){const g=s[p];if("key"in g&&de(a,g.key)){const k=g.value,T=o(k);return T===k?s:At(T)?(--u.value,WR(t,p,s)):pc(t,p,new ji(n,r,a,T),s)}}const h=o(V());return At(h)?s:(++u.value,pc(t,f,new ji(n,r,a,h),s))}}class Pc{constructor(t,n,r){d(this,"edit");d(this,"mask");d(this,"children");d(this,"_tag","IndexedNode");this.edit=t,this.mask=n,this.children=r}modify(t,n,r,s,o,a){const u=this.mask,f=this.children,h=Ac(n,s),p=oc(h),g=VR(u,p),k=u&p,T=Pp(this,t);if(!k){const _=new Zo().modify(t,n+oa,r,s,o,a);return _?f.length>=az?mz(t,h,_,u,f):new Pc(t,u|p,fz(T,g,_,f)):this}const O=f[g],D=O.modify(t,n+oa,r,s,o,a);if(O===D)return this;let E=u,S;if(Vr(D)){if(E&=~p,!E)return new Zo;if(f.length<=2&&dz(f[g^1]))return f[g^1];S=WR(T,g,f)}else S=pc(T,g,D,f);return T?(this.mask=E,this.children=S,this):new Pc(t,E,S)}}class sw{constructor(t,n,r){d(this,"edit");d(this,"size");d(this,"children");d(this,"_tag","ArrayNode");this.edit=t,this.size=n,this.children=r}modify(t,n,r,s,o,a){let u=this.size;const f=this.children,h=Ac(n,s),p=f[h],g=(p||new Zo).modify(t,n+oa,r,s,o,a);if(p===g)return this;const k=Pp(this,t);let T;if(Vr(p)&&!Vr(g))++u,T=pc(k,h,g,f);else if(!Vr(p)&&Vr(g)){if(--u,u<=cz)return hz(t,u,h,f);T=pc(k,h,new Zo,f)}else T=pc(k,h,g,f);return k?(this.size=u,this.children=T,this):new sw(t,u,T)}}function hz(e,t,n,r){const s=new Array(t-1);let o=0,a=0;for(let u=0,f=r.length;u<f;++u)if(u!==n){const h=r[u];h&&!Vr(h)&&(s[o++]=h,a|=1<<u)}return new Pc(e,a,s)}function mz(e,t,n,r,s){const o=[];let a=r,u=0;for(let f=0;a;++f)a&1&&(o[f]=s[u++]),a>>>=1;return o[t]=n,new sw(e,u+1,o)}function pz(e,t,n,r,s,o){if(n===s)return new rw(e,n,[o,r]);const a=Ac(t,n),u=Ac(t,s);if(a===u)return f=>new Pc(e,oc(a)|oc(u),[f]);{const f=a<u?[r,o]:[o,r];return new Pc(e,oc(a)|oc(u),f)}}function KR(e,t,n,r,s,o){let a,u=t;for(;;){const f=pz(e,u,n,r,s,o);if(typeof f=="function")a=lz(f,a),u=u+oa;else{let h=f;for(;a!=null;)h=a.value(h),a=a.previous;return h}}}const JR="effect/HashMap",zy=Symbol.for(JR),gz={[zy]:zy,[Symbol.iterator](){return new Fp(this,(e,t)=>[e,t])},[pe](){let e=Q(JR);for(const t of this)e^=v(Q(t[0]),ue(Q(t[1])));return it(this,e)},[ge](e){if(bz(e)){if(e._size!==this._size)return!1;for(const t of this){const n=v(e,iw(t[0],Q(t[0])));if(At(n))return!1;if(!de(t[1],n.value))return!1}return!0}return!1},toString(){return lt(this.toJSON())},toJSON(){return{_id:"HashMap",values:Array.from(this).map(It)}},[Ue](){return this.toJSON()},pipe(){return Z(this,arguments)}},ow=(e,t,n,r)=>{const s=Object.create(gz);return s._editable=e,s._edit=t,s._root=n,s._size=r,s};class Fp{constructor(t,n){d(this,"map");d(this,"f");d(this,"v");this.map=t,this.f=n,this.v=GR(this.map._root,this.f,void 0)}next(){if(At(this.v))return{done:!0,value:void 0};const t=this.v.value;return this.v=nm(t.cont),{done:!1,value:t.value}}[Symbol.iterator](){return new Fp(this.map,this.f)}}const nm=e=>e?QR(e[0],e[1],e[2],e[3],e[4]):V(),GR=(e,t,n=void 0)=>{switch(e._tag){case"LeafNode":return ct(e.value)?W({value:t(e.key,e.value.value),cont:n}):nm(n);case"CollisionNode":case"ArrayNode":case"IndexedNode":{const r=e.children;return QR(r.length,r,0,t,n)}default:return nm(n)}},QR=(e,t,n,r,s)=>{for(;n<e;){const o=t[n++];if(o&&!Vr(o))return GR(o,r,[e,t,n,r,s])}return nm(s)},_z=ow(!1,0,new Zo,0),xp=()=>_z,yz=e=>{const t=XR(xp());for(const n of e)Ul(t,n[0],n[1]);return kz(t)},bz=e=>ne(e,zy),Sz=e=>e&&Vr(e._root),wz=y(2,(e,t)=>iw(e,t,Q(t))),iw=y(3,(e,t,n)=>{let r=e._root,s=0;for(;;)switch(r._tag){case"LeafNode":return de(t,r.key)?r.value:V();case"CollisionNode":{if(n===r.hash){const o=r.children;for(let a=0,u=o.length;a<u;++a){const f=o[a];if("key"in f&&de(t,f.key))return f.value}}return V()}case"IndexedNode":{const o=Ac(s,n),a=oc(o);if(r.mask&a){r=r.children[VR(r.mask,a)],s+=oa;break}return V()}case"ArrayNode":{if(r=r.children[Ac(s,n)],r){s+=oa;break}return V()}default:return V()}}),vz=y(2,(e,t)=>ct(iw(e,t,Q(t)))),Ul=y(3,(e,t,n)=>aw(e,t,()=>W(n))),Ez=y(3,(e,t,n)=>e._editable?(e._root=t,e._size=n,e):t===e._root?e:ow(e._editable,e._edit,t,n)),YR=e=>new Fp(e,t=>t),rm=e=>e._size,XR=e=>ow(!0,e._edit+1,e._root,e._size),kz=e=>(e._editable=!1,e),aw=y(3,(e,t,n)=>$z(e,t,Q(t),n)),$z=y(4,(e,t,n,r)=>{const s={value:e._size},o=e._root.modify(e._editable?e._edit:NaN,0,r,n,t,s);return v(e,Ez(o,s.value))}),fk=y(2,(e,t)=>aw(e,t,V)),Cz=y(2,(e,t)=>Np(e,xp(),(n,r,s)=>Ul(n,s,t(r,s)))),ZR=y(2,(e,t)=>Np(e,void 0,(n,r,s)=>t(r,s))),Np=y(3,(e,t,n)=>{const r=e._root;if(r._tag==="LeafNode")return ct(r.value)?n(t,r.value.value,r.key):t;if(r._tag==="EmptyNode")return t;const s=[r.children];let o;for(;o=s.pop();)for(let a=0,u=o.length;a<u;){const f=o[a++];f&&!Vr(f)&&(f._tag==="LeafNode"?ct(f.value)&&(t=n(t,f.value.value,f.key)):s.push(f.children))}return t}),eO="effect/HashSet",By=Symbol.for(eO),Tz={[By]:By,[Symbol.iterator](){return YR(this._keyMap)},[pe](){return it(this,ue(Q(this._keyMap))(Q(eO)))},[ge](e){return Iz(e)?rm(this._keyMap)===rm(e._keyMap)&&de(this._keyMap,e._keyMap):!1},toString(){return lt(this.toJSON())},toJSON(){return{_id:"HashSet",values:Array.from(this).map(It)}},[Ue](){return this.toJSON()},pipe(){return Z(this,arguments)}},Dp=e=>{const t=Object.create(Tz);return t._keyMap=e,t},Iz=e=>ne(e,By),Rz=Dp(xp()),Mp=()=>Rz,Oz=e=>{const t=cw(Mp());for(const n of e)zl(t,n);return uw(t)},qz=(...e)=>{const t=cw(Mp());for(const n of e)zl(t,n);return uw(t)},Az=y(2,(e,t)=>vz(e._keyMap,t)),Pz=e=>rm(e._keyMap),cw=e=>Dp(XR(e._keyMap)),uw=e=>(e._keyMap._editable=!1,e),tO=y(2,(e,t)=>{const n=cw(e);return t(n),uw(n)}),zl=y(2,(e,t)=>e._keyMap._editable?(Ul(t,!0)(e._keyMap),e):Dp(Ul(t,!0)(e._keyMap))),nO=y(2,(e,t)=>e._keyMap._editable?(fk(t)(e._keyMap),e):Dp(fk(t)(e._keyMap))),Fz=y(2,(e,t)=>tO(e,n=>{for(const r of t)nO(n,r)})),xz=y(2,(e,t)=>tO(Mp(),n=>{Nz(e,r=>zl(n,r));for(const r of t)zl(n,r)})),Nz=y(2,(e,t)=>ZR(e._keyMap,(n,r)=>t(r))),Dz=y(3,(e,t,n)=>Np(e._keyMap,t,(r,s,o)=>n(r,o))),ia=Mp,Mz=Oz,Lp=qz,jp=Az,lw=Pz,gc=zl,fw=nO,dk=Fz,Bl=xz,Hl=Dz,hk=Symbol.for("effect/MutableRef"),Lz={[hk]:hk,toString(){return lt(this.toJSON())},toJSON(){return{_id:"MutableRef",current:It(this.current)}},[Ue](){return this.toJSON()},pipe(){return Z(this,arguments)}},Ea=e=>{const t=Object.create(Lz);return t.current=e,t},jz=y(3,(e,t,n)=>de(t,e.current)?(e.current=n,!0):!1),ze=e=>e.current,ka=y(2,(e,t)=>(e.current=t,e)),Up="effect/FiberId",aa=Symbol.for(Up),Fc="None",Hy="Runtime",Vy="Composite",Uz=$t(`${Up}-${Fc}`);var dT;let zz=class{constructor(){d(this,dT,aa);d(this,"_tag",Fc);d(this,"id",-1);d(this,"startTimeMillis",-1)}[(dT=aa,pe)](){return Uz}[ge](t){return hw(t)&&t._tag===Fc}toString(){return lt(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag}}[Ue](){return this.toJSON()}};var hT;class dw{constructor(t,n){d(this,"id");d(this,"startTimeMillis");d(this,hT,aa);d(this,"_tag",Hy);this.id=t,this.startTimeMillis=n}[(hT=aa,pe)](){return it(this,$t(`${Up}-${this._tag}-${this.id}-${this.startTimeMillis}`))}[ge](t){return hw(t)&&t._tag===Hy&&this.id===t.id&&this.startTimeMillis===t.startTimeMillis}toString(){return lt(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,id:this.id,startTimeMillis:this.startTimeMillis}}[Ue](){return this.toJSON()}}var mT;let rO=class{constructor(t,n){d(this,"left");d(this,"right");d(this,mT,aa);d(this,"_tag",Vy);d(this,"_hash");this.left=t,this.right=n}[(mT=aa,pe)](){return v($t(`${Up}-${this._tag}`),ue(Q(this.left)),ue(Q(this.right)),it(this))}[ge](t){return hw(t)&&t._tag===Vy&&de(this.left,t.left)&&de(this.right,t.right)}toString(){return lt(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,left:It(this.left),right:It(this.right)}}[Ue](){return this.toJSON()}};const sO=new zz,Bz=(e,t)=>new dw(e,t),Hz=(e,t)=>new rO(e,t),hw=e=>ne(e,aa),oO=y(2,(e,t)=>e._tag===Fc?t:t._tag===Fc?e:new rO(e,t)),Vz=e=>v(e,Hl(sO,(t,n)=>oO(n)(t))),sm=e=>{switch(e._tag){case Fc:return ia();case Hy:return Lp(e.id);case Vy:return v(sm(e.left),Bl(sm(e.right)))}},mk=Ee(Symbol.for("effect/Fiber/Id/_fiberCounter"),()=>Ea(0)),Wz=(e,t)=>new dw(e,t),zp=e=>Array.from(sm(e)).map(n=>`#${n}`).join(","),Kz=()=>{const e=ze(mk);return v(mk,ka(e+1)),new dw(e,Date.now())},Nn=sO,Jz=Bz,Gz=Hz,cr=oO,Qz=Vz,Bp=sm,mw=Wz,Yz=zp,iO=Kz,Hp=xp,Xz=yz,Zz=Sz,aO=wz,xc=Ul,cO=YR,uO=rm,eB=aw,tB=Cz,nB=ZR,lO=Np,Vl=Symbol.for("effect/List"),Wy=e=>je(e),rB=e=>i1(Hf(e),Wy),sB=rB(de),oB={[Vl]:Vl,_tag:"Cons",toString(){return lt(this.toJSON())},toJSON(){return{_id:"List",_tag:"Cons",values:Wy(this).map(It)}},[Ue](){return this.toJSON()},[ge](e){return dO(e)&&this._tag===e._tag&&sB(this,e)},[pe](){return it(this,jf(Wy(this)))},[Symbol.iterator](){let e=!1,t=this;return{next(){if(e)return this.return();if(t._tag==="Nil")return e=!0,this.return();const n=t.head;return t=t.tail,{done:e,value:n}},return(n){return e||(e=!0),{done:!0,value:n}}}},pipe(){return Z(this,arguments)}},om=(e,t)=>{const n=Object.create(oB);return n.head=e,n.tail=t,n},iB=$t("Nil"),aB={[Vl]:Vl,_tag:"Nil",toString(){return lt(this.toJSON())},toJSON(){return{_id:"List",_tag:"Nil"}},[Ue](){return this.toJSON()},[pe](){return iB},[ge](e){return dO(e)&&this._tag===e._tag},[Symbol.iterator](){return{next(){return{done:!0,value:void 0}}}},pipe(){return Z(this,arguments)}},fO=Object.create(aB),dO=e=>ne(e,Vl),Xs=e=>e._tag==="Nil",pw=e=>e._tag==="Cons",cB=()=>fO,ca=(e,t)=>om(e,t),Nc=cB,gw=e=>om(e,fO),uB=y(2,(e,t)=>fB(t,e)),lB=y(2,(e,t)=>ca(t,e)),fB=y(2,(e,t)=>{if(Xs(e))return t;if(Xs(t))return e;{const n=om(t.head,e);let r=n,s=t.tail;for(;!Xs(s);){const o=om(s.head,e);r.tail=o,r=o,s=s.tail}return n}}),dB=y(3,(e,t,n)=>{let r=t,s=e;for(;!Xs(s);)r=n(r,s.head),s=s.tail;return r}),hB=e=>{let t=Nc(),n=e;for(;!Xs(n);)t=lB(t,n.head),n=n.tail;return t},Vp=function(){function e(t){t&&Object.assign(this,t)}return e.prototype=MS,e}(),mB=Symbol.for("effect/DifferContextPatch");function pk(e){return e}const Yf={...Vp.prototype,[mB]:{_Value:pk,_Patch:pk}},pB=Object.assign(Object.create(Yf),{_tag:"Empty"}),gB=Object.create(pB),hO=()=>gB,_B=Object.assign(Object.create(Yf),{_tag:"AndThen"}),yB=(e,t)=>{const n=Object.create(_B);return n.first=e,n.second=t,n},bB=Object.assign(Object.create(Yf),{_tag:"AddService"}),SB=(e,t)=>{const n=Object.create(bB);return n.key=e,n.service=t,n},wB=Object.assign(Object.create(Yf),{_tag:"RemoveService"}),vB=e=>{const t=Object.create(wB);return t.key=e,t},EB=Object.assign(Object.create(Yf),{_tag:"UpdateService"}),kB=(e,t)=>{const n=Object.create(EB);return n.key=e,n.update=t,n},$B=(e,t)=>{const n=new Map(e.unsafeMap);let r=hO();for(const[s,o]of t.unsafeMap.entries())if(n.has(s)){const a=n.get(s);n.delete(s),de(a,o)||(r=vh(kB(s,()=>o))(r))}else n.delete(s),r=vh(SB(s,o))(r);for(const[s]of n.entries())r=vh(vB(s))(r);return r},vh=y(2,(e,t)=>yB(e,t)),CB=y(2,(e,t)=>{if(e._tag==="Empty")return t;let n=!1,r=ut(e);const s=new Map(t.unsafeMap);for(;uo(r);){const a=hs(r),u=Hs(r);switch(a._tag){case"Empty":{r=u;break}case"AddService":{s.set(a.key,a.service),r=u;break}case"AndThen":{r=wn(wn(u,a.second),a.first);break}case"RemoveService":{s.delete(a.key),r=u;break}case"UpdateService":{s.set(a.key,a.update(s.get(a.key))),n=!0,r=u;break}}}if(!n)return ra(s);const o=new Map;for(const[a]of t.unsafeMap)s.has(a)&&(o.set(a,s.get(a)),s.delete(a));for(const[a,u]of s)o.set(a,u);return ra(o)}),TB=Symbol.for("effect/DifferHashSetPatch");function V_(e){return e}const Wp={...Vp.prototype,[TB]:{_Value:V_,_Key:V_,_Patch:V_}},IB=Object.assign(Object.create(Wp),{_tag:"Empty"}),RB=Object.create(IB),mO=()=>RB,OB=Object.assign(Object.create(Wp),{_tag:"AndThen"}),qB=(e,t)=>{const n=Object.create(OB);return n.first=e,n.second=t,n},AB=Object.assign(Object.create(Wp),{_tag:"Add"}),PB=e=>{const t=Object.create(AB);return t.value=e,t},FB=Object.assign(Object.create(Wp),{_tag:"Remove"}),xB=e=>{const t=Object.create(FB);return t.value=e,t},NB=(e,t)=>{const[n,r]=Hl([e,mO()],([s,o],a)=>jp(a)(s)?[fw(a)(s),o]:[s,Ky(PB(a))(o)])(t);return Hl(r,(s,o)=>Ky(xB(o))(s))(n)},Ky=y(2,(e,t)=>qB(e,t)),DB=y(2,(e,t)=>{if(e._tag==="Empty")return t;let n=t,r=ut(e);for(;uo(r);){const s=hs(r),o=Hs(r);switch(s._tag){case"Empty":{r=o;break}case"AndThen":{r=wn(s.first)(wn(s.second)(o));break}case"Add":{n=gc(s.value)(n),r=o;break}case"Remove":n=fw(s.value)(n),r=o}}return n}),MB=Symbol.for("effect/DifferReadonlyArrayPatch");function gk(e){return e}const Xf={...Vp.prototype,[MB]:{_Value:gk,_Patch:gk}},LB=Object.assign(Object.create(Xf),{_tag:"Empty"}),jB=Object.create(LB),pO=()=>jB,UB=Object.assign(Object.create(Xf),{_tag:"AndThen"}),zB=(e,t)=>{const n=Object.create(UB);return n.first=e,n.second=t,n},BB=Object.assign(Object.create(Xf),{_tag:"Append"}),HB=e=>{const t=Object.create(BB);return t.values=e,t},VB=Object.assign(Object.create(Xf),{_tag:"Slice"}),WB=(e,t)=>{const n=Object.create(VB);return n.from=e,n.until=t,n},KB=Object.assign(Object.create(Xf),{_tag:"Update"}),JB=(e,t)=>{const n=Object.create(KB);return n.index=e,n.patch=t,n},GB=e=>{let t=0,n=pO();for(;t<e.oldValue.length&&t<e.newValue.length;){const r=e.oldValue[t],s=e.newValue[t],o=e.differ.diff(r,s);de(o,e.differ.empty)||(n=Eh(n,JB(t,o))),t=t+1}return t<e.oldValue.length&&(n=Eh(n,WB(0,t))),t<e.newValue.length&&(n=Eh(n,HB(XL(t)(e.newValue)))),n},Eh=y(2,(e,t)=>zB(e,t)),QB=y(3,(e,t,n)=>{if(e._tag==="Empty")return t;let r=t.slice(),s=rr(e);for(;gh(s);){const o=xn(s),a=ea(s);switch(o._tag){case"Empty":{s=a;break}case"AndThen":{a.unshift(o.first,o.second),s=a;break}case"Append":{for(const u of o.values)r.push(u);s=a;break}case"Slice":{r=r.slice(o.from,o.until),s=a;break}case"Update":{r[o.index]=n.patch(o.patch,r[o.index]),s=a;break}}}return r}),YB=Symbol.for("effect/Differ"),XB={[YB]:{_P:ie,_V:ie},pipe(){return Z(this,arguments)}},hu=e=>{const t=Object.create(XB);return t.empty=e.empty,t.diff=e.diff,t.combine=e.combine,t.patch=e.patch,t},ZB=()=>hu({empty:hO(),combine:(e,t)=>vh(t)(e),diff:(e,t)=>$B(e,t),patch:(e,t)=>CB(t)(e)}),eH=()=>hu({empty:mO(),combine:(e,t)=>Ky(t)(e),diff:(e,t)=>NB(e,t),patch:(e,t)=>DB(t)(e)}),tH=e=>hu({empty:pO(),combine:(t,n)=>Eh(t,n),diff:(t,n)=>GB({oldValue:t,newValue:n,differ:e}),patch:(t,n)=>QB(t,n,e)}),gO=()=>nH((e,t)=>t),nH=e=>hu({empty:ie,combine:(t,n)=>t===ie?n:n===ie?t:r=>n(t(r)),diff:(t,n)=>de(t,n)?ie:fp(n),patch:(t,n)=>e(n,t(n))}),Wl=255,_O=8,Jy=e=>e&Wl,Gy=e=>e>>_O&Wl,Zf=(e,t)=>(e&Wl)+((t&e&Wl)<<_O),rH=Zf(0,0),sH=e=>Zf(e,e),oH=e=>Zf(e,0),iH=y(2,(e,t)=>Zf(Jy(e)&~t,Gy(e))),aH=y(2,(e,t)=>e|t),cH=e=>~e>>>0&Wl,uH=0,mu=1,lH=2,yO=4,Qy=16,bO=32,fH=e=>Kp(e,bO),dH=y(2,(e,t)=>e|t),Lo=e=>SO(e)&&!mH(e),SO=e=>Kp(e,mu),Kp=y(2,(e,t)=>(e&t)!==0),wO=(...e)=>e.reduce((t,n)=>t|n,0),hH=wO(uH),_k=e=>Kp(e,yO),mH=e=>Kp(e,Qy),Ko=y(2,(e,t)=>Zf(e^t,t)),_c=y(2,(e,t)=>e&(cH(Jy(t))|Gy(t))|Jy(t)&Gy(t)),yk=hu({empty:rH,diff:(e,t)=>Ko(e,t),combine:(e,t)=>aH(t)(e),patch:(e,t)=>_c(t,e)}),pH=sH,vO=oH,bk=iH,EO=(e,t)=>({_tag:"Par",left:e,right:t}),Jd=(e,t)=>({_tag:"Seq",left:e,right:t}),gH=e=>{let t=gw(e),n=Nc();for(;;){const[r,s]=dB(t,[kO(),Nc()],([o,a],u)=>{const[f,h]=_H(u);return[vH(o,f),uB(a,h)]});if(n=yH(n,r),Xs(s))return hB(n);t=s}throw new Error("BUG: BlockedRequests.flatten - please report an issue at https://github.com/Effect-TS/effect/issues")},_H=e=>{let t=e,n=kO(),r=Nc(),s=Nc();for(;;)switch(t._tag){case"Empty":{if(Xs(r))return[n,s];t=r.head,r=r.tail;break}case"Par":{r=ca(t.right,r),t=t.left;break}case"Seq":{const o=t.left,a=t.right;switch(o._tag){case"Empty":{t=a;break}case"Par":{const u=o.left,f=o.right;t=EO(Jd(u,a),Jd(f,a));break}case"Seq":{const u=o.left,f=o.right;t=Jd(u,Jd(f,a));break}case"Single":{t=o,s=ca(a,s);break}}break}case"Single":{if(n=wH(n,t),Xs(r))return[n,s];t=r.head,r=r.tail;break}}throw new Error("BUG: BlockedRequests.step - please report an issue at https://github.com/Effect-TS/effect/issues")},yH=(e,t)=>{if(Xs(e))return gw(W_(t));if(EH(t))return e;const n=RH(e.head),r=kH(t);return n.length===1&&r.length===1&&de(n[0],r[0])?ca(IH(e.head,W_(t)),e.tail):ca(W_(t),e)},bH=Symbol.for("effect/RequestBlock/RequestBlockParallel"),SH={_R:e=>e};var pT;pT=bH;class _w{constructor(t){d(this,"map");d(this,pT,SH);this.map=t}}const kO=()=>new _w(Hp()),wH=(e,t)=>new _w(eB(e.map,t.dataSource,n=>$L(Wo(n,jl(t.blockedRequest)),()=>ut(t.blockedRequest)))),vH=(e,t)=>new _w(lO(e.map,t.map,(n,r,s)=>xc(n,s,rt(aO(n,s),{onNone:()=>r,onSome:o=>Tt(r,o)})))),EH=e=>Zz(e.map),kH=e=>Array.from(cO(e.map)),W_=e=>TH(tB(e.map,t=>ut(t))),$H=Symbol.for("effect/RequestBlock/RequestBlockSequential"),CH={_R:e=>e};var gT;gT=$H;class $O{constructor(t){d(this,"map");d(this,gT,CH);this.map=t}}const TH=e=>new $O(e),IH=(e,t)=>new $O(lO(t.map,e.map,(n,r,s)=>xc(n,s,rt(aO(n,s),{onNone:()=>_t(),onSome:o=>Tt(o,r)})))),RH=e=>Array.from(cO(e.map)),OH=e=>Array.from(e.map),pu="Die",ua="Empty",$a="Fail",gu="Interrupt",Dc="Parallel",Mc="Sequential",CO="effect/Cause",TO=Symbol.for(CO),qH={_E:e=>e},_u={[TO]:qH,[pe](){return v(Q(CO),ue(Q(jH(this))),it(this))},[ge](e){return yw(e)&&LH(this,e)},pipe(){return Z(this,arguments)},toJSON(){switch(this._tag){case"Empty":return{_id:"Cause",_tag:this._tag};case"Die":return{_id:"Cause",_tag:this._tag,defect:It(this.defect)};case"Interrupt":return{_id:"Cause",_tag:this._tag,fiberId:this.fiberId.toJSON()};case"Fail":return{_id:"Cause",_tag:this._tag,failure:It(this.error)};case"Sequential":case"Parallel":return{_id:"Cause",_tag:this._tag,left:It(this.left),right:It(this.right)}}},toString(){return li(this)},[Ue](){return this.toJSON()}},lo=(()=>{const e=Object.create(_u);return e._tag=ua,e})(),la=e=>{const t=Object.create(_u);return t._tag=$a,t.error=e,t},Dn=e=>{const t=Object.create(_u);return t._tag=pu,t.defect=e,t},br=e=>{const t=Object.create(_u);return t._tag=gu,t.fiberId=e,t},fo=(e,t)=>{const n=Object.create(_u);return n._tag=Dc,n.left=e,n.right=t,n},Qt=(e,t)=>{const n=Object.create(_u);return n._tag=Mc,n.left=e,n.right=t,n},yw=e=>ne(e,TO),AH=e=>e._tag===ua,PH=e=>e._tag===$a,bw=e=>e._tag===pu,Sw=e=>e._tag===ua?!0:Lc(e,!0,(t,n)=>{switch(n._tag){case ua:return W(t);case pu:case $a:case gu:return W(!1);default:return V()}}),ww=e=>ct(NH(e)),Jp=e=>Xp(void 0,zH)(e),FH=e=>co(Lc(e,_t(),(t,n)=>n._tag===$a?W(v(t,wn(n.error))):V())),IO=e=>co(Lc(e,_t(),(t,n)=>n._tag===pu?W(v(t,wn(n.defect))):V())),vw=e=>Lc(e,ia(),(t,n)=>n._tag===gu?W(v(t,gc(n.fiberId))):V()),RO=e=>Qp(e,t=>t._tag===$a?W(t.error):V()),Gp=e=>{const t=RO(e);switch(t._tag){case"None":return ce(e);case"Some":return oe(t.value)}},xH=e=>Yp(e,{onEmpty:W(lo),onFail:Wo(la),onDie:t=>W(Dn(t)),onInterrupt:t=>W(br(t)),onSequential:J0(Qt),onParallel:J0(fo)}),NH=e=>Qp(e,t=>t._tag===gu?W(t.fiberId):V()),Sk=e=>Yp(e,{onEmpty:lo,onFail:()=>lo,onDie:Dn,onInterrupt:br,onSequential:Qt,onParallel:fo}),DH=e=>Yp(e,{onEmpty:lo,onFail:Dn,onDie:Dn,onInterrupt:br,onSequential:Qt,onParallel:fo}),OO=y(2,(e,t)=>MH(e,n=>la(t(n)))),MH=y(2,(e,t)=>Yp(e,{onEmpty:lo,onFail:n=>t(n),onDie:n=>Dn(n),onInterrupt:n=>br(n),onSequential:(n,r)=>Qt(n,r),onParallel:(n,r)=>fo(n,r)})),LH=(e,t)=>{let n=ut(e),r=ut(t);for(;uo(n)&&uo(r);){const[s,o]=v(hs(n),Lc([ia(),_t()],([f,h],p)=>{const[g,k]=Yy(p);return W([v(f,Bl(g)),v(h,Tt(k))])})),[a,u]=v(hs(r),Lc([ia(),_t()],([f,h],p)=>{const[g,k]=Yy(p);return W([v(f,Bl(g)),v(h,Tt(k))])}));if(!de(s,a))return!1;n=o,r=u}return!0},jH=e=>UH(ut(e),_t()),UH=(e,t)=>{for(;;){const[n,r]=v(e,HS([ia(),_t()],([o,a],u)=>{const[f,h]=Yy(u);return[v(o,Bl(f)),v(a,Tt(h))]})),s=lw(n)>0?v(t,wn(n)):t;if(Qf(r))return co(s);e=r,t=s}throw new Error(pp("Cause.flattenCauseLoop"))},Qp=y(2,(e,t)=>{const n=[e];for(;n.length>0;){const r=n.pop(),s=t(r);switch(s._tag){case"None":{switch(r._tag){case Mc:case Dc:{n.push(r.right),n.push(r.left);break}}break}case"Some":return s}}return V()}),Yy=e=>{let t=e;const n=[];let r=ia(),s=_t();for(;t!==void 0;)switch(t._tag){case ua:{if(n.length===0)return[r,s];t=n.pop();break}case $a:{if(r=gc(r,H_(t._tag,t.error)),n.length===0)return[r,s];t=n.pop();break}case pu:{if(r=gc(r,H_(t._tag,t.defect)),n.length===0)return[r,s];t=n.pop();break}case gu:{if(r=gc(r,H_(t._tag,t.fiberId)),n.length===0)return[r,s];t=n.pop();break}case Mc:{switch(t.left._tag){case ua:{t=t.right;break}case Mc:{t=Qt(t.left.left,Qt(t.left.right,t.right));break}case Dc:{t=fo(Qt(t.left.left,t.right),Qt(t.left.right,t.right));break}default:{s=wn(s,t.right),t=t.left;break}}break}case Dc:{n.push(t.right),t=t.left;break}}throw new Error(pp("Cause.evaluateCauseLoop"))},zH={emptyCase:W0,failCase:Hn,dieCase:Hn,interruptCase:W0,sequentialCase:(e,t,n)=>t&&n,parallelCase:(e,t,n)=>t&&n},wk="SequentialCase",vk="ParallelCase",Yp=y(2,(e,{onDie:t,onEmpty:n,onFail:r,onInterrupt:s,onParallel:o,onSequential:a})=>Xp(e,void 0,{emptyCase:()=>n,failCase:(u,f)=>r(f),dieCase:(u,f)=>t(f),interruptCase:(u,f)=>s(f),sequentialCase:(u,f,h)=>a(f,h),parallelCase:(u,f,h)=>o(f,h)})),Lc=y(3,(e,t,n)=>{let r=t,s=e;const o=[];for(;s!==void 0;){const a=n(r,s);switch(r=ct(a)?a.value:r,s._tag){case Mc:{o.push(s.right),s=s.left;break}case Dc:{o.push(s.right),s=s.left;break}default:{s=void 0;break}}s===void 0&&o.length>0&&(s=o.pop())}return r}),Xp=y(3,(e,t,n)=>{const r=[e],s=[];for(;r.length>0;){const a=r.pop();switch(a._tag){case ua:{s.push(ce(n.emptyCase(t)));break}case $a:{s.push(ce(n.failCase(t,a.error)));break}case pu:{s.push(ce(n.dieCase(t,a.defect)));break}case gu:{s.push(ce(n.interruptCase(t,a.fiberId)));break}case Mc:{r.push(a.right),r.push(a.left),s.push(oe({_tag:wk}));break}case Dc:{r.push(a.right),r.push(a.left),s.push(oe({_tag:vk}));break}}}const o=[];for(;s.length>0;){const a=s.pop();switch(a._tag){case"Left":{switch(a.left._tag){case wk:{const u=o.pop(),f=o.pop(),h=n.sequentialCase(t,u,f);o.push(h);break}case vk:{const u=o.pop(),f=o.pop(),h=n.parallelCase(t,u,f);o.push(h);break}}break}case"Right":{o.push(a.right);break}}}if(o.length===0)throw new Error("BUG: Cause.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return o.pop()}),li=(e,t)=>Jp(e)?"All fibers interrupted without errors.":Ew(e).map(function(n){return(t==null?void 0:t.renderErrorCause)!==!0||n.cause===void 0?n.stack:`${n.stack} {
${qO(n.cause,"  ")}
}`}).join(`
`),qO=(e,t)=>{const n=e.stack.split(`
`);let r=`${t}[cause]: ${n[0]}`;for(let s=1,o=n.length;s<o;s++)r+=`
${t}${n[s]}`;return e.cause&&(r+=` {
${qO(e.cause,`${t}  `)}
${t}}`),r};class im extends globalThis.Error{constructor(n){const r=typeof n=="object"&&n!==null,s=Error.stackTraceLimit;Error.stackTraceLimit=1;super(AO(n),r&&"cause"in n&&typeof n.cause<"u"?{cause:new im(n.cause)}:void 0);d(this,"span");this.message===""&&(this.message="An error has occurred"),Error.stackTraceLimit=s,this.name=n instanceof Error?n.name:"Error",r&&(jc in n&&(this.span=n[jc]),Object.keys(n).forEach(o=>{o in this||(this[o]=n[o])})),this.stack=HH(`${this.name}: ${this.message}`,n instanceof Error&&n.stack?n.stack:"",this.span)}}const AO=e=>{if(typeof e=="string")return e;if(typeof e=="object"&&e!==null&&e instanceof Error)return e.message;try{if(ne(e,"toString")&&iu(e.toString)&&e.toString!==Object.prototype.toString&&e.toString!==globalThis.Array.prototype.toString)return e.toString()}catch{}return m1(e)},BH=/\((.*)\)/g,am=Ee("effect/Tracer/spanToTrace",()=>new WeakMap),HH=(e,t,n)=>{const r=[e],s=t.startsWith(e)?t.slice(e.length).split(`
`):t.split(`
`);for(let o=1;o<s.length;o++){if(s[o].includes(" at new BaseEffectError")||s[o].includes(" at new YieldableError")){o++;continue}if(s[o].includes("Generator.next")||s[o].includes("effect_internal_function"))break;r.push(s[o].replace(/at .*effect_instruction_i.*\((.*)\)/,"at $1").replace(/EffectPrimitive\.\w+/,"<anonymous>"))}if(n){let o=n,a=0;for(;o&&o._tag==="Span"&&a<10;){const u=am.get(o);if(typeof u=="function"){const f=u();if(typeof f=="string"){const h=f.matchAll(BH);let p=!1;for(const[,g]of h)p=!0,r.push(`    at ${o.name} (${g})`);p||r.push(`    at ${o.name} (${f.replace(/^at /,"")})`)}else r.push(`    at ${o.name}`)}else r.push(`    at ${o.name}`);o=or(o.parent),a++}}return r.join(`
`)},jc=Symbol.for("effect/SpanAnnotation"),Ew=e=>Xp(e,void 0,{emptyCase:()=>[],dieCase:(t,n)=>[new im(n)],failCase:(t,n)=>[new im(n)],interruptCase:()=>[],parallelCase:(t,n,r)=>[...n,...r],sequentialCase:(t,n,r)=>[...n,...r]}),ed="Pending",Zp="Done",VH="effect/Deferred",WH=Symbol.for(VH),KH={_E:e=>e,_A:e=>e},JH=e=>({_tag:ed,joiners:e}),PO=e=>({_tag:Zp,effect:e});class yu{constructor(t){d(this,"self");d(this,"called",!1);this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new yu(this.self)}}const FO=(e,t)=>{const n=new Zt("Blocked");return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n},GH=e=>{const t=new Zt("RunBlocked");return t.effect_instruction_i0=e,t},fa=Symbol.for("effect/Effect");class QH{constructor(t,n){d(this,"patch");d(this,"op");d(this,"_op",DS);this.patch=t,this.op=n}}var _T;class Zt{constructor(t){d(this,"_op");d(this,"effect_instruction_i0");d(this,"effect_instruction_i1");d(this,"effect_instruction_i2");d(this,"trace");d(this,_T,Xi);this._op=t}[(_T=fa,ge)](t){return this===t}[pe](){return it(this,gp(this))}pipe(){return Z(this,arguments)}toJSON(){return{_id:"Effect",_op:this._op,effect_instruction_i0:It(this.effect_instruction_i0),effect_instruction_i1:It(this.effect_instruction_i1),effect_instruction_i2:It(this.effect_instruction_i2)}}toString(){return lt(this.toJSON())}[Ue](){return this.toJSON()}[Symbol.iterator](){return new yu(new au(this))}}var yT;class xO{constructor(t){d(this,"_op");d(this,"effect_instruction_i0");d(this,"effect_instruction_i1");d(this,"effect_instruction_i2");d(this,"trace");d(this,yT,Xi);this._op=t,this._tag=t}[(yT=fa,ge)](t){return dg(t)&&t._op==="Failure"&&de(this.effect_instruction_i0,t.effect_instruction_i0)}[pe](){return v($t(this._tag),ue(Q(this.effect_instruction_i0)),it(this))}get cause(){return this.effect_instruction_i0}pipe(){return Z(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,cause:this.cause.toJSON()}}toString(){return lt(this.toJSON())}[Ue](){return this.toJSON()}[Symbol.iterator](){return new yu(new au(this))}}var bT;class NO{constructor(t){d(this,"_op");d(this,"effect_instruction_i0");d(this,"effect_instruction_i1");d(this,"effect_instruction_i2");d(this,"trace");d(this,bT,Xi);this._op=t,this._tag=t}[(bT=fa,ge)](t){return dg(t)&&t._op==="Success"&&de(this.effect_instruction_i0,t.effect_instruction_i0)}[pe](){return v($t(this._tag),ue(Q(this.effect_instruction_i0)),it(this))}get value(){return this.effect_instruction_i0}pipe(){return Z(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,value:It(this.value)}}toString(){return lt(this.toJSON())}[Ue](){return this.toJSON()}[Symbol.iterator](){return new yu(new au(this))}}const hr=e=>ne(e,fa),Ae=e=>{const t=new Zt(_1);return t.effect_instruction_i0=e,t},DO=y(3,(e,t,n)=>dr(r=>U(e,s=>U(_s(he(()=>r(t(s)))),o=>he(()=>n(s,o)).pipe(Ln({onFailure:a=>{switch(o._tag){case an:return Et(Qt(o.effect_instruction_i0,a));case cn:return Et(a)}},onSuccess:()=>o})))))),Xt=y(2,(e,t)=>U(e,()=>J(t))),Xn=e=>Xt(e,void 0),MO=function(){const e=new Zt(Uf);switch(arguments.length){case 2:{e.effect_instruction_i0=arguments[0],e.commit=arguments[1];break}case 3:{e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.commit=arguments[2];break}case 4:{e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.effect_instruction_i2=arguments[2],e.commit=arguments[3];break}default:throw new Error(pp("you're not supposed to end up here"))}return e},Kl=(e,t=Nn)=>{const n=new Zt(bl);let r;return n.effect_instruction_i0=s=>{r=e(s)},n.effect_instruction_i1=t,Ta(n,s=>hr(r)?r:Ke)},zo=(e,t=Nn)=>he(()=>Kl(e,t)),Qr=(e,t=Nn)=>MO(e,function(){let n,r;function s(f){n?n(f):r===void 0&&(r=f)}const o=new Zt(bl);o.effect_instruction_i0=f=>{n=f,r&&f(r)},o.effect_instruction_i1=t;let a,u;return this.effect_instruction_i0.length!==1?(u=new AbortController,a=mt(()=>this.effect_instruction_i0(s,u.signal))):a=mt(()=>this.effect_instruction_i0(s)),a||u?Ta(o,f=>(u&&u.abort(),a??Ke)):o}),eg=y(2,(e,t)=>{const n=new Zt(mh);return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n}),Uc=y(2,(e,t)=>ho(e,{onFailure:t,onSuccess:J})),LO=y(3,(e,t,n)=>eg(e,r=>{const s=Gp(r);switch(s._tag){case"Left":return t(s.left)?n(s.left):Et(r);case"Right":return Et(s.right)}})),Ek=Symbol.for("effect/OriginalAnnotation"),kw=(e,t)=>ct(t)?new Proxy(e,{has(n,r){return r===jc||r===Ek||r in n},get(n,r){return r===jc?t.value:r===Ek?e:n[r]}}):e,Jl=e=>qs(e)&&!(jc in e)?Ae(t=>Et(Dn(kw(e,Nw(t))))):Et(Dn(e)),Xy=e=>jO(()=>Dn(new O4(e))),zc=e=>ho(e,{onFailure:t=>J(oe(t)),onSuccess:t=>J(ce(t))}),_s=e=>UO(e,{onFailure:nt,onSuccess:We}),bt=e=>qs(e)&&!(jc in e)?Ae(t=>Et(la(kw(e,Nw(t))))):Et(la(e)),td=e=>U(K(e),bt),Et=e=>{const t=new xO(an);return t.effect_instruction_i0=e,t},jO=e=>U(K(e),Et),tg=Ae(e=>J(e.id())),Ca=e=>Ae(t=>e(t.id())),U=y(2,(e,t)=>{const n=new Zt(Vh);return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n}),YH=y(2,(e,t)=>U(e,n=>{const r=typeof t=="function"?t(n):t;return hr(r)?r:c1(r)?Kl(s=>{r.then(o=>s(J(o)),o=>s(bt(new fg(o,"An unknown error occurred in Effect.andThen"))))}):J(r)})),XH=e=>{const t=new Zt("OnStep");return t.effect_instruction_i0=e,t},bu=e=>U(e,ie),UO=y(2,(e,t)=>Ln(e,{onFailure:n=>J(t.onFailure(n)),onSuccess:n=>J(t.onSuccess(n))})),Ln=y(2,(e,t)=>{const n=new Zt(Wh);return n.effect_instruction_i0=e,n.effect_instruction_i1=t.onFailure,n.effect_instruction_i2=t.onSuccess,n}),ho=y(2,(e,t)=>Ln(e,{onFailure:n=>{if(IO(n).length>0)return Et(DH(n));const s=FH(n);return s.length>0?t.onFailure(qp(s)):Et(n)},onSuccess:t.onSuccess})),Vs=y(2,(e,t)=>he(()=>{const n=je(e),r=Sp(n.length);let s=0;return Xt(Tw({while:()=>s<n.length,body:()=>t(n[s],s),step:o=>{r[s++]=o}}),r)})),Bc=y(2,(e,t)=>he(()=>{const n=je(e);let r=0;return Tw({while:()=>r<n.length,body:()=>t(n[r],r),step:()=>{r++}})})),fn=U(tg,e=>zO(e)),zO=e=>Et(br(e)),ng=e=>{const t=new Zt(cu);return t.effect_instruction_i0=pH(mu),t.effect_instruction_i1=()=>e,t},BO=y(2,(e,t)=>dr(n=>U(_s(n(e)),r=>rq(t,r)))),_e=y(2,(e,t)=>U(e,n=>K(()=>t(n)))),$w=y(2,(e,t)=>ho(e,{onFailure:n=>td(()=>t.onFailure(n)),onSuccess:n=>K(()=>t.onSuccess(n))})),rg=y(2,(e,t)=>Ln(e,{onFailure:n=>{const r=Gp(n);switch(r._tag){case"Left":return td(()=>t(r.left));case"Right":return Et(r.right)}},onSuccess:J})),ZH=y(2,(e,t)=>ws(e,n=>tq(n)?Ke:t(n.effect_instruction_i0))),ws=y(2,(e,t)=>dr(n=>Ln(n(e),{onFailure:r=>{const s=nt(r);return Ln(t(s),{onFailure:o=>nt(Qt(r,o)),onSuccess:()=>s})},onSuccess:r=>{const s=We(r);return Ct(t(s),s)}}))),Ta=y(2,(e,t)=>ws(e,hg({onFailure:n=>Jp(n)?Xn(t(vw(n))):Ke,onSuccess:()=>Ke}))),Cw=e=>e4(e,ie),e4=y(2,(e,t)=>ho(e,{onFailure:n=>Jl(t(n)),onSuccess:J})),t4=Ae((e,t)=>J(t.runtimeFlags)),J=e=>{const t=new NO(cn);return t.effect_instruction_i0=e,t},he=e=>{const t=new Zt(Uf);return t.commit=e,t},K=e=>{const t=new Zt(g1);return t.effect_instruction_i0=e,t},sg=y(e=>e.length===3||e.length===2&&!(qs(e[1])&&"onlyEffect"in e[1]),(e,t)=>U(e,n=>{const r=typeof t=="function"?t(n):t;return hr(r)?Xt(r,n):c1(r)?Kl(s=>{r.then(o=>s(J(n)),o=>s(bt(new fg(o,"An unknown error occurred in Effect.tap"))))}):J(n)})),n4=e=>Ae(t=>{const n=t.getFiberRef(eb),r=v(n,gt(()=>t.scope()));return e(ko(eb,W(r)))}),fi=e=>{const t=new Zt(cu);return t.effect_instruction_i0=vO(mu),t.effect_instruction_i1=()=>e,t},dr=e=>MO(e,function(){const t=new Zt(cu);return t.effect_instruction_i0=vO(mu),t.effect_instruction_i1=n=>SO(n)?mt(()=>this.effect_instruction_i0(ng)):mt(()=>this.effect_instruction_i0(fi)),t}),Ke=J(void 0),HO=e=>{const t=new Zt(cu);return t.effect_instruction_i0=e,t.effect_instruction_i1=void 0,t},nd=y(2,(e,t)=>U(t,n=>n?v(e,_e(W)):J(V()))),Tw=e=>{const t=new Zt(Kh);return t.effect_instruction_i0=e.while,t.effect_instruction_i1=e.body,t.effect_instruction_i2=e.step,t},cm=e=>he(()=>{const t=new Zt(Sl);return t.effect_instruction_i0=e(),t}),r4=function(){const e=arguments.length===1?arguments[0]:arguments[1].bind(arguments[0]);return cm(()=>e(v))},s4=(e,...t)=>Object.defineProperty(t.length===0?function(...n){return cm(()=>e.apply(this,n))}:function(...n){let r=cm(()=>e.apply(this,n));for(const s of t)r=s(r,...n);return r},"length",{value:e.length,configurable:!0}),o4=y(2,(e,t)=>{const n=new Zt(cu);return n.effect_instruction_i0=t,n.effect_instruction_i1=()=>e,n}),og=e=>{const t=new Zt(ph);return typeof(e==null?void 0:e.priority)<"u"?v4(t,e.priority):t},ig=y(2,(e,t)=>U(e,n=>_e(t,r=>[n,r]))),Iw=y(2,(e,t)=>U(e,n=>Xt(t,n))),Ct=y(2,(e,t)=>U(e,()=>t)),VO=y(3,(e,t,n)=>U(e,r=>_e(t,s=>n(r,s)))),i4=zo(()=>{const e=setInterval(()=>{},2147483647);return K(()=>clearInterval(e))}),Rw=e=>U(tg,t=>v(e,Ws(t))),Ws=y(2,(e,t)=>U(e.interruptAsFork(t),()=>e.await)),a4={_tag:"All",syslog:0,label:"ALL",ordinal:Number.MIN_SAFE_INTEGER,pipe(){return Z(this,arguments)}},c4={_tag:"Fatal",syslog:2,label:"FATAL",ordinal:5e4,pipe(){return Z(this,arguments)}},u4={_tag:"Error",syslog:3,label:"ERROR",ordinal:4e4,pipe(){return Z(this,arguments)}},l4={_tag:"Warning",syslog:4,label:"WARN",ordinal:3e4,pipe(){return Z(this,arguments)}},WO={_tag:"Info",syslog:6,label:"INFO",ordinal:2e4,pipe(){return Z(this,arguments)}},KO={_tag:"Debug",syslog:7,label:"DEBUG",ordinal:1e4,pipe(){return Z(this,arguments)}},f4={_tag:"Trace",syslog:7,label:"TRACE",ordinal:0,pipe(){return Z(this,arguments)}},d4={_tag:"None",syslog:7,label:"OFF",ordinal:Number.MAX_SAFE_INTEGER,pipe(){return Z(this,arguments)}},h4="effect/FiberRef",m4=Symbol.for(h4),p4={_A:e=>e},rd=e=>Ae(t=>We(t.getFiberRef(e))),Su=y(2,(e,t)=>U(rd(e),t)),um=y(2,(e,t)=>g4(e,()=>[void 0,t])),g4=y(2,(e,t)=>Ae(n=>{const[r,s]=t(n.getFiberRef(e));return n.setFiberRef(e,s),J(r)})),ko=y(3,(e,t,n)=>DO(Iw(rd(t),um(t,n)),()=>e,r=>um(t,r))),ag=y(3,(e,t,n)=>Su(t,r=>ko(e,t,n(r)))),pn=(e,t)=>wu(e,{differ:gO(),fork:(t==null?void 0:t.fork)??ie,join:t==null?void 0:t.join}),_4=e=>{const t=eH();return wu(e,{differ:t,fork:t.empty})},y4=e=>{const t=tH(gO());return wu(e,{differ:t,fork:t.empty})},JO=e=>{const t=ZB();return wu(e,{differ:t,fork:t.empty})},wu=(e,t)=>({...Bf,[m4]:p4,initial:e,commit(){return rd(this)},diff:(r,s)=>t.differ.diff(r,s),combine:(r,s)=>t.differ.combine(r,s),patch:r=>s=>t.differ.patch(r,s),fork:t.fork,join:t.join??((r,s)=>s)}),b4=e=>wu(e,{differ:yk,fork:yk.empty}),Zr=Ee(Symbol.for("effect/FiberRef/currentContext"),()=>JO(io())),di=Ee(Symbol.for("effect/FiberRef/currentSchedulingPriority"),()=>pn(0)),cg=Ee(Symbol.for("effect/FiberRef/currentMaxOpsBeforeYield"),()=>pn(2048)),GO=Ee(Symbol.for("effect/FiberRef/currentLogAnnotation"),()=>pn(Hp())),S4=Ee(Symbol.for("effect/FiberRef/currentLogLevel"),()=>pn(WO)),w4=Ee(Symbol.for("effect/FiberRef/currentLogSpan"),()=>pn(Nc())),v4=y(2,(e,t)=>ko(e,di,t)),E4=y(2,(e,t)=>ko(e,cg,t)),k4=Ee(Symbol.for("effect/FiberRef/currentConcurrency"),()=>pn("unbounded")),$4=Ee(Symbol.for("effect/FiberRef/currentRequestBatching"),()=>pn(!0)),QO=Ee(Symbol.for("effect/FiberRef/currentUnhandledErrorLogLevel"),()=>pn(W(KO))),C4=y(2,(e,t)=>ko(e,QO,t)),Zy=Ee(Symbol.for("effect/FiberRef/currentMetricLabels"),()=>y4(Xo())),eb=Ee(Symbol.for("effect/FiberRef/currentForkScopeOverride"),()=>pn(V(),{fork:()=>V(),join:(e,t)=>e})),Gd=Ee(Symbol.for("effect/FiberRef/currentInterruptedCause"),()=>pn(lo,{fork:()=>lo,join:(e,t)=>e})),YO=Ee(Symbol.for("effect/FiberRef/currentTracerEnabled"),()=>pn(!0)),ug=Ee(Symbol.for("effect/FiberRef/currentTracerTiming"),()=>pn(!0)),XO=Ee(Symbol.for("effect/FiberRef/currentTracerSpanAnnotations"),()=>pn(Hp())),T4=Ee(Symbol.for("effect/FiberRef/currentTracerSpanLinks"),()=>pn(_t())),kk=Symbol.for("effect/Scope"),$k=Symbol.for("effect/CloseableScope"),ZO=(e,t)=>e.addFinalizer(()=>Xn(t)),Gl=(e,t)=>e.addFinalizer(t),tb=(e,t)=>e.close(t),lg=(e,t)=>e.fork(t),I4=e=>R4(ie)(e),R4=y(2,(e,t)=>{const n=v(e,RO,Wo(t));switch(n._tag){case"None":return v(IO(e),Op,rt({onNone:()=>{const r=je(vw(e)).flatMap(s=>je(Bp(s)).map(o=>`#${o}`));return new q4(r?`Interrupted by fibers: ${r.join(", ")}`:void 0)},onSome:ie}));case"Some":return n.value}}),Ow=function(){class e extends globalThis.Error{commit(){return bt(this)}toJSON(){const n={...this};return this.message&&(n.message=this.message),this.cause&&(n.cause=this.cause),n}[Ue](){return this.toString!==globalThis.Error.prototype.toString?this.stack?`${this.toString()}
${this.stack.split(`
`).slice(1).join(`
`)}`:this.toString():"Bun"in globalThis?li(la(this),{renderErrorCause:!0}):this}}return Object.assign(e.prototype,uL),e}(),sd=(e,t)=>{class n extends Ow{constructor(){super(...arguments);d(this,"_tag",t)}}return Object.assign(n.prototype,e),n.prototype.name=t,n},Ck=Symbol.for("effect/Cause/errors/RuntimeException"),O4=sd({[Ck]:Ck},"RuntimeException"),nb=Symbol.for("effect/Cause/errors/InterruptedException"),q4=sd({[nb]:nb},"InterruptedException"),A4=e=>ne(e,nb),Tk=Symbol.for("effect/Cause/errors/IllegalArgument"),P4=sd({[Tk]:Tk},"IllegalArgumentException"),Ik=Symbol.for("effect/Cause/errors/NoSuchElement"),od=sd({[Ik]:Ik},"NoSuchElementException"),Rk=Symbol.for("effect/Cause/errors/Timeout"),F4=sd({[Rk]:Rk},"TimeoutException"),x4=e=>new F4(`Operation timed out after '${HR(e)}'`),Ok=Symbol.for("effect/Cause/errors/UnknownException"),fg=function(){class e extends Ow{constructor(r,s){super(s??"An unknown error occurred",{cause:r});d(this,"_tag","UnknownException");d(this,"error");this.error=r}}return Object.assign(e.prototype,{[Ok]:Ok,name:"UnknownException"}),e}(),dg=e=>hr(e)&&"_tag"in e&&(e._tag==="Success"||e._tag==="Failure"),eq=e=>e._tag==="Failure",tq=e=>e._tag==="Success",N4=e=>{switch(e._tag){case an:return ww(e.effect_instruction_i0);case cn:return!1}},kh=y(2,(e,t)=>{switch(e._tag){case an:return nt(e.effect_instruction_i0);case cn:return We(t)}}),K_=e=>kh(e,void 0),yc=(e,t)=>L4(e,t!=null&&t.parallel?fo:Qt),ic=e=>nt(Dn(e)),Ql=e=>nt(la(e)),nt=e=>{const t=new xO(an);return t.effect_instruction_i0=e,t},qw=e=>nt(br(e)),$h=y(2,(e,t)=>{switch(e._tag){case an:return nt(e.effect_instruction_i0);case cn:return We(t(e.effect_instruction_i0))}}),D4=y(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case an:return nt(v(e.effect_instruction_i0,OO(t)));case cn:return We(n(e.effect_instruction_i0))}}),hg=y(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case an:return t(e.effect_instruction_i0);case cn:return n(e.effect_instruction_i0)}}),rb=y(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case an:return t(e.effect_instruction_i0);case cn:return n(e.effect_instruction_i0)}}),We=e=>{const t=new NO(cn);return t.effect_instruction_i0=e,t},$n=We(void 0),M4=y(2,(e,t)=>Aw(e,t,{onSuccess:(n,r)=>[n,r],onFailure:Qt})),nq=y(2,(e,t)=>Aw(e,t,{onSuccess:(n,r)=>r,onFailure:Qt})),Aw=y(3,(e,t,{onFailure:n,onSuccess:r})=>{switch(e._tag){case an:switch(t._tag){case cn:return nt(e.effect_instruction_i0);case an:return nt(n(e.effect_instruction_i0,t.effect_instruction_i0))}case cn:switch(t._tag){case cn:return We(r(e.effect_instruction_i0,t.effect_instruction_i0));case an:return nt(t.effect_instruction_i0)}}}),L4=(e,t)=>{const n=ao(e);return uo(n)?v(Hs(n),HS(v(hs(n),$h(ut)),(r,s)=>v(r,Aw(s,{onSuccess:(o,a)=>v(o,wn(a)),onFailure:t}))),$h(co),$h(r=>ar(r)),W):V()},vu=e=>({...Bf,[WH]:KH,state:Ea(JH([])),commit(){return Yr(this)},blockingOn:e}),Eu=()=>U(tg,e=>j4(e)),j4=e=>K(()=>vu(e)),Yr=e=>zo(t=>{const n=ze(e.state);switch(n._tag){case Zp:return t(n.effect);case ed:return n.joiners.push(t),B4(e,t)}},e.blockingOn),id=y(2,(e,t)=>K(()=>{const n=ze(e.state);switch(n._tag){case Zp:return!1;case ed:{ka(e.state,PO(t));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](t);return!0}}})),rq=y(2,(e,t)=>id(e,t)),U4=y(2,(e,t)=>id(e,bt(t))),sq=y(2,(e,t)=>id(e,Et(t))),Pw=y(2,(e,t)=>id(e,zO(t))),z4=e=>K(()=>ze(e.state)._tag===Zp),ad=y(2,(e,t)=>id(e,J(t))),cd=(e,t)=>{const n=ze(e.state);if(n._tag===ed){ka(e.state,PO(t));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](t)}},B4=(e,t)=>K(()=>{const n=ze(e.state);if(n._tag===ed){const r=n.joiners.indexOf(t);r>=0&&n.joiners.splice(r,1)}}),H4=Ae(e=>We(e.currentContext)),ud=()=>H4,ku=e=>U(ud(),e),Fw=y(2,(e,t)=>ko(Zr,t)(e)),xw=y(2,(e,t)=>ag(Zr,n=>Eo(n,t))(e)),oq=y(2,(e,t)=>ku(n=>Fw(e,t(n)))),Nw=e=>{const t=e.currentSpan;return t!==void 0&&t._tag==="Span"?W(t):V()},V4={_tag:"Span",spanId:"noop",traceId:"noop",sampled:!1,status:{_tag:"Ended",startTime:BigInt(0),endTime:BigInt(0),exit:$n},attributes:new Map,links:[],kind:"internal",attribute(){},event(){},end(){},addLinks(){}},W4=e=>Object.assign(Object.create(V4),e),Me=Eu,zt=Yr,Ia=rq,Dw=U4,iq=sq,sb=z4,at=ad,K4=vu,Oi=cd,J4=dg,Ra=eq,Hc=tq,G4=N4,Q4=yc,Yl=ic,ld=Ql,sn=nt,Y4=qw,X4=$h,Z4=D4,Wr=hg,Ht=We,Jn=$n,qk=M4,Xl=nq,Ak=Symbol.for("effect/MutableHashMap"),e6={[Ak]:Ak,[Symbol.iterator](){return new Mw(this)},toString(){return lt(this.toJSON())},toJSON(){return{_id:"MutableHashMap",values:Array.from(this).map(It)}},[Ue](){return this.toJSON()},pipe(){return Z(this,arguments)}};class Mw{constructor(t){d(this,"self");d(this,"referentialIterator");d(this,"bucketIterator");this.self=t,this.referentialIterator=t.referential[Symbol.iterator]()}next(){if(this.bucketIterator!==void 0)return this.bucketIterator.next();const t=this.referentialIterator.next();return t.done?(this.bucketIterator=new t6(this.self.buckets.values()),this.next()):t}[Symbol.iterator](){return new Mw(this.self)}}class t6{constructor(t){d(this,"backing");d(this,"currentBucket");this.backing=t}next(){if(this.currentBucket===void 0){const n=this.backing.next();if(n.done)return n;this.currentBucket=n.value[Symbol.iterator]()}const t=this.currentBucket.next();return t.done?(this.currentBucket=void 0,this.next()):t}}const aq=()=>{const e=Object.create(e6);return e.referential=new Map,e.buckets=new Map,e.bucketsSize=0,e},is=y(2,(e,t)=>{if(Dl(t)===!1)return e.referential.has(t)?W(e.referential.get(t)):V();const n=t[pe](),r=e.buckets.get(n);return r===void 0?V():n6(e,r,t)}),n6=(e,t,n,r=!1)=>{for(let s=0,o=t.length;s<o;s++)if(n[ge](t[s][0])){const a=t[s][1];return r&&(t.splice(s,1),e.bucketsSize--),W(a)}return V()},Ya=y(2,(e,t)=>ct(is(e,t))),Xa=y(3,(e,t,n)=>{if(Dl(t)===!1)return e.referential.set(t,n),e;const r=t[pe](),s=e.buckets.get(r);return s===void 0?(e.buckets.set(r,[[t,n]]),e.bucketsSize++,e):(cq(e,s,t),s.push([t,n]),e.bucketsSize++,e)}),cq=(e,t,n)=>{for(let r=0,s=t.length;r<s;r++)if(n[ge](t[r][0])){t.splice(r,1),e.bucketsSize--;return}},r6=y(2,(e,t)=>{if(Dl(t)===!1)return e.referential.delete(t),e;const n=t[pe](),r=e.buckets.get(n);return r===void 0||(cq(e,r,t),r.length===0&&e.buckets.delete(n)),e}),Pk=Symbol.for("effect/MutableList"),s6={[Pk]:Pk,[Symbol.iterator](){let e=!1,t=this.head;return{next(){if(e)return this.return();if(t==null)return e=!0,this.return();const n=t.value;return t=t.next,{done:e,value:n}},return(n){return e||(e=!0),{done:!0,value:n}}}},toString(){return lt(this.toJSON())},toJSON(){return{_id:"MutableList",values:Array.from(this).map(It)}},[Ue](){return this.toJSON()},pipe(){return Z(this,arguments)}},o6=e=>({value:e,removed:!1,prev:void 0,next:void 0}),i6=()=>{const e=Object.create(s6);return e.head=void 0,e.tail=void 0,e._length=0,e},uq=e=>Lw(e)===0,Lw=e=>e._length,a6=y(2,(e,t)=>{const n=o6(t);return e.head===void 0&&(e.head=n),e.tail===void 0||(e.tail.next=n,n.prev=e.tail),e.tail=n,e._length+=1,e}),c6=e=>{const t=e.head;if(t!==void 0)return u6(e,t),t.value},u6=(e,t)=>{t.removed||(t.removed=!0,t.prev!==void 0&&t.next!==void 0?(t.prev.next=t.next,t.next.prev=t.prev):t.prev!==void 0?(e.tail=t.prev,t.prev.next=void 0):t.next!==void 0?(e.head=t.next,t.next.prev=void 0):(e.tail=void 0,e.head=void 0),e._length>0&&(e._length-=1))},Fk=Symbol.for("effect/MutableQueue"),Bt=Symbol.for("effect/mutable/MutableQueue/Empty"),l6={[Fk]:Fk,[Symbol.iterator](){return Array.from(this.queue)[Symbol.iterator]()},toString(){return lt(this.toJSON())},toJSON(){return{_id:"MutableQueue",values:Array.from(this).map(It)}},[Ue](){return this.toJSON()},pipe(){return Z(this,arguments)}},lq=e=>{const t=Object.create(l6);return t.queue=i6(),t.capacity=e,t},jw=e=>lq(e),mg=()=>lq(void 0),Uw=e=>Lw(e.queue),Ui=e=>uq(e.queue),f6=e=>e.capacity===void 0?1/0:e.capacity,Vc=y(2,(e,t)=>{const n=Lw(e.queue);return e.capacity!==void 0&&n===e.capacity?!1:(a6(t)(e.queue),!0)}),zw=y(2,(e,t)=>{const n=t[Symbol.iterator]();let r,s=_t(),o=!0;for(;o&&(r=n.next())&&!r.done;)o=Vc(r.value)(e);for(;r!=null&&!r.done;)s=wn(r.value)(s),r=n.next();return co(s)}),Zs=y(2,(e,t)=>uq(e.queue)?t:c6(e.queue)),pg=y(2,(e,t)=>{let n=_t(),r=0;for(;r<t;){const s=Zs(Bt)(e);if(s===Bt)break;n=wn(s)(n),r+=1}return co(n)}),d6="effect/Clock",xk=Symbol.for(d6),Oa=Yn("effect/Clock"),h6=2**31-1,Nk={unsafeSchedule(e,t){const n=qc(t);if(n>h6)return Hn;let r=!1;const s=setTimeout(()=>{r=!0,e()},n);return()=>(clearTimeout(s),!r)}},Dk=function(){const e=BigInt(1e6);if(typeof performance>"u")return()=>BigInt(Date.now())*e;let t;return()=>(t===void 0&&(t=BigInt(Date.now())*e-BigInt(Math.round(performance.now()*1e6))),t+BigInt(Math.round(performance.now()*1e6)))}(),m6=function(){const e=typeof process=="object"&&"hrtime"in process&&typeof process.hrtime.bigint=="function"?process.hrtime:void 0;if(!e)return Dk;const t=Dk()-e.bigint();return()=>t+e.bigint()}();var ST;ST=xk;class p6{constructor(){d(this,ST,xk);d(this,"currentTimeMillis",K(()=>this.unsafeCurrentTimeMillis()));d(this,"currentTimeNanos",K(()=>this.unsafeCurrentTimeNanos()))}unsafeCurrentTimeMillis(){return Date.now()}unsafeCurrentTimeNanos(){return m6()}scheduler(){return J(Nk)}sleep(t){return Qr(n=>{const r=Nk.unsafeSchedule(()=>n(Ke),t);return Xn(K(r))})}}const g6=()=>new p6,fq="And",dq="Or",hq="InvalidData",mq="MissingData",pq="SourceUnavailable",gq="Unsupported",_6="effect/ConfigError",Mk=Symbol.for(_6),$u={_tag:"ConfigError",[Mk]:Mk},_q=(e,t)=>{const n=Object.create($u);return n._op=fq,n.left=e,n.right=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} and ${this.right}`}}),Object.defineProperty(n,"message",{enumerable:!1,get(){return this.toString()}}),n},yq=(e,t)=>{const n=Object.create($u);return n._op=dq,n.left=e,n.right=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} or ${this.right}`}}),Object.defineProperty(n,"message",{enumerable:!1,get(){return this.toString()}}),n},y6=(e,t,n={pathDelim:"."})=>{const r=Object.create($u);return r._op=hq,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Invalid data at ${v(this.path,va(n.pathDelim))}: "${this.message}")`}}),r},da=(e,t,n={pathDelim:"."})=>{const r=Object.create($u);return r._op=mq,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Missing data at ${v(this.path,va(n.pathDelim))}: "${this.message}")`}}),r},b6=(e,t,n,r={pathDelim:"."})=>{const s=Object.create($u);return s._op=pq,s.path=e,s.message=t,s.cause=n,Object.defineProperty(s,"toString",{enumerable:!1,value(){return`(Source unavailable at ${v(this.path,va(r.pathDelim))}: "${this.message}")`}}),s},S6=(e,t,n={pathDelim:"."})=>{const r=Object.create($u);return r._op=gq,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Unsupported operation at ${v(this.path,va(n.pathDelim))}: "${this.message}")`}}),r},qi=y(2,(e,t)=>{switch(e._op){case fq:return _q(qi(e.left,t),qi(e.right,t));case dq:return yq(qi(e.left,t),qi(e.right,t));case hq:return y6([...t,...e.path],e.message);case mq:return da([...t,...e.path],e.message);case pq:return b6([...t,...e.path],e.message,e.cause);case gq:return S6([...t,...e.path],e.message)}}),w6={_tag:"Empty"},J_=y(2,(e,t)=>{let n=gw(t),r=e;for(;pw(n);){const s=n.head;switch(s._tag){case"Empty":{n=n.tail;break}case"AndThen":{n=ca(s.first,ca(s.second,n.tail));break}case"MapName":{r=Qs(r,s.f),n=n.tail;break}case"Nested":{r=Jh(r,s.name),n=n.tail;break}case"Unnested":{if(v(dc(r),AL(s.name)))r=ea(r),n=n.tail;else return oe(da(r,`Expected ${s.name} to be in path in ConfigProvider#unnested`));break}}}return ce(r)}),v6="Constant",E6="Fail",k6="Fallback",$6="Described",C6="Lazy",T6="MapOrFail",I6="Nested",R6="Primitive",O6="Sequence",q6="HashMap",A6="ZipWith";var Lk={};const lm=(e,t)=>[...e,...t],P6="effect/ConfigProvider",jk=Symbol.for(P6),F6=Yn("effect/ConfigProvider"),x6="effect/ConfigProviderFlat",Uk=Symbol.for(x6),N6=e=>({[jk]:jk,pipe(){return Z(this,arguments)},...e}),D6=e=>({[Uk]:Uk,patch:e.patch,load:(t,n,r=!0)=>e.load(t,n,r),enumerateChildren:e.enumerateChildren}),M6=e=>N6({load:t=>U(_r(e,Xo(),t,!1),n=>rt(dc(n),{onNone:()=>bt(da(Xo(),`Expected a single value having structure: ${t}`)),onSome:J})),flattened:e}),L6=e=>{const{pathDelim:t,seqDelim:n}=Object.assign({},{pathDelim:"_",seqDelim:","},e),r=f=>v(f,va(t)),s=f=>f.split(t),o=()=>typeof process<"u"&&"env"in process&&typeof Lk=="object"?Lk:{};return M6(D6({load:(f,h,p=!0)=>{const g=r(f),k=o(),T=g in k?W(k[g]):V();return v(T,rg(()=>da(f,`Expected ${g} to exist in the process context`)),U(O=>H6(O,f,h,n,p)))},enumerateChildren:f=>K(()=>{const h=o(),k=Object.keys(h).map(T=>s(T.toUpperCase())).filter(T=>{for(let O=0;O<f.length;O++){const D=v(f,P1(O)),E=T[O];if(E===void 0||D!==E)return!1}return!0}).flatMap(T=>T.slice(f.length,f.length+1));return Mz(k)}),patch:w6}))},j6=(e,t,n,r)=>{const s=Y0(n.length,f=>f>=r.length?V():W([e(f),f+1])),o=Y0(r.length,f=>f>=n.length?V():W([t(f),f+1])),a=lm(n,s),u=lm(r,o);return[a,u]},U6=(e,t)=>{let n=t;if(n._tag==="Nested"){const r=e.slice();for(;n._tag==="Nested";)r.push(n.name),n=n.config;return r}return e},_r=(e,t,n,r)=>{const s=n;switch(s._tag){case v6:return J(rr(s.value));case $6:return he(()=>_r(e,t,s.config,r));case E6:return bt(da(t,s.message));case k6:return v(he(()=>_r(e,t,s.first,r)),Uc(o=>s.condition(o)?v(_r(e,t,s.second,r),Uc(a=>bt(yq(o,a)))):bt(o)));case C6:return he(()=>_r(e,t,s.config(),r));case T6:return he(()=>v(_r(e,t,s.original,r),U(Vs(o=>v(s.mapOrFail(o),rg(qi(U6(t,s.original))))))));case I6:return he(()=>_r(e,lm(t,rr(s.name)),s.config,r));case R6:return v(J_(t,e.patch),U(o=>v(e.load(o,s,r),U(a=>{if(a.length===0){const u=v(YL(o),gt(()=>"<n/a>"));return bt(da([],`Expected ${s.description} with name ${u}`))}return J(a)}))));case O6:return v(J_(t,e.patch),U(o=>v(e.enumerateChildren(o),U(W6),U(a=>a.length===0?he(()=>_e(_r(e,t,s.config,!0),rr)):v(Vs(a,u=>_r(e,VL(t,`[${u}]`),s.config,!0)),_e(u=>{const f=uj(u);return f.length===0?rr(Xo()):rr(f)}))))));case q6:return he(()=>v(J_(t,e.patch),U(o=>v(e.enumerateChildren(o),U(a=>v(a,Vs(u=>_r(e,lm(o,rr(u)),s.valueConfig,r)),_e(u=>u.length===0?rr(Hp()):v(V6(u),Qs(f=>Xz(Q0(je(a),f)))))))))));case A6:return he(()=>v(_r(e,t,s.left,r),zc,U(o=>v(_r(e,t,s.right,r),zc,U(a=>{if(en(o)&&en(a))return bt(_q(o.left,a.left));if(en(o)&&ds(a))return bt(o.left);if(ds(o)&&en(a))return bt(a.left);if(ds(o)&&ds(a)){const u=v(t,va(".")),f=z6(t,u),[h,p]=j6(f,f,v(o.right,Qs(ce)),v(a.right,Qs(ce)));return v(h,Q0(p),Vs(([g,k])=>v(ig(g,k),_e(([T,O])=>s.zip(T,O)))))}throw new Error("BUG: ConfigProvider.fromFlatLoop - please report an issue at https://github.com/Effect-TS/effect/issues")})))))}},z6=(e,t)=>n=>oe(da(e,`The element at index ${n} in a sequence at path "${t}" was missing`)),B6=(e,t)=>e.split(new RegExp(`\\s*${Qh(t)}\\s*`)),H6=(e,t,n,r,s)=>s?v(B6(e,r),Vs(o=>n.parse(o.trim())),rg(qi(t))):v(n.parse(e),$w({onFailure:qi(t),onSuccess:rr})),V6=e=>Object.keys(e[0]).map(t=>e.map(n=>n[t])),W6=e=>v(Vs(e,J6),$w({onFailure:()=>Xo(),onSuccess:Ml(Ic)}),zc,_e(SL)),K6=/^(\[(\d+)\])$/,J6=e=>{const t=e.match(K6);if(t!==null){const n=t[2];return v(n!==void 0&&n.length>0?W(n):V(),uu(G6))}return V()},G6=e=>{const t=Number.parseInt(e);return Number.isNaN(t)?V():W(t)},zk=Symbol.for("effect/Console"),gg=Yn("effect/Console"),Q6={[zk]:zk,assert(e,...t){return K(()=>{console.assert(e,...t)})},clear:K(()=>{console.clear()}),count(e){return K(()=>{console.count(e)})},countReset(e){return K(()=>{console.countReset(e)})},debug(...e){return K(()=>{console.debug(...e)})},dir(e,t){return K(()=>{console.dir(e,t)})},dirxml(...e){return K(()=>{console.dirxml(...e)})},error(...e){return K(()=>{console.error(...e)})},group(e){return e!=null&&e.collapsed?K(()=>console.groupCollapsed(e==null?void 0:e.label)):K(()=>console.group(e==null?void 0:e.label))},groupEnd:K(()=>{console.groupEnd()}),info(...e){return K(()=>{console.info(...e)})},log(...e){return K(()=>{console.log(...e)})},table(e,t){return K(()=>{console.table(e,t)})},time(e){return K(()=>console.time(e))},timeEnd(e){return K(()=>console.timeEnd(e))},timeLog(e,...t){return K(()=>{console.timeLog(e,...t)})},trace(...e){return K(()=>{console.trace(...e)})},warn(...e){return K(()=>{console.warn(...e)})},unsafe:console},Y6="effect/Random",Bk=Symbol.for(Y6),X6=Yn("effect/Random");var wT;wT=Bk;class Z6{constructor(t){d(this,"seed");d(this,wT,Bk);d(this,"PRNG");this.seed=t,this.PRNG=new KM(t)}get next(){return K(()=>this.PRNG.number())}get nextBoolean(){return _e(this.next,t=>t>.5)}get nextInt(){return K(()=>this.PRNG.integer(Number.MAX_SAFE_INTEGER))}nextRange(t,n){return _e(this.next,r=>(n-t)*r+t)}nextIntBetween(t,n){return K(()=>this.PRNG.integer(n-t)+t)}shuffle(t){return e5(t,n=>this.nextIntBetween(0,n))}}const e5=(e,t)=>he(()=>v(K(()=>Array.from(e)),U(n=>{const r=[];for(let s=n.length;s>=2;s=s-1)r.push(s);return v(r,Bc(s=>v(t(s),_e(o=>t5(n,s-1,o)))),Xt(ao(n)))}))),t5=(e,t,n)=>{const r=e[t];return e[t]=e[n],e[n]=r,e},n5=e=>new Z6(Q(e)),Hk=Symbol.for("effect/Tracer"),bq=e=>({[Hk]:Hk,...e}),fd=Yn("effect/Tracer"),vs=Yn("effect/ParentSpan"),Vk=function(){const e="abcdef0123456789",t=e.length;return function(n){let r="";for(let s=0;s<n;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}}();class r5{constructor(t,n,r,s,o,a){d(this,"name");d(this,"parent");d(this,"context");d(this,"startTime");d(this,"kind");d(this,"_tag","Span");d(this,"spanId");d(this,"traceId","native");d(this,"sampled",!0);d(this,"status");d(this,"attributes");d(this,"events",[]);d(this,"links");this.name=t,this.parent=n,this.context=r,this.startTime=o,this.kind=a,this.status={_tag:"Started",startTime:o},this.attributes=new Map,this.traceId=n._tag==="Some"?n.value.traceId:Vk(32),this.spanId=Vk(16),this.links=Array.from(s)}end(t,n){this.status={_tag:"Ended",endTime:t,exit:n,startTime:this.status.startTime}}attribute(t,n){this.attributes.set(t,n)}event(t,n,r){this.events.push([t,n,r??{}])}addLinks(t){this.links.push(...t)}}const s5=bq({span:(e,t,n,r,s,o)=>new r5(e,t,n,r,s,o),context:e=>e()}),eo=e=>{if((e==null?void 0:e.captureStackTrace)===!1)return e;if((e==null?void 0:e.captureStackTrace)!==void 0&&typeof e.captureStackTrace!="boolean")return e;const t=Error.stackTraceLimit;Error.stackTraceLimit=3;const n=new Error;Error.stackTraceLimit=t;let r=!1;return{...e,captureStackTrace:()=>{if(r!==!1)return r;if(n.stack!==void 0){const s=n.stack.split(`
`);if(s[3]!==void 0)return r=s[3].trim(),r}}}},fm=du()("effect/Tracer/DisablePropagation",{defaultValue:Hn}),o5=v(io(),ls(Oa,g6()),ls(gg,Q6),ls(X6,n5(Math.random())),ls(F6,L6()),ls(fd,s5)),Es=Ee(Symbol.for("effect/DefaultServices/currentServices"),()=>JO(o5)),i5=e=>{const t=fr(e);return Bw(n=>n.sleep(t))},Sq=e=>Ae(t=>e(t.currentDefaultServices)),Bw=e=>Sq(t=>e(t.unsafeMap.get(Oa.key))),a5=Bw(e=>e.currentTimeMillis),c5=e=>Sq(t=>e(t.unsafeMap.get(fd.key))),wq=i5,u5=a5,l5=Bw,f5=Oa;function d5(e){return new ei(e)}function h5(){return d5(new Map)}const Wk=Symbol.for("effect/FiberRefs");var vT;vT=Wk;class ei{constructor(t){d(this,"locals");d(this,vT,Wk);this.locals=t}pipe(){return Z(this,arguments)}}const m5=(e,t,n,r=!1)=>{const s=e;let o=t,a=n,u=r,f;for(;f===void 0;)if(yt(o)&&yt(a)){const h=xn(o)[0],p=ea(o),g=xn(a)[0],k=xn(a)[1],T=ea(a);h.startTimeMillis<g.startTimeMillis?(a=T,u=!0):h.startTimeMillis>g.startTimeMillis?o=p:h.id<g.id?(a=T,u=!0):h.id>g.id?o=p:f=[k,u]}else f=[s.initial,!0];return f},p5=y(3,(e,t,n)=>{const r=new Map(e.locals);return n.locals.forEach((s,o)=>{const a=s[0][1];if(!s[0][0][ge](t)){if(!r.has(o)){if(de(a,o.initial))return;r.set(o,[[t,o.join(o.initial,a)]]);return}const u=r.get(o),[f,h]=m5(o,u,s);if(h){const p=o.diff(f,a),g=u[0][1],k=o.join(g,o.patch(p)(g));if(!de(g,k)){let T;const O=u[0][0];O[ge](t)?T=[[O,k],...u.slice(1)]:T=[[t,k],...u],r.set(o,T)}}}}),new ei(r)}),g5=y(2,(e,t)=>{const n=new Map;return vq(e,n,t),new ei(n)}),vq=(e,t,n)=>{e.locals.forEach((r,s)=>{const o=r[0][1],a=s.patch(s.fork)(o);de(o,a)?t.set(s,r):t.set(s,[[n,a],...r])})},Eq=y(2,(e,t)=>{const n=new Map(e.locals);return n.delete(t),new ei(n)}),kq=y(2,(e,t)=>e.locals.has(t)?W(xn(e.locals.get(t))[1]):V()),Zl=y(2,(e,t)=>v(kq(e,t),gt(()=>t.initial))),ob=y(2,(e,{fiberId:t,fiberRef:n,value:r})=>{if(e.locals.size===0)return new ei(new Map([[n,[[t,r]]]]));const s=new Map(e.locals);return ib(s,t,n,r),new ei(s)}),ib=(e,t,n,r)=>{const s=e.get(n)??[];let o;if(yt(s)){const[a,u]=xn(s);if(a[ge](t)){if(de(u,r))return;o=[[t,r],...s.slice(1)]}else o=[[t,r],...s]}else o=[[t,r]];e.set(n,o)},_5=y(2,(e,{entries:t,forkAs:n})=>{if(e.locals.size===0)return new ei(new Map(t));const r=new Map(e.locals);return n!==void 0&&vq(e,r,n),t.forEach(([s,o])=>{o.length===1?ib(r,o[0][0],s,o[0][1]):o.forEach(([a,u])=>{ib(r,a,s,u)})}),new ei(r)}),Kk=kq,_g=Zl,y5=_5,b5=h5,S5=a4,w5=c4,$q=u4,Cq=l4,v5=WO,Hw=KO,E5=f4,k5=d4,$5=v(Ic,O1(e=>e.ordinal)),C5=EL($5),T5=e=>{switch(e){case"All":return S5;case"Debug":return Hw;case"Error":return $q;case"Fatal":return w5;case"Info":return v5;case"Trace":return E5;case"None":return k5;case"Warning":return Cq}},Tq=e=>e.replace(/[\s="]/g,"_"),Vw=e=>t=>`${Tq(t.label)}=${e-t.startTime}ms`,I5=zf,R5=lL;let $o=class extends R5{};const ti=Symbol.for("effect/Readable"),Ww=Symbol.for("effect/Ref"),Kw={_A:e=>e};var ET,kT,$T;class O5 extends($T=$o,kT=Ww,ET=ti,$T){constructor(n){super();d(this,"ref");d(this,kT,Kw);d(this,ET,ti);d(this,"get");this.ref=n,this.get=K(()=>ze(this.ref))}commit(){return this.get}modify(n){return K(()=>{const r=ze(this.ref),[s,o]=n(r);return r!==o&&ka(o)(this.ref),s})}}const Iq=e=>new O5(Ea(e)),dm=e=>K(()=>Iq(e)),Jo=e=>e.get,ef=y(2,(e,t)=>e.modify(()=>[void 0,t])),q5=y(2,(e,t)=>e.modify(n=>[n,t])),Rq=y(2,(e,t)=>e.modify(t)),ab=y(2,(e,t)=>e.modify(n=>[void 0,t(n)])),A5=Ww,hi=dm,zi=Jo,P5=q5,ki=Rq,Wc=ef,F5=ab,x5=vs,Oq=bq,N5=c5,qq="Empty",Aq="Add",Pq="Remove",Fq="Update",xq="AndThen",D5={_tag:qq},Jw=(e,t)=>{const n=new Map(e.locals);let r=D5;for(const[s,o]of t.locals.entries()){const a=xn(o)[1],u=n.get(s);if(u!==void 0){const f=xn(u)[1];de(f,a)||(r=G_({_tag:Fq,fiberRef:s,patch:s.diff(f,a)})(r))}else r=G_({_tag:Aq,fiberRef:s,value:a})(r);n.delete(s)}for(const[s]of n.entries())r=G_({_tag:Pq,fiberRef:s})(r);return r},G_=y(2,(e,t)=>({_tag:xq,first:e,second:t})),Nq=y(3,(e,t,n)=>{let r=n,s=rr(e);for(;yt(s);){const o=xn(s),a=ea(s);switch(o._tag){case qq:{s=a;break}case Aq:{r=ob(r,{fiberId:t,fiberRef:o.fiberRef,value:o.value}),s=a;break}case Pq:{r=Eq(r,o.fiberRef),s=a;break}case Fq:{const u=Zl(r,o.fiberRef);r=ob(r,{fiberId:t,fiberRef:o.fiberRef,value:o.fiberRef.patch(o.patch)(u)}),s=a;break}case xq:{s=Jh(o.first)(Jh(o.second)(a));break}}}return r}),Dq="effect/MetricLabel",cb=Symbol.for(Dq);var CT;class M5{constructor(t,n){d(this,"key");d(this,"value");d(this,CT,cb);d(this,"_hash");this.key=t,this.value=n,this._hash=$t(Dq+this.key+this.value)}[(CT=cb,pe)](){return this._hash}[ge](t){return j5(t)&&this.key===t.key&&this.value===t.value}pipe(){return Z(this,arguments)}}const L5=(e,t)=>new M5(e,t),j5=e=>ne(e,cb),U5=y(e=>hr(e[0]),function(){const e=arguments;return ag(e[0],GO,typeof e[1]=="string"?xc(e[1],e[2]):t=>Object.entries(e[1]).reduce((n,[r,s])=>xc(n,r,s),t))}),z5=e=>_e(e,W),Mq=e=>{let t,n;return typeof e=="function"?t=e:(t=e.try,n=e.catch),he(()=>{try{return J(mt(t))}catch(r){return bt(n?mt(()=>n(r)):new fg(r,"An unknown error occurred in Effect.try"))}})},B5=y(2,(e,t)=>eg(e,n=>{const r=Qp(n,s=>bw(s)?W(s):V());switch(r._tag){case"None":return Et(n);case"Some":return t(r.value.defect)}})),H5=y(2,(e,t)=>Ln(e,{onFailure:n=>{const r=t(n);switch(r._tag){case"None":return Et(n);case"Some":return r.value}},onSuccess:J})),V5=y(e=>hr(e[0]),(e,...t)=>{const n=t[t.length-1];let r;return t.length===2?r=mp(t[0]):r=s=>{const o=ne(s,"_tag")?s._tag:void 0;if(!o)return!1;for(let a=0;a<t.length-1;a++)if(t[a]===o)return!0;return!1},LO(e,r,n)}),W5=l5,K5=W5(J),J5=y(2,(e,t)=>Ct(wq(t),e)),G5=e=>Hq(e,jq,Jw),Q5=e=>Hq(e,ig(jq,t4),([t,n],[r,s])=>[Jw(t,r),Ko(n,s)]),Lq=y(2,(e,t)=>ho(e,{onFailure:n=>J(t.onFailure(n)),onSuccess:n=>J(t.onSuccess(n))})),Y5=e=>{const t=U(U(e,()=>og()),()=>t);return t},jq=Ae(e=>J(e.getFiberRefs())),Uq=e=>Lq(e,{onFailure:Nl,onSuccess:Nl}),X5=e=>Ln(e,{onFailure:t=>zq(t,"An error was silently ignored because it is not anticipated to be useful"),onSuccess:()=>Ke}),yg=e=>(...t)=>{const n=wa(e);let r;for(let s=0,o=t.length;s<o;s++){const a=t[s];yw(a)&&(r!==void 0?r=Qt(r,a):r=a,t=[...t.slice(0,s),...t.slice(s+1)],s--)}return r===void 0&&(r=lo),Ae(s=>(s.log(t,r,n),Ke))},Z5=yg(),zq=yg(Hw),eV=yg(Cq),tV=yg($q),Jk=y(2,(e,t)=>Ln(e,{onFailure:n=>jO(()=>t(n)),onSuccess:J})),nV=e=>v(Eu(),U(t=>v(Q5(e),BO(t),sV,_e(n=>Ct(n,v(Yr(t),U(([r,s])=>Xt(ig(Bq(r[0]),HO(r[1])),s)))))))),rV=e=>_e(e,t=>!t),sV=e=>_e(hi(!0),t=>Xn(nd(e,P5(t,!1)))),Bq=e=>mV((t,n)=>v(e,Nq(t,n))),oV=e=>e.length>=1?Qr((t,n)=>{try{e(n).then(r=>t(We(r)),r=>t(ic(r)))}catch(r){t(ic(r))}}):Qr(t=>{try{e().then(n=>t(We(n)),n=>t(ic(n)))}catch(n){t(ic(n))}}),tf=y(3,(e,t,n)=>ku(r=>Fw(e,ls(r,t,n)))),Gw=wq,iV=J(V()),Hq=y(3,(e,t,n)=>U(t,r=>U(e,s=>_e(t,o=>[n(r,o),s])))),aV=y(2,(e,t)=>Ln(e,{onFailure:n=>{const r=Gp(n);switch(r._tag){case"Left":return Ct(t(r.left),Et(n));case"Right":return Et(n)}},onSuccess:J})),cV=y(3,(e,t,n)=>aV(e,r=>mp(r,t)?n(r):Ke)),uV=y(2,(e,t)=>Ln(e,{onFailure:n=>Ct(t(n),Et(n)),onSuccess:J})),lV=N5,fV=lV(J),dV=e=>{let t,n;typeof e=="function"?t=e:(t=e.try,n=e.catch);const r=s=>n?td(()=>n(s)):bt(new fg(s,"An unknown error occurred in Effect.tryPromise"));return t.length>=1?Qr((s,o)=>{try{t(o).then(a=>s(We(a)),a=>s(r(a)))}catch(a){s(r(a))}}):Qr(s=>{try{t().then(o=>s(We(o)),o=>s(r(o)))}catch(o){s(r(o))}})},hV=y(2,(e,t)=>U(e,n=>Mq({try:()=>t.try(n),catch:t.catch}))),mV=e=>Ae(t=>(t.setFiberRefs(e(t.id(),t.getFiberRefs())),Ke)),pV=y(2,(e,t)=>he(()=>t()?_e(e,W):J(V()))),gV=e=>new Proxy({},{get(t,n,r){return(...s)=>U(e,o=>o[n](...s))}}),_V=e=>_e(ud(),Or(e)),yV=function(){const e=arguments;return Uq(U(Vq,t=>K(()=>{if(typeof e[0]=="string")t.attribute(e[0],e[1]);else for(const n in e[0])t.attribute(n,e[0][n])})))},bV=y(e=>hr(e[0]),function(){const e=arguments;return ag(e[0],XO,typeof e[1]=="string"?xc(e[1],e[2]):t=>Object.entries(e[1]).reduce((n,[r,s])=>xc(n,r,s),t))}),Vq=U(ud(),e=>{const t=e.unsafeMap.get(vs.key);return t!==void 0&&t._tag==="Span"?J(t):bt(new od)}),Wq=BigInt(0),Kq=uu(e=>Vn(e.context,fm)?e._tag==="Span"?Kq(e.parent):V():W(e)),Qw=(e,t,n)=>{const r=!e.getFiberRef(YO)||n.context&&Vn(n.context,fm),s=e.getFiberRef(Zr),o=n.parent?W(n.parent):n.root?V():Kq(Or(s,vs));let a;if(r)a=W4({name:t,parent:o,context:ls(n.context??io(),fm,!0)});else{const u=e.getFiberRef(Es),f=Vn(u,fd),h=Vn(u,f5),p=e.getFiberRef(ug),g=e.getFiberRefs(),k=Kk(g,XO),T=Kk(g,T4),O=T._tag==="Some"?n.links!==void 0?[...ar(T.value),...n.links??[]]:ar(T.value):n.links??Xo();a=f.span(t,o,n.context??io(),O,p?h.unsafeCurrentTimeNanos():Wq,n.kind??"internal"),k._tag==="Some"&&nB(k.value,(D,E)=>a.attribute(E,D)),n.attributes!==void 0&&Object.entries(n.attributes).forEach(([D,E])=>a.attribute(D,E))}return typeof n.captureStackTrace=="function"&&am.set(a,n.captureStackTrace),a},SV=(e,t)=>(t=eo(t),Ae(n=>J(Qw(n,e,t)))),hm=(e,t,n,r)=>K(()=>{e.status._tag!=="Ended"&&(eq(t)&&am.has(e)&&e.attribute("code.stacktrace",am.get(e)()),e.end(r?n.unsafeCurrentTimeNanos():Wq,t))}),ub=(e,...t)=>{const n=eo(t.length===1?void 0:t[0]),r=t[t.length-1];return Ae(s=>{const o=Qw(s,e,n),a=s.getFiberRef(ug),u=Vn(s.getFiberRef(Es),Oa);return ws(r(o),f=>hm(o,f,u,a))})},lb=y(2,(e,t)=>tf(e,vs,t)),wV=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=eo(e?arguments[2]:arguments[1]);if(e){const r=arguments[0];return ub(t,n,s=>lb(r,s))}return r=>ub(t,n,s=>lb(r,s))},Jq="Sequential",Gq="Parallel",vV="ParallelN",dd={_tag:Jq},EV={_tag:Gq},kV=e=>({_tag:vV,parallelism:e}),$V=e=>e._tag===Jq,CV=e=>e._tag===Gq,nf=dd,fb=EV,db=kV,rf=Jw,sf=Nq,bg="effect/FiberStatus",ha=Symbol.for(bg),mm="Done",Gk="Running",Qk="Suspended",TV=$t(`${bg}-${mm}`);var TT;let IV=class{constructor(){d(this,TT,ha);d(this,"_tag",mm)}[(TT=ha,pe)](){return TV}[ge](t){return Yw(t)&&t._tag===mm}};var IT;class RV{constructor(t){d(this,"runtimeFlags");d(this,IT,ha);d(this,"_tag",Gk);this.runtimeFlags=t}[(IT=ha,pe)](){return v(Q(bg),ue(Q(this._tag)),ue(Q(this.runtimeFlags)),it(this))}[ge](t){return Yw(t)&&t._tag===Gk&&this.runtimeFlags===t.runtimeFlags}}var RT;class OV{constructor(t,n){d(this,"runtimeFlags");d(this,"blockingOn");d(this,RT,ha);d(this,"_tag",Qk);this.runtimeFlags=t,this.blockingOn=n}[(RT=ha,pe)](){return v(Q(bg),ue(Q(this._tag)),ue(Q(this.runtimeFlags)),ue(Q(this.blockingOn)),it(this))}[ge](t){return Yw(t)&&t._tag===Qk&&this.runtimeFlags===t.runtimeFlags&&de(this.blockingOn,t.blockingOn)}}const qV=new IV,AV=e=>new RV(e),PV=(e,t)=>new OV(e,t),Yw=e=>ne(e,ha),FV=e=>e._tag===mm,xV=qV,Qq=AV,NV=PV,DV=FV,MV=Symbol.for("effect/Micro"),pm=Symbol.for("effect/Micro/MicroExit"),Yk=Symbol.for("effect/Micro/MicroCause"),LV={_E:ie};var OT;class Yq extends globalThis.Error{constructor(n,r,s){const o=`MicroCause.${n}`;let a,u,f;if(r instanceof globalThis.Error){a=`(${o}) ${r.name}`,u=r.message;const h=u.split(`
`).length;f=r.stack?`(${o}) ${r.stack.split(`
`).slice(0,h+3).join(`
`)}`:`${a}: ${u}`}else a=o,u=Qi(r,0),f=`${a}: ${u}`;s.length>0&&(f+=`
    ${s.join(`
    `)}`);super(u);d(this,"_tag");d(this,"traces");d(this,OT);this._tag=n,this.traces=s,this[Yk]=LV,this.name=a,this.stack=f}pipe(){return Z(this,arguments)}toString(){return this.stack}[(OT=Yk,Ue)](){return this.stack}}class jV extends Yq{constructor(n,r=[]){super("Die",n,r);d(this,"defect");this.defect=n}}const UV=(e,t=[])=>new jV(e,t);class zV extends Yq{constructor(t=[]){super("Interrupt","interrupted",t)}}const BV=(e=[])=>new zV(e),HV=e=>e._tag==="Interrupt",Xk=Symbol.for("effect/Micro/MicroFiber"),VV={_A:ie,_E:ie};var qT;qT=Xk;class WV{constructor(t,n=!0){d(this,"context");d(this,"interruptible");d(this,qT);d(this,"_stack",[]);d(this,"_observers",[]);d(this,"_exit");d(this,"_children");d(this,"currentOpCount",0);d(this,"_interrupted",!1);d(this,"_yielded");this.context=t,this.interruptible=n,this[Xk]=VV}getRef(t){return CU(this.context,t)}addObserver(t){return this._exit?(t(this._exit),Nl):(this._observers.push(t),()=>{const n=this._observers.indexOf(t);n>=0&&this._observers.splice(n,1)})}unsafeInterrupt(){this._exit||(this._interrupted=!0,this.interruptible&&this.evaluate(nv))}unsafePoll(){return this._exit}evaluate(t){if(this._exit)return;if(this._yielded!==void 0){const s=this._yielded;this._yielded=void 0,s()}const n=this.runLoop(t);if(n===Qd)return;const r=Zk.interruptChildren&&Zk.interruptChildren(this);if(r!==void 0)return this.evaluate(_m(r,()=>n));this._exit=n;for(let s=0;s<this._observers.length;s++)this._observers[s](n);this._observers.length=0}runLoop(t){let n=!1,r=t;this.currentOpCount=0;try{for(;;){if(this.currentOpCount++,!n&&this.getRef(rv).shouldYield(this)){n=!0;const s=r;r=_m(YV,()=>s)}if(r=r[hb](this),r===Qd){const s=this._yielded;return pm in s?(this._yielded=void 0,s):Qd}}}catch(s){return ne(r,hb)?mb(s):mb(`MicroFiber.runLoop: Not a valid effect: ${String(r)}`)}}getCont(t){for(;;){const n=this._stack.pop();if(!n)return;const r=n[gm]&&n[gm](this);if(r)return{[t]:r};if(n[t])return n}}yieldWith(t){return this._yielded=t,Qd}children(){return this._children??(this._children=new Set)}}const Zk=Ee("effect/Micro/fiberMiddleware",()=>({interruptChildren:void 0})),Xq=Symbol.for("effect/Micro/identifier"),nn=Symbol.for("effect/Micro/args"),hb=Symbol.for("effect/Micro/evaluate"),Kc=Symbol.for("effect/Micro/successCont"),bc=Symbol.for("effect/Micro/failureCont"),gm=Symbol.for("effect/Micro/ensureCont"),Qd=Symbol.for("effect/Micro/Yield"),KV={_A:ie,_E:ie,_R:ie},JV={...I5,_op:"Micro",[MV]:KV,pipe(){return Z(this,arguments)},[Symbol.iterator](){return new u1(new au(this))},toJSON(){return{_id:"Micro",op:this[Xq],...nn in this?{args:this[nn]}:void 0}},toString(){return lt(this)},[Ue](){return lt(this)}};function GV(e){return mb("Micro.evaluate: Not implemented")}const Sg=e=>({...JV,[Xq]:e.op,[hb]:e.eval??GV,[Kc]:e.contA,[bc]:e.contE,[gm]:e.ensure}),Xw=e=>{const t=Sg(e);return function(){const n=Object.create(t);return n[nn]=e.single===!1?arguments:arguments[0],n}},Zq=e=>{const t={...Sg(e),[pm]:pm,_tag:e.op,get[e.prop](){return this[nn]},toJSON(){return{_id:"MicroExit",_tag:e.op,[e.prop]:this[nn]}},[ge](n){return eW(n)&&n._tag===e.op&&de(this[nn],n[nn])},[pe](){return it(this,ue($t(e.op))(Q(this[nn])))}};return function(n){const r=Object.create(t);return r[nn]=n,r[Kc]=void 0,r[bc]=void 0,r[gm]=void 0,r}},Zw=Zq({op:"Success",prop:"value",eval(e){const t=e.getCont(Kc);return t?t[Kc](this[nn],e):e.yieldWith(this)}}),eA=Zq({op:"Failure",prop:"cause",eval(e){let t=e.getCont(bc);for(;HV(this[nn])&&t&&e.interruptible;)t=e.getCont(bc);return t?t[bc](this[nn],e):e.yieldWith(this)}}),QV=Xw({op:"Yield",eval(e){let t=!1;return e.getRef(rv).scheduleTask(()=>{t||e.evaluate(tW)},this[nn]??0),e.yieldWith(()=>{t=!0})}}),YV=QV(0),XV=Zw(void 0),ev=Xw({op:"WithMicroFiber",eval(e){return this[nn](e)}}),_m=y(2,(e,t)=>{const n=Object.create(ZV);return n[nn]=e,n[Kc]=t,n}),ZV=Sg({op:"OnSuccess",eval(e){return e._stack.push(this),this[nn]}}),eW=e=>ne(e,pm),tA=Zw,tv=eA,nv=tv(BV()),mb=e=>tv(UV(e)),tW=tA(void 0),nW="setImmediate"in globalThis?globalThis.setImmediate:e=>setTimeout(e,0);class nA{constructor(){d(this,"tasks",[]);d(this,"running",!1);d(this,"afterScheduled",()=>{this.running=!1,this.runTasks()})}scheduleTask(t,n){this.tasks.push(t),this.running||(this.running=!0,nW(this.afterScheduled))}runTasks(){const t=this.tasks;this.tasks=[];for(let n=0,r=t.length;n<r;n++)t[n]()}shouldYield(t){return t.currentOpCount>=t.getRef(oW)}flush(){for(;this.tasks.length>0;)this.runTasks()}}const rW=y(2,(e,t)=>ev(n=>{const r=n.context;return n.context=t(r),cW(e,()=>(n.context=r,XV))})),sW=y(2,(e,t)=>rW(e,Eo(t)));class oW extends du()("effect/Micro/currentMaxOpsBeforeYield",{defaultValue:()=>2048}){}class rv extends du()("effect/Micro/currentScheduler",{defaultValue:()=>new nA}){}const iW=y(2,(e,t)=>{const n=Object.create(aW);return n[nn]=e,n[Kc]=t.onSuccess,n[bc]=t.onFailure,n}),aW=Sg({op:"OnSuccessAndFailure",eval(e){return e._stack.push(this),this[nn]}}),cW=y(2,(e,t)=>lW(n=>iW(n(e),{onFailure:r=>_m(t(tv(r)),()=>eA(r)),onSuccess:r=>_m(t(tA(r)),()=>Zw(r))}))),rA=Xw({op:"SetInterruptible",ensure(e){if(e.interruptible=this[nn],e._interrupted&&e.interruptible)return()=>nv}}),uW=e=>ev(t=>t.interruptible?e:(t.interruptible=!0,t._stack.push(rA(!1)),t._interrupted?nv:e)),lW=e=>ev(t=>t.interruptible?(t.interruptible=!1,t._stack.push(rA(!0)),e(uW)):e(ie)),fW=(e,t)=>{const n=new WV(rv.context(new nA));return n.evaluate(e),n};class sv{constructor(){d(this,"buckets",[])}scheduleTask(t,n){const r=this.buckets.length;let s,o=0;for(;o<r&&this.buckets[o][0]<=n;o++)s=this.buckets[o];s&&s[0]===n?s[1].push(t):o===r?this.buckets.push([n,[t]]):this.buckets.splice(o,0,[n,[t]])}}class dW{constructor(t){d(this,"maxNextTickBeforeTimer");d(this,"running",!1);d(this,"tasks",new sv);this.maxNextTickBeforeTimer=t}starveInternal(t){const n=this.tasks.buckets;this.tasks.buckets=[];for(const[r,s]of n)for(let o=0;o<s.length;o++)s[o]();this.tasks.buckets.length===0?this.running=!1:this.starve(t)}starve(t=0){t>=this.maxNextTickBeforeTimer?setTimeout(()=>this.starveInternal(0),0):Promise.resolve(void 0).then(()=>this.starveInternal(t+1))}shouldYield(t){return t.currentOpCount>t.getFiberRef(cg)?t.getFiberRef(di):!1}scheduleTask(t,n){this.tasks.scheduleTask(t,n),this.running||(this.running=!0,this.starve())}}const sA=Ee(Symbol.for("effect/Scheduler/defaultScheduler"),()=>new dW(2048));class oA{constructor(){d(this,"tasks",new sv);d(this,"deferred",!1)}scheduleTask(t,n){this.deferred?sA.scheduleTask(t,n):this.tasks.scheduleTask(t,n)}shouldYield(t){return t.currentOpCount>t.getFiberRef(cg)?t.getFiberRef(di):!1}flush(){for(;this.tasks.buckets.length>0;){const t=this.tasks.buckets;this.tasks.buckets=[];for(const[n,r]of t)for(let s=0;s<r.length;s++)r[s]()}this.deferred=!0}}const ov=e=>e.currentOpCount>e.getFiberRef(cg)?e.getFiberRef(di):!1,hW=(e,t=ov)=>({scheduleTask:e,shouldYield:t}),mW=(e,t=ov)=>{let n=!1;const r=new sv,s=()=>{const a=r.buckets;r.buckets=[];for(const[u,f]of a)for(let h=0;h<f.length;h++)f[h]();r.buckets.length===0?n=!1:o()},o=()=>e(s);return hW((a,u)=>{r.scheduleTask(a,u),n||(n=!0,o())},t)},hd=Ee(Symbol.for("effect/FiberRef/currentScheduler"),()=>pn(sA)),pW=y(2,(e,t)=>ko(e,hd,t)),iA=Ee(Symbol.for("effect/FiberRef/currentRequestMap"),()=>pn(new Map)),e$=(e,t,n,r)=>{switch(e){case void 0:return t();case"unbounded":return n();case"inherit":return Su(k4,s=>s==="unbounded"?n():s>1?r(s):t());default:return e>1?r(e):t()}},iv="InterruptSignal",av="Stateful",cv="Resume",uv="YieldNow",Q_=e=>({_tag:iv,cause:e}),Ch=e=>({_tag:av,onFiber:e}),Wa=e=>({_tag:cv,effect:e}),gW=()=>({_tag:uv}),_W="effect/FiberScope",ym=Symbol.for(_W);var AT;AT=ym;class yW{constructor(){d(this,AT,ym);d(this,"fiberId",Nn);d(this,"roots",new Set)}add(t,n){this.roots.add(n),n.addObserver(()=>{this.roots.delete(n)})}}var PT;PT=ym;class bW{constructor(t,n){d(this,"fiberId");d(this,"parent");d(this,PT,ym);this.fiberId=t,this.parent=n}add(t,n){this.parent.tell(Ch(r=>{r.addChild(n),n.addObserver(()=>{r.removeChild(n)})}))}}const SW=e=>new bW(e.id(),e),md=Ee(Symbol.for("effect/FiberScope/Global"),()=>new yW),wW="effect/Fiber",vW=Symbol.for(wW),EW={_E:e=>e,_A:e=>e},kW="effect/Fiber",$W=Symbol.for(kW),aA=e=>e.await,CW=e=>e.inheritAll,TW=y(2,(e,t)=>v(Bc(e,cA(t)),Ct(v(e,Bc(aA))))),cA=y(2,(e,t)=>e.interruptAsFork(t)),Jc=e=>Iw(bu(e.await),e.inheritAll);({...Bf});const Mo="effect/FiberCurrent",IW=()=>wa(globalThis[Mo]),RW="effect/Logger",OW=Symbol.for(RW),qW={_Message:e=>e,_Output:e=>e},pd=e=>({[OW]:qW,log:e,pipe(){return Z(this,arguments)}}),AW=/^[^\s"=]*$/,PW=(e,t)=>({annotations:n,cause:r,date:s,fiberId:o,logLevel:a,message:u,spans:f})=>{const h=O=>O.match(AW)?O:e(O),p=(O,D)=>`${Tq(O)}=${h(D)}`,g=(O,D)=>" "+p(O,D);let k=p("timestamp",s.toISOString());k+=g("level",a.label),k+=g("fiber",zp(o));const T=BS(u);for(let O=0;O<T.length;O++)k+=g("message",Qi(T[O],t));AH(r)||(k+=g("cause",li(r,{renderErrorCause:!0})));for(const O of f)k+=" "+Vw(s.getTime())(O);for(const[O,D]of n)k+=g(O,Qi(D,t));return k},FW=e=>`"${e.replace(/\\([\s\S])|(")/g,"\\$1$2")}"`,xW=pd(PW(FW)),uA=e=>{switch(typeof e){case"bigint":case"function":case"symbol":return String(e);default:return It(e)}},NW=(e,...t)=>{let n="";for(let r=0;r<t.length;r++)n+=`\x1B[${t[r]}m`;return n+e+"\x1B[0m"},DW=(e,...t)=>e,yr={bold:"1",red:"31",green:"32",yellow:"33",blue:"34",cyan:"36",white:"37",gray:"90",black:"30",bgBrightRed:"101"},MW={None:[],All:[],Trace:[yr.gray],Debug:[yr.blue],Info:[yr.green],Warning:[yr.yellow],Error:[yr.red],Fatal:[yr.bgBrightRed,yr.black]},LW={None:"",All:"",Trace:"color:gray",Debug:"color:blue",Info:"color:green",Warning:"color:orange",Error:"color:red",Fatal:"background-color:red;color:white"},jW=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}.${e.getMilliseconds().toString().padStart(3,"0")}`,lA=typeof process=="object"&&process!==null&&typeof process.stdout=="object"&&process.stdout!==null,UW=lA&&process.stdout.isTTY===!0,zW=lA||"Deno"in globalThis,BW=e=>{const t=(e==null?void 0:e.mode)??"auto",r=(t==="auto"?zW?"tty":"browser":t)==="browser",s=typeof(e==null?void 0:e.colors)=="boolean"?e.colors:UW||r,o=(e==null?void 0:e.formatDate)??jW;return r?VW({colors:s,formatDate:o}):HW({colors:s,formatDate:o,stderr:(e==null?void 0:e.stderr)===!0})},HW=e=>{const t=typeof process=="object"&&"isBun"in process&&process.isBun===!0,n=e.colors?NW:DW;return pd(({annotations:r,cause:s,context:o,date:a,fiberId:u,logLevel:f,message:h,spans:p})=>{const g=_g(o,Es),k=Vn(g,gg).unsafe,T=e.stderr===!0?k.error:k.log,O=BS(h);let D=n(`[${e.formatDate(a)}]`,yr.white)+` ${n(f.label,...MW[f._tag])} (${zp(u)})`;if(pw(p)){const S=a.getTime(),_=Vw(S);for(const C of p)D+=" "+_(C)}D+=":";let E=0;if(O.length>0){const S=uA(O[0]);typeof S=="string"&&(D+=" "+n(S,yr.bold,yr.cyan),E++)}if(T(D),t||k.group(),Sw(s)||T(li(s,{renderErrorCause:!0})),E<O.length)for(;E<O.length;E++)T(Yi(O[E]));if(uO(r)>0)for(const[S,_]of r)T(n(`${S}:`,yr.bold,yr.white),Yi(_));t||k.groupEnd()})},VW=e=>{const t=e.colors?"%c":"";return pd(({annotations:n,cause:r,context:s,date:o,fiberId:a,logLevel:u,message:f,spans:h})=>{const p=_g(s,Es),g=Vn(p,gg).unsafe,k=BS(f);let T=`${t}[${e.formatDate(o)}]`;const O=[];if(e.colors&&O.push("color:gray"),T+=` ${t}${u.label}${t} (${zp(a)})`,e.colors&&O.push(LW[u._tag],""),pw(h)){const E=o.getTime(),S=Vw(E);for(const _ of h)T+=" "+S(_)}T+=":";let D=0;if(k.length>0){const E=uA(k[0]);typeof E=="string"&&(T+=` ${t}${E}`,e.colors&&O.push("color:deepskyblue"),D++)}if(g.groupCollapsed(T,...O),Sw(r)||g.error(li(r,{renderErrorCause:!0})),D<k.length)for(;D<k.length;D++)g.log(Yi(k[D]));if(uO(n)>0)for(const[E,S]of n){const _=Yi(S);e.colors?g.log(`%c${E}:`,"color:gray",_):g.log(`${E}:`,_)}g.groupEnd()})},fA="effect/MetricBoundaries",pb=Symbol.for(fA);var FT;class WW{constructor(t){d(this,"values");d(this,FT,pb);d(this,"_hash");this.values=t,this._hash=v($t(fA),ue(jf(this.values)))}[(FT=pb,pe)](){return this._hash}[ge](t){return KW(t)&&de(this.values,t.values)}pipe(){return Z(this,arguments)}}const KW=e=>ne(e,pb),JW=e=>{const t=v(e,wp(ut(Number.POSITIVE_INFINITY)),lj);return new WW(t)},GW=e=>v(zL(e.count-1,t=>e.start*Math.pow(e.factor,t)),jt,JW),QW="effect/MetricKeyType",dA=Symbol.for(QW),hA="effect/MetricKeyType/Counter",gb=Symbol.for(hA),YW="effect/MetricKeyType/Frequency",XW=Symbol.for(YW),ZW="effect/MetricKeyType/Gauge",eK=Symbol.for(ZW),mA="effect/MetricKeyType/Histogram",_b=Symbol.for(mA),tK="effect/MetricKeyType/Summary",nK=Symbol.for(tK),pA={_In:e=>e,_Out:e=>e};var xT,NT;class rK{constructor(t,n){d(this,"incremental");d(this,"bigint");d(this,NT,pA);d(this,xT,gb);d(this,"_hash");this.incremental=t,this.bigint=n,this._hash=$t(hA)}[(NT=dA,xT=gb,pe)](){return this._hash}[ge](t){return gA(t)}pipe(){return Z(this,arguments)}}var DT,MT;class sK{constructor(t){d(this,"boundaries");d(this,MT,pA);d(this,DT,_b);d(this,"_hash");this.boundaries=t,this._hash=v($t(mA),ue(Q(this.boundaries)))}[(MT=dA,DT=_b,pe)](){return this._hash}[ge](t){return _A(t)&&de(this.boundaries,t.boundaries)}pipe(){return Z(this,arguments)}}const oK=e=>new rK((e==null?void 0:e.incremental)??!1,(e==null?void 0:e.bigint)??!1),iK=e=>new sK(e),gA=e=>ne(e,gb),aK=e=>ne(e,XW),cK=e=>ne(e,eK),_A=e=>ne(e,_b),uK=e=>ne(e,nK),lK="effect/MetricKey",yA=Symbol.for(lK),fK={_Type:e=>e},dK=Hf(de);var LT;class lv{constructor(t,n,r,s=[]){d(this,"name");d(this,"keyType");d(this,"description");d(this,"tags");d(this,LT,fK);d(this,"_hash");this.name=t,this.keyType=n,this.description=r,this.tags=s,this._hash=v($t(this.name+this.description),ue(Q(this.keyType)),ue(jf(this.tags)))}[(LT=yA,pe)](){return this._hash}[ge](t){return hK(t)&&this.name===t.name&&de(this.keyType,t.keyType)&&de(this.description,t.description)&&dK(this.tags,t.tags)}pipe(){return Z(this,arguments)}}const hK=e=>ne(e,yA),mK=(e,t)=>new lv(e,oK(t),wa(t==null?void 0:t.description)),pK=(e,t,n)=>new lv(e,iK(t),wa(n)),gK=y(2,(e,t)=>t.length===0?e:new lv(e.name,e.keyType,e.description,_h(e.tags,t))),_K="effect/MetricState",gd=Symbol.for(_K),bA="effect/MetricState/Counter",yb=Symbol.for(bA),SA="effect/MetricState/Frequency",bb=Symbol.for(SA),wA="effect/MetricState/Gauge",Sb=Symbol.for(wA),vA="effect/MetricState/Histogram",wb=Symbol.for(vA),EA="effect/MetricState/Summary",vb=Symbol.for(EA),_d={_A:e=>e};var jT,UT;class yK{constructor(t){d(this,"count");d(this,UT,_d);d(this,jT,yb);this.count=t}[(UT=gd,jT=yb,pe)](){return v(Q(bA),ue(Q(this.count)),it(this))}[ge](t){return RK(t)&&this.count===t.count}pipe(){return Z(this,arguments)}}const bK=Hf(de);var zT,BT;class SK{constructor(t){d(this,"occurrences");d(this,BT,_d);d(this,zT,bb);d(this,"_hash");this.occurrences=t}[(BT=gd,zT=bb,pe)](){return v($t(SA),ue(jf(je(this.occurrences.entries()))),it(this))}[ge](t){return OK(t)&&bK(je(this.occurrences.entries()),je(t.occurrences.entries()))}pipe(){return Z(this,arguments)}}var HT,VT;class wK{constructor(t){d(this,"value");d(this,VT,_d);d(this,HT,Sb);this.value=t}[(VT=gd,HT=Sb,pe)](){return v(Q(wA),ue(Q(this.value)),it(this))}[ge](t){return qK(t)&&this.value===t.value}pipe(){return Z(this,arguments)}}var WT,KT;class vK{constructor(t,n,r,s,o){d(this,"buckets");d(this,"count");d(this,"min");d(this,"max");d(this,"sum");d(this,KT,_d);d(this,WT,wb);this.buckets=t,this.count=n,this.min=r,this.max=s,this.sum=o}[(KT=gd,WT=wb,pe)](){return v(Q(vA),ue(Q(this.buckets)),ue(Q(this.count)),ue(Q(this.min)),ue(Q(this.max)),ue(Q(this.sum)),it(this))}[ge](t){return AK(t)&&de(this.buckets,t.buckets)&&this.count===t.count&&this.min===t.min&&this.max===t.max&&this.sum===t.sum}pipe(){return Z(this,arguments)}}var JT,GT;class EK{constructor(t,n,r,s,o,a){d(this,"error");d(this,"quantiles");d(this,"count");d(this,"min");d(this,"max");d(this,"sum");d(this,GT,_d);d(this,JT,vb);this.error=t,this.quantiles=n,this.count=r,this.min=s,this.max=o,this.sum=a}[(GT=gd,JT=vb,pe)](){return v(Q(EA),ue(Q(this.error)),ue(Q(this.quantiles)),ue(Q(this.count)),ue(Q(this.min)),ue(Q(this.max)),ue(Q(this.sum)),it(this))}[ge](t){return PK(t)&&this.error===t.error&&de(this.quantiles,t.quantiles)&&this.count===t.count&&this.min===t.min&&this.max===t.max&&this.sum===t.sum}pipe(){return Z(this,arguments)}}const kK=e=>new yK(e),$K=e=>new SK(e),CK=e=>new wK(e),TK=e=>new vK(e.buckets,e.count,e.min,e.max,e.sum),IK=e=>new EK(e.error,e.quantiles,e.count,e.min,e.max,e.sum),RK=e=>ne(e,yb),OK=e=>ne(e,bb),qK=e=>ne(e,Sb),AK=e=>ne(e,wb),PK=e=>ne(e,vb),FK="effect/MetricHook",xK=Symbol.for(FK),NK={_In:e=>e,_Out:e=>e},yd=e=>({[xK]:NK,pipe(){return Z(this,arguments)},...e}),t$=BigInt(0),DK=e=>{let t=e.keyType.bigint?t$:0;const n=e.keyType.incremental?e.keyType.bigint?s=>s>=t$:s=>s>=0:s=>!0,r=s=>{n(s)&&(t=t+s)};return yd({get:()=>kK(t),update:r,modify:r})},MK=e=>{const t=new Map;for(const r of e.keyType.preregisteredWords)t.set(r,0);const n=r=>{const s=t.get(r)??0;t.set(r,s+1)};return yd({get:()=>$K(t),update:n,modify:n})},LK=(e,t)=>{let n=t;return yd({get:()=>CK(n),update:r=>{n=r},modify:r=>{n=n+r}})},jK=e=>{const t=e.keyType.boundaries.values,n=t.length,r=new Uint32Array(n+1),s=new Float32Array(n);let o=0,a=0,u=Number.MAX_VALUE,f=Number.MIN_VALUE;v(t,Ml(Ic),Qs((g,k)=>{s[k]=g}));const h=g=>{let k=0,T=n;for(;k!==T;){const O=Math.floor(k+(T-k)/2),D=s[O];g<=D?T=O:k=O,T===k+1&&(g<=s[k]?T=k:k=T)}r[k]=r[k]+1,o=o+1,a=a+g,g<u&&(u=g),g>f&&(f=g)},p=()=>{const g=Sp(n);let k=0;for(let T=0;T<n;T++){const O=s[T],D=r[T];k=k+D,g[T]=[O,k]}return g};return yd({get:()=>TK({buckets:p(),count:o,min:u,max:f,sum:a}),update:h,modify:h})},UK=e=>{const{error:t,maxAge:n,maxSize:r,quantiles:s}=e.keyType,o=v(s,Ml(Ic)),a=Sp(r);let u=0,f=0,h=0,p=0,g=0;const k=O=>{const D=[];let E=0;for(;E!==r-1;){const S=a[E];if(S!=null){const[_,C]=S,$=sa(O-_);rz($,LR)&&nz($,n)&&D.push(C)}E=E+1}return zK(t,o,Ml(D,Ic))},T=(O,D)=>{if(r>0){u=u+1;const E=u%r;a[E]=[D,O]}p=f===0?O:Math.min(p,O),g=f===0?O:Math.max(g,O),f=f+1,h=h+O};return yd({get:()=>IK({error:t,quantiles:k(Date.now()),count:f,min:p,max:g,sum:h}),update:([O,D])=>T(O,D),modify:([O,D])=>T(O,D)})},zK=(e,t,n)=>{const r=n.length;if(!yt(t))return Xo();const s=t[0],o=t.slice(1),a=n$(e,r,V(),0,s,n),u=rr(a);return o.forEach(f=>{u.push(n$(e,r,a.value,a.consumed,f,a.rest))}),Qs(u,f=>[f.quantile,f.value])},n$=(e,t,n,r,s,o)=>{let a=e,u=t,f=n,h=r,p=s,g=o,k=e,T=t,O=n,D=r,E=s,S=o;for(;;){if(!yt(g))return{quantile:p,value:V(),consumed:h,rest:[]};if(p===1)return{quantile:p,value:W(F1(g)),consumed:h+g.length,rest:[]};const _=xn(g),C=N1(g,M=>M===_),$=p*u,q=a/2*$,P=h+C[0].length,N=Math.abs(P-$);if(P<$-q){k=a,T=u,O=dc(g),D=P,E=p,S=C[1],a=k,u=T,f=O,h=D,p=E,g=S;continue}if(P>$+q){const M=At(f)?W(_):f;return{quantile:p,value:M,consumed:h,rest:g}}switch(f._tag){case"None":{k=a,T=u,O=dc(g),D=P,E=p,S=C[1],a=k,u=T,f=O,h=D,p=E,g=S;continue}case"Some":{const M=Math.abs($-f.value);if(N<M){k=a,T=u,O=dc(g),D=P,E=p,S=C[1],a=k,u=T,f=O,h=D,p=E,g=S;continue}return{quantile:p,value:W(f.value),consumed:h,rest:g}}}}throw new Error("BUG: MetricHook.resolveQuantiles - please report an issue at https://github.com/Effect-TS/effect/issues")},BK="effect/MetricPair",HK=Symbol.for(BK),VK={_Type:e=>e},WK=(e,t)=>({[HK]:VK,metricKey:e,metricState:t,pipe(){return Z(this,arguments)}}),KK="effect/MetricRegistry",r$=Symbol.for(KK);var QT;QT=r$;class JK{constructor(){d(this,QT,r$);d(this,"map",aq())}snapshot(){const t=[];for(const[n,r]of this.map)t.push(WK(n,r.get()));return t}get(t){const n=v(this.map,is(t),or);if(n==null){if(gA(t.keyType))return this.getCounter(t);if(cK(t.keyType))return this.getGauge(t);if(aK(t.keyType))return this.getFrequency(t);if(_A(t.keyType))return this.getHistogram(t);if(uK(t.keyType))return this.getSummary(t);throw new Error("BUG: MetricRegistry.get - unknown MetricKeyType - please report an issue at https://github.com/Effect-TS/effect/issues")}else return n}getCounter(t){let n=v(this.map,is(t),or);if(n==null){const r=DK(t);v(this.map,Ya(t))||v(this.map,Xa(t,r)),n=r}return n}getFrequency(t){let n=v(this.map,is(t),or);if(n==null){const r=MK(t);v(this.map,Ya(t))||v(this.map,Xa(t,r)),n=r}return n}getGauge(t){let n=v(this.map,is(t),or);if(n==null){const r=LK(t,t.keyType.bigint?BigInt(0):0);v(this.map,Ya(t))||v(this.map,Xa(t,r)),n=r}return n}getHistogram(t){let n=v(this.map,is(t),or);if(n==null){const r=jK(t);v(this.map,Ya(t))||v(this.map,Xa(t,r)),n=r}return n}getSummary(t){let n=v(this.map,is(t),or);if(n==null){const r=UK(t);v(this.map,Ya(t))||v(this.map,Xa(t,r)),n=r}return n}}const GK=()=>new JK,QK="effect/Metric",YK=Symbol.for(QK),XK={_Type:e=>e,_In:e=>e,_Out:e=>e},s$=Ee(Symbol.for("effect/Metric/globalMetricRegistry"),()=>GK()),kA=function(e,t,n,r){const s=Object.assign(o=>sg(o,a=>n8(s,a)),{[YK]:XK,keyType:e,unsafeUpdate:t,unsafeValue:n,unsafeModify:r,register(){return this.unsafeValue([]),this},pipe(){return Z(this,arguments)}});return s},wg=(e,t)=>$A(mK(e,t)),$A=e=>{let t;const n=new WeakMap,r=s=>{if(s.length===0)return t!==void 0||(t=s$.get(e)),t;let o=n.get(s);return o!==void 0||(o=s$.get(gK(e,s)),n.set(s,o)),o};return kA(e.keyType,(s,o)=>r(o).update(s),s=>r(s).get(),(s,o)=>r(o).modify(s))},ZK=(e,t,n)=>$A(pK(e,t,n)),e8=y(3,(e,t,n)=>t8(e,[L5(t,n)])),t8=y(2,(e,t)=>kA(e.keyType,(n,r)=>e.unsafeUpdate(n,_h(t,r)),n=>e.unsafeValue(_h(t,n)),(n,r)=>e.unsafeModify(n,_h(t,r)))),n8=y(2,(e,t)=>Su(Zy,n=>K(()=>e.unsafeUpdate(t,n)))),r8="effect/Request",s8=Symbol.for(r8),o8={_E:e=>e,_A:e=>e},i8={...MS,[s8]:o8},a8=function(){function e(t){t&&Object.assign(this,t)}return e.prototype=i8,e}(),c8=y(2,(e,t)=>Su(iA,n=>K(()=>{if(n.has(e)){const r=n.get(e);r.state.completed||(r.state.completed=!0,cd(r.result,t))}}))),u8="effect/Supervisor",vg=Symbol.for(u8),fv={_T:e=>e};var YT;YT=vg;const g0=class g0{constructor(t,n){d(this,"underlying");d(this,"value0");d(this,YT,fv);this.underlying=t,this.value0=n}get value(){return this.value0}onStart(t,n,r,s){this.underlying.onStart(t,n,r,s)}onEnd(t,n){this.underlying.onEnd(t,n)}onEffect(t,n){this.underlying.onEffect(t,n)}onSuspend(t){this.underlying.onSuspend(t)}onResume(t){this.underlying.onResume(t)}map(t){return new g0(this,v(this.value,_e(t)))}zip(t){return new Sm(this,t)}};let bm=g0;var XT;XT=vg;const _0=class _0{constructor(t,n){d(this,"left");d(this,"right");d(this,"_tag","Zip");d(this,XT,fv);this.left=t,this.right=n}get value(){return ig(this.left.value,this.right.value)}onStart(t,n,r,s){this.left.onStart(t,n,r,s),this.right.onStart(t,n,r,s)}onEnd(t,n){this.left.onEnd(t,n),this.right.onEnd(t,n)}onEffect(t,n){this.left.onEffect(t,n),this.right.onEffect(t,n)}onSuspend(t){this.left.onSuspend(t),this.right.onSuspend(t)}onResume(t){this.left.onResume(t),this.right.onResume(t)}map(t){return new bm(this,v(this.value,_e(t)))}zip(t){return new _0(this,t)}};let Sm=_0;const CA=e=>ne(e,vg)&&mp(e,"Zip");var ZT;ZT=vg;class l8{constructor(t){d(this,"effect");d(this,ZT,fv);this.effect=t}get value(){return this.effect}onStart(t,n,r,s){}onEnd(t,n){}onEffect(t,n){}onSuspend(t){}onResume(t){}map(t){return new bm(this,v(this.value,_e(t)))}zip(t){return new Sm(this,t)}onRun(t,n){return t()}}const f8=e=>new l8(e),Eg=Ee("effect/Supervisor/none",()=>f8(Ke)),d8=hu,TA="Empty",IA="AddSupervisor",RA="RemoveSupervisor",OA="AndThen",vl={_tag:TA},Th=(e,t)=>({_tag:OA,first:e,second:t}),h8=(e,t)=>m8(t,ut(e)),m8=(e,t)=>{let n=e,r=t;for(;uo(r);){const s=hs(r);switch(s._tag){case TA:{r=Hs(r);break}case IA:{n=n.zip(s.supervisor),r=Hs(r);break}case RA:{n=Eb(n,s.supervisor),r=Hs(r);break}case OA:{r=wn(s.first)(wn(s.second)(Hs(r)));break}}}return n},Eb=(e,t)=>de(e,t)?Eg:CA(e)?Eb(e.left,t).zip(Eb(e.right,t)):e,wm=e=>de(e,Eg)?ia():CA(e)?v(wm(e.left),Bl(wm(e.right))):Lp(e),p8=(e,t)=>{if(de(e,t))return vl;const n=wm(e),r=wm(t),s=v(r,dk(n),Hl(vl,(a,u)=>Th(a,{_tag:IA,supervisor:u}))),o=v(n,dk(r),Hl(vl,(a,u)=>Th(a,{_tag:RA,supervisor:u})));return Th(s,o)},g8=d8({empty:vl,patch:h8,combine:Th,diff:p8}),_8=wg("effect_fiber_started",{incremental:!0}),o$=wg("effect_fiber_active"),y8=wg("effect_fiber_successes",{incremental:!0}),b8=wg("effect_fiber_failures",{incremental:!0}),S8=e8(ZK("effect_fiber_lifetimes",GW({start:.5,factor:2,count:35})),"time_unit","milliseconds"),Qu="Continue",w8="Done",i$="Yield",v8={_E:e=>e,_A:e=>e},Yd=e=>{throw new Error(`BUG: FiberRuntime - ${Qi(e)} - please report an issue at https://github.com/Effect-TS/effect/issues`)},Fs=Symbol.for("effect/internal/fiberRuntime/YieldedOp"),xs=Ee("effect/internal/fiberRuntime/yieldedOpChannel",()=>({currentOp:null})),Yu={[Vh]:(e,t,n)=>mt(()=>t.effect_instruction_i1(n)),OnStep:(e,t,n)=>We(We(n)),[Wh]:(e,t,n)=>mt(()=>t.effect_instruction_i2(n)),[DS]:(e,t,n)=>(e.patchRuntimeFlags(e.currentRuntimeFlags,t.patch),Lo(e.currentRuntimeFlags)&&e.isInterrupted()?nt(e.getInterruptedCause()):We(n)),[Kh]:(e,t,n)=>(mt(()=>t.effect_instruction_i2(n)),mt(()=>t.effect_instruction_i0())?(e.pushStack(t),mt(()=>t.effect_instruction_i1())):Ke),[Sl]:(e,t,n)=>{const r=mt(()=>t.effect_instruction_i0.next(n));return r.done?We(r.value):(e.pushStack(t),f1(r.value))}},E8={[iv]:(e,t,n,r)=>(e.processNewInterruptSignal(r.cause),Lo(t)?nt(r.cause):n),[cv]:(e,t,n,r)=>{throw new Error("It is illegal to have multiple concurrent run loops in a single fiber")},[av]:(e,t,n,r)=>(r.onFiber(e,Qq(t)),n),[uv]:(e,t,n,r)=>U(og(),()=>n)},k8=e=>Bc(gH(e),t=>to(OH(t),([n,r])=>{const s=new Map,o=[];for(const u of r){o.push(ar(u));for(const f of u)s.set(f.request,f)}const a=o.flat();return ko(H8(n.runAll(o),a,()=>a.forEach(u=>{u.listeners.interrupted=!0})),iA,s)},!1,!1)),$8=dp();var eI,tI;class qA extends $o{constructor(n,r,s){super();d(this,tI,EW);d(this,eI,v8);d(this,"_fiberRefs");d(this,"_fiberId");d(this,"_queue",new Array);d(this,"_children",null);d(this,"_observers",new Array);d(this,"_running",!1);d(this,"_stack",[]);d(this,"_asyncInterruptor",null);d(this,"_asyncBlockingOn",null);d(this,"_exitValue",null);d(this,"_steps",[]);d(this,"_isYielding",!1);d(this,"currentRuntimeFlags");d(this,"currentOpCount",0);d(this,"currentSupervisor");d(this,"currentScheduler");d(this,"currentTracer");d(this,"currentSpan");d(this,"currentContext");d(this,"currentDefaultServices");d(this,"run",()=>{this.drainQueueOnCurrentThread()});if(this.currentRuntimeFlags=s,this._fiberId=n,this._fiberRefs=r,_k(s)){const o=this.getFiberRef(Zy);_8.unsafeUpdate(1,o),o$.unsafeUpdate(1,o)}this.refreshRefCache()}commit(){return Jc(this)}id(){return this._fiberId}resume(n){this.tell(Wa(n))}get status(){return this.ask((n,r)=>r)}get runtimeFlags(){return this.ask((n,r)=>DV(r)?n.currentRuntimeFlags:r.runtimeFlags)}scope(){return SW(this)}get children(){return this.ask(n=>Array.from(n.getChildren()))}getChildren(){return this._children===null&&(this._children=new Set),this._children}getInterruptedCause(){return this.getFiberRef(Gd)}fiberRefs(){return this.ask(n=>n.getFiberRefs())}ask(n){return he(()=>{const r=vu(this._fiberId);return this.tell(Ch((s,o)=>{cd(r,K(()=>n(s,o)))})),Yr(r)})}tell(n){this._queue.push(n),this._running||(this._running=!0,this.drainQueueLaterOnExecutor())}get await(){return Qr(n=>{const r=s=>n(J(s));return this.tell(Ch((s,o)=>{s._exitValue!==null?r(this._exitValue):s.addObserver(r)})),K(()=>this.tell(Ch((s,o)=>{s.removeObserver(r)})))},this.id())}get inheritAll(){return Ae((n,r)=>{const s=n.id(),o=n.getFiberRefs(),a=r.runtimeFlags,u=this.getFiberRefs(),f=p5(o,s,u);n.setFiberRefs(f);const h=n.getFiberRef(l$),p=v(Ko(a,h),bk(mu),bk(Qy));return HO(p)})}get poll(){return K(()=>wa(this._exitValue))}unsafePoll(){return this._exitValue}interruptAsFork(n){return K(()=>this.tell(Q_(br(n))))}unsafeInterruptAsFork(n){this.tell(Q_(br(n)))}addObserver(n){this._exitValue!==null?n(this._exitValue):this._observers.push(n)}removeObserver(n){this._observers=this._observers.filter(r=>r!==n)}getFiberRefs(){return this.setFiberRef(l$,this.currentRuntimeFlags),this._fiberRefs}unsafeDeleteFiberRef(n){this._fiberRefs=Eq(this._fiberRefs,n)}getFiberRef(n){return this._fiberRefs.locals.has(n)?this._fiberRefs.locals.get(n)[0][1]:n.initial}setFiberRef(n,r){this._fiberRefs=ob(this._fiberRefs,{fiberId:this._fiberId,fiberRef:n,value:r}),this.refreshRefCache()}refreshRefCache(){this.currentDefaultServices=this.getFiberRef(Es),this.currentTracer=this.currentDefaultServices.unsafeMap.get(fd.key),this.currentSupervisor=this.getFiberRef(z8),this.currentScheduler=this.getFiberRef(hd),this.currentContext=this.getFiberRef(Zr),this.currentSpan=this.currentContext.unsafeMap.get(vs.key)}setFiberRefs(n){this._fiberRefs=n,this.refreshRefCache()}addChild(n){this.getChildren().add(n)}removeChild(n){this.getChildren().delete(n)}transferChildren(n){const r=this._children;if(this._children=null,r!==null&&r.size>0)for(const s of r)s._exitValue===null&&n.add(this.currentRuntimeFlags,s)}drainQueueOnCurrentThread(){let n=!0;for(;n;){let r=Qu;const s=globalThis[Mo];globalThis[Mo]=this;try{for(;r===Qu;)r=this._queue.length===0?w8:this.evaluateMessageWhileSuspended(this._queue.splice(0,1)[0])}finally{this._running=!1,globalThis[Mo]=s}this._queue.length>0&&!this._running?(this._running=!0,r===i$?(this.drainQueueLaterOnExecutor(),n=!1):n=!0):n=!1}}drainQueueLaterOnExecutor(){this.currentScheduler.scheduleTask(this.run,this.getFiberRef(di))}drainQueueWhileRunning(n,r){let s=r;for(;this._queue.length>0;){const o=this._queue.splice(0,1)[0];s=E8[o._tag](this,n,s,o)}return s}isInterrupted(){return!Sw(this.getFiberRef(Gd))}addInterruptedCause(n){const r=this.getFiberRef(Gd);this.setFiberRef(Gd,Qt(r,n))}processNewInterruptSignal(n){this.addInterruptedCause(n),this.sendInterruptSignalToAllChildren()}sendInterruptSignalToAllChildren(){if(this._children===null||this._children.size===0)return!1;let n=!1;for(const r of this._children)r.tell(Q_(br(this.id()))),n=!0;return n}interruptAllChildren(){if(this.sendInterruptSignalToAllChildren()){const n=this._children.values();this._children=null;let r=!1;return Tw({while:()=>!r,body:()=>{const o=n.next();return o.done?K(()=>{r=!0}):Xn(o.value.await)},step:()=>{}})}return null}reportExitValue(n){if(_k(this.currentRuntimeFlags)){const r=this.getFiberRef(Zy),s=this.id().startTimeMillis,o=Date.now();switch(S8.unsafeUpdate(o-s,r),o$.unsafeUpdate(-1,r),n._tag){case cn:{y8.unsafeUpdate(1,r);break}case an:{b8.unsafeUpdate(1,r);break}}}if(n._tag==="Failure"){const r=this.getFiberRef(QO);!Jp(n.cause)&&r._tag==="Some"&&this.log("Fiber terminated with an unhandled error",n.cause,r)}}setExitValue(n){this._exitValue=n,this.reportExitValue(n);for(let r=this._observers.length-1;r>=0;r--)this._observers[r](n);this._observers=[]}getLoggers(){return this.getFiberRef(kg)}log(n,r,s){const o=ct(s)?s.value:this.getFiberRef(S4),a=this.getFiberRef(AA);if(C5(a,o))return;const u=this.getFiberRef(w4),f=this.getFiberRef(GO),h=this.getLoggers(),p=this.getFiberRefs();if(lw(h)>0){const g=Vn(this.getFiberRef(Es),Oa),k=new Date(g.unsafeCurrentTimeMillis());nL(p,()=>{for(const T of h)T.log({fiberId:this.id(),logLevel:o,message:n,cause:r,context:p,spans:u,annotations:f,date:k})})}}evaluateMessageWhileSuspended(n){switch(n._tag){case uv:return i$;case iv:return this.processNewInterruptSignal(n.cause),this._asyncInterruptor!==null&&(this._asyncInterruptor(nt(n.cause)),this._asyncInterruptor=null),Qu;case cv:return this._asyncInterruptor=null,this._asyncBlockingOn=null,this.evaluateEffect(n.effect),Qu;case av:return n.onFiber(this,this._exitValue!==null?xV:NV(this.currentRuntimeFlags,this._asyncBlockingOn)),Qu;default:return Yd(n)}}evaluateEffect(n){this.currentSupervisor.onResume(this);try{let r=Lo(this.currentRuntimeFlags)&&this.isInterrupted()?nt(this.getInterruptedCause()):n;for(;r!==null;){const s=r,o=this.runLoop(s);if(o===Fs){const a=xs.currentOp;xs.currentOp=null,a._op===ph?fH(this.currentRuntimeFlags)?(this.tell(gW()),this.tell(Wa($n)),r=null):r=$n:a._op===bl&&(r=null)}else{this.currentRuntimeFlags=v(this.currentRuntimeFlags,dH(Qy));const a=this.interruptAllChildren();a!==null?r=U(a,()=>o):(this._queue.length===0?this.setExitValue(o):this.tell(Wa(o)),r=null)}}}finally{this.currentSupervisor.onSuspend(this)}}start(n){if(this._running)this.tell(Wa(n));else{this._running=!0;const r=globalThis[Mo];globalThis[Mo]=this;try{this.evaluateEffect(n)}finally{this._running=!1,globalThis[Mo]=r,this._queue.length>0&&this.drainQueueLaterOnExecutor()}}}startFork(n){this.tell(Wa(n))}patchRuntimeFlags(n,r){const s=_c(n,r);return globalThis[Mo]=this,this.currentRuntimeFlags=s,s}initiateAsync(n,r){let s=!1;const o=a=>{s||(s=!0,this.tell(Wa(a)))};Lo(n)&&(this._asyncInterruptor=o);try{r(o)}catch(a){o(Et(Dn(a)))}}pushStack(n){this._stack.push(n),n._op==="OnStep"&&this._steps.push({refs:this.getFiberRefs(),flags:this.currentRuntimeFlags})}popStack(){const n=this._stack.pop();if(n)return n._op==="OnStep"&&this._steps.pop(),n}getNextSuccessCont(){let n=this.popStack();for(;n;){if(n._op!==mh)return n;n=this.popStack()}}getNextFailCont(){let n=this.popStack();for(;n;){if(n._op!==Vh&&n._op!==Kh&&n._op!==Sl)return n;n=this.popStack()}}[(tI=vW,eI=$W,rL)](n){return K(()=>Ip(this.currentContext,n))}Left(n){return bt(n.left)}None(n){return bt(new od)}Right(n){return We(n.right)}Some(n){return We(n.value)}Micro(n){return Kl(r=>{let s=r;const o=fW(sW(n,this.currentContext));return o.addObserver(a=>{if(a._tag==="Success")return s(We(a.value));switch(a.cause._tag){case"Interrupt":return s(nt(br(Nn)));case"Fail":return s(bt(a.cause.error));case"Die":return s(Jl(a.cause.defect))}}),Kl(a=>{s=u=>{a(Ke)},o.unsafeInterrupt()})})}[g1](n){const r=mt(()=>n.effect_instruction_i0()),s=this.getNextSuccessCont();return s!==void 0?(s._op in Yu||Yd(s),Yu[s._op](this,s,r)):(xs.currentOp=We(r),Fs)}[cn](n){const r=n,s=this.getNextSuccessCont();return s!==void 0?(s._op in Yu||Yd(s),Yu[s._op](this,s,r.effect_instruction_i0)):(xs.currentOp=r,Fs)}[an](n){const r=n.effect_instruction_i0,s=this.getNextFailCont();if(s!==void 0)switch(s._op){case mh:case Wh:return Lo(this.currentRuntimeFlags)&&this.isInterrupted()?nt(Sk(r)):mt(()=>s.effect_instruction_i1(r));case"OnStep":return Lo(this.currentRuntimeFlags)&&this.isInterrupted()?nt(Sk(r)):We(nt(r));case DS:return this.patchRuntimeFlags(this.currentRuntimeFlags,s.patch),Lo(this.currentRuntimeFlags)&&this.isInterrupted()?nt(Qt(r,this.getInterruptedCause())):nt(r);default:Yd(s)}else return xs.currentOp=nt(r),Fs}[_1](n){return mt(()=>n.effect_instruction_i0(this,Qq(this.currentRuntimeFlags)))}Blocked(n){const r=this.getFiberRefs(),s=this.currentRuntimeFlags;if(this._steps.length>0){const o=[],a=this._steps[this._steps.length-1];let u=this.popStack();for(;u&&u._op!=="OnStep";)o.push(u),u=this.popStack();this.setFiberRefs(a.refs),this.currentRuntimeFlags=a.flags;const f=rf(a.refs,r),h=Ko(a.flags,s);return We(FO(n.effect_instruction_i0,Ae(p=>{for(;o.length>0;)p.pushStack(o.pop());return p.setFiberRefs(sf(p.id(),p.getFiberRefs())(f)),p.currentRuntimeFlags=_c(h)(p.currentRuntimeFlags),n.effect_instruction_i1})))}return dr(o=>U($g(GH(n.effect_instruction_i0)),()=>o(n.effect_instruction_i1)))}RunBlocked(n){return k8(n.effect_instruction_i0)}[cu](n){const r=n.effect_instruction_i0,s=this.currentRuntimeFlags,o=_c(s,r);if(Lo(o)&&this.isInterrupted())return nt(this.getInterruptedCause());if(this.patchRuntimeFlags(this.currentRuntimeFlags,r),n.effect_instruction_i1){const a=Ko(o,s);return this.pushStack(new QH(a,n)),mt(()=>n.effect_instruction_i1(s))}else return $n}[Vh](n){return this.pushStack(n),n.effect_instruction_i0}OnStep(n){return this.pushStack(n),n.effect_instruction_i0}[mh](n){return this.pushStack(n),n.effect_instruction_i0}[Wh](n){return this.pushStack(n),n.effect_instruction_i0}[bl](n){return this._asyncBlockingOn=n.effect_instruction_i1,this.initiateAsync(this.currentRuntimeFlags,n.effect_instruction_i0),xs.currentOp=n,Fs}[ph](n){return this._isYielding=!1,xs.currentOp=n,Fs}[Kh](n){const r=n.effect_instruction_i0,s=n.effect_instruction_i1;return r()?(this.pushStack(n),s()):$n}[Sl](n){return Yu[Sl](this,n,void 0)}[Uf](n){return mt(()=>n.commit())}runLoop(n){let r=n;for(this.currentOpCount=0;;){if((this.currentRuntimeFlags&lH)!==0&&this.currentSupervisor.onEffect(this,r),this._queue.length>0&&(r=this.drainQueueWhileRunning(this.currentRuntimeFlags,r)),!this._isYielding){this.currentOpCount+=1;const s=this.currentScheduler.shouldYield(this);if(s!==!1){this._isYielding=!0,this.currentOpCount=0;const o=r;r=U(og({priority:s}),()=>o)}}try{if(r=this.currentTracer.context(()=>$8!==r[fa]._V?Xy(`Cannot execute an Effect versioned ${r[fa]._V} with a Runtime of version ${dp()}`):this[r._op](r),this),r===Fs){const s=xs.currentOp;return s._op===ph||s._op===bl?Fs:(xs.currentOp=null,s._op===cn||s._op===an?s:nt(Dn(s)))}}catch(s){r!==Fs&&!ne(r,"_op")||!(r._op in this)?r=Xy(`Not a valid effect: ${Qi(r)}`):A4(s)?r=nt(Qt(Dn(s),br(Nn))):r=Jl(s)}}}}const AA=Ee("effect/FiberRef/currentMinimumLogLevel",()=>pn(T5("Info"))),C8=e=>pd(t=>{const n=_g(t.context,Es);Vn(n,gg).unsafe.log(e.log(t))}),PA=Ee(Symbol.for("effect/Logger/defaultLogger"),()=>C8(xW)),FA=Ee(Symbol.for("effect/Logger/tracerLogger"),()=>pd(({annotations:e,cause:t,context:n,fiberId:r,logLevel:s,message:o})=>{const a=Or(Zl(n,Zr),vs);if(a._tag==="None"||a.value._tag==="ExternalSpan")return;const u=Ip(Zl(n,Es),Oa),f={};for(const[h,p]of e)f[h]=p;f["effect.fiberId"]=Yz(r),f["effect.logLevel"]=s.label,t!==null&&t._tag!=="Empty"&&(f["effect.cause"]=li(t,{renderErrorCause:!0})),a.value.event(Qi(Array.isArray(o)?o[0]:o),u.unsafeCurrentTimeNanos(),f)})),kg=Ee(Symbol.for("effect/FiberRef/currentLoggers"),()=>_4(Lp(PA,FA))),dv=y(e=>hr(e[0]),(e,t)=>fi(sg(e,n=>xA(r=>t(n,r))))),xA=e=>Ae(t=>{const n=t.getFiberRefs(),r=t.currentRuntimeFlags;return U(DA,s=>Gl(s,o=>Ae(a=>{const u=a.getFiberRefs(),f=a.currentRuntimeFlags,h=rf(u,n),p=Ko(f,r),g=rf(n,u);return a.setFiberRefs(sf(h,a.id(),n)),of(o4(e(o),p),K(()=>{a.setFiberRefs(sf(g,a.id(),a.getFiberRefs()))}))})))}),T8=e=>{if(Array.isArray(e)||FS(e))return[e,V()];const t=Object.keys(e),n=t.length;return[t.map(r=>e[r]),W(r=>{const s={};for(let o=0;o<n;o++)s[t[o]]=r[o];return s})]},I8=(e,t,n)=>{const r=[];for(const s of e)r.push(zc(s));return U(Gc(r,ie,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching,concurrentFinalizers:n==null?void 0:n.concurrentFinalizers}),s=>{const o=V(),a=s.length,u=new Array(a),f=new Array(a);let h=!1;for(let p=0;p<a;p++){const g=s[p];g._tag==="Left"?(u[p]=W(g.left),h=!0):(f[p]=g.right,u[p]=o)}return h?t._tag==="Some"?bt(t.value(u)):bt(u):n!=null&&n.discard?Ke:t._tag==="Some"?J(t.value(f)):J(f)})},R8=(e,t,n)=>{const r=[];for(const s of e)r.push(zc(s));return n!=null&&n.discard?Gc(r,ie,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching,discard:!0,concurrentFinalizers:n==null?void 0:n.concurrentFinalizers}):_e(Gc(r,ie,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching,concurrentFinalizers:n==null?void 0:n.concurrentFinalizers}),s=>t._tag==="Some"?t.value(s):s)},hv=(e,t)=>{const[n,r]=T8(e);return(t==null?void 0:t.mode)==="validate"?I8(n,r,t):(t==null?void 0:t.mode)==="either"?R8(n,r,t):(t==null?void 0:t.discard)!==!0&&r._tag==="Some"?_e(Gc(n,ie,t),r.value):Gc(n,ie,t)},Gc=y(e=>FS(e[0]),(e,t,n)=>Ae(r=>{const s=(n==null?void 0:n.batching)===!0||(n==null?void 0:n.batching)==="inherit"&&r.getFiberRef($4);return n!=null&&n.discard?e$(n.concurrency,()=>Ka(nf,n==null?void 0:n.concurrentFinalizers)(o=>s?to(e,(a,u)=>o(t(a,u)),!0,!1,1):Bc(e,(a,u)=>o(t(a,u)))),()=>Ka(fb,n==null?void 0:n.concurrentFinalizers)(o=>to(e,(a,u)=>o(t(a,u)),s,!1)),o=>Ka(db(o),n==null?void 0:n.concurrentFinalizers)(a=>to(e,(u,f)=>a(t(u,f)),s,!1,o))):e$(n==null?void 0:n.concurrency,()=>Ka(nf,n==null?void 0:n.concurrentFinalizers)(o=>s?kb(e,1,(a,u)=>o(t(a,u)),!0):Vs(e,(a,u)=>o(t(a,u)))),()=>Ka(fb,n==null?void 0:n.concurrentFinalizers)(o=>mv(e,(a,u)=>o(t(a,u)),s)),o=>Ka(db(o),n==null?void 0:n.concurrentFinalizers)(a=>kb(e,o,(u,f)=>a(t(u,f)),s)))})),mv=(e,t,n)=>he(()=>{const r=je(e),s=new Array(r.length);return Ct(to(r,(a,u)=>U(t(a,u),f=>K(()=>s[u]=f)),n,!1),J(s))}),to=(e,t,n,r,s)=>dr(o=>n4(a=>Ae(u=>{let f=Array.from(e).reverse(),h=f.length;if(h===0)return Ke;let p=0,g=!1;const k=s?Math.min(f.length,s):f.length,T=new Set,O=new Array,D=()=>T.forEach(M=>{M.currentScheduler.scheduleTask(()=>{M.unsafeInterruptAsFork(u.id())},0)}),E=new Array,S=new Array,_=new Array,C=()=>{const M=O.filter(({exit:B})=>B._tag==="Failure").sort((B,F)=>B.index<F.index?-1:B.index===F.index?0:1).map(({exit:B})=>B);return M.length===0&&M.push($n),M},$=(M,B=!1)=>{const F=fi(a(M)),j=q8(F,u,u.currentRuntimeFlags,md);return u.currentScheduler.scheduleTask(()=>{B&&j.unsafeInterruptAsFork(u.id()),j.resume(F)},0),j},q=()=>{r||(h-=f.length,f=[]),g=!0,D()},P=n?XH:_s,N=$(Qr(M=>{const B=(j,X)=>{j._op==="Blocked"?_.push(j):(O.push({index:X,exit:j}),j._op==="Failure"&&!g&&q())},F=()=>{if(f.length>0){const j=f.pop();let X=p++;const ye=()=>{const Be=f.pop();return X=p++,U(og(),()=>U(P(o(t(Be,X))),G))},G=Be=>f.length>0&&(B(Be,X),f.length>0)?ye():J(Be),ve=U(P(o(t(j,X))),G),Re=$(ve);E.push(Re),T.add(Re),g&&Re.currentScheduler.scheduleTask(()=>{Re.unsafeInterruptAsFork(u.id())},0),Re.addObserver(Be=>{let Xe;if(Be._op==="Failure"?Xe=Be:Xe=Be.effect_instruction_i0,S.push(Re),T.delete(Re),B(Xe,X),O.length===h)M(J(gt(yc(C(),{parallel:!0}),()=>$n)));else if(_.length+O.length===h){const He=C(),Dt=_.map(On=>On.effect_instruction_i0).reduce(EO);M(J(FO(Dt,to([gt(yc(He,{parallel:!0}),()=>$n),..._.map(On=>On.effect_instruction_i1)],On=>On,n,!0,s))))}else F()})}};for(let j=0;j<k;j++)F()}));return Xn(ws(bu(o(Jc(N))),hg({onFailure:M=>{q();const B=_.length+1,F=Math.min(typeof s=="number"?s:_.length,_.length),j=Array.from(_);return Qr(X=>{let ye=0,G=0;const ve=(Be,Xe)=>He=>{ye++,ye===B&&X(We(nt(M))),j.length>0&&Xe&&Re()},Re=()=>{$(j.pop(),!0).addObserver(ve(G,!0)),G++};N.addObserver(ve(G,!1)),G++;for(let Be=0;Be<F;Be++)Re()})},onSuccess:()=>Vs(S,M=>M.inheritAll)})))}))),kb=(e,t,n,r)=>he(()=>{const s=je(e),o=new Array(s.length);return Ct(to(s,(u,f)=>_e(n(u,f),h=>o[f]=h),r,!1,t),J(o))}),O8=e=>Ae((t,n)=>J(pv(e,t,n.runtimeFlags))),$g=e=>A8(e,md),pv=(e,t,n,r=null)=>{const s=vm(e,t,n,r);return s.resume(e),s},q8=(e,t,n,r=null)=>vm(e,t,n,r),vm=(e,t,n,r=null)=>{const s=iO(),o=t.getFiberRefs(),a=g5(o,s),u=new qA(s,a,n),f=Zl(a,Zr),h=u.currentSupervisor;return h.onStart(f,e,W(t),u),u.addObserver(g=>h.onEnd(g,u)),(r!==null?r:v(t.getFiberRef(eb),gt(()=>t.scope()))).add(n,u),u},A8=(e,t)=>Ae((n,r)=>J(pv(e,n,r.runtimeFlags,t))),a$=e=>ku(t=>rt(Or(t,Co),{onNone:()=>e,onSome:n=>{switch(n.strategy._tag){case"Parallel":return e;case"Sequential":case"ParallelN":return U(lg(n,fb),r=>Cu(e,r))}}})),c$=e=>t=>ku(n=>rt(Or(n,Co),{onNone:()=>t,onSome:r=>r.strategy._tag==="ParallelN"&&r.strategy.parallelism===e?t:U(lg(r,db(e)),s=>Cu(t,s))})),Ka=(e,t)=>n=>ku(r=>rt(Or(r,Co),{onNone:()=>n(ie),onSome:s=>{if(t===!0){const o=e._tag==="Parallel"?a$:e._tag==="Sequential"?u$:c$(e.parallelism);switch(s.strategy._tag){case"Parallel":return o(n(a$));case"Sequential":return o(n(u$));case"ParallelN":return o(n(c$(s.strategy.parallelism)))}}else return n(ie)}})),gv=e=>U(Co,e),NA=e=>U(Sd(),t=>ws(e(t),n=>t.close(n))),P8=e=>U(Sd(),t=>L8(e,t)),u$=e=>ku(t=>rt(Or(t,Co),{onNone:()=>e,onSome:n=>{switch(n.strategy._tag){case"Sequential":return e;case"Parallel":case"ParallelN":return U(lg(n,nf),r=>Cu(e,r))}}})),F8=y(e=>hr(e[1]),(e,t,n)=>bd(e,t,(r,s)=>[r,s],n)),x8=y(e=>hr(e[1]),(e,t,n)=>(n==null?void 0:n.concurrent)!==!0&&((n==null?void 0:n.batching)===void 0||n.batching===!1)?Iw(e,t):bd(e,t,(r,s)=>r,n)),N8=y(e=>hr(e[1]),(e,t,n)=>(n==null?void 0:n.concurrent)!==!0&&((n==null?void 0:n.batching)===void 0||n.batching===!1)?Ct(e,t):bd(e,t,(r,s)=>s,n)),bd=y(e=>hr(e[1]),(e,t,n,r)=>_e(hv([e,t],{concurrency:r!=null&&r.concurrent?2:1,batching:r==null?void 0:r.batching,concurrentFinalizers:r==null?void 0:r.concurrentFinalizers}),([s,o])=>n(s,o))),Co=Yn("effect/Scope"),DA=Co,D8=(e,t)=>{e.state._tag==="Open"&&e.state.finalizers.set({},t)},M8={[kk]:kk,[$k]:$k,pipe(){return Z(this,arguments)},fork(e){return K(()=>{const t=MA(e);if(this.state._tag==="Closed")return t.state=this.state,t;const n={},r=s=>t.close(s);return this.state.finalizers.set(n,r),D8(t,s=>K(()=>{this.state._tag==="Open"&&this.state.finalizers.delete(n)})),t})},close(e){return he(()=>{if(this.state._tag==="Closed")return Ke;const t=Array.from(this.state.finalizers.values()).reverse();return this.state={_tag:"Closed",exit:e},t.length===0?Ke:$V(this.strategy)?v(Vs(t,n=>_s(n(e))),U(n=>v(yc(n),Wo(K_),gt(()=>$n)))):CV(this.strategy)?v(mv(t,n=>_s(n(e)),!1),U(n=>v(yc(n,{parallel:!0}),Wo(K_),gt(()=>$n)))):v(kb(t,this.strategy.parallelism,n=>_s(n(e)),!1),U(n=>v(yc(n,{parallel:!0}),Wo(K_),gt(()=>$n))))})},addFinalizer(e){return he(()=>this.state._tag==="Closed"?e(this.state.exit):(this.state.finalizers.set({},e),Ke))}},MA=(e=dd)=>{const t=Object.create(M8);return t.strategy=e,t.state={_tag:"Open",finalizers:new Map},t},Sd=(e=dd)=>K(()=>MA(e)),Cu=y(2,(e,t)=>oq(e,Eo(Gf(Co,t)))),L8=y(2,(e,t)=>v(e,Cu(t),ws(n=>t.close(n)))),j8=e=>wu(e,{differ:g8,fork:vl}),U8=y(2,(e,t)=>Xn(dv(U(rd(e),n=>Xt(um(e,t),n)),n=>um(e,n)))),_v=y(2,(e,t)=>Su(e,n=>U8(e,t(n)))),l$=b4(hH),z8=j8(Eg),LA=y(3,(e,t,n)=>UA(e,t,{onSelfWin:(r,s)=>U(r.await,o=>{switch(o._tag){case cn:return U(r.inheritAll,()=>n.onSelfDone(o,s));case an:return n.onSelfDone(o,s)}}),onOtherWin:(r,s)=>U(r.await,o=>{switch(o._tag){case cn:return U(r.inheritAll,()=>n.onOtherDone(o,s));case an:return n.onOtherDone(o,s)}})})),B8=e=>dr(t=>Ca(n=>U($g(t(e)),r=>v(t(Jc(r)),Ta(()=>v(r,cA(n))))))),jA=y(2,(e,t)=>Ca(n=>LA(e,t,{onSelfDone:(r,s)=>rb(r,{onFailure:o=>v(Jc(s),Jk(a=>fo(o,a))),onSuccess:o=>v(s,Ws(n),Xt(o))}),onOtherDone:(r,s)=>rb(r,{onFailure:o=>v(Jc(s),Jk(a=>fo(a,o))),onSuccess:o=>v(s,Ws(n),Xt(o))})}))),UA=y(3,(e,t,n)=>Ae((r,s)=>{const o=s.runtimeFlags,a=Ea(!0),u=vm(e,r,o,n.selfScope),f=vm(t,r,o,n.otherScope);return Qr(h=>{u.addObserver(()=>f$(u,f,n.onSelfWin,a,h)),f.addObserver(()=>f$(f,u,n.onOtherWin,a,h)),u.startFork(e),f.startFork(t)},cr(u.id(),f.id()))})),f$=(e,t,n,r,s)=>{jz(!0,!1)(r)&&s(n(e,t))},of=y(2,(e,t)=>dr(n=>Ln(n(e),{onFailure:r=>Ln(t,{onFailure:s=>Et(Qt(r,s)),onSuccess:()=>Et(r)}),onSuccess:r=>Xt(t,r)}))),H8=(e,t,n)=>Ca(r=>U(U($g(ng(e)),s=>Qr(o=>{const a=t.map(h=>h.listeners.count),u=()=>{a.every(h=>h===0)&&t.every(h=>h.result.state.current._tag==="Pending"?!0:!!(h.result.state.current._tag==="Done"&&dg(h.result.state.current.effect)&&h.result.state.current.effect._tag==="Failure"&&ww(h.result.state.current.effect.cause)))&&(f.forEach(h=>h()),n==null||n(),o(Rw(s)))};s.addObserver(h=>{f.forEach(p=>p()),o(h)});const f=t.map((h,p)=>{const g=k=>{a[p]=k,u()};return h.listeners.addObserver(g),()=>h.listeners.removeObserver(g)});return u(),K(()=>{f.forEach(h=>h())})})),()=>he(()=>{const s=t.flatMap(o=>o.state.completed?[]:[o]);return Bc(s,o=>c8(o.request,qw(r)))}))),d$=(e,t)=>(t=eo(t),fi(Ae(n=>{const r=Ip(n.getFiberRef(Zr),Co),s=Qw(n,e,t),o=n.getFiberRef(ug),a=Vn(n.getFiberRef(Es),Oa);return Xt(Gl(r,u=>hm(s,u,a,o)),s)}))),V8=e=>_v(Es,ls(fd,e)),W8=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=eo(e?arguments[2]:arguments[1]);if(e){const r=arguments[0];return U(d$(t,eo(n)),s=>tf(r,vs,s))}return r=>U(d$(t,eo(n)),s=>tf(r,vs,s))},K8=lo,Tu=la,ma=Dn,Cg=br,J8=fo,G8=Qt,Q8=yw,zA=PH,Y8=bw,af=ww,no=Jp,X8=vw,Tg=Gp,yv=xH,Ig=OO,bv=I4,Sv=Xp,Z8=P4,Rg=od,Em=li,eJ=Ew,tJ="effect/ScheduleInterval",km=Symbol.for(tJ),BA={[km]:km,startMillis:0,endMillis:0},wv=(e,t)=>e>t?BA:{[km]:km,startMillis:e,endMillis:t},nJ=y(2,(e,t)=>rJ(e,t)===e),rJ=y(2,(e,t)=>e.endMillis<=t.startMillis?e:t.endMillis<=e.startMillis?t:e.startMillis<t.startMillis?e:t.startMillis<e.startMillis?t:e.endMillis<=t.endMillis?e:t),sJ=e=>e.startMillis>=e.endMillis,oJ=y(2,(e,t)=>{const n=Math.max(e.startMillis,t.startMillis),r=Math.min(e.endMillis,t.endMillis);return wv(n,r)}),iJ=e=>sa(e.endMillis-e.startMillis),aJ=e=>wv(e,Number.POSITIVE_INFINITY),h$=wv,HA=BA,cJ=nJ,uJ=sJ,lJ=oJ,fJ=iJ,dJ=aJ,hJ="effect/ScheduleIntervals",m$=Symbol.for(hJ),VA=e=>({[m$]:m$,intervals:e}),mJ=y(2,(e,t)=>pJ(e.intervals,t.intervals,_t())),pJ=(e,t,n)=>{let r=e,s=t,o=n;for(;uo(r)&&uo(s);){const a=v(hs(r),lJ(hs(s))),u=uJ(a)?o:v(o,wn(a));v(hs(r),cJ(hs(s)))?r=Hs(r):s=Hs(s),o=u}return VA(co(o))},$b=e=>v(e.intervals,Op,gt(()=>HA)).startMillis,gJ=e=>v(e.intervals,Op,gt(()=>HA)).endMillis,_J=y(2,(e,t)=>$b(e)<$b(t)),yJ=e=>uo(e.intervals),bJ=VA,SJ=mJ,Cb=$b,Tb=gJ,wJ=_J,vJ=yJ,vv="Continue",WA="Done",EJ=e=>({_tag:vv,intervals:e}),kJ=e=>({_tag:vv,intervals:bJ(ut(e))}),$J={_tag:WA},CJ=e=>e._tag===vv,TJ=e=>e._tag===WA,IJ=EJ,KA=kJ,cf=$J,p$=CJ,uf=TJ,RJ=Co,Go=ZO,OJ=Gl,yn=tb,Ev=Cu,kv=lg,$v=Sd,qJ=Vp,Cv=function(){const e=Symbol.for("effect/Data/Error/plainArgs");return{BaseEffectError:class extends Ow{constructor(n){super(n==null?void 0:n.message,n!=null&&n.cause?{cause:n.cause}:void 0),n&&(Object.assign(this,n),Object.defineProperty(this,e,{value:n,enumerable:!1}))}toJSON(){return{...this[e],...this}}}}.BaseEffectError}(),AJ=e=>{const t={BaseEffectError:class extends Cv{constructor(){super(...arguments);d(this,"_tag",e)}}};return t.BaseEffectError.prototype.name=e,t.BaseEffectError},PJ="effect/Schedule",JA=Symbol.for(PJ),GA=e=>ne(e,JA),FJ="effect/ScheduleDriver",xJ=Symbol.for(FJ),NJ={_Out:e=>e,_In:e=>e,_R:e=>e},DJ={_Out:e=>e,_In:e=>e,_R:e=>e};var nI;nI=JA;class MJ{constructor(t,n){d(this,"initial");d(this,"step");d(this,nI,NJ);this.initial=t,this.step=n}pipe(){return Z(this,arguments)}}var rI;rI=xJ;class LJ{constructor(t,n){d(this,"schedule");d(this,"ref");d(this,rI,DJ);this.schedule=t,this.ref=n}get state(){return _e(Jo(this.ref),t=>t[1])}get last(){return U(Jo(this.ref),([t,n])=>{switch(t._tag){case"None":return td(()=>new od);case"Some":return J(t.value)}})}get reset(){return ef(this.ref,[V(),this.schedule.initial])}next(t){return v(_e(Jo(this.ref),n=>n[1]),U(n=>v(u5,U(r=>v(he(()=>this.schedule.step(r,t,n)),U(([s,o,a])=>{const u=ef(this.ref,[W(o),s]);if(uf(a))return Ct(u,bt(V()));const f=Cb(a.intervals)-r;return f<=0?Xt(u,o):v(u,Ct(Gw(sa(f))),Xt(o))}))))))}}const Iu=(e,t)=>new MJ(e,t),jJ=y(2,(e,t)=>UJ(e,n=>K(()=>t(n)))),UJ=y(2,(e,t)=>KJ(e,(n,r)=>_e(t(n),s=>tz(r,fr(s))))),zJ=y(2,(e,t)=>Tv(e,(n,r)=>K(()=>t(n,r)))),Tv=y(2,(e,t)=>Iu(e.initial,(n,r,s)=>U(e.step(n,r,s),([o,a,u])=>uf(u)?J([o,a,cf]):_e(t(r,a),f=>f?[o,a,u]:[o,a,cf])))),BJ=e=>jJ(e,t=>t),QA=e=>v(dm([V(),e.initial]),_e(t=>new LJ(e,t))),HJ=(e,t=2)=>{const n=fr(e);return BJ(XA(Og,r=>ez(n,Math.pow(t,r))))},YA=y(2,(e,t)=>VJ(e,t,SJ)),VJ=y(3,(e,t,n)=>Iu([e.initial,t.initial],(r,s,o)=>v(VO(e.step(r,s,o[0]),t.step(r,s,o[1]),(a,u)=>[a,u]),U(([[a,u,f],[h,p,g]])=>p$(f)&&p$(g)?Ib(e,t,s,a,u,f.intervals,h,p,g.intervals,n):J([[a,h],[u,p],cf]))))),Ib=(e,t,n,r,s,o,a,u,f,h)=>{const p=h(o,f);return vJ(p)?J([[r,a],[s,u],IJ(p)]):v(o,wJ(f))?U(e.step(Tb(o),n,r),([g,k,T])=>uf(T)?J([[g,a],[k,u],cf]):Ib(e,t,n,g,k,T.intervals,a,u,f,h)):U(t.step(Tb(f),n,a),([g,k,T])=>uf(T)?J([[r,g],[s,k],cf]):Ib(e,t,n,r,s,o,g,k,T.intervals,h))},XA=y(2,(e,t)=>WJ(e,n=>K(()=>t(n)))),WJ=y(2,(e,t)=>Iu(e.initial,(n,r,s)=>U(e.step(n,r,s),([o,a,u])=>_e(t(a),f=>[o,f,u])))),KJ=y(2,(e,t)=>Iu(e.initial,(n,r,s)=>U(e.step(n,r,s),([o,a,u])=>{if(uf(u))return J([o,a,u]);const f=u.intervals,h=fJ(h$(n,Cb(f)));return _e(t(a,h),p=>{const g=fr(p),k=Cb(f),T=n+qc(g),O=T-k,D=Math.max(0,Tb(f)+O),E=h$(T,D);return[o,a,KA(E)]})}))),JJ=e=>Iu(e.initial,(t,n,r)=>v(e.step(t,n,r),_e(([s,o,a])=>[s,n,a]))),ZA=e=>QJ(Og,t=>t<e),GJ=(e,t)=>Iu(e,(n,r,s)=>K(()=>[t(s),s,KA(dJ(n))])),eP=y(2,(e,t)=>Tv(e,(n,r)=>rV(t(n)))),tP=y(2,(e,t)=>Tv(e,(n,r)=>t(n))),QJ=y(2,(e,t)=>zJ(e,(n,r)=>t(r))),Ih=Symbol.for("effect/Schedule/ScheduleDefect");var sI;sI=Ih;class YJ{constructor(t){d(this,"error");d(this,sI);this.error=t,this[Ih]=Ih}}const XJ=e=>ne(e,Ih),$m=e=>Uc(e,t=>Jl(new YJ(t))),nP=e=>eg(e,t=>rt(Qp(t,n=>bw(n)&&XJ(n.defect)?W(n.defect):V()),{onNone:()=>Et(t),onSome:n=>bt(n.error)})),g$=y(2,(e,t)=>eG(e,t,(n,r)=>bt(n))),ZJ=y(2,(e,t)=>{if(GA(t))return g$(e,t);const n=t.schedule??JJ(Og),r=t.while?tP(n,a=>{const u=t.while(a);return typeof u=="boolean"?J(u):$m(u)}):n,s=t.until?eP(r,a=>{const u=t.until(a);return typeof u=="boolean"?J(u):$m(u)}):r,o=t.times?YA(s,ZA(t.times)).pipe(XA(a=>a[0])):s;return nP(g$(e,o))}),eG=y(3,(e,t,n)=>U(QA(t),r=>ho(e,{onFailure:s=>n(s,V()),onSuccess:s=>rP(e,r,n,s)}))),rP=(e,t,n,r)=>ho(t.next(r),{onFailure:()=>Cw(t.last),onSuccess:s=>ho(e,{onFailure:o=>n(o,W(s)),onSuccess:o=>rP(e,t,n,o)})}),_$=y(2,(e,t)=>nG(e,t,(n,r)=>bt(n))),tG=y(2,(e,t)=>{if(GA(t))return _$(e,t);const n=t.schedule??Og,r=t.while?tP(n,a=>{const u=t.while(a);return typeof u=="boolean"?J(u):$m(u)}):n,s=t.until?eP(r,a=>{const u=t.until(a);return typeof u=="boolean"?J(u):$m(u)}):r,o=t.times?YA(s,ZA(t.times)):s;return nP(_$(e,o))}),nG=y(3,(e,t,n)=>U(QA(t),r=>sP(e,r,n))),sP=(e,t,n)=>Uc(e,r=>ho(t.next(r),{onFailure:()=>v(t.last,Cw,U(s=>n(r,s))),onSuccess:()=>sP(e,t,n)})),Og=GJ(0,e=>e+1);class rG{constructor(t){d(this,"permits");d(this,"waiters",new Set);d(this,"taken",0);d(this,"take",t=>zo(n=>{if(this.free<t){const r=()=>{this.free<t||(this.waiters.delete(r),this.taken+=t,n(J(t)))};return this.waiters.add(r),K(()=>{this.waiters.delete(r)})}return this.taken+=t,n(J(t))}));d(this,"updateTaken",t=>Ae(n=>(this.taken=t(this.taken),this.waiters.size>0&&n.getFiberRef(hd).scheduleTask(()=>{const r=this.waiters.values();let s=r.next();for(;s.done===!1&&this.free>0;)s.value(),s=r.next()},n.getFiberRef(di)),J(this.free))));d(this,"release",t=>this.updateTaken(n=>n-t));d(this,"releaseAll",this.updateTaken(t=>0));d(this,"withPermits",t=>n=>dr(r=>U(r(this.take(t)),s=>of(r(n),this.release(s)))));d(this,"withPermitsIfAvailable",t=>n=>dr(r=>he(()=>this.free<t?iV:(this.taken+=t,of(r(z5(n)),this.release(t))))));this.permits=t}get free(){return this.permits-this.taken}}const oP=e=>new rG(e),sG=e=>K(()=>oP(e));class oG extends $o{constructor(n){super();d(this,"isOpen");d(this,"waiters",[]);d(this,"scheduled",!1);d(this,"flushWaiters",()=>{this.scheduled=!1;const n=this.waiters;this.waiters=[];for(let r=0;r<n.length;r++)n[r]($n)});d(this,"open",Ae(n=>this.isOpen?Ke:(this.isOpen=!0,this.unsafeSchedule(n))));d(this,"release",Ae(n=>this.isOpen?Ke:this.unsafeSchedule(n)));d(this,"await",zo(n=>this.isOpen?n(Ke):(this.waiters.push(n),K(()=>{const r=this.waiters.indexOf(n);r!==-1&&this.waiters.splice(r,1)}))));d(this,"close",K(()=>{this.isOpen=!1}));d(this,"whenOpen",n=>Ct(this.await,n));this.isOpen=n}commit(){return this.await}unsafeSchedule(n){return this.scheduled||this.waiters.length===0||(this.scheduled=!0,n.currentScheduler.scheduleTask(this.flushWaiters,n.getFiberRef(di))),Ke}unsafeOpen(){this.isOpen||(this.isOpen=!0,this.flushWaiters())}unsafeClose(){this.isOpen=!1}}const iP=e=>new oG(e??!1),iG=e=>K(()=>iP(e)),aP=y(2,(e,t)=>Ae((n,r)=>{const s=t,o=pv(e,n,r.runtimeFlags,md);if(s.state._tag==="Open"){const a=()=>Ca(f=>de(f,o.id())?Ke:Xn(Rw(o))),u={};s.state.finalizers.set(u,a),o.addObserver(()=>{s.state._tag!=="Closed"&&s.state.finalizers.delete(u)})}else o.unsafeInterruptAsFork(n.id());return J(o)})),aG=e=>gv(t=>aP(e,t)),cG=y(2,(e,t)=>v(_s(e),jA(_s(t)),n=>bu(n))),uG=y(2,(e,t)=>lG(e,{onTimeout:()=>x4(t),duration:t})),lG=y(2,(e,{duration:t,onTimeout:n})=>bu(fG(e,{onTimeout:()=>td(n),onSuccess:J,duration:t}))),fG=y(2,(e,{duration:t,onSuccess:n,onTimeout:r})=>Ca(s=>dr(o=>UA(o(e),ng(Gw(t)),{onSelfWin:(a,u)=>U(a.await,f=>f._tag==="Success"?U(a.inheritAll,()=>Xt(Ws(u,s),n(f.value))):U(Ws(u,s),()=>nt(f.cause))),onOtherWin:(a,u)=>U(a.await,f=>f._tag==="Success"?U(a.inheritAll,()=>Xt(Ws(u,s),r())):U(Ws(u,s),()=>nt(f.cause))),otherScope:md})))),dG="effect/Ref/SynchronizedRef",cP=Symbol.for(dG),uP={_A:e=>e};var oI,iI,aI,cI;class hG extends(cI=$o,aI=cP,iI=Ww,oI=ti,cI){constructor(n,r){super();d(this,"ref");d(this,"withLock");d(this,aI,uP);d(this,iI,Kw);d(this,oI,ti);d(this,"get");this.ref=n,this.withLock=r,this.get=Jo(this.ref)}commit(){return this.get}modify(n){return this.modifyEffect(r=>J(n(r)))}modifyEffect(n){return this.withLock(v(U(Jo(this.ref),n),U(([r,s])=>Xt(ef(this.ref,s),r))))}}const mG=e=>K(()=>lP(e)),lP=e=>{const t=Iq(e),n=oP(1);return new hG(t,n.withPermits(1))},pG=Symbol.for("effect/ManagedRuntime"),gG="Fold",_G="Fresh",yG="FromEffect",bG="Scoped",SG="Suspend",wG="Provide",fP="ProvideMerge",vG="ZipWith",dP=aA,EG=IW,y$=CW,Ir=Rw,qg=Ws,hP=TW,Cm=Jc,wd=e=>function(){if(arguments.length===1){const t=arguments[0];return(n,...r)=>e(t,n,...r)}return e.apply(this,arguments)},Ag=wd((e,t,n)=>{const r=iO(),s=[[Zr,[[r,e.context]]]];n!=null&&n.scheduler&&s.push([hd,[[r,n.scheduler]]]);let o=y5(e.fiberRefs,{entries:s,forkAs:r});n!=null&&n.updateRefs&&(o=n.updateRefs(o,r));const a=new qA(r,o,e.runtimeFlags);let u=t;n!=null&&n.scope&&(u=U(kv(n.scope,dd),h=>Ct(ZO(h,Ca(p=>de(p,a.id())?Ke:Ws(a,p))),ws(t,p=>yn(h,p)))));const f=a.currentSupervisor;return f!==Eg&&(f.onStart(e.context,u,V(),a),a.addObserver(h=>f.onEnd(h,a))),md.add(e.runtimeFlags,a),(n==null?void 0:n.immediate)===!1?a.resume(u):a.start(u),a}),kG=wd((e,t)=>{const n=IG(e)(t);if(n._tag==="Failure")throw mP(n.effect_instruction_i0);return n.effect_instruction_i0});class $G extends Error{constructor(n){super(`Fiber #${n.id().id} cannot be resolved synchronously. This is caused by using runSync on an effect that performs async work`);d(this,"fiber");d(this,"_tag","AsyncFiberException");this.fiber=n,this.name=this._tag,this.stack=this.message}}const CG=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new $G(e);return Error.stackTraceLimit=t,n},Y_=Symbol.for("effect/Runtime/FiberFailure"),Xd=Symbol.for("effect/Runtime/FiberFailure/Cause");var uI,lI;class TG extends Error{constructor(n){const r=Ew(n)[0];super((r==null?void 0:r.message)||"An error has occurred");d(this,lI);d(this,uI);this[Y_]=Y_,this[Xd]=n,this.name=r?`(FiberFailure) ${r.name}`:"FiberFailure",r!=null&&r.stack&&(this.stack=r.stack)}toJSON(){return{_id:"FiberFailure",cause:this[Xd].toJSON()}}toString(){return"(FiberFailure) "+li(this[Xd],{renderErrorCause:!0})}[(lI=Y_,uI=Xd,Ue)](){return this.toString()}}const mP=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new TG(e);return Error.stackTraceLimit=t,n},pP=e=>{const t=e;switch(t._op){case"Failure":case"Success":return t;case"Left":return Ql(t.left);case"Right":return We(t.right);case"Some":return We(t.value);case"None":return Ql(od())}},IG=wd((e,t)=>{const n=pP(t);if(n)return n;const r=new oA,s=Ag(e)(t,{scheduler:r});r.flush();const o=s.unsafePoll();return o||ic(kw(CG(s),Nw(s)))}),RG=wd((e,t,n)=>gP(e,t,n).then(r=>{switch(r._tag){case cn:return r.effect_instruction_i0;case an:throw mP(r.effect_instruction_i0)}})),gP=wd((e,t,n)=>new Promise(r=>{const s=pP(t);s&&r(s);const o=Ag(e)(t);o.addObserver(a=>{r(a)}),(n==null?void 0:n.signal)!==void 0&&(n.signal.aborted?o.unsafeInterruptAsFork(o.id()):n.signal.addEventListener("abort",()=>{o.unsafeInterruptAsFork(o.id())},{once:!0}))}));class _P{constructor(t,n,r){d(this,"context");d(this,"runtimeFlags");d(this,"fiberRefs");this.context=t,this.runtimeFlags=n,this.fiberRefs=r}pipe(){return Z(this,arguments)}}const yP=e=>new _P(e.context,e.runtimeFlags,e.fiberRefs),OG=()=>Ae((e,t)=>J(new _P(e.getFiberRef(Zr),t.runtimeFlags,e.getFiberRefs()))),qG=wO(mu,bO,yO),lf=yP({context:io(),runtimeFlags:qG,fiberRefs:b5()}),AG=y(2,(e,t)=>yP({context:t(e.context),runtimeFlags:e.runtimeFlags,fiberRefs:e.fiberRefs})),PG=Ag(lf),FG=RG(lf),xG=kG(lf),NG=y(2,(e,t)=>e.modifyEffect(t)),DG="effect/Layer",bP=Symbol.for(DG),MG={_RIn:e=>e,_E:e=>e,_ROut:e=>e},ni={[bP]:MG,pipe(){return Z(this,arguments)}},LG="effect/Layer/MemoMap",X_=Symbol.for(LG),jG=du()("effect/Layer/CurrentMemoMap",{defaultValue:()=>BG()}),SP=e=>ne(e,bP),UG=e=>e._op_layer===_G;var fI;fI=X_;class wP{constructor(t){d(this,"ref");d(this,fI);this.ref=t,this[X_]=X_}getOrElseMemoize(t,n){return v(NG(this.ref,r=>{const s=r.get(t);if(s!==void 0){const[o,a]=s,u=v(o,U(([f,h])=>v(Bq(f),Xt(h))),ws(hg({onFailure:()=>Ke,onSuccess:()=>Gl(n,a)})));return J([u,r])}return v(dm(0),U(o=>v(Eu(),U(a=>v(dm(()=>Ke),_e(u=>{const f=dr(p=>v(Sd(),U(g=>v(p(U(vP(t,g,!0),k=>G5(k(this)))),_s,U(k=>{switch(k._tag){case an:return v(sq(a,k.effect_instruction_i0),Ct(tb(g,k)),Ct(Et(k.effect_instruction_i0)));case cn:return v(ef(u,T=>v(tb(g,T),nd(Rq(o,O=>[O===1,O-1])),Xn)),Ct(ab(o,T=>T+1)),Ct(Gl(n,T=>v(K(()=>r.delete(t)),Ct(Jo(u)),U(O=>O(T))))),Ct(ad(a,k.effect_instruction_i0)),Xt(k.effect_instruction_i0[1]))}}))))),h=[v(Yr(a),ws(rb({onFailure:()=>Ke,onSuccess:()=>ab(o,p=>p+1)}))),p=>v(Jo(u),U(g=>g(p)))];return[f,UG(t)?r:r.set(t,h)]}))))))}),bu)}}const zG=he(()=>_e(mG(new Map),e=>new wP(e))),BG=()=>new wP(lP(new Map)),Iv=y(2,(e,t)=>U(zG,n=>HG(e,n,t))),HG=y(3,(e,t,n)=>U(vP(e,n),r=>tf(r(t),jG,t))),vP=(e,t,n=!1)=>{const r=e;switch(r._op_layer){case"Locally":return K(()=>s=>r.f(s.getOrElseMemoize(r.self,t)));case"ExtendScope":return K(()=>s=>gv(o=>s.getOrElseMemoize(r.layer,o)));case"Fold":return K(()=>s=>v(s.getOrElseMemoize(r.layer,t),Ln({onFailure:o=>s.getOrElseMemoize(r.failureK(o),t),onSuccess:o=>s.getOrElseMemoize(r.successK(o),t)})));case"Fresh":return K(()=>s=>v(r.layer,Iv(t)));case"FromEffect":return K(n?()=>s=>r.effect:()=>s=>s.getOrElseMemoize(e,t));case"Provide":return K(()=>s=>v(s.getOrElseMemoize(r.first,t),U(o=>v(s.getOrElseMemoize(r.second,t),Fw(o)))));case"Scoped":return K(n?()=>s=>Cu(r.effect,t):()=>s=>s.getOrElseMemoize(e,t));case"Suspend":return K(()=>s=>s.getOrElseMemoize(r.evaluate(),t));case"ProvideMerge":return K(()=>s=>v(s.getOrElseMemoize(r.first,t),VO(s.getOrElseMemoize(r.second,t),r.zipK)));case"ZipWith":return K(()=>s=>v(s.getOrElseMemoize(r.first,t),bd(s.getOrElseMemoize(r.second,t),r.zipK,{concurrent:!0})))}},VG=()=>Ru(ud()),WG=e=>EP(Tu(e)),EP=e=>Ru(Et(e)),Rv=y(2,(e,t)=>JG(e,{onFailure:WG,onSuccess:t})),kP=y(2,(e,t)=>{const n=Tp(e),r=n?e:t;return Ru(_e(n?t:e,o=>Gf(r,o)))});function Ru(e){const t=Object.create(ni);return t._op_layer=yG,t.effect=e,t}const KG=y(2,(e,{onFailure:t,onSuccess:n})=>{const r=Object.create(ni);return r._op_layer=gG,r.layer=e,r.failureK=t,r.successK=n,r}),JG=y(2,(e,{onFailure:t,onSuccess:n})=>KG(e,{onFailure:r=>{const s=Tg(r);switch(s._tag){case"Left":return t(s.left);case"Right":return EP(s.right)}},onSuccess:n})),GG=y(2,(e,t)=>tQ(e,t,(n,r)=>Eo(n,r))),$P=(...e)=>{let t=e[0];for(let n=1;n<e.length;n++)t=GG(t,e[n]);return t},CP=y(2,(e,t)=>{const n=Tp(e),r=n?e:t;return TP(_e(n?t:e,o=>Gf(r,o)))}),Pg=e=>TP(v(e,Xt(io()))),TP=e=>{const t=Object.create(ni);return t._op_layer=bG,t.effect=e,t},QG=y(2,(e,t)=>{const n=Tp(e);return Ru(J(Gf(n?e:t,n?t:e)))}),YG=e=>Ru(J(e)),XG=YG(io()),IP=e=>{const t=Object.create(ni);return t._op_layer=SG,t.evaluate=e,t},ZG=y(2,(e,t)=>{const n=Tp(e),r=n?e:t,s=n?t:e;return Ru(K(()=>Gf(r,s())))}),RP=y(2,(e,t)=>IP(()=>{const n=Object.create(ni);return n._op_layer=wG,n.first=Object.create(ni,{_op_layer:{value:fP,enumerable:!0},first:{value:VG(),enumerable:!0},second:{value:Array.isArray(t)?$P(...t):t},zipK:{value:(r,s)=>v(r,Eo(s))}}),n.second=e,n})),eQ=y(2,(e,t)=>{const n=Object.create(ni);return n._op_layer=fP,n.first=t,n.second=RP(e,t),n.zipK=(r,s)=>v(r,Eo(s)),n}),tQ=y(3,(e,t,n)=>IP(()=>{const r=Object.create(ni);return r._op_layer=vG,r.first=e,r.second=t,r.zipK=n,r})),nQ=e=>{const t=Yn("effect/Layer/unwrapEffect/Layer.Layer<R1, E1, A>");return Rv(kP(t,e),n=>Vn(n,t))},rQ=e=>{const t=Yn("effect/Layer/unwrapScoped/Layer.Layer<R1, E1, A>");return Rv(CP(t,e),n=>Vn(n,t))},b$=y(2,(e,t)=>NA(n=>U(Iv(t,n),r=>xw(e,r)))),S$=y(2,(e,t)=>{const n=rf(lf.fiberRefs,t.fiberRefs),r=Ko(lf.runtimeFlags,t.runtimeFlags);return dr(s=>Ae(o=>{const a=o.getFiberRef(Zr),u=o.getFiberRefs(),f=sf(o.id(),u)(n),h=o.currentRuntimeFlags,p=_c(r)(h),g=rf(f,u),k=Ko(p,h);return o.setFiberRefs(f),o.currentRuntimeFlags=p,of(xw(s(e),Eo(a,t.context)),Ae(T=>(T.setFiberRefs(sf(T.id(),T.getFiberRefs())(g)),T.currentRuntimeFlags=_c(k)(T.currentRuntimeFlags),Ke)))}))}),sQ=y(2,(e,t)=>Array.isArray(t)?b$(e,$P(...t)):SP(t)?b$(e,t):qU(t)?xw(e,t):pG in t?U(t.runtimeEffect,n=>S$(e,n)):S$(e,t)),oQ=a8,w$=fa,qr=hr,Z_=nV,vd=hv,bn=Gc,OP=Qr,ks=Ae,Mn=bt,Wn=Et,ri=Jl,qP=Xy,z=r4,Ov=i4,Fg=oV,Le=J,pt=he,Te=K,fe=Ke,xg=Uc,ys=eg,iQ=B5,aQ=LO,ey=H5,qv=V5,Av=Uq,Ed=X5,Pv=tG,To=Mq,cQ=hV,El=dV,uQ=B8,as=fn,qt=ng,lQ=Ta,Bo=fi,si=dr,ro=Xt,$s=Xn,Se=_e,AP=$w,mo=rg,ot=dv,PP=DO,Gn=xA,Ai=of,fQ=ZH,dQ=ws,Ng=DA,hQ=gv,Tm=NA,oi=P8,Fv=Ca,Dg=O8,xv=$g,ur=aP,Vt=aG,mQ=pW,pQ=E4,gQ=K5,_Q=J5,Qc=Gw,Mg=uG,FP=ud,yQ=oq,Cn=sQ,Rh=tf,bQ=gV,SQ=_V,Ei=zc,Wt=_s,kd=BO,xP=pV,Y=U,Br=YH,$i=bu,ty=jA,NP=cG,Nv=LA,po=sg,wQ=cV,Ou=uV,ff=Y5,v$=ZJ,vQ=ag,EQ=Lq,df=UO,Sr=Ln,kQ=Z5,cs=zq,Ks=eV,Yc=tV,Sc=U5,$Q=C4,wr=Cw,Io=OG,Lg=sG,CQ=iP,Rb=iG,Ro=PG,DP=FG,bs=xG,Im=F8,Dv=x8,ht=N8,Xc=bd,TQ=fV,IQ=bV,Ob=yV,jg=Vq,RQ=SV,OQ=ub,Ie=wV,$d=W8,Pi=lb,Ug=function(e,...t){const n=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;if(Error.stackTraceLimit=n,typeof e!="string")return E$(e.length,function(...a){const u=Error.stackTraceLimit;Error.stackTraceLimit=2;const f=new Error;return Error.stackTraceLimit=u,k$({self:this,body:e,args:a,pipeables:t,spanName:"<anonymous>",spanOptions:{context:fm.context(!0)},errorDef:r,errorCall:f})});const s=e,o=t[0];return(a,...u)=>E$(a.length,{[s](...f){const h=Error.stackTraceLimit;Error.stackTraceLimit=2;const p=new Error;return Error.stackTraceLimit=h,k$({self:this,body:a,args:f,pipeables:u,spanName:s,spanOptions:o,errorDef:r,errorCall:p})}}[s])};function E$(e,t){return Object.defineProperty(t,"length",{value:e,configurable:!0})}function k$(e){let t,n;if(XM(e.body))t=cm(()=>e.body.apply(e.self,e.args));else try{t=e.body.apply(e.self,e.args)}catch(a){n=a,t=ri(a)}if(e.pipeables.length>0)try{for(const a of e.pipeables)t=a(t,...e.args)}catch(a){t=n?Wn(Qt(Dn(n),Dn(a))):ri(a)}let r=!1;const s=()=>{if(r!==!1)return r;if(e.errorCall.stack){const a=e.errorDef.stack.trim().split(`
`),u=e.errorCall.stack.trim().split(`
`);let f=a.slice(2).join(`
`).trim();f.includes("(")||(f=f.replace(/at (.*)/,"at ($1)"));let h=u.slice(2).join(`
`).trim();return h.includes("(")||(h=h.replace(/at (.*)/,"at ($1)")),r=`${f}
${h}`,r}},o=e.spanOptions&&"captureStackTrace"in e.spanOptions?e.spanOptions:{captureStackTrace:s,...e.spanOptions};return Ie(t,e.spanName,o)}const Rm=s4,Mv=pn,qQ=rd,AQ=Su,MP=Zr,PQ=di,FQ=kg,LP=hd,xQ=YO,NQ=ug,DQ=y(2,(e,t)=>ko(AA,t)(e)),MQ=e=>Pg(_v(kg,gc(e))),LQ=e=>Pg(_v(kg,fw(e))),jQ=y(2,(e,t)=>Rv(LQ(e),()=>MQ(t))),UQ=e=>Pg(V8(e)),zQ=SP,jP=Iv,UP=kP,BQ=XG,HQ=CP,VQ=Pg,Lv=QG,WQ=ZG,jv=RP,zP=eQ,BP=nQ,Uv=rQ,HP=UQ,KQ="effect/QueueEnqueue",VP=Symbol.for(KQ),JQ="effect/QueueDequeue",zv=Symbol.for(JQ),GQ="effect/QueueStrategy",Bv=Symbol.for(GQ),QQ="effect/BackingQueue",YQ=Symbol.for(QQ),Hv={_A:e=>e},XQ={_A:e=>e},WP={_In:e=>e},Vv={_Out:e=>e};var dI,hI,mI;class ZQ extends(mI=$o,hI=VP,dI=zv,mI){constructor(n,r,s,o,a){super();d(this,"queue");d(this,"takers");d(this,"shutdownHook");d(this,"shutdownFlag");d(this,"strategy");d(this,hI,WP);d(this,dI,Vv);this.queue=n,this.takers=r,this.shutdownHook=s,this.shutdownFlag=o,this.strategy=a}pipe(){return Z(this,arguments)}commit(){return this.take}capacity(){return this.queue.capacity()}get size(){return he(()=>Uc(this.unsafeSize(),()=>fn))}unsafeSize(){return ze(this.shutdownFlag)?V():W(this.queue.length()-Uw(this.takers)+this.strategy.surplusSize())}get isEmpty(){return _e(this.size,n=>n<=0)}get isFull(){return _e(this.size,n=>n>=this.capacity())}get shutdown(){return fi(Ae(n=>(v(this.shutdownFlag,ka(!0)),v(to(wc(this.takers),r=>Pw(r,n.id()),!1,!1),Ct(this.strategy.shutdown),nd(ad(this.shutdownHook,void 0)),Xn))))}get isShutdown(){return K(()=>ze(this.shutdownFlag))}get awaitShutdown(){return Yr(this.shutdownHook)}isActive(){return!ze(this.shutdownFlag)}unsafeOffer(n){if(ze(this.shutdownFlag))return!1;let r;if(this.queue.length()===0){const o=v(this.takers,Zs(Bt));o!==Bt?(Bi(o,n),r=!0):r=!1}else r=!1;if(r)return!0;const s=this.queue.offer(n);return Fi(this.strategy,this.queue,this.takers),s}offer(n){return he(()=>{if(ze(this.shutdownFlag))return fn;let r;if(this.queue.length()===0){const o=v(this.takers,Zs(Bt));o!==Bt?(Bi(o,n),r=!0):r=!1}else r=!1;if(r)return J(!0);const s=this.queue.offer(n);return Fi(this.strategy,this.queue,this.takers),s?J(!0):this.strategy.handleSurplus([n],this.queue,this.takers,this.shutdownFlag)})}offerAll(n){return he(()=>{if(ze(this.shutdownFlag))return fn;const r=je(n),s=this.queue.length()===0?je(b9(this.takers,r.length)):Xo,[o,a]=v(r,M1(s.length));for(let f=0;f<s.length;f++){const h=s[f],p=o[f];Bi(h,p)}if(a.length===0)return J(!0);const u=this.queue.offerAll(a);return Fi(this.strategy,this.queue,this.takers),Qf(u)?J(!0):this.strategy.handleSurplus(u,this.queue,this.takers,this.shutdownFlag)})}get take(){return Ae(n=>{if(ze(this.shutdownFlag))return fn;const r=this.queue.poll(Bt);if(r!==Bt)return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),J(r);{const s=vu(n.id());return v(he(()=>(v(this.takers,Vc(s)),Fi(this.strategy,this.queue,this.takers),ze(this.shutdownFlag)?fn:Yr(s))),Ta(()=>K(()=>S9(this.takers,s))))}})}get takeAll(){return he(()=>ze(this.shutdownFlag)?fn:K(()=>{const n=this.queue.pollUpTo(Number.POSITIVE_INFINITY);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),ao(n)}))}takeUpTo(n){return he(()=>ze(this.shutdownFlag)?fn:K(()=>{const r=this.queue.pollUpTo(n);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),ao(r)}))}takeBetween(n,r){return he(()=>KP(this,n,r,_t()))}}const KP=(e,t,n,r)=>n<t?J(r):v(d9(e,n),U(s=>{const o=t-s.length;return o===1?v(qb(e),_e(a=>v(r,Tt(s),jl(a)))):o>1?v(qb(e),U(a=>KP(e,o-1,n-s.length-1,v(r,Tt(s),jl(a))))):J(v(r,Tt(s)))})),e9=e=>v(K(()=>jw(e)),U(t=>zg(Bg(t),m9()))),t9=e=>v(K(()=>jw(e)),U(t=>zg(Bg(t),JP()))),n9=e=>v(K(()=>jw(e)),U(t=>zg(Bg(t),p9()))),r9=()=>v(K(()=>mg()),U(e=>zg(Bg(e),JP()))),s9=(e,t,n,r,s)=>new ZQ(e,t,n,r,s),zg=(e,t)=>v(Eu(),_e(n=>s9(e,mg(),n,Ea(!1),t)));var pI;pI=YQ;class o9{constructor(t){d(this,"mutable");d(this,pI,XQ);this.mutable=t}poll(t){return Zs(this.mutable,t)}pollUpTo(t){return pg(this.mutable,t)}offerAll(t){return zw(this.mutable,t)}offer(t){return Vc(this.mutable,t)}capacity(){return f6(this.mutable)}length(){return Uw(this.mutable)}}const Bg=e=>new o9(e),i9=e=>e.size,a9=e=>e.isShutdown,c9=e=>e.shutdown,u9=y(2,(e,t)=>e.offer(t)),l9=y(2,(e,t)=>e.offerAll(t)),qb=e=>e.take,f9=e=>e.takeAll,d9=y(2,(e,t)=>e.takeUpTo(t)),h9=y(3,(e,t,n)=>e.takeBetween(t,n)),m9=()=>new g9,JP=()=>new _9,p9=()=>new y9;var gI;gI=Bv;class g9{constructor(){d(this,gI,Hv);d(this,"putters",mg())}surplusSize(){return Uw(this.putters)}onCompleteTakersWithEmptyQueue(t){for(;!Ui(this.putters)&&!Ui(t);){const n=Zs(t,void 0),r=Zs(this.putters,void 0);r[2]&&Bi(r[1],!0),Bi(n,r[0])}}get shutdown(){return v(tg,U(t=>v(K(()=>wc(this.putters)),U(n=>to(n,([r,s,o])=>o?v(Pw(s,t),Xn):Ke,!1,!1)))))}handleSurplus(t,n,r,s){return Ae(o=>{const a=vu(o.id());return v(he(()=>(this.unsafeOffer(t,a),this.unsafeOnQueueEmptySpace(n,r),Fi(this,n,r),ze(s)?fn:Yr(a))),Ta(()=>K(()=>this.unsafeRemove(a))))})}unsafeOnQueueEmptySpace(t,n){let r=!0;for(;r&&(t.capacity()===Number.POSITIVE_INFINITY||t.length()<t.capacity());){const s=v(this.putters,Zs(Bt));if(s===Bt)r=!1;else{const o=t.offer(s[0]);o&&s[2]?Bi(s[1],!0):o||Om(this.putters,v(wc(this.putters),wn(s))),Fi(this,t,n)}}}unsafeOffer(t,n){const r=je(t);for(let s=0;s<r.length;s++){const o=r[s];s===r.length-1?v(this.putters,Vc([o,n,!0])):v(this.putters,Vc([o,n,!1]))}}unsafeRemove(t){Om(this.putters,v(wc(this.putters),Rp(([,n])=>n!==t)))}}var _I;let _9=(_I=Bv,class{constructor(){d(this,_I,Hv)}surplusSize(){return 0}get shutdown(){return Ke}onCompleteTakersWithEmptyQueue(){}handleSurplus(t,n,r,s){return J(!1)}unsafeOnQueueEmptySpace(t,n){}});var yI;yI=Bv;class y9{constructor(){d(this,yI,Hv)}surplusSize(){return 0}get shutdown(){return Ke}onCompleteTakersWithEmptyQueue(){}handleSurplus(t,n,r,s){return K(()=>(this.unsafeOffer(n,t),Fi(this,n,r),!0))}unsafeOnQueueEmptySpace(t,n){}unsafeOffer(t,n){const r=n[Symbol.iterator]();let s,o=!0;for(;!(s=r.next()).done&&o;){if(t.capacity()===0)return;t.poll(Bt),o=t.offer(s.value)}}}const Bi=(e,t)=>cd(e,J(t)),Om=(e,t)=>v(e,zw(t)),wc=e=>v(e,pg(Number.POSITIVE_INFINITY)),b9=(e,t)=>v(e,pg(t)),S9=(e,t)=>{Om(e,v(wc(e),Rp(n=>t!==n)))},Fi=(e,t,n)=>{let r=!0;for(;r&&t.length()!==0;){const s=v(n,Zs(Bt));if(s!==Bt){const o=t.poll(Bt);o!==Bt?(Bi(s,o),e.unsafeOnQueueEmptySpace(t,n)):Om(n,v(wc(n),wn(s))),r=!0}else r=!1}r&&t.length()===0&&!Ui(n)&&e.onCompleteTakersWithEmptyQueue(n)},us=Symbol.for("effect/PubSub/AbsentValue"),GP=(e,t)=>n=>{n.has(e)||n.set(e,new Set),n.get(e).add(t)},w9=(e,t)=>n=>{if(!n.has(e))return;const r=n.get(e);r.delete(t),r.size===0&&n.delete(e)},v9=e=>he(()=>{const t=C9(e);return P9(t,new j9)}),E9=e=>e.shutdown,k9=y(2,(e,t)=>e.publish(t)),$9=e=>e.subscribe,C9=e=>new R9(e!=null&&e.replay?new B9(e.replay):void 0),T9=(e,t,n)=>_e(Eu(),r=>I9(e,t,e.subscribe(),mg(),r,Ea(!1),n)),I9=(e,t,n,r,s,o,a)=>new q9(e,t,n,r,s,o,a,e.replayWindow());class R9{constructor(t){d(this,"replayBuffer");d(this,"publisherHead",{value:us,subscribers:0,next:null});d(this,"publisherTail",this.publisherHead);d(this,"publisherIndex",0);d(this,"subscribersIndex",0);d(this,"capacity",Number.MAX_SAFE_INTEGER);this.replayBuffer=t}replayWindow(){return this.replayBuffer?new H9(this.replayBuffer):V9}isEmpty(){return this.publisherHead===this.publisherTail}isFull(){return!1}size(){return this.publisherIndex-this.subscribersIndex}publish(t){const n=this.publisherTail.subscribers;return n!==0&&(this.publisherTail.next={value:t,subscribers:n,next:null},this.publisherTail=this.publisherTail.next,this.publisherIndex+=1),this.replayBuffer&&this.replayBuffer.offer(t),!0}publishAll(t){if(this.publisherTail.subscribers!==0)for(const n of t)this.publish(n);else this.replayBuffer&&this.replayBuffer.offerAll(t);return _t()}slide(){this.publisherHead!==this.publisherTail&&(this.publisherHead=this.publisherHead.next,this.publisherHead.value=us,this.subscribersIndex+=1),this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.publisherTail.subscribers+=1,new O9(this,this.publisherTail,this.publisherIndex,!1)}}class O9{constructor(t,n,r,s){d(this,"self");d(this,"subscriberHead");d(this,"subscriberIndex");d(this,"unsubscribed");this.self=t,this.subscriberHead=n,this.subscriberIndex=r,this.unsubscribed=s}isEmpty(){if(this.unsubscribed)return!0;let t=!0,n=!0;for(;n;)this.subscriberHead===this.self.publisherTail?n=!1:this.subscriberHead.next.value!==us?(t=!1,n=!1):(this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1);return t}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(t){if(this.unsubscribed)return t;let n=!0,r=t;for(;n;)if(this.subscriberHead===this.self.publisherTail)n=!1;else{const s=this.subscriberHead.next.value;s!==us&&(r=s,this.subscriberHead.subscribers-=1,this.subscriberHead.subscribers===0&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=us,this.self.subscribersIndex+=1),n=!1),this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1}return r}pollUpTo(t){const n=[],r=us;let s=0;for(;s!==t;){const o=this.poll(r);o===r?s=t:(n.push(o),s+=1)}return ao(n)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.publisherTail.subscribers-=1;this.subscriberHead!==this.self.publisherTail;)this.subscriberHead.next.value!==us&&(this.subscriberHead.subscribers-=1,this.subscriberHead.subscribers===0&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=us,this.self.subscribersIndex+=1)),this.subscriberHead=this.subscriberHead.next}}var bI,SI;class q9 extends(SI=$o,bI=zv,SI){constructor(n,r,s,o,a,u,f,h){super();d(this,"pubsub");d(this,"subscribers");d(this,"subscription");d(this,"pollers");d(this,"shutdownHook");d(this,"shutdownFlag");d(this,"strategy");d(this,"replayWindow");d(this,bI,Vv);this.pubsub=n,this.subscribers=r,this.subscription=s,this.pollers=o,this.shutdownHook=a,this.shutdownFlag=u,this.strategy=f,this.replayWindow=h}commit(){return this.take}pipe(){return Z(this,arguments)}capacity(){return this.pubsub.capacity}isActive(){return!ze(this.shutdownFlag)}get size(){return he(()=>ze(this.shutdownFlag)?fn:J(this.subscription.size()+this.replayWindow.remaining))}unsafeSize(){return ze(this.shutdownFlag)?V():W(this.subscription.size()+this.replayWindow.remaining)}get isFull(){return he(()=>ze(this.shutdownFlag)?fn:J(this.subscription.size()===this.capacity()))}get isEmpty(){return _e(this.size,n=>n===0)}get shutdown(){return fi(Ae(n=>(ka(this.shutdownFlag,!0),v(mv(Wv(this.pollers),r=>Pw(r,n.id()),!1),Ct(K(()=>{this.subscribers.delete(this.subscription),this.subscription.unsubscribe(),this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers)})),nd(ad(this.shutdownHook,void 0)),Xn))))}get isShutdown(){return K(()=>ze(this.shutdownFlag))}get awaitShutdown(){return Yr(this.shutdownHook)}get take(){return Ae(n=>{if(ze(this.shutdownFlag))return fn;if(this.replayWindow.remaining>0){const s=this.replayWindow.take();return J(s)}const r=Ui(this.pollers)?this.subscription.poll(Bt):Bt;if(r===Bt){const s=vu(n.id());return v(he(()=>(v(this.pollers,Vc(s)),v(this.subscribers,GP(this.subscription,this.pollers)),this.strategy.unsafeCompletePollers(this.pubsub,this.subscribers,this.subscription,this.pollers),ze(this.shutdownFlag)?fn:Yr(s))),Ta(()=>K(()=>L9(this.pollers,s))))}else return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),J(r)})}get takeAll(){return he(()=>{if(ze(this.shutdownFlag))return fn;const n=Ui(this.pollers)?N9(this.subscription):_t();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),this.replayWindow.remaining>0?J(Tt(this.replayWindow.takeAll(),n)):J(n)})}takeUpTo(n){return he(()=>{if(ze(this.shutdownFlag))return fn;let r;if(this.replayWindow.remaining>=n){const o=this.replayWindow.takeN(n);return J(o)}else this.replayWindow.remaining>0&&(r=this.replayWindow.takeAll(),n=n-r.length);const s=Ui(this.pollers)?D9(this.subscription,n):_t();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),J(r?Tt(r,s):s)})}takeBetween(n,r){return he(()=>QP(this,n,r,_t()))}}const QP=(e,t,n,r)=>n<t?J(r):v(e.takeUpTo(n),U(s=>{const o=t-s.length;return o===1?v(e.take,_e(a=>v(r,Tt(s),jl(a)))):o>1?v(e.take,U(a=>QP(e,o-1,n-s.length-1,v(r,Tt(s),jl(a))))):J(v(r,Tt(s)))}));var wI,vI;vI=VP,wI=zv;class A9{constructor(t,n,r,s,o,a){d(this,"pubsub");d(this,"subscribers");d(this,"scope");d(this,"shutdownHook");d(this,"shutdownFlag");d(this,"strategy");d(this,vI,WP);d(this,wI,Vv);this.pubsub=t,this.subscribers=n,this.scope=r,this.shutdownHook=s,this.shutdownFlag=o,this.strategy=a}capacity(){return this.pubsub.capacity}get size(){return he(()=>ze(this.shutdownFlag)?fn:K(()=>this.pubsub.size()))}unsafeSize(){return ze(this.shutdownFlag)?V():W(this.pubsub.size())}get isFull(){return _e(this.size,t=>t===this.capacity())}get isEmpty(){return _e(this.size,t=>t===0)}get awaitShutdown(){return Yr(this.shutdownHook)}get isShutdown(){return K(()=>ze(this.shutdownFlag))}get shutdown(){return fi(Ae(t=>(v(this.shutdownFlag,ka(!0)),v(this.scope.close(qw(t.id())),Ct(this.strategy.shutdown),nd(ad(this.shutdownHook,void 0)),Xn))))}publish(t){return he(()=>ze(this.shutdownFlag)?fn:this.pubsub.publish(t)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),J(!0)):this.strategy.handleSurplus(this.pubsub,this.subscribers,ut(t),this.shutdownFlag))}isActive(){return!ze(this.shutdownFlag)}unsafeOffer(t){return ze(this.shutdownFlag)?!1:this.pubsub.publish(t)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),!0):!1}publishAll(t){return he(()=>{if(ze(this.shutdownFlag))return fn;const n=M9(this.pubsub,t);return this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),Qf(n)?J(!0):this.strategy.handleSurplus(this.pubsub,this.subscribers,n,this.shutdownFlag)})}get subscribe(){const t=sg(hv([this.scope.fork(dd),T9(this.pubsub,this.subscribers,this.strategy)]),n=>n[0].addFinalizer(()=>n[1].shutdown));return _e(dv(t,(n,r)=>n[0].close(r)),n=>n[1])}offer(t){return this.publish(t)}offerAll(t){return this.publishAll(t)}pipe(){return Z(this,arguments)}}const P9=(e,t)=>U(Sd(),n=>_e(Eu(),r=>F9(e,new Map,n,r,Ea(!1),t))),F9=(e,t,n,r,s,o)=>new A9(e,t,n,r,s,o),x9=(e,t)=>{cd(e,J(t))},YP=(e,t)=>v(e,zw(t)),Wv=e=>v(e,pg(Number.POSITIVE_INFINITY)),N9=e=>e.pollUpTo(Number.POSITIVE_INFINITY),D9=(e,t)=>e.pollUpTo(t),M9=(e,t)=>e.publishAll(t),L9=(e,t)=>{YP(e,v(Wv(e),Rp(n=>n!==t)))};class j9{get shutdown(){return Ke}handleSurplus(t,n,r,s){return J(!1)}unsafeOnPubSubEmptySpace(t,n){}unsafeCompletePollers(t,n,r,s){return U9(this,t,n,r,s)}unsafeCompleteSubscribers(t,n){return z9(this,t,n)}}const U9=(e,t,n,r,s)=>{let o=!0;for(;o&&!r.isEmpty();){const a=v(s,Zs(Bt));if(a===Bt)v(n,w9(r,s)),Ui(s)?o=!1:v(n,GP(r,s));else{const u=r.poll(Bt);u===Bt?YP(s,v(Wv(s),wn(a))):(x9(a,u),e.unsafeOnPubSubEmptySpace(t,n))}}},z9=(e,t,n)=>{for(const[r,s]of n)for(const o of s)e.unsafeCompletePollers(t,n,r,o)};class B9{constructor(t){d(this,"capacity");d(this,"head",{value:us,next:null});d(this,"tail",this.head);d(this,"size",0);d(this,"index",0);this.capacity=t}slide(){this.index++}offer(t){this.tail.value=t,this.tail.next={value:us,next:null},this.tail=this.tail.next,this.size===this.capacity?this.head=this.head.next:this.size+=1}offerAll(t){for(const n of t)this.offer(n)}}class H9{constructor(t){d(this,"buffer");d(this,"head");d(this,"index");d(this,"remaining");this.buffer=t,this.index=t.index,this.remaining=t.size,this.head=t.head}fastForward(){for(;this.index<this.buffer.index;)this.head=this.head.next,this.index++}take(){if(this.remaining===0)return;this.index<this.buffer.index&&this.fastForward(),this.remaining--;const t=this.head.value;return this.head=this.head.next,t}takeN(t){if(this.remaining===0)return _t();this.index<this.buffer.index&&this.fastForward();const n=Math.min(t,this.remaining),r=new Array(n);for(let s=0;s<n;s++){const o=this.head.value;this.head=this.head.next,r[s]=o}return this.remaining-=n,jt(r)}takeAll(){return this.takeN(this.remaining)}}const V9={remaining:0,take:()=>{},takeN:()=>_t(),takeAll:()=>_t()},Kv=v9,qm=E9,Hg=k9,$$=$9,Zc=e9,Vg=t9,Wg=n9,dn=r9,W9=i9,K9=a9,xt=c9,Qe=u9,Jv=l9,go=qb,J9=f9,XP=h9,ZP="Continue",G9="Close",Q9="Yield",Y9="effect/ChannelChildExecutorDecision",C$=Symbol.for(Y9),X9={[C$]:C$},eF=e=>{const t=Object.create(X9);return t._tag=ZP,t},Oh="ContinuationK",Z9="ContinuationFinalizer",tF=Symbol.for("effect/ChannelContinuation"),nF={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutDone:e=>e,_OutErr2:e=>e,_OutElem:e=>e,_OutDone2:e=>e};var EI;EI=tF;class Gv{constructor(t,n){d(this,"onSuccess");d(this,"onHalt");d(this,"_tag",Oh);d(this,EI,nF);this.onSuccess=t,this.onHalt=n}onExit(t){return Ra(t)?this.onHalt(t.cause):this.onSuccess(t.value)}}var kI;kI=tF;class e7{constructor(t){d(this,"finalizer");d(this,"_tag",Z9);d(this,kI,nF);this.finalizer=t}}const rF="PullAfterNext",t7="PullAfterAllEnqueued",n7="effect/ChannelUpstreamPullStrategy",r7=Symbol.for(n7),s7={_A:e=>e},o7={[r7]:s7},sF=e=>{const t=Object.create(o7);return t._tag=rF,t.emitSeparator=e,t},oF="BracketOut",iF="Bridge",Qv="ConcatAll",aF="Emit",cF="Ensuring",uF="Fail",Yv="Fold",lF="FromEffect",fF="PipeTo",dF="Provide",hF="Read",mF="Succeed",pF="SucceedNow",gF="Suspend",i7="effect/Channel",Am=Symbol.for(i7),a7={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},Rn={[Am]:a7,pipe(){return Z(this,arguments)}},_F=e=>ne(e,Am)||qr(e),c7=y(2,(e,t)=>{const n=Object.create(Rn);return n._tag=oF,n.acquire=()=>e,n.finalizer=t,n}),yF=y(2,(e,t)=>{const n=Object.create(Rn);return n._tag=Yv,n.channel=e,n.k=new Gv(qa,t),n}),bF=(e,t,n)=>{const r=Object.create(Rn);return r._tag=Qv,r.combineInners=t,r.combineAll=n,r.onPull=()=>sF(V()),r.onEmit=()=>eF,r.value=()=>e,r.k=ie,r},u7=y(4,(e,t,n,r)=>{const s=Object.create(Rn);return s._tag=Qv,s.combineInners=n,s.combineAll=r,s.onPull=()=>sF(V()),s.onEmit=()=>eF,s.value=()=>e,s.k=t,s}),Xv=y(2,(e,t)=>{const n=Object.create(Rn);return n._tag=iF,n.input=t,n.channel=e,n}),Zv=y(2,(e,t)=>{const n=Object.create(Rn);return n._tag=cF,n.channel=e,n.finalizer=t,n}),Cd=e=>Rt(Tu(e)),Rt=e=>SF(()=>e),SF=e=>{const t=Object.create(Rn);return t._tag=uF,t.error=e,t},Fe=y(2,(e,t)=>{const n=Object.create(Rn);return n._tag=Yv,n.channel=e,n.k=new Gv(t,Rt),n}),kt=e=>{const t=Object.create(Rn);return t._tag=lF,t.effect=()=>e,t},un=y(2,(e,t)=>{const n=Object.create(Rn);return n._tag=fF,n.left=()=>e,n.right=()=>t,n}),Ab=y(2,(e,t)=>{const n=Object.create(Rn);return n._tag=dF,n.context=()=>t,n.inner=e,n}),Kg=e=>mr({onInput:e.onInput,onFailure:t=>rn(Tg(t),{onLeft:e.onFailure,onRight:Rt}),onDone:e.onDone}),mr=e=>{const t=Object.create(Rn);return t._tag=hF,t.more=e.onInput,t.done=new Gv(e.onDone,e.onFailure),t},qa=e=>wF(()=>e),ii=e=>{const t=Object.create(Rn);return t._tag=pF,t.terminal=e,t},Td=e=>{const t=Object.create(Rn);return t._tag=gF,t.channel=e,t},wF=e=>{const t=Object.create(Rn);return t._tag=mF,t.evaluate=e,t},hn=ii(void 0),et=e=>{const t=Object.create(Rn);return t._tag=aF,t.out=e,t},Id="Done",Rd="Emit",qu="FromEffect",Od="Read",l7=Symbol.for("effect/ChannelState"),f7={_E:e=>e,_R:e=>e},Jg={[l7]:f7},Ja=()=>{const e=Object.create(Jg);return e._tag=Id,e},ny=()=>{const e=Object.create(Jg);return e._tag=Rd,e},Xu=e=>{const t=Object.create(Jg);return t._tag=qu,t.effect=e,t},ry=(e,t,n,r)=>{const s=Object.create(Jg);return s._tag=Od,s.upstream=e,s.onEffect=t,s.onEmit=n,s.onDone=r,s},Pm=e=>e._tag===qu,d7=e=>Pm(e)?e.effect:fe,T$=e=>Pm(e)?Av(e.effect):void 0,vF="PullFromChild",Pb="PullFromUpstream",Fb="DrainChildExecutors",EF="Emit";class Zd{constructor(t,n,r){d(this,"childExecutor");d(this,"parentSubexecutor");d(this,"onEmit");d(this,"_tag",vF);this.childExecutor=t,this.parentSubexecutor=n,this.onEmit=r}close(t){const n=this.childExecutor.close(t),r=this.parentSubexecutor.close(t);return n!==void 0&&r!==void 0?Xc(Wt(n),Wt(r),(s,o)=>v(s,Xl(o))):n!==void 0?n:r!==void 0?r:void 0}enqueuePullFromChild(t){return this}}class Ci{constructor(t,n,r,s,o,a,u,f){d(this,"upstreamExecutor");d(this,"createChild");d(this,"lastDone");d(this,"activeChildExecutors");d(this,"combineChildResults");d(this,"combineWithChildResult");d(this,"onPull");d(this,"onEmit");d(this,"_tag",Pb);this.upstreamExecutor=t,this.createChild=n,this.lastDone=r,this.activeChildExecutors=s,this.combineChildResults=o,this.combineWithChildResult=a,this.onPull=u,this.onEmit=f}close(t){const n=this.upstreamExecutor.close(t),s=[...this.activeChildExecutors.map(o=>o!==void 0?o.childExecutor.close(t):void 0),n].reduce((o,a)=>o!==void 0&&a!==void 0?Xc(o,Wt(a),(u,f)=>Xl(u,f)):o!==void 0?o:a!==void 0?Wt(a):void 0,void 0);return s}enqueuePullFromChild(t){return new Ci(this.upstreamExecutor,this.createChild,this.lastDone,[...this.activeChildExecutors,t],this.combineChildResults,this.combineWithChildResult,this.onPull,this.onEmit)}}class ac{constructor(t,n,r,s,o,a,u){d(this,"upstreamExecutor");d(this,"lastDone");d(this,"activeChildExecutors");d(this,"upstreamDone");d(this,"combineChildResults");d(this,"combineWithChildResult");d(this,"onPull");d(this,"_tag",Fb);this.upstreamExecutor=t,this.lastDone=n,this.activeChildExecutors=r,this.upstreamDone=s,this.combineChildResults=o,this.combineWithChildResult=a,this.onPull=u}close(t){const n=this.upstreamExecutor.close(t),s=[...this.activeChildExecutors.map(o=>o!==void 0?o.childExecutor.close(t):void 0),n].reduce((o,a)=>o!==void 0&&a!==void 0?Xc(o,Wt(a),(u,f)=>Xl(u,f)):o!==void 0?o:a!==void 0?Wt(a):void 0,void 0);return s}enqueuePullFromChild(t){return new ac(this.upstreamExecutor,this.lastDone,[...this.activeChildExecutors,t],this.upstreamDone,this.combineChildResults,this.combineWithChildResult,this.onPull)}}class sy{constructor(t,n){d(this,"value");d(this,"next");d(this,"_tag",EF);this.value=t,this.next=n}close(t){const n=this.next.close(t);return n}enqueuePullFromChild(t){return this}}const h7="Pulled",m7="NoUpstream",p7="effect/ChannelUpstreamPullRequest",g7=Symbol.for(p7),_7={_A:e=>e},kF={[g7]:_7},I$=e=>{const t=Object.create(kF);return t._tag=h7,t.value=e,t},y7=e=>{const t=Object.create(kF);return t._tag=m7,t.activeDownstreamCount=e,t};class xi{constructor(t,n,r){d(this,"_activeSubexecutor");d(this,"_cancelled");d(this,"_closeLastSubstream");d(this,"_currentChannel");d(this,"_done");d(this,"_doneStack",[]);d(this,"_emitted");d(this,"_executeCloseLastSubstream");d(this,"_input");d(this,"_inProgressFinalizer");d(this,"_providedEnv");this._currentChannel=t,this._executeCloseLastSubstream=r,this._providedEnv=n}run(){let t;for(;t===void 0;)if(this._cancelled!==void 0)t=this.processCancellation();else if(this._activeSubexecutor!==void 0)t=this.runSubexecutor();else try{if(this._currentChannel===void 0)t=Ja();else switch(qr(this._currentChannel)&&(this._currentChannel=kt(this._currentChannel)),this._currentChannel._tag){case oF:{t=this.runBracketOut(this._currentChannel);break}case iF:{const n=this._currentChannel.input;if(this._currentChannel=this._currentChannel.channel,this._input!==void 0){const r=this._input;this._input=void 0;const s=()=>Y(n.awaitRead(),()=>pt(()=>{const o=r.run();switch(o._tag){case Id:return Wr(r.getDone(),{onFailure:a=>n.error(a),onSuccess:a=>n.done(a)});case Rd:return Y(n.emit(r.getEmit()),()=>s());case qu:return Sr(o.effect,{onFailure:a=>n.error(a),onSuccess:()=>s()});case Od:return eE(o,()=>s(),a=>n.error(a))}}));t=Xu(Y(xv(qt(s())),o=>Te(()=>this.addFinalizer(a=>Y(Ir(o),()=>pt(()=>{const u=this.restorePipe(a,r);return u!==void 0?u:fe}))))))}break}case Qv:{const n=new xi(this._currentChannel.value(),this._providedEnv,s=>Te(()=>{const o=this._closeLastSubstream===void 0?fe:this._closeLastSubstream;this._closeLastSubstream=v(o,ht(s))}));n._input=this._input;const r=this._currentChannel;this._activeSubexecutor=new Ci(n,s=>r.k(s),void 0,[],(s,o)=>r.combineInners(s,o),(s,o)=>r.combineAll(s,o),s=>r.onPull(s),s=>r.onEmit(s)),this._closeLastSubstream=void 0,this._currentChannel=void 0;break}case aF:{this._emitted=this._currentChannel.out,this._currentChannel=this._activeSubexecutor!==void 0?void 0:hn,t=ny();break}case cF:{this.runEnsuring(this._currentChannel);break}case uF:{t=this.doneHalt(this._currentChannel.error());break}case Yv:{this._doneStack.push(this._currentChannel.k),this._currentChannel=this._currentChannel.channel;break}case lF:{const n=this._providedEnv===void 0?this._currentChannel.effect():v(this._currentChannel.effect(),Cn(this._providedEnv));t=Xu(Sr(n,{onFailure:r=>{const s=this.doneHalt(r);return s!==void 0&&Pm(s)?s.effect:fe},onSuccess:r=>{const s=this.doneSucceed(r);return s!==void 0&&Pm(s)?s.effect:fe}}));break}case fF:{const n=this._input,r=new xi(this._currentChannel.left(),this._providedEnv,s=>this._executeCloseLastSubstream(s));r._input=n,this._input=r,this.addFinalizer(s=>{const o=this.restorePipe(s,n);return o!==void 0?o:fe}),this._currentChannel=this._currentChannel.right();break}case dF:{const n=this._providedEnv;this._providedEnv=this._currentChannel.context(),this._currentChannel=this._currentChannel.inner,this.addFinalizer(()=>Te(()=>{this._providedEnv=n}));break}case hF:{const n=this._currentChannel;t=ry(this._input,ie,r=>{try{this._currentChannel=n.more(r)}catch(s){this._currentChannel=n.done.onExit(Yl(s))}},r=>{const s=o=>n.done.onExit(o);this._currentChannel=s(r)});break}case mF:{t=this.doneSucceed(this._currentChannel.evaluate());break}case pF:{t=this.doneSucceed(this._currentChannel.terminal);break}case gF:{this._currentChannel=this._currentChannel.channel();break}}}catch(n){this._currentChannel=Rt(ma(n))}return t}getDone(){return this._done}getEmit(){return this._emitted}cancelWith(t){this._cancelled=t}clearInProgressFinalizer(){this._inProgressFinalizer=void 0}storeInProgressFinalizer(t){this._inProgressFinalizer=t}popAllFinalizers(t){const n=[];let r=this._doneStack.pop();for(;r;)r._tag==="ContinuationFinalizer"&&n.push(r.finalizer),r=this._doneStack.pop();const s=n.length===0?fe:iy(n,t);return this.storeInProgressFinalizer(s),s}popNextFinalizers(){const t=[];for(;this._doneStack.length!==0;){const n=this._doneStack[this._doneStack.length-1];if(n._tag===Oh)return t;t.push(n),this._doneStack.pop()}return t}restorePipe(t,n){const r=this._input;return this._input=n,r!==void 0?r.close(t):fe}close(t){let n;const r=this._inProgressFinalizer;r!==void 0&&(n=v(r,Ai(Te(()=>this.clearInProgressFinalizer()))));let s;const o=this.popAllFinalizers(t);o!==void 0&&(s=v(o,Ai(Te(()=>this.clearInProgressFinalizer()))));const a=this._activeSubexecutor===void 0?void 0:this._activeSubexecutor.close(t);if(!(a===void 0&&n===void 0&&s===void 0))return v(Wt(oy(a)),Im(Wt(oy(n))),Im(Wt(oy(s))),Se(([[u,f],h])=>v(u,Xl(f),Xl(h))),Bo,Y(u=>pt(()=>u)))}doneSucceed(t){if(this._doneStack.length===0)return this._done=Ht(t),this._currentChannel=void 0,Ja();const n=this._doneStack[this._doneStack.length-1];if(n._tag===Oh){this._doneStack.pop(),this._currentChannel=n.onSuccess(t);return}const r=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=r.reverse(),this._done=Ht(t),this._currentChannel=void 0,Ja();const s=iy(r.map(a=>a.finalizer),Ht(t));this.storeInProgressFinalizer(s);const o=v(s,Ai(Te(()=>this.clearInProgressFinalizer())),Bo,Y(()=>Te(()=>this.doneSucceed(t))));return Xu(o)}doneHalt(t){if(this._doneStack.length===0)return this._done=sn(t),this._currentChannel=void 0,Ja();const n=this._doneStack[this._doneStack.length-1];if(n._tag===Oh){this._doneStack.pop();try{this._currentChannel=n.onHalt(t)}catch(a){this._currentChannel=Rt(ma(a))}return}const r=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=r.reverse(),this._done=sn(t),this._currentChannel=void 0,Ja();const s=iy(r.map(a=>a.finalizer),sn(t));this.storeInProgressFinalizer(s);const o=v(s,Ai(Te(()=>this.clearInProgressFinalizer())),Bo,Y(()=>Te(()=>this.doneHalt(t))));return Xu(o)}processCancellation(){return this._currentChannel=void 0,this._done=this._cancelled,this._cancelled=void 0,Ja()}runBracketOut(t){const n=Bo(Sr(this.provide(t.acquire()),{onFailure:r=>Te(()=>{this._currentChannel=Rt(r)}),onSuccess:r=>Te(()=>{this.addFinalizer(s=>this.provide(t.finalizer(r,s))),this._currentChannel=et(r)})}));return Xu(n)}provide(t){return this._providedEnv===void 0?t:v(t,Cn(this._providedEnv))}runEnsuring(t){this.addFinalizer(t.finalizer),this._currentChannel=t.channel}addFinalizer(t){this._doneStack.push(new e7(t))}runSubexecutor(){const t=this._activeSubexecutor;switch(t._tag){case vF:return this.pullFromChild(t.childExecutor,t.parentSubexecutor,t.onEmit,t);case Pb:return this.pullFromUpstream(t);case Fb:return this.drainChildExecutors(t);case EF:return this._emitted=t.value,this._activeSubexecutor=t.next,ny()}}replaceSubexecutor(t){this._currentChannel=void 0,this._activeSubexecutor=t}finishWithExit(t){const n=Wr(t,{onFailure:r=>this.doneHalt(r),onSuccess:r=>this.doneSucceed(r)});return this._activeSubexecutor=void 0,n===void 0?fe:d7(n)}finishSubexecutorWithCloseEffect(t,...n){this.addFinalizer(()=>v(n,bn(s=>v(Te(()=>s(t)),Y(o=>o!==void 0?o:fe)),{discard:!0})));const r=v(t,Wr({onFailure:s=>this.doneHalt(s),onSuccess:s=>this.doneSucceed(s)}));return this._activeSubexecutor=void 0,r}applyUpstreamPullStrategy(t,n,r){switch(r._tag){case rF:{const s=!t||n.some(o=>o!==void 0);return[r.emitSeparator,s?[void 0,...n]:n]}case t7:{const s=!t||n.some(o=>o!==void 0);return[r.emitSeparator,s?[...n,void 0]:n]}}}pullFromChild(t,n,r,s){return ry(t,ie,o=>{const a=r(o);switch(a._tag){case ZP:break;case G9:{this.finishWithDoneValue(t,n,a.value);break}case Q9:{const u=n.enqueuePullFromChild(s);this.replaceSubexecutor(u);break}}this._activeSubexecutor=new sy(o,this._activeSubexecutor)},Wr({onFailure:o=>{const a=this.handleSubexecutorFailure(t,n,o);return a===void 0?void 0:T$(a)},onSuccess:o=>{this.finishWithDoneValue(t,n,o)}}))}finishWithDoneValue(t,n,r){const s=n;switch(s._tag){case Pb:{const o=new Ci(s.upstreamExecutor,s.createChild,s.lastDone!==void 0?s.combineChildResults(s.lastDone,r):r,s.activeChildExecutors,s.combineChildResults,s.combineWithChildResult,s.onPull,s.onEmit);this._closeLastSubstream=t.close(Ht(r)),this.replaceSubexecutor(o);break}case Fb:{const o=new ac(s.upstreamExecutor,s.lastDone!==void 0?s.combineChildResults(s.lastDone,r):r,s.activeChildExecutors,s.upstreamDone,s.combineChildResults,s.combineWithChildResult,s.onPull);this._closeLastSubstream=t.close(Ht(r)),this.replaceSubexecutor(o);break}}}handleSubexecutorFailure(t,n,r){return this.finishSubexecutorWithCloseEffect(sn(r),s=>n.close(s),s=>t.close(s))}pullFromUpstream(t){if(t.activeChildExecutors.length===0)return this.performPullFromUpstream(t);const n=t.activeChildExecutors[0],r=new Ci(t.upstreamExecutor,t.createChild,t.lastDone,t.activeChildExecutors.slice(1),t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit);if(n===void 0)return this.performPullFromUpstream(r);this.replaceSubexecutor(new Zd(n.childExecutor,r,n.onEmit))}performPullFromUpstream(t){return ry(t.upstreamExecutor,n=>{const r=this._closeLastSubstream===void 0?fe:this._closeLastSubstream;return this._closeLastSubstream=void 0,v(this._executeCloseLastSubstream(r),ht(n))},n=>{if(this._closeLastSubstream!==void 0){const a=this._closeLastSubstream;return this._closeLastSubstream=void 0,v(this._executeCloseLastSubstream(a),Se(()=>{const u=new xi(t.createChild(n),this._providedEnv,this._executeCloseLastSubstream);u._input=this._input;const[f,h]=this.applyUpstreamPullStrategy(!1,t.activeChildExecutors,t.onPull(I$(n)));this._activeSubexecutor=new Zd(u,new Ci(t.upstreamExecutor,t.createChild,t.lastDone,h,t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit),t.onEmit),ct(f)&&(this._activeSubexecutor=new sy(f.value,this._activeSubexecutor))}))}const r=new xi(t.createChild(n),this._providedEnv,this._executeCloseLastSubstream);r._input=this._input;const[s,o]=this.applyUpstreamPullStrategy(!1,t.activeChildExecutors,t.onPull(I$(n)));this._activeSubexecutor=new Zd(r,new Ci(t.upstreamExecutor,t.createChild,t.lastDone,o,t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit),t.onEmit),ct(s)&&(this._activeSubexecutor=new sy(s.value,this._activeSubexecutor))},n=>{if(t.activeChildExecutors.some(o=>o!==void 0)){const o=new ac(t.upstreamExecutor,t.lastDone,[void 0,...t.activeChildExecutors],t.upstreamExecutor.getDone(),t.combineChildResults,t.combineWithChildResult,t.onPull);if(this._closeLastSubstream!==void 0){const a=this._closeLastSubstream;return this._closeLastSubstream=void 0,v(this._executeCloseLastSubstream(a),Se(()=>this.replaceSubexecutor(o)))}this.replaceSubexecutor(o);return}const r=this._closeLastSubstream,s=this.finishSubexecutorWithCloseEffect(v(n,X4(o=>t.combineWithChildResult(t.lastDone,o))),()=>r,o=>t.upstreamExecutor.close(o));return s===void 0?void 0:T$(s)})}drainChildExecutors(t){if(t.activeChildExecutors.length===0){const o=this._closeLastSubstream;return o!==void 0&&this.addFinalizer(()=>Le(o)),this.finishSubexecutorWithCloseEffect(t.upstreamDone,()=>o,a=>t.upstreamExecutor.close(a))}const n=t.activeChildExecutors[0],r=t.activeChildExecutors.slice(1);if(n===void 0){const[o,a]=this.applyUpstreamPullStrategy(!0,r,t.onPull(y7(r.reduce((u,f)=>f!==void 0?u+1:u,0))));return this.replaceSubexecutor(new ac(t.upstreamExecutor,t.lastDone,a,t.upstreamDone,t.combineChildResults,t.combineWithChildResult,t.onPull)),ct(o)?(this._emitted=o.value,ny()):void 0}const s=new ac(t.upstreamExecutor,t.lastDone,r,t.upstreamDone,t.combineChildResults,t.combineWithChildResult,t.onPull);this.replaceSubexecutor(new Zd(n.childExecutor,s,n.onEmit))}}const oy=e=>e!==void 0?e:fe,iy=(e,t)=>v(bn(e,n=>Wt(n(t))),Se(n=>v(Q4(n),gt(()=>Jn))),Y(n=>pt(()=>n))),eE=(e,t,n)=>{const r=[e],s=()=>{const o=r.pop();if(o===void 0||o.upstream===void 0)return qP("Unexpected end of input for channel execution");const a=o.upstream.run();switch(a._tag){case Rd:{const u=o.onEmit(o.upstream.getEmit());return r.length===0?u===void 0?pt(t):v(u,Sr({onFailure:n,onSuccess:t})):u===void 0?pt(()=>s()):v(u,Sr({onFailure:n,onSuccess:()=>s()}))}case Id:{const u=o.onDone(o.upstream.getDone());return r.length===0?u===void 0?pt(t):v(u,Sr({onFailure:n,onSuccess:t})):u===void 0?pt(()=>s()):v(u,Sr({onFailure:n,onSuccess:()=>s()}))}case qu:return r.push(o),v(o.onEffect(a.effect),ys(u=>pt(()=>{const f=o.onDone(sn(u));return f===void 0?fe:f})),Sr({onFailure:n,onSuccess:()=>s()}));case Od:return r.push(o),r.push(a),pt(()=>s())}};return s()},tE=y(2,(e,t)=>{const n=(r,s,o)=>PP(Te(()=>new xi(e,void 0,ie)),a=>pt(()=>qh(a.run(),a).pipe(kd(r),ht(zt(r)),Dv(zt(s)))),(a,u)=>{const f=a.close(u);return f===void 0?fe:Ou(f,h=>Go(o,Wn(h)))});return si(r=>vd([kv(t,nf),Me(),Me()]).pipe(Y(([s,o,a])=>r(n(o,a,s)).pipe(ur(t),Y(u=>t.addFinalizer(f=>{const h=Ra(f)?X8(f.cause):void 0;return sb(o).pipe(Y(p=>p?at(a,void 0).pipe(ht(dP(u)),ht(y$(u))):at(a,void 0).pipe(ht(h&&lw(h)>0?qg(u,Qz(h)):Ir(u)),ht(y$(u)))))}).pipe(ht(r(zt(o)))))))))}),qh=(e,t)=>{const n=e;switch(n._tag){case qu:return v(n.effect,Y(()=>qh(t.run(),t)));case Rd:return qh(t.run(),t);case Id:return pt(()=>t.getDone());case Od:return eE(n,()=>qh(t.run(),t),Wn)}},$F="Done",b7="Await",S7="effect/ChannelMergeDecision",w7=Symbol.for(S7),CF={[w7]:{_R:e=>e,_E0:e=>e,_Z0:e=>e,_E:e=>e,_Z:e=>e}},v7=e=>{const t=Object.create(CF);return t._tag=$F,t.effect=e,t},xb=e=>{const t=Object.create(CF);return t._tag=b7,t.f=e,t},TF="BothRunning",IF="LeftDone",RF="RightDone",E7="effect/ChannelMergeState",R$=Symbol.for(E7),nE={[R$]:R$},ay=(e,t)=>{const n=Object.create(nE);return n._tag=TF,n.left=e,n.right=t,n},O$=e=>{const t=Object.create(nE);return t._tag=IF,t.f=e,t},q$=e=>{const t=Object.create(nE);return t._tag=RF,t.f=e,t},OF="BackPressure",qF="BufferSliding",k7="effect/ChannelMergeStrategy",A$=Symbol.for(k7),AF={[A$]:A$},$7=e=>{const t=Object.create(AF);return t._tag=OF,t},C7=e=>{const t=Object.create(AF);return t._tag=qF,t},T7=y(2,(e,{onBackPressure:t,onBufferSliding:n})=>{switch(e._tag){case OF:return t();case qF:return n()}}),Za="Empty",al="Emit",cl="Error",ul="Done",PF=e=>({_tag:Za,notifyProducer:e}),cy=e=>({_tag:al,notifyConsumers:e}),I7=e=>({_tag:cl,cause:e}),R7=e=>({_tag:ul,done:e});class O7{constructor(t){d(this,"ref");this.ref=t}awaitRead(){return $i(ki(this.ref,t=>t._tag===Za?[zt(t.notifyProducer),t]:[fe,t]))}get close(){return Fv(t=>this.error(Cg(t)))}done(t){return $i(ki(this.ref,n=>{switch(n._tag){case Za:return[zt(n.notifyProducer),n];case al:return[bn(n.notifyConsumers,r=>at(r,oe(t)),{discard:!0}),R7(t)];case cl:return[as,n];case ul:return[as,n]}}))}emit(t){return Y(Me(),n=>$i(ki(this.ref,r=>{switch(r._tag){case Za:return[zt(r.notifyProducer),r];case al:{const s=r.notifyConsumers[0],o=r.notifyConsumers.slice(1);if(s!==void 0)return[at(s,ce(t)),o.length===0?PF(n):cy(o)];throw new Error("Bug: Channel.SingleProducerAsyncInput.emit - Queue was empty! please report an issue at https://github.com/Effect-TS/effect/issues")}case cl:return[as,r];case ul:return[as,r]}})))}error(t){return $i(ki(this.ref,n=>{switch(n._tag){case Za:return[zt(n.notifyProducer),n];case al:return[bn(n.notifyConsumers,r=>iq(r,t),{discard:!0}),I7(t)];case cl:return[as,n];case ul:return[as,n]}}))}get take(){return this.takeWith(t=>sn(Ig(t,oe)),t=>Ht(t),t=>ld(ce(t)))}takeWith(t,n,r){return Y(Me(),s=>$i(ki(this.ref,o=>{switch(o._tag){case Za:return[ht(at(o.notifyProducer,void 0),df(zt(s),{onFailure:t,onSuccess:rn({onLeft:r,onRight:n})})),cy([s])];case al:return[df(zt(s),{onFailure:t,onSuccess:rn({onLeft:r,onRight:n})}),cy([...o.notifyConsumers,s])];case cl:return[Le(t(o.cause)),o];case ul:return[Le(r(o.done)),o]}})))}}const rE=()=>v(Me(),Y(e=>hi(PF(e))),Se(e=>new O7(e))),P$=(e,t,n)=>Fe(kt(hi(()=>fe)),r=>v(kt(Bo(po(e,s=>Wc(r,o=>n(s,o))))),Fe(t),Zv(s=>Y(zi(r),o=>o(s))))),q7=y(2,(e,t)=>yF(e,n=>rn(Tg(n),{onLeft:t,onRight:Rt}))),Fm=y(2,(e,t)=>u7(e,t,()=>{},()=>{})),Gg=e=>{const t=mr({onInput:()=>t,onFailure:Rt,onDone:qa});return un(e,t)},FF=y(2,(e,t)=>Zv(e,()=>t)),A7=e=>Fe(e,ie),Qg=e=>Rr(e.takeWith(Rt,t=>Fe(et(t),()=>Qg(e)),qa)),xF=()=>Kg({onInput:e=>Fe(et(e),()=>xF()),onFailure:Cd,onDone:ii}),NF=y(2,(e,t)=>Fe(e,n=>wF(()=>t(n)))),P7=y(2,(e,t)=>F7(e,Ig(t))),F7=y(2,(e,t)=>yF(e,n=>Rt(t(n)))),Yg=y(2,(e,t)=>{const n=Kg({onInput:r=>Fe(et(t(r)),()=>n),onFailure:Cd,onDone:ii});return un(e,n)}),DF=y(2,(e,t)=>{const n=mr({onInput:r=>v(kt(t(r)),Fe(et),Fe(()=>n)),onFailure:Rt,onDone:ii});return un(e,n)}),x7=y(3,(e,t,n)=>sE(r=>z(function*(){const s=yield*rE(),o=Qg(s),a=yield*Zc(n);yield*Go(r,xt(a));const u=yield*Me(),f=n===Number.POSITIVE_INFINITY?g=>ie:(yield*Lg(n)).withPermits;yield*(yield*o.pipe(un(e),Hi(r))).pipe(Sr({onFailure:g=>Qe(a,Wn(g)),onSuccess:rn({onLeft:g=>ht(qt(f(n)(fe)),$s(Qe(a,Le(oe(g))))),onRight:g=>z(function*(){const k=yield*Me(),T=yield*Me();yield*Qe(a,Se(zt(k),ce)),yield*at(T,void 0).pipe(ht(si(O=>Wt(O(zt(u))).pipe(NP(Wt(O(t(g)))),Y(ie))).pipe(Ou(O=>iq(u,O)),kd(k))),f(1),ur(r)),yield*zt(T)})})}),ff,qt,ur(r));const p=Rr(df($i(go(a)),{onFailure:Rt,onSuccess:rn({onLeft:ii,onRight:g=>Fe(et(g),()=>p)})}));return Xv(p,s)}))),N7=e=>t=>D7(e)(t,Nl),D7=({bufferSize:e=16,concurrency:t,mergeStrategy:n=$7()})=>(r,s)=>sE(o=>z(function*(){const a=t==="unbounded"?Number.MAX_SAFE_INTEGER:t,u=yield*rE(),f=Qg(u),h=yield*Zc(e);yield*Go(o,xt(h));const p=yield*dn();yield*Go(o,xt(p));const g=yield*hi(V()),k=yield*Me(),T=(yield*Lg(a)).withPermits,O=yield*Hi(un(f,r),o);function D(S){return S.pipe(Y(rn({onLeft:_=>Le(W(_)),onRight:_=>ro(Qe(h,Le(ce(_))),V())})),v$({until:_=>ct(_)}),Y(_=>F5(g,rt({onNone:()=>W(_.value),onSome:C=>W(s(C,_.value))}))),ys(_=>af(_)?Wn(_):Qe(h,Wn(_)).pipe(ht(at(k,void 0)),$s)))}yield*O.pipe(Sr({onFailure:S=>Qe(h,Wn(S)).pipe(ht(Le(!1))),onSuccess:rn({onLeft:S=>Nv(qt(zt(k)),qt(T(a)(fe)),{onSelfDone:(_,C)=>ro(Ir(C),!1),onOtherDone:(_,C)=>ht(Ir(C),zi(g).pipe(Y(rt({onNone:()=>Qe(h,Le(oe(S))),onSome:$=>Qe(h,Le(oe(s($,S))))})),ro(!1)))}),onRight:S=>T7(n,{onBackPressure:()=>z(function*(){const _=yield*Me(),C=Tm(q=>Hi(un(f,S),q).pipe(Y(P=>ty(Wt(D(P)),Wt(qt(zt(k))))),Y(ie)));return yield*at(_,void 0).pipe(ht(C),T(1),ur(o)),yield*zt(_),!(yield*sb(k))}),onBufferSliding:()=>z(function*(){const _=yield*Me(),C=yield*Me(),$=yield*W9(p);yield*go(p).pipe(Y(N=>at(N,void 0)),xP(()=>$>=a)),yield*Qe(p,_);const q=Tm(N=>Hi(un(f,S),N).pipe(Y(M=>Wt(D(M)).pipe(ty(Wt(qt(zt(k)))),ty(Wt(qt(zt(_)))))),Y(ie)));return yield*at(C,void 0).pipe(ht(q),T(1),ur(o)),yield*zt(C),!(yield*sb(k))})})})}),v$({while:S=>S}),ur(o));const E=v(go(h),$i,df({onFailure:Rt,onSuccess:rn({onLeft:ii,onRight:S=>Fe(et(S),()=>E)})}),Rr);return Xv(E,u)})),MF=y(3,(e,t,n)=>N7(n)(Yg(e,t))),LF=y(2,(e,t)=>{function n(r){return z(function*(){const s=yield*rE(),o=Qg(s),a=yield*Hi(un(o,e),r),u=yield*Hi(un(o,t.other),r);function f(p,g,k){return(T,O,D)=>{function E(S){const _=S;return _._tag===$F?Le(kt(ht(Ir(g),_.effect))):Se(dP(g),Wr({onFailure:C=>kt(_.f(sn(C))),onSuccess:rn({onLeft:C=>kt(_.f(Ht(C))),onRight:C=>qd(et(C),h(D(_.f)))})}))}return Wr(p,{onFailure:S=>E(T(sn(S))),onSuccess:rn({onLeft:S=>E(T(Ht(S))),onRight:S=>Le(Fe(et(S),()=>Fe(kt(ur(qt(k),r)),_=>h(O(_,g)))))})})}}function h(p){switch(p._tag){case TF:{const g=qt(Cm(p.left)),k=qt(Cm(p.right));return Rr(Nv(g,k,{onSelfDone:(T,O)=>ht(Ir(O),f(T,p.right,a)(t.onSelfDone,ay,D=>O$(D))),onOtherDone:(T,O)=>ht(Ir(O),f(T,p.left,u)(t.onOtherDone,(D,E)=>ay(E,D),D=>q$(D)))}))}case IF:return Rr(Se(Wt(u),Wr({onFailure:g=>kt(p.f(sn(g))),onSuccess:rn({onLeft:g=>kt(p.f(Ht(g))),onRight:g=>Fe(et(g),()=>h(O$(p.f)))})})));case RF:return Rr(Se(Wt(a),Wr({onFailure:g=>kt(p.f(sn(g))),onSuccess:rn({onLeft:g=>kt(p.f(Ht(g))),onRight:g=>Fe(et(g),()=>h(q$(p.f)))})})))}}return kt(ks(p=>{const g=ks(O=>(O.transferChildren(p.scope()),fe)),k=qt(a).pipe(Ai(g),ur(r)),T=qt(u).pipe(Ai(g),ur(r));return Xc(k,T,(O,D)=>ay(O,D))})).pipe(Fe(h),Xv(s))})}return sE(n)}),M7=y(2,(e,t)=>q7(e,n=>SF(()=>ma(t(n))))),jF=y(2,(e,t)=>Td(()=>{let n;const r=Kg({onInput:o=>Fe(et(o),()=>r),onFailure:o=>(n=B7(o),Rt(ma(n))),onDone:ii}),s=mr({onInput:o=>v(et(o),Fe(()=>s)),onFailure:o=>Y8(o)&&H7(o.defect)&&de(o.defect,n)?Cd(o.defect.error):Rt(o),onDone:ii});return un(un(un(e,r),t),s)})),L7=e=>Tm(t=>tE(e,t)),j7=e=>L7(Gg(e)),UF=e=>hQ(t=>tE(e,t)),zF=e=>Rr(si(t=>Se($v(),n=>c7(Ou(t(Ev(e,n)),r=>yn(n,sn(r))),(r,s)=>yn(n,s))))),BF=e=>Xg(Se(Ng,t=>Fe(kt(e(t)),et))),U7=e=>Y(Ng,t=>Hi(e,t)),Hi=y(2,(e,t)=>Im(Te(()=>new xi(e,void 0,ie)),Io()).pipe(po(([n,r])=>OJ(t,s=>{const o=n.close(s);return o!==void 0?Cn(o,r):fe})),Bo,Se(([n])=>pt(()=>Nb(n.run(),n))))),Nb=(e,t)=>{const n=e;switch(n._tag){case Id:return Wr(t.getDone(),{onFailure:Wn,onSuccess:r=>Le(oe(r))});case Rd:return Le(ce(t.getEmit()));case qu:return v(n.effect,Y(()=>Nb(t.run(),t)));case Od:return eE(n,()=>Nb(t.run(),t),r=>Wn(r))}},Rr=e=>A7(kt(e)),Xg=e=>bF(zF(e),(t,n)=>t,(t,n)=>t),sE=e=>bF(BF(e),(t,n)=>t,(t,n)=>t),F$=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=eo(e?arguments[2]:arguments[1]),r=vd([RQ(t,n),FP(),gQ,qQ(NQ)]);if(e){const s=arguments[0];return P$(r,([o,a])=>Ab(s,ls(a,vs,o)),([o,,a,u],f)=>hm(o,f,a,u))}return s=>P$(r,([o,a])=>Ab(s,ls(a,vs,o)),([o,,a,u],f)=>hm(o,f,a,u))},Zg=e=>HF(0,e.length,e),HF=(e,t,n)=>e===t?hn:v(et(v(n,Ys(e))),Fe(()=>HF(e+1,t,n))),z7=y(e=>_F(e[1]),(e,t,n)=>n!=null&&n.concurrent?LF(e,{other:t,onSelfDone:r=>xb(s=>pt(()=>qk(r,s))),onOtherDone:r=>xb(s=>pt(()=>qk(s,r)))}):Fe(e,r=>NF(t,s=>[r,s]))),qd=y(e=>_F(e[1]),(e,t,n)=>n!=null&&n.concurrent?NF(z7(e,t,{concurrent:!0}),r=>r[1]):Fe(e,()=>t)),Db=Symbol.for("effect/Channel/ChannelException"),B7=e=>({_tag:"ChannelException",[Db]:Db,error:e}),H7=e=>ne(e,Db),Mb=Symbol.for("effect/Sink"),V7={_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e};var $I;$I=Mb;class e_{constructor(t){d(this,"channel");d(this,$I,V7);this.channel=t}pipe(){return Z(this,arguments)}}const W7=()=>new e_(VF(_t())),VF=e=>mr({onInput:t=>VF(v(e,Tt(t))),onFailure:Rt,onDone:()=>qa(e)}),K7=new e_(Gg(xF())),J7=e=>{const t=mr({onInput:n=>v(kt(e(n)),Fe(()=>t)),onFailure:Rt,onDone:()=>hn});return new e_(t)},G7=e=>new e_(kt(e)),WF=e=>qr(e)?WF(G7(e)):e.channel,Q7=v7,Y7=xb,KF=Ag,X7=gP,Z7=AG,JF=HJ,eY="Left",tY="Right",nY="Both",rY="Either",sY={_tag:eY},oY={_tag:tY},GF={_tag:nY},iY={_tag:rY},aY=e=>{switch(e){case"left":return sY;case"right":return oY;case"both":return GF;case"either":return iY;default:return e}},cY=GF;class QF{constructor(t){d(this,"value");this.value=t}}const YF=(e,t)=>({ref:e,isNew:t,isChanged:!1,expected:e.versioned,newValue:e.versioned.value}),XF=e=>e.newValue,ZF=(e,t)=>{e.isChanged=!0,e.newValue=t},uY=e=>{e.ref.versioned=new QF(e.newValue)},lY=e=>e.ref.versioned!==e.expected,fY=e=>e.isChanged,xm="Invalid",oE="ReadWrite",dY="ReadOnly",ex=e=>{for(const t of e)uY(t[1])},tx=e=>{let t=dY;for(const[,n]of e)if(t=lY(n)?xm:fY(n)?oE:t,t===xm)return t;return t},hY=e=>{const t=new Map;for(const[,n]of e){for(const r of n.ref.todos)t.set(r[0],r[1]);n.ref.todos=new Map}return t},mY=e=>{const t=Array.from(e.entries()).sort((n,r)=>n[0]-r[0]);for(const[n,r]of t)r()},pY=(e,t,n)=>{let r=!1;for(const[,s]of t)s.ref.todos.has(e)||(s.ref.todos.set(e,n),r=!0);return r},nx="WithSTMRuntime",Lb="OnFailure",x$="OnRetry",jb="OnSuccess",gY="Provide",rx="Sync",sx="Succeed",ox="Retry",ix="Fail",ax="Die",cx="Interrupt",vc="Fail",Ec="Die",kc="Interrupt",Vi="Succeed",Au="Retry",iE="Done",aE="Suspend",Ah="Done",Ub="Interrupted",Nm="Running",t_="effect/STM/State",pa=Symbol.for(t_),cE=e=>ne(e,pa),ux=e=>e._tag===Nm,_Y=e=>e._tag===Ah,eh=e=>({[pa]:pa,_tag:Ah,exit:e,[pe](){return v(Q(t_),ue(Q(Ah)),ue(Q(e)),it(this))},[ge](t){return cE(t)&&t._tag===Ah&&de(e,t.exit)}}),yY=v(Q(t_),ue(Q(Ub)),ue(Q("interrupted"))),bY={[pa]:pa,_tag:Ub,[pe](){return yY},[ge](e){return cE(e)&&e._tag===Ub}},SY=v(Q(t_),ue(Q(Nm)),ue(Q("running"))),wY={[pa]:pa,_tag:Nm,[pe](){return SY},[ge](e){return cE(e)&&e._tag===Nm}},th=e=>{switch(e._tag){case vc:return eh(ld(e.error));case Ec:return eh(Yl(e.defect));case kc:return eh(Y4(e.fiberId));case Vi:return eh(Ht(e.value));case Au:throw new Error("BUG: STM.STMState.fromTExit - please report an issue at https://github.com/Effect-TS/effect/issues")}},Pu="effect/TExit",Fu=Symbol.for(Pu),Ad={_A:e=>e,_E:e=>e},Pd=e=>ne(e,Fu),vY=e=>e._tag===Vi,EY=e=>e._tag===Au,kY=e=>({[Fu]:Ad,_tag:vc,error:e,[pe](){return v(Q(Pu),ue(Q(vc)),ue(Q(e)),it(this))},[ge](t){return Pd(t)&&t._tag===vc&&de(e,t.error)}}),$Y=e=>({[Fu]:Ad,_tag:Ec,defect:e,[pe](){return v(Q(Pu),ue(Q(Ec)),ue(Q(e)),it(this))},[ge](t){return Pd(t)&&t._tag===Ec&&de(e,t.defect)}}),CY=e=>({[Fu]:Ad,_tag:kc,fiberId:e,[pe](){return v(Q(Pu),ue(Q(kc)),ue(Q(e)),it(this))},[ge](t){return Pd(t)&&t._tag===kc&&de(e,t.fiberId)}}),N$=e=>({[Fu]:Ad,_tag:Vi,value:e,[pe](){return v(Q(Pu),ue(Q(Vi)),ue(Q(e)),it(this))},[ge](t){return Pd(t)&&t._tag===Vi&&de(e,t.value)}}),TY=v(Q(Pu),ue(Q(Au)),ue(Q("retry"))),IY={[Fu]:Ad,_tag:Au,[pe](){return TY},[ge](e){return Pd(e)&&EY(e)}},RY=e=>({_tag:iE,exit:e}),lx=e=>({_tag:aE,journal:e}),D$={ref:0},OY=()=>{const e=D$.ref+1;return D$.ref=e,e},qY="effect/STM",AY=Symbol.for(qY),nh={_R:e=>e,_E:e=>e,_A:e=>e};var CI,TI,II,RI;class Oo{constructor(t){d(this,"effect_instruction_i0");d(this,"_op",Uf);d(this,"effect_instruction_i1");d(this,"effect_instruction_i2");d(this,RI);d(this,II);d(this,TI);d(this,CI);this.effect_instruction_i0=t,this[w$]=Xi,this[qy]=nh,this[Mb]=nh,this[Am]=nh}get[(RI=w$,II=qy,TI=Mb,CI=Am,AY)](){return nh}[ge](t){return this===t}[pe](){return it(this,gp(this))}[Symbol.iterator](){return new yu(new au(this))}commit(){return PY(this,Nl)}pipe(){return Z(this,arguments)}}const PY=(e,t,n)=>Ae(r=>{const s=r.id(),o=r.getFiberRef(MP),a=r.getFiberRef(LP),u=r.getFiberRef(PQ),f=xY(s,e,o,a,u);switch(f._tag){case iE:return t(f.exit),f.exit;case aE:{const h=OY(),p={value:wY},g=OP(k=>fx(s,e,h,p,o,a,u,k));return si(k=>v(k(g),ys(T=>{let O=p.value;return ux(O)&&(p.value=bY),O=p.value,_Y(O)?(t(O.exit),O.exit):Wn(T)})))}}}),FY=(e,t,n,r,s,o)=>{const a=new Map,u=new dx(t,a,e,r).run(),f=tx(a);if(f===oE)ex(a);else if(f===xm)throw new Error("BUG: STM.TryCommit.tryCommit - please report an issue at https://github.com/Effect-TS/effect/issues");switch(u._tag){case Vi:return n.value=th(u),Ho(Ht(u.value),a,s,o);case vc:{n.value=th(u);const h=Tu(u.error);return Ho(sn(h),a,s,o)}case Ec:{n.value=th(u);const h=ma(u.defect);return Ho(sn(h),a,s,o)}case kc:{n.value=th(u);const h=Cg(e);return Ho(sn(h),a,s,o)}case Au:return lx(a)}},xY=(e,t,n,r,s)=>{const o=new Map,a=new dx(t,o,e,n).run(),u=tx(o);if(u===oE&&vY(a))ex(o);else if(u===xm)throw new Error("BUG: STM.TryCommit.tryCommitSync - please report an issue at https://github.com/Effect-TS/effect/issues");switch(a._tag){case Vi:return Ho(Ht(a.value),o,r,s);case vc:{const f=Tu(a.error);return Ho(sn(f),o,r,s)}case Ec:{const f=ma(a.defect);return Ho(sn(f),o,r,s)}case kc:{const f=Cg(e);return Ho(sn(f),o,r,s)}case Au:return lx(o)}},fx=(e,t,n,r,s,o,a,u)=>{if(ux(r.value)){const f=FY(e,t,r,s,o,a);switch(f._tag){case iE:{NY(f.exit,u);break}case aE:{pY(n,f.journal,()=>fx(e,t,n,r,s,o,a,u));break}}}},Ho=(e,t,n,r)=>{const s=hY(t);return s.size>0&&n.scheduleTask(()=>mY(s),r),RY(e)},NY=(e,t)=>{t(e)};class dx{constructor(t,n,r,s){d(this,"self");d(this,"journal");d(this,"fiberId");d(this,"contStack",[]);d(this,"env");this.self=t,this.journal=n,this.fiberId=r,this.env=s}getEnv(){return this.env}pushStack(t){this.contStack.push(t)}popStack(){return this.contStack.pop()}nextSuccess(){let t=this.popStack();for(;t!==void 0&&t.effect_instruction_i0!==jb;)t=this.popStack();return t}nextFailure(){let t=this.popStack();for(;t!==void 0&&t.effect_instruction_i0!==Lb;)t=this.popStack();return t}nextRetry(){let t=this.popStack();for(;t!==void 0&&t.effect_instruction_i0!==x$;)t=this.popStack();return t}run(){let t=this.self,n;for(;n===void 0&&t!==void 0;)try{const r=t;if(r)switch(r._op){case"Tag":{t=n_((s,o,a)=>Ip(a,r));break}case"Left":{t=zb(r.left);break}case"None":{t=zb(new Rg);break}case"Right":{t=Gt(r.right);break}case"Some":{t=Gt(r.value);break}case"Commit":{switch(r.effect_instruction_i0){case ax:{n=$Y(mt(()=>r.effect_instruction_i1()));break}case ix:{const s=this.nextFailure();s===void 0?n=kY(mt(()=>r.effect_instruction_i1())):t=mt(()=>s.effect_instruction_i2(mt(()=>r.effect_instruction_i1())));break}case ox:{const s=this.nextRetry();s===void 0?n=IY:t=mt(()=>s.effect_instruction_i2());break}case cx:{n=CY(this.fiberId);break}case nx:{t=mt(()=>r.effect_instruction_i1(this));break}case jb:case Lb:case x$:{this.pushStack(r),t=r.effect_instruction_i1;break}case gY:{const s=this.env;this.env=mt(()=>r.effect_instruction_i2(s)),t=v(r.effect_instruction_i1,jY(uE(()=>this.env=s)));break}case sx:{const s=r.effect_instruction_i1,o=this.nextSuccess();o===void 0?n=N$(s):t=mt(()=>o.effect_instruction_i2(s));break}case rx:{const s=mt(()=>r.effect_instruction_i1()),o=this.nextSuccess();o===void 0?n=N$(s):t=mt(()=>o.effect_instruction_i2(s));break}}break}}}catch(r){t=MY(r)}return n}}const DY=y(2,(e,t)=>{const n=new Oo(Lb);return n.effect_instruction_i1=e,n.effect_instruction_i2=t,n}),MY=e=>LY(()=>e),LY=e=>{const t=new Oo(ax);return t.effect_instruction_i1=e,t},n_=e=>ss(t=>Gt(e(t.journal,t.fiberId,t.getEnv()))),jY=y(2,(e,t)=>zY(e,{onFailure:n=>M$(t,zb(n)),onSuccess:n=>M$(t,Gt(n))})),zb=e=>UY(()=>e),UY=e=>{const t=new Oo(ix);return t.effect_instruction_i1=e,t},xu=y(2,(e,t)=>{const n=new Oo(jb);return n.effect_instruction_i1=e,n.effect_instruction_i2=t,n}),zY=y(2,(e,{onFailure:t,onSuccess:n})=>v(e,hf(ce),DY(r=>v(t(r),hf(oe))),xu(r=>{switch(r._tag){case"Left":return Gt(r.left);case"Right":return n(r.right)}}))),ss=e=>{const t=new Oo(nx);return t.effect_instruction_i1=e,t},No=e=>{const t=new Oo(cx);return t.effect_instruction_i1=e,t},hf=y(2,(e,t)=>v(e,xu(n=>uE(()=>t(n))))),ec=new Oo(ox),Gt=e=>{const t=new Oo(sx);return t.effect_instruction_i1=e,t},uE=e=>{const t=new Oo(rx);return t.effect_instruction_i1=e,t},M$=y(2,(e,t)=>v(e,xu(()=>t))),L$="BackPressure",Bb="Dropping",j$="Sliding",BY=e=>xu(e,ie),HY=(...e)=>VY(()=>{const n=(e.length===1?e[0]:e[1].bind(e[0]))(v),r=n.next(),s=o=>o.done?Gt(o.value):xu(f1(o.value),a=>s(n.next(a)));return s(r)}),VY=e=>BY(uE(e)),U$=Gt(void 0),WY="effect/TRef",KY=Symbol.for(WY),JY={_A:e=>e};var OI;OI=KY;class GY{constructor(t){d(this,OI,JY);d(this,"todos");d(this,"versioned");this.versioned=new QF(t),this.todos=new Map}modify(t){return n_(n=>{const r=lE(this,n),[s,o]=t(XF(r));return ZF(r,o),s})}pipe(){return Z(this,arguments)}}const hx=e=>n_(t=>{const n=new GY(e);return t.set(n,YF(n,!0)),n}),QY=e=>e.modify(t=>[t,t]),YY=y(2,(e,t)=>e.modify(()=>[void 0,t])),XY=y(2,(e,t)=>e.modify(n=>[void 0,t(n)])),lE=(e,t)=>{if(t.has(e))return t.get(e);const n=YF(e,!1);return t.set(e,n),n},Ns=y(2,(e,t)=>XF(lE(e,t))),Ds=y(3,(e,t,n)=>{const r=lE(e,n);ZF(r,t)}),ZY="effect/TQueue/TEnqueue",eX=Symbol.for(ZY),tX="effect/TQueue/TDequeue",nX=Symbol.for(tX),rX={_tag:Bb},sX={_Out:e=>e},oX={_In:e=>e};var qI,AI;AI=nX,qI=eX;class iX{constructor(t,n,r){d(this,"ref");d(this,"requestedCapacity");d(this,"strategy");d(this,AI,sX);d(this,qI,oX);d(this,"size",ss(t=>{const n=Ns(this.ref,t.journal);return n===void 0?No(t.fiberId):Gt(n.length)}));d(this,"isFull",hf(this.size,t=>t===this.requestedCapacity));d(this,"isEmpty",hf(this.size,t=>t===0));d(this,"shutdown",ss(t=>(Ds(this.ref,void 0,t.journal),U$)));d(this,"isShutdown",n_(t=>Ns(this.ref,t)===void 0));d(this,"awaitShutdown",xu(this.isShutdown,t=>t?U$:ec));d(this,"peek",ss(t=>{const n=Ns(this.ref,t.journal);return n===void 0?No(t.fiberId):n.length===0?ec:Gt(n[0])}));d(this,"peekOption",ss(t=>{const n=Ns(this.ref,t.journal);return n===void 0?No(t.fiberId):Gt(wa(n[0]))}));d(this,"take",ss(t=>{const n=Ns(this.ref,t.journal);if(n===void 0)return No(t.fiberId);if(n.length===0)return ec;const r=n.shift();return Ds(this.ref,n,t.journal),Gt(r)}));d(this,"takeAll",ss(t=>{const n=Ns(this.ref,t.journal);return n===void 0?No(t.fiberId):(Ds(this.ref,[],t.journal),Gt(n))}));this.ref=t,this.requestedCapacity=n,this.strategy=r}capacity(){return this.requestedCapacity}offer(t){return ss(n=>{const r=v(this.ref,Ns(n.journal));if(r===void 0)return No(n.fiberId);if(r.length<this.requestedCapacity)return r.push(t),Ds(this.ref,r,n.journal),Gt(!0);switch(this.strategy._tag){case L$:return ec;case Bb:return Gt(!1);case j$:return r.length===0||(r.shift(),r.push(t),Ds(this.ref,r,n.journal)),Gt(!0)}})}offerAll(t){return ss(n=>{const r=Array.from(t),s=Ns(this.ref,n.journal);if(s===void 0)return No(n.fiberId);if(s.length+r.length<=this.requestedCapacity)return Ds(this.ref,[...s,...r],n.journal),Gt(!0);switch(this.strategy._tag){case L$:return ec;case Bb:{const o=r.slice(0,this.requestedCapacity-s.length);return Ds(this.ref,[...s,...o],n.journal),Gt(!1)}case j$:{const o=r.slice(0,this.requestedCapacity-s.length),a=s.length+o.length-this.requestedCapacity,u=s.slice(a);return Ds(this.ref,[...u,...o],n.journal),Gt(!0)}}})}takeUpTo(t){return ss(n=>{const r=Ns(this.ref,n.journal);if(r===void 0)return No(n.fiberId);const[s,o]=DR(jt(r),t);return Ds(this.ref,Array.from(o),n.journal),Gt(Array.from(s))})}}const aX=y(2,(e,t)=>e.offer(t)),cX=e=>e.peek,uX=e=>e.take,lX=()=>fX(Number.MAX_SAFE_INTEGER,rX),fX=(e,t)=>hf(hx([]),n=>new iX(n,e,t)),dX=aX,hX=cX,mX=uX,pX=lX,gX=e=>Object.assign(e,{chunk(n){return this(Le(n))},die(n){return this(ri(n))},dieMessage(n){return this(qP(n))},done(n){return this(pt(()=>Z4(n,{onFailure:W,onSuccess:ut})))},end(){return this(Mn(V()))},fail(n){return this(Mn(W(n)))},fromEffect(n){return this(AP(n,{onFailure:W,onSuccess:ut}))},fromEffectChunk(n){return this(v(n,mo(W)))},halt(n){return this(Wn(v(n,Ig(W))))},single(n){return this(Le(ut(n)))}}),_X=(e,t)=>{let n=!1,r=[],s=!1;function o(f){if(n)return!1;if(f.length<=5e4)r.push.apply(r,f);else for(let h=0;h<f.length;h++)r.push(f[0]);return s||(s=!0,t.scheduleTask(a,0)),!0}function a(){s=!1,r.length>0&&(e.unsafeOffer(r),r=[])}function u(f){n||(n=!0,f._tag==="Success"&&r.push(f.value),a(),e.unsafeOffer(f._tag==="Success"?Jn:f))}return{single(f){return n?!1:(r.push(f),s||(s=!0,t.scheduleTask(a,0)),!0)},array:o,chunk(f){return o(ar(f))},done:u,end(){n||(n=!0,a(),e.unsafeOffer(Jn))},halt(f){return u(sn(f))},fail(f){return u(ld(f))},die(f){return u(Yl(f))},dieMessage(f){return u(Yl(new Error(f)))}}},yX="effect/Take",bX=Symbol.for(yX),SX={_A:e=>e,_E:e=>e};var PI;PI=bX;class r_{constructor(t){d(this,"exit");d(this,PI,SX);this.exit=t}pipe(){return Z(this,arguments)}}const mf=e=>new r_(Ht(e)),wX=e=>pt(()=>e.exit),pf=new r_(ld(V())),s_=e=>new r_(sn(v(e,Ig(W)))),vX=e=>df(e,{onFailure:t=>rt(yv(t),{onNone:()=>pf,onSome:s_}),onSuccess:mf}),mx=y(2,(e,{onEnd:t,onFailure:n,onSuccess:r})=>Wr(e.exit,{onFailure:s=>rt(yv(s),{onNone:t,onSome:n}),onSuccess:r})),EX=e=>new r_(Ht(ut(e))),px=()=>Mn(V()),kX=e=>mo(Wn(e),W),$X="effect/Stream",gx=Symbol.for($X),CX={_R:e=>e,_E:e=>e,_A:e=>e};var FI;FI=gx;class Ye{constructor(t){d(this,"channel");d(this,FI,CX);this.channel=t}pipe(){return Z(this,arguments)}}const Fd=e=>ne(e,gx)||qr(e),fE=4096,TX=e=>{if(e==="unbounded")return dn();if(typeof e=="number"||e===void 0)return Zc(e??16);switch(e.strategy){case"dropping":return Vg(e.bufferSize??16);case"sliding":return Wg(e.bufferSize??16);default:return Zc(e.bufferSize??16)}},IX=e=>{if((e==null?void 0:e.bufferSize)==="unbounded"||(e==null?void 0:e.bufferSize)===void 0&&(e==null?void 0:e.strategy)===void 0)return dn();switch(e==null?void 0:e.strategy){case"sliding":return Wg(e.bufferSize??16);default:return Vg((e==null?void 0:e.bufferSize)??16)}},RX=(e,t)=>ot(IX(t),xt).pipe(po(n=>AQ(LP,r=>e(_X(n,r)))),Se(n=>{const r=Fe(go(n),s=>J4(s)?Hc(s)?hn:Rt(s.cause):qd(et(jt(s)),r));return r}),Xg,zX),OX=(e,t)=>v(ot(TX(t),n=>xt(n)),Y(n=>v(Io(),Y(r=>v(e(gX(s=>v(vX(s),Y(o=>Qe(n,o)),$s,X7(r)).then(o=>{if(Ra(o)&&!af(o.cause))throw bv(o.cause)}))),ht(hi(!1)),Y(s=>v(zi(s),Se(o=>o?px():v(go(n),Y(wX),fQ(()=>v(Wc(s,!0),ht(xt(n)))))))))))),mE,Qo(i_)),qX=y(2,(e,t)=>{if(t.strategy==="dropping")return AX(e,t.capacity);if(t.strategy==="sliding")return PX(e,t.capacity);const n=cZ(e,t);return new Ye(Xg(Se(n,r=>{const s=v(kt(go(r)),Fe(mx({onEnd:()=>hn,onFailure:Rt,onSuccess:o=>v(et(o),Fe(()=>s))})));return s})))}),AX=y(2,(e,t)=>{const n=ot(Vg(t),r=>xt(r));return new Ye(_x(n,Je(e)))}),PX=y(2,(e,t)=>{const n=ot(Wg(t),r=>xt(r));return new Ye(_x(n,Je(e)))}),_x=(e,t)=>{const n=(s,o)=>{const a=u=>v(zi(o),po(zt),ht(Me()),Y(f=>v(Qe(s,[u,f]),ht(Wc(o,f)),ht(zt(f)))),$s,kt);return mr({onInput:u=>v(Me(),Y(f=>v(Qe(s,[mf(u),f]),Y(h=>v(Wc(o,f),xP(()=>h))))),$s,kt,Fe(()=>n(s,o))),onFailure:u=>a(s_(u)),onDone:()=>a(pf)})},r=s=>{const o=v(kt(go(s)),Fe(([a,u])=>qd(kt(at(u,void 0)),mx(a,{onEnd:()=>hn,onFailure:Rt,onSuccess:f=>v(et(f),Fe(()=>o))}))));return o};return Xg(v(e,Y(s=>v(Me(),po(o=>at(o,void 0)),Y(o=>v(hi(o),Y(a=>v(t,un(n(s,a)),UF,Vt)),ro(r(s))))))))},yx=y(2,(e,t)=>new Ye(v(Je(e),qd(Je(t))))),FX=e=>Nu(ri(e)),Hb=y(2,(e,t)=>new Ye(v(Je(e),FF(t)))),xX=y(2,(e,t)=>new Ye(Zv(Je(e),t))),NX=e=>dE(Mn(W(e))),DX=y(2,(e,t)=>Ex(e,Rp(t))),MX=y(2,(e,t)=>{const n=r=>{const s=r.next();return s.done?mr({onInput:o=>n(o[Symbol.iterator]()),onFailure:Rt,onDone:qa}):v(t(s.value),Se(o=>o?v(et(ut(s.value)),Fe(()=>n(r))):n(r)),Rr)};return new Ye(Td(()=>v(Je(e),un(n(_t()[Symbol.iterator]())))))}),LX=y(2,(e,t)=>Ex(e,NR(t))),Qo=y(e=>Fd(e[0]),(e,t,n)=>{const r=(n==null?void 0:n.bufferSize)??16;return n!=null&&n.switch?Vb(n==null?void 0:n.concurrency,()=>z$(e,1,r,t),s=>z$(e,s,r,t)):Vb(n==null?void 0:n.concurrency,()=>new Ye(Fm(Je(e),s=>v(s,sc(o=>Je(t(o))),BU(hn,(o,a)=>v(o,qd(a)))))),s=>new Ye(v(Je(e),Fm(Zg),MF(o=>Je(t(o)),n))))}),Vb=(e,t,n)=>{switch(e){case void 0:return t();case"unbounded":return n(Number.MAX_SAFE_INTEGER);default:return e>1?n(e):t()}},z$=y(4,(e,t,n,r)=>new Ye(v(Je(e),Fm(Zg),MF(s=>Je(r(s)),{concurrency:t,mergeStrategy:C7(),bufferSize:n})))),o_=y(e=>Fd(e[0]),(e,t)=>Qo(e,ie,t)),bx=e=>{const t=mr({onInput:n=>Fe(Zg(n),()=>t),onFailure:Rt,onDone:()=>hn});return new Ye(v(Je(e),un(t)))},jX=e=>{const t=(r,s)=>{const[o,a]=v(r,UU(f=>!Hc(f))),u=v(Op(a),rt({onNone:()=>s,onSome:Wr({onFailure:f=>rt(yv(f),{onNone:()=>hn,onSome:Rt}),onSuccess:()=>hn})}));return v(et(v(o,NR(f=>Hc(f)?W(f.value):V()))),Fe(()=>u))},n=mr({onInput:r=>t(r,n),onFailure:r=>Rt(r),onDone:()=>hn});return new Ye(v(Je(e),un(n)))},UX=e=>v(e,_f(ao),bx),Sx=e=>bx(jX(v(e,_f(t=>t.exit)))),zX=e=>new Ye(e),Je=e=>{if("channel"in e)return e.channel;if(qr(e))return Je(Nu(e));throw new TypeError("Expected a Stream.")},Wb=e=>new Ye(Qf(e)?hn:et(e)),Nu=e=>v(e,mo(W),dE),dE=e=>new Ye(Rr(EQ(e,{onFailure:rt({onNone:()=>hn,onSome:Cd}),onSuccess:t=>et(ut(t))}))),wx=(e,t)=>{const n=(t==null?void 0:t.maxChunkSize)??fE;if(t!=null&&t.scoped){const s=Se($$(e),o=>gf(o,{maxChunkSize:n,shutdown:!0}));return t.shutdown?Se(s,Hb(qm(e))):s}const r=Qo(mE($$(e)),s=>gf(s,{maxChunkSize:n}));return t!=null&&t.shutdown?Hb(r,qm(e)):r},BX=e=>pE(()=>Li(e)?Wb(e):HX(e[Symbol.iterator]())),HX=(e,t=fE)=>v(Te(()=>{let n=[];const r=s=>v(Te(()=>{let o=s.next();if(t===1)return o.done?hn:v(et(ut(o.value)),Fe(()=>r(s)));n=[];let a=0;for(;o.done===!1&&(n.push(o.value),a=a+1,!(a>=t));)o=s.next();return a>0?v(et(jt(n)),Fe(()=>r(s))):hn}),Rr);return new Ye(r(e))}),$x),VX=e=>v(e,Se(i_),a_),gf=(e,t)=>v(XP(e,1,(t==null?void 0:t.maxChunkSize)??fE),ys(n=>v(K9(e),Y(r=>r&&af(n)?px():kX(n)))),i_,t!=null&&t.shutdown?Hb(xt(e)):ie),WX=(...e)=>{const t=e.length===1?e[0].evaluate:e[0],n=e.length===1?e[0].onError:e[1],r=e.length===1?e[0].releaseLockOnEnd===!0:!1;return a_(Se(ot(Te(()=>t().getReader()),s=>r?Te(()=>s.releaseLock()):Fg(()=>s.cancel())),s=>Kb(Y(El({try:()=>s.read(),catch:o=>W(n(o))}),({done:o,value:a})=>o?Mn(V()):Le(a)))))},vx=(...e)=>BX(e),_f=y(2,(e,t)=>new Ye(v(Je(e),Yg(sc(t))))),Ex=y(2,(e,t)=>new Ye(v(Je(e),Yg(t)))),KX=y(2,(e,t)=>new Ye(v(Je(e),DF(t)))),Dm=y(2,(e,t)=>{const n=r=>{const s=r.next();if(s.done)return mr({onInput:o=>n(o[Symbol.iterator]()),onFailure:Rt,onDone:qa});{const o=s.value;return Rr(Se(t(o),a=>Fe(et(ut(a)),()=>n(r))))}};return new Ye(v(Je(e),un(Td(()=>n(_t()[Symbol.iterator]())))))}),JX=y(3,(e,t,n)=>new Ye(v(Je(e),Fm(Zg),x7(n,t),Yg(ut)))),GX=y(2,(e,t)=>new Ye(v(Je(e),P7(t)))),QX=y(2,(e,t)=>YX(e,t,{onSelf:oe,onOther:ce})),YX=y(3,(e,t,n)=>{const r=n.haltStrategy?aY(n.haltStrategy):cY,s=o=>a=>o||!Hc(a)?Q7(pt(()=>a)):Y7(u=>pt(()=>u));return new Ye(LF(Je(_f(e,n.onSelf)),{other:Je(_f(t,n.onOther)),onSelfDone:s(r._tag==="Either"||r._tag==="Left"),onOtherDone:s(r._tag==="Either"||r._tag==="Right")}))}),XX=Nu(Ov),ZX=e=>v(e,eZ(ie)),eZ=y(2,(e,t)=>new Ye(v(Je(e),M7(t)))),tZ=y(2,(e,t)=>new Ye(v(Je(e),Ab(t)))),i_=e=>dZ(e,t=>v(Se(t,n=>W([n,t])),xg(rt({onNone:()=>Le(V()),onSome:Mn})))),Kb=e=>i_(v(e,Se(ut))),hE=y(2,(e,t)=>Je(e).pipe(jF(WF(t)),j7)),nZ=e=>hE(e,W7()),rZ=e=>hE(e,K7),kx=y(2,(e,t)=>hE(e,J7(t))),sZ=y(2,(e,t)=>{const n=mr({onInput:r=>Fe(et(mf(r)),()=>n),onFailure:r=>et(s_(r)),onDone:()=>et(pf)});return v(un(Je(e),n),DF(r=>Qe(t,r)),Gg,UF,$s)}),mE=e=>new Ye(FF(zF(v(e,Se(ut))),fe)),oZ=e=>new Ye(BF(t=>e(t).pipe(Se(ut)))),pE=e=>new Ye(Td(()=>Je(e()))),iZ=y(2,(e,t)=>{if(!Number.isInteger(t))return FX(new Z8(`${t} must be an integer`));const n=r=>Kg({onInput:s=>{const o=v(s,Oc(Math.min(r,Number.POSITIVE_INFINITY))),a=Math.max(0,r-o.length);return a>0?v(et(o),Fe(()=>n(a))):et(o)},onFailure:Cd,onDone:qa});return new Ye(v(Je(e),jF(0<t?n(t):hn)))}),aZ=y(2,(e,t)=>Dm(e,n=>ro(t(n),n))),uy=e=>Se(U7(Je(e)),t=>v(t,mo(W),Y(rn({onLeft:()=>Mn(V()),onRight:Le})))),cZ=y(e=>Fd(e[0]),(e,t)=>po(ot((t==null?void 0:t.strategy)==="unbounded"?dn():(t==null?void 0:t.strategy)==="dropping"?Vg(t.capacity??2):(t==null?void 0:t.strategy)==="sliding"?Wg(t.capacity??2):Zc((t==null?void 0:t.capacity)??2),n=>xt(n)),n=>Vt(sZ(e,n)))),uZ=y(e=>Fd(e[0]),(e,t)=>Se(Io(),n=>lZ(e,n,t))),lZ=y(e=>Fd(e[0]),(e,t,n)=>{const r=KF(t);let s,o;const a=CQ(!1);return new ReadableStream({start(u){o=r(kx(e,f=>a.whenOpen(Te(()=>{a.unsafeClose();for(const h of f)u.enqueue(h);s(),s=void 0})))),o.addObserver(f=>{f._tag==="Failure"?u.error(bv(f.cause)):u.close()})},pull(){return new Promise(u=>{s=u,bs(a.open)})},cancel(){if(o)return DP($s(Ir(o)))}},n==null?void 0:n.strategy)}),fZ=(e,t)=>{const n=r=>rt(t(r),{onNone:()=>hn,onSome:([s,o])=>Fe(et(s),()=>n(o))});return new Ye(Td(()=>n(e)))},dZ=(e,t)=>pE(()=>{const n=r=>Rr(Se(t(r),rt({onNone:()=>hn,onSome:([s,o])=>Fe(et(s),()=>n(o))})));return new Ye(n(e))}),$x=e=>o_(Nu(e)),a_=e=>o_(mE(e)),hZ=e=>o_(oZ(t=>e(t))),mZ=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=eo(e?arguments[2]:arguments[1]);if(e){const r=arguments[0];return new Ye(F$(Je(r),t,n))}return r=>new Ye(F$(Je(r),t,n))},pZ=y(2,(e,t)=>v(e,gZ(t,(n,r)=>[n,r]))),gZ=y(3,(e,t,n)=>{const r=s=>v(s,Y(o=>Qf(o)?r(s):Le(o)));return v(uy(e),Se(r),Im(v(uy(t),Se(r))),Y(([s,o])=>v(dE(Nv(s,o,{onSelfDone:(a,u)=>v(pt(()=>a),Xc(Cm(u),(f,h)=>[f,h,!0])),onOtherDone:(a,u)=>v(pt(()=>a),Xc(Cm(u),(f,h)=>[h,f,!1]))})),Qo(([a,u,f])=>v(Nu(hi([Va(a),Va(u)])),Qo(h=>v(Wb(f?v(u,sc(p=>n(Va(a),p))):v(a,sc(p=>n(p,Va(u))))),yx(v(Kb(s),QX(Kb(o)),Dm(rn({onLeft:p=>v(ki(h,([g,k])=>[v(p,sc(T=>n(T,k))),[Va(p),k]])),onRight:p=>v(ki(h,([g,k])=>[v(p,sc(T=>n(g,T))),[g,Va(p)]]))})),Qo(Wb))))))),uy)),VX)}),_Z=(e,t,n)=>RX(r=>ot(Te(()=>e.addEventListener(t,r.single,n)),()=>Te(()=>e.removeEventListener(t,r.single,n))),{bufferSize:typeof n=="object"?n.bufferSize:void 0}),Cx="effect/Redacted",Ph=Ee("effect/Redacted/redactedRegistry",()=>new WeakMap),Tx=Symbol.for(Cx),yZ={[Tx]:{_A:e=>e},pipe(){return Z(this,arguments)},toString(){return"<redacted>"},toJSON(){return"<redacted>"},[Ue](){return"<redacted>"},[pe](){return v(Q(Cx),ue(Q(Ph.get(this))),it(this))},[ge](e){return bZ(e)&&de(Ph.get(this),Ph.get(e))}},bZ=e=>ne(e,Tx),SZ=e=>{const t=Object.create(yZ);return Ph.set(t,e),t},B$=Symbol.for("effect/Encoding/errors/Decode"),Fh=(e,t)=>{const n={_tag:"DecodeException",[B$]:B$,input:e};return Tn(t)&&(n.message=t),n},H$=Symbol.for("effect/Encoding/errors/Encode"),wZ=(e,t)=>{const n={_tag:"EncodeException",[H$]:H$,input:e};return Tn(t)&&(n.message=t),n},vZ=new TextEncoder,V$=e=>{const t=e.length;let n="",r;for(r=2;r<t;r+=3)n+=Ms[e[r-2]>>2],n+=Ms[(e[r-2]&3)<<4|e[r-1]>>4],n+=Ms[(e[r-1]&15)<<2|e[r]>>6],n+=Ms[e[r]&63];return r===t+1&&(n+=Ms[e[r-2]>>2],n+=Ms[(e[r-2]&3)<<4],n+="=="),r===t&&(n+=Ms[e[r-2]>>2],n+=Ms[(e[r-2]&3)<<4|e[r-1]>>4],n+=Ms[(e[r-1]&15)<<2],n+="="),n},EZ=e=>{const t=kZ(e),n=t.length;if(n%4!==0)return oe(Fh(t,`Length must be a multiple of 4, but is ${n}`));const r=t.indexOf("=");if(r!==-1&&(r<n-2||r===n-2&&t[n-1]!=="="))return oe(Fh(t,"Found a '=' character, but it is not at the end"));try{const s=t.endsWith("==")?2:t.endsWith("=")?1:0,o=new Uint8Array(3*(n/4)-s);for(let a=0,u=0;a<n;a+=4,u+=3){const f=rh(t.charCodeAt(a))<<18|rh(t.charCodeAt(a+1))<<12|rh(t.charCodeAt(a+2))<<6|rh(t.charCodeAt(a+3));o[u]=f>>16,o[u+1]=f>>8&255,o[u+2]=f&255}return ce(o)}catch(s){return oe(Fh(t,s instanceof Error?s.message:"Invalid input"))}},kZ=e=>e.replace(/[\n\r]/g,"");function rh(e){if(e>=W$.length)throw new TypeError(`Invalid character ${String.fromCharCode(e)}`);const t=W$[e];if(t===255)throw new TypeError(`Invalid character ${String.fromCharCode(e)}`);return t}const Ms=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],W$=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,0,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],$Z=e=>V$(typeof e=="string"?vZ.encode(e):e),CZ=e=>EZ(e),TZ=e=>US({try:()=>encodeURIComponent(e),catch:t=>OZ(e,t instanceof Error?t.message:"Invalid input")}),IZ=e=>US({try:()=>decodeURIComponent(e),catch:t=>RZ(e,t instanceof Error?t.message:"Invalid input")}),RZ=Fh,OZ=wZ,Jb=Symbol.for("effect/FiberHandle"),qZ=e=>ne(e,Jb),AZ={[Jb]:Jb,toString(){return lt(this.toJSON())},toJSON(){return{_id:"FiberHandle",state:this.state}},[Ue](){return this.toJSON()},pipe(){return Z(this,arguments)}},PZ=e=>{const t=Object.create(AZ);return t.state={_tag:"Open",fiber:void 0},t.deferred=e,t},Ix=()=>ot(Se(Me(),e=>PZ(e)),e=>ks(t=>{const n=e.state;return n._tag==="Closed"?fe:(e.state={_tag:"Closed"},n.fiber?kd($s(qg(n.fiber,cr(t.id(),kl))),e.deferred):Ia(e.deferred,Jn))})),Rx=-1,kl=mw(Rx,0),FZ=Sv(void 0,{emptyCase:Hn,failCase:Hn,dieCase:Hn,interruptCase:(e,t)=>jp(Bp(t),Rx),sequentialCase:(e,t,n)=>t||n,parallelCase:(e,t,n)=>t||n}),xZ=y(e=>qZ(e[0]),(e,t,n)=>{if(e.state._tag==="Closed"){t.unsafeInterruptAsFork(cr((n==null?void 0:n.interruptAs)??Nn,kl));return}else if(e.state.fiber!==void 0){if((n==null?void 0:n.onlyIfMissing)===!0){t.unsafeInterruptAsFork(cr((n==null?void 0:n.interruptAs)??Nn,kl));return}else if(e.state.fiber===t)return;e.state.fiber.unsafeInterruptAsFork(cr((n==null?void 0:n.interruptAs)??Nn,kl)),e.state.fiber=void 0}e.state.fiber=t,t.addObserver(r=>{e.state._tag==="Open"&&t===e.state.fiber&&(e.state.fiber=void 0),Ra(r)&&((n==null?void 0:n.propagateInterruption)===!0?!FZ(r.cause):!no(r.cause))&&Oi(e.deferred,r)})}),NZ=e=>si(t=>ks(n=>e.state._tag==="Closed"||e.state.fiber===void 0?fe:ht(t(qg(e.state.fiber,cr(n.id(),kl))),Te(()=>{e.state._tag==="Open"&&(e.state.fiber=void 0)})))),DZ=function(){let e;return()=>(e===void 0&&(e=Ro(as)),e)}(),Mm=function(){const e=arguments[0];if(qr(arguments[1]))return K$(e,arguments[1],arguments[2]);const t=arguments[1];return n=>K$(e,n,t)},K$=(e,t,n)=>Fv(r=>e.state._tag==="Closed"?as:e.state.fiber!==void 0&&(n==null?void 0:n.onlyIfMissing)===!0?Te(DZ):po(xv(t),s=>xZ(e,s,{...n,interruptAs:r}))),Gb=Symbol.for("effect/FiberMap"),MZ=e=>ne(e,Gb),LZ={[Gb]:Gb,[Symbol.iterator](){return this.state._tag==="Closed"?q1():this.state.backing[Symbol.iterator]()},toString(){return lt(this.toJSON())},toJSON(){return{_id:"FiberMap",state:this.state}},[Ue](){return this.toJSON()},pipe(){return Z(this,arguments)}},jZ=(e,t)=>{const n=Object.create(LZ);return n.state={_tag:"Open",backing:e},n.deferred=t,n},UZ=()=>ot(Se(Me(),e=>jZ(aq(),e)),e=>ks(t=>{const n=e.state;return n._tag==="Closed"?fe:(e.state={_tag:"Closed"},hP(LL(n.backing,([,r])=>r),cr(t.id(),$l)).pipe(kd(e.deferred)))})),Ox=-1,$l=mw(Ox,0),zZ=Sv(void 0,{emptyCase:Hn,failCase:Hn,dieCase:Hn,interruptCase:(e,t)=>jp(Bp(t),Ox),sequentialCase:(e,t,n)=>t||n,parallelCase:(e,t,n)=>t||n}),BZ=y(e=>MZ(e[0]),(e,t,n,r)=>{if(e.state._tag==="Closed"){n.unsafeInterruptAsFork(cr((r==null?void 0:r.interruptAs)??Nn,$l));return}const s=is(e.state.backing,t);if(s._tag==="Some"){if((r==null?void 0:r.onlyIfMissing)===!0){n.unsafeInterruptAsFork(cr((r==null?void 0:r.interruptAs)??Nn,$l));return}else if(s.value===n)return;s.value.unsafeInterruptAsFork(cr((r==null?void 0:r.interruptAs)??Nn,$l))}Xa(e.state.backing,t,n),n.addObserver(o=>{if(e.state._tag==="Closed")return;const a=is(e.state.backing,t);ct(a)&&n===a.value&&r6(e.state.backing,t),Ra(o)&&((r==null?void 0:r.propagateInterruption)===!0?!zZ(o.cause):!no(o.cause))&&Oi(e.deferred,o)})}),HZ=y(2,(e,t)=>e.state._tag==="Closed"?!1:Ya(e.state.backing,t)),ly=y(2,(e,t)=>ks(n=>{if(e.state._tag==="Closed")return fe;const r=is(e.state.backing,t);return r._tag==="None"?fe:qg(r.value,cr(n.id(),$l))})),VZ=function(){let e;return()=>(e===void 0&&(e=Ro(as)),e)}(),fy=function(){const e=arguments[0];if(qr(arguments[2]))return J$(e,arguments[1],arguments[2],arguments[3]);const t=arguments[1],n=arguments[2];return r=>J$(e,t,r,n)},J$=(e,t,n,r)=>Fv(s=>e.state._tag==="Closed"?as:(r==null?void 0:r.onlyIfMissing)===!0&&HZ(e,t)?Te(VZ):po(xv(n),o=>BZ(e,t,o,{...r,interruptAs:s}))),Qb=Symbol.for("effect/FiberSet"),WZ=e=>ne(e,Qb),KZ={[Qb]:Qb,[Symbol.iterator](){return this.state._tag==="Closed"?q1():this.state.backing[Symbol.iterator]()},toString(){return lt(this.toJSON())},toJSON(){return{_id:"FiberMap",state:this.state}},[Ue](){return this.toJSON()},pipe(){return Z(this,arguments)}},JZ=(e,t)=>{const n=Object.create(KZ);return n.state={_tag:"Open",backing:e},n.deferred=t,n},GZ=()=>ot(Se(Me(),e=>JZ(new Set,e)),e=>ks(t=>{const n=e.state;if(n._tag==="Closed")return fe;e.state={_tag:"Closed"};const r=n.backing;return hP(r,cr(t.id(),Ax)).pipe(kd(e.deferred))})),qx=-1,Ax=mw(qx,0),QZ=Sv(void 0,{emptyCase:Hn,failCase:Hn,dieCase:Hn,interruptCase:(e,t)=>jp(Bp(t),qx),sequentialCase:(e,t,n)=>t||n,parallelCase:(e,t,n)=>t||n}),G$=y(e=>WZ(e[0]),(e,t,n)=>{if(e.state._tag==="Closed"){t.unsafeInterruptAsFork(cr((n==null?void 0:n.interruptAs)??Nn,Ax));return}else if(e.state.backing.has(t))return;e.state.backing.add(t),t.addObserver(r=>{e.state._tag!=="Closed"&&(e.state.backing.delete(t),Ra(r)&&((n==null?void 0:n.propagateInterruption)===!0?!QZ(r.cause):!no(r.cause))&&Oi(e.deferred,r))})}),YZ="effect/GroupBy",Px=Symbol.for(YZ),XZ={_R:e=>e,_E:e=>e,_K:e=>e,_V:e=>e},ZZ=e=>ne(e,Px),eee=y(e=>ZZ(e[0]),(e,t,n)=>Qo(e.grouped,([r,s])=>t(r,Sx(gf(s,{shutdown:!0}))),{concurrency:"unbounded",bufferSize:(n==null?void 0:n.bufferSize)??16})),tee=e=>({[Px]:XZ,pipe(){return Z(this,arguments)},grouped:e}),nee=y(e=>typeof e[0]!="function",(e,t,n)=>n!=null&&n.key?eee(ree(e,n.key,{bufferSize:n.bufferSize}),(r,s)=>Dm(s,t)):Vb(n==null?void 0:n.concurrency,()=>Dm(e,t),r=>n!=null&&n.unordered?Qo(e,s=>Nu(t(s)),{concurrency:r}):JX(e,r,t))),ree=y(e=>typeof e[0]!="function",(e,t,n)=>{const r=(s,o)=>mr({onInput:a=>Fe(kt(bn(see(a,t),([u,f])=>{const h=s.get(u);return h===void 0?v(Zc((n==null?void 0:n.bufferSize)??16),Y(p=>v(Te(()=>{s.set(u,p)}),ht(Qe(o,EX([u,p]))),ht(v(Qe(p,mf(f)),ey(g=>no(g)?W(fe):V())))))):ey(Qe(h,mf(f)),p=>no(p)?W(fe):V())},{discard:!0})),()=>r(s,o)),onFailure:a=>kt(Qe(o,s_(a))),onDone:()=>v(kt(v(bn(s.entries(),([a,u])=>v(Qe(u,pf),ey(f=>no(f)?W(fe):V())),{discard:!0}),ht(Qe(o,pf)))))});return tee(hZ(s=>z(function*(){const o=new Map,a=yield*dn();return yield*Go(s,xt(a)),yield*Je(e).pipe(un(r(o,a)),Gg,tE(s),ur(s),ro(Sx(gf(a,{shutdown:!0}))))})))}),see=y(2,(e,t)=>{const n=[],r=e[Symbol.iterator](),s=new Map;let o;for(;(o=r.next())&&!o.done;){const a=o.value,u=t(a);if(s.has(u))s.get(u).push(a);else{const f=[a];n.push([u,f]),s.set(u,f)}}return jt(n.map(a=>[a[0],jt(a[1])]))});class _n{constructor(t,n,r){d(this,"path");d(this,"actual");d(this,"issue");d(this,"_tag","Pointer");this.path=t,this.actual=n,this.issue=r}}class Q${constructor(t,n){d(this,"actual");d(this,"message");d(this,"_tag","Unexpected");this.actual=t,this.message=n}}class Zu{constructor(t,n){d(this,"ast");d(this,"message");d(this,"_tag","Missing");d(this,"actual");this.ast=t,this.message=n}}class Mt{constructor(t,n,r,s){d(this,"ast");d(this,"actual");d(this,"issues");d(this,"output");d(this,"_tag","Composite");this.ast=t,this.actual=n,this.issues=r,this.output=s}}class dy{constructor(t,n,r,s){d(this,"ast");d(this,"actual");d(this,"kind");d(this,"issue");d(this,"_tag","Refinement");this.ast=t,this.actual=n,this.kind=r,this.issue=s}}class hy{constructor(t,n,r,s){d(this,"ast");d(this,"actual");d(this,"kind");d(this,"issue");d(this,"_tag","Transformation");this.ast=t,this.actual=n,this.kind=r,this.issue=s}}class Kt{constructor(t,n,r){d(this,"ast");d(this,"actual");d(this,"message");d(this,"_tag","Type");this.ast=t,this.actual=n,this.message=r}}class Y${constructor(t,n,r){d(this,"ast");d(this,"actual");d(this,"message");d(this,"_tag","Forbidden");this.ast=t,this.actual=n,this.message=r}}const X$=Symbol.for("effect/Schema/ParseErrorTypeId");var xI;class oee extends AJ("ParseError"){constructor(){super(...arguments);d(this,xI,X$)}get message(){return this.toString()}toString(){return Tl.formatIssueSync(this.issue)}toJSON(){return{_id:"ParseError",message:this.toString()}}[(xI=X$,Ue)](){return this.toJSON()}}const Du=e=>new oee({issue:e}),Kr=ce,Mu=oe,Z$=US,Pn=T1,Vo=y(2,(e,t)=>Pn(e)?rn(e,{onLeft:oe,onRight:t}):Y(e,t)),sr=y(2,(e,t)=>Pn(e)?bL(e,t):Se(e,t)),Cl=y(2,(e,t)=>Pn(e)?Zi(e,t):mo(e,t)),iee=y(2,(e,t)=>Pn(e)?yL(e,{onLeft:t.onFailure,onRight:t.onSuccess}):AP(e,t)),Fx=y(2,(e,t)=>Pn(e)?rn(e,{onLeft:t,onRight:ce}):xg(e,t)),c_=(e,t)=>t===void 0||oo(t)?e:e===void 0?t:{...e,...t},u_=(e,t,n)=>{const r=ln(e,t);return(s,o)=>r(s,c_(n,o))},gE=(e,t,n)=>{const r=u_(e,t,n);return(s,o)=>I1(r(s,o),Du)},xx=(e,t,n)=>{const r=ln(e,t);return(s,o)=>r(s,{...c_(n,o),isEffectAllowed:!0})},Lm=(e,t)=>gE(e.ast,!0,t),aee=(e,t)=>u_(e.ast,!0,t),xd=(e,t)=>xx(e.ast,!0,t),Nx=(e,t)=>gE(e.ast,!1,t),cee=(e,t)=>u_(e.ast,!1,t),Lu=(e,t)=>xx(e.ast,!1,t),_E=Lm,uee=xd,l_=(e,t)=>gE(Ft(e.ast),!0,t),lee=(e,t)=>u_(Ft(e.ast),!0,t),kn=(e,t)=>{const n=ln(Ft(e.ast),!0);return(r,s)=>ds(n(r,{exact:!0,...c_(t,s)}))},ms=Nx,fee=Lu,dee=Ee(Symbol.for("effect/ParseResult/decodeMemoMap"),()=>new WeakMap),hee=Ee(Symbol.for("effect/ParseResult/encodeMemoMap"),()=>new WeakMap),ln=(e,t)=>{const n=t?dee:hee,r=n.get(e);if(r)return r;const s=mee(e,t),o=Rj(e),a=ct(o)?(h,p)=>s(h,c_(p,o.value)):s,u=Oj(e),f=t&&ct(u)?(h,p)=>fl(Fx(a(h,p),u.value),e,h,p):a;return n.set(e,f),f},my=e=>or(Cj(e)),py=e=>or(Tj(e)),mee=(e,t)=>{switch(e._tag){case"Refinement":if(t){const n=ln(e.from,!0);return(r,s)=>{s=s??z_;const o=(s==null?void 0:s.errors)==="all",a=Vo(Fx(n(r,s),u=>{const f=new dy(e,r,"From",u);return o&&Aj(e)&&jx(u)?rt(e.filter(r,s,e),{onNone:()=>oe(f),onSome:h=>oe(new Mt(e,r,[f,new dy(e,r,"Predicate",h)]))}):oe(f)}),u=>rt(e.filter(u,s,e),{onNone:()=>ce(u),onSome:f=>oe(new dy(e,r,"Predicate",f))}));return fl(a,e,r,s)}}else{const n=ln(Ft(e),!0),r=ln(Dx(e.from),!1);return(s,o)=>fl(Vo(n(s,o),a=>r(a,o)),e,s,o)}case"Transformation":{const n=_ee(e.transformation,t),r=t?ln(e.from,!0):ln(e.to,!1),s=t?ln(e.to,!0):ln(e.from,!1);return(o,a)=>fl(Vo(Cl(r(o,a),u=>new hy(e,o,t?"Encoded":"Type",u)),u=>Vo(Cl(n(u,a??z_,e,o),f=>new hy(e,o,"Transformation",f)),f=>Cl(s(f,a),h=>new hy(e,o,t?"Type":"Encoded",h)))),e,o,a)}case"Declaration":{const n=t?e.decodeUnknown(...e.typeParameters):e.encodeUnknown(...e.typeParameters);return(r,s)=>fl(n(r,s??z_,e),e,r,s)}case"Literal":return er(e,n=>n===e.literal);case"UniqueSymbol":return er(e,n=>n===e.symbol);case"UndefinedKeyword":return er(e,NM);case"NeverKeyword":return er(e,DM);case"UnknownKeyword":case"AnyKeyword":case"VoidKeyword":return ce;case"StringKeyword":return er(e,Tn);case"NumberKeyword":return er(e,oo);case"BooleanKeyword":return er(e,Gi);case"BigIntKeyword":return er(e,hp);case"SymbolKeyword":return er(e,Bh);case"ObjectKeyword":return er(e,qs);case"Enums":return er(e,n=>e.enums.some(([r,s])=>s===n));case"TemplateLiteral":{const n=ER(e);return er(e,r=>Tn(r)&&n.test(r))}case"TupleType":{const n=e.elements.map(h=>ln(h.type,t)),r=e.rest.map(h=>ln(h.type,t));let s=e.elements.filter(h=>!h.isOptional);e.rest.length>0&&(s=s.concat(e.rest.slice(1)));const o=s.length,a=e.elements.length>0?e.elements.map((h,p)=>p).join(" | "):"never",u=my(e),f=py(e);return(h,p)=>{if(!WL(h))return oe(new Kt(e,h));const g=(p==null?void 0:p.errors)==="all",k=[];let T=0;const O=[],D=h.length;for(let C=D;C<=o-1;C++){const $=new _n(C,h,new Zu(s[C-D]));if(g){k.push([T++,$]);continue}else return oe(new Mt(e,h,$,O))}if(e.rest.length===0)for(let C=e.elements.length;C<=D-1;C++){const $=new _n(C,h,new Q$(h[C],`is unexpected, expected: ${a}`));if(g){k.push([T++,$]);continue}else return oe(new Mt(e,h,$,O))}let E=0,S;for(;E<n.length;E++)if(D<E+1){if(e.elements[E].isOptional)continue}else{const C=n[E],$=C(h[E],p);if(Pn($)){if(en($)){const q=new _n(E,h,$.left);if(g){k.push([T++,q]);continue}else return oe(new Mt(e,h,q,Lr(O)))}O.push([T++,$.right])}else{const q=T++,P=E;S||(S=[]),S.push(({es:N,output:M})=>Y(Ei($),B=>{if(en(B)){const F=new _n(P,h,B.left);return g?(N.push([q,F]),fe):oe(new Mt(e,h,F,Lr(M)))}return M.push([q,B.right]),fe}))}}if(yt(r)){const[C,...$]=r;for(;E<D-$.length;E++){const q=C(h[E],p);if(Pn(q))if(en(q)){const P=new _n(E,h,q.left);if(g){k.push([T++,P]);continue}else return oe(new Mt(e,h,P,Lr(O)))}else O.push([T++,q.right]);else{const P=T++,N=E;S||(S=[]),S.push(({es:M,output:B})=>Y(Ei(q),F=>{if(en(F)){const j=new _n(N,h,F.left);return g?(M.push([P,j]),fe):oe(new Mt(e,h,j,Lr(B)))}else return B.push([P,F.right]),fe}))}}for(let q=0;q<$.length;q++)if(E+=q,!(D<E+1)){const P=$[q](h[E],p);if(Pn(P)){if(en(P)){const N=new _n(E,h,P.left);if(g){k.push([T++,N]);continue}else return oe(new Mt(e,h,N,Lr(O)))}O.push([T++,P.right])}else{const N=T++,M=E;S||(S=[]),S.push(({es:B,output:F})=>Y(Ei(P),j=>{if(en(j)){const X=new _n(M,h,j.left);return g?(B.push([N,X]),fe):oe(new Mt(e,h,X,Lr(F)))}return F.push([N,j.right]),fe}))}}}const _=({es:C,output:$})=>gh(C)?oe(new Mt(e,h,Lr(C),Lr($))):ce(Lr($));if(S&&S.length>0){const C=S;return pt(()=>{const $={es:ol(k),output:ol(O)};return Y(bn(C,q=>q($),{concurrency:u,batching:f,discard:!0}),()=>_($))})}return _({output:O,es:k})}}case"TypeLiteral":{if(e.propertySignatures.length===0&&e.indexSignatures.length===0)return er(e,MM);const n=[],r={},s=[];for(const p of e.propertySignatures)n.push([ln(p.type,t),p]),r[p.name]=null,s.push(p.name);const o=e.indexSignatures.map(p=>[ln(p.parameter,t),ln(p.type,t),p.parameter]),a=tn.make(e.indexSignatures.map(p=>p.parameter).concat(s.map(p=>Bh(p)?new mR(p):new Xh(p)))),u=ln(a,t),f=my(e),h=py(e);return(p,g)=>{if(!jM(p))return oe(new Kt(e,p));const k=(g==null?void 0:g.errors)==="all",T=[];let O=0;const D=(g==null?void 0:g.onExcessProperty)==="error",E=(g==null?void 0:g.onExcessProperty)==="preserve",S={};let _;if(D||E){_=gs(p);for(const P of _){const N=u(P,g);if(Pn(N)&&en(N))if(D){const M=new _n(P,p,new Q$(p[P],`is unexpected, expected: ${String(a)}`));if(k){T.push([O++,M]);continue}else return oe(new Mt(e,p,M,S))}else S[P]=p[P]}}let C;const $=(g==null?void 0:g.exact)===!0;for(let P=0;P<n.length;P++){const N=n[P][1],M=N.name,B=Object.prototype.hasOwnProperty.call(p,M);if(!B){if(N.isOptional)continue;if($){const X=new _n(M,p,new Zu(N));if(k){T.push([O++,X]);continue}else return oe(new Mt(e,p,X,S))}}const F=n[P][0],j=F(p[M],g);if(Pn(j)){if(en(j)){const X=new _n(M,p,B?j.left:new Zu(N));if(k){T.push([O++,X]);continue}else return oe(new Mt(e,p,X,S))}S[M]=j.right}else{const X=O++,ye=M;C||(C=[]),C.push(({es:G,output:ve})=>Y(Ei(j),Re=>{if(en(Re)){const Be=new _n(ye,p,B?Re.left:new Zu(N));return k?(G.push([X,Be]),fe):oe(new Mt(e,p,Be,ve))}return ve[ye]=Re.right,fe}))}}for(let P=0;P<o.length;P++){const N=o[P],M=N[0],B=N[1],F=H1(p,N[2]);for(const j of F){const X=M(j,g);if(Pn(X)&&ds(X)){const ye=B(p[j],g);if(Pn(ye))if(en(ye)){const G=new _n(j,p,ye.left);if(k){T.push([O++,G]);continue}else return oe(new Mt(e,p,G,S))}else Object.prototype.hasOwnProperty.call(r,j)||(S[j]=ye.right);else{const G=O++,ve=j;C||(C=[]),C.push(({es:Re,output:Be})=>Y(Ei(ye),Xe=>{if(en(Xe)){const He=new _n(ve,p,Xe.left);return k?(Re.push([G,He]),fe):oe(new Mt(e,p,He,Be))}else return Object.prototype.hasOwnProperty.call(r,j)||(Be[j]=Xe.right),fe}))}}}}const q=({es:P,output:N})=>{if(gh(P))return oe(new Mt(e,p,Lr(P),N));if((g==null?void 0:g.propertyOrder)==="original"){const M=_||gs(p);for(const F of s)M.indexOf(F)===-1&&M.push(F);const B={};for(const F of M)Object.prototype.hasOwnProperty.call(N,F)&&(B[F]=N[F]);return ce(B)}return ce(N)};if(C&&C.length>0){const P=C;return pt(()=>{const N={es:ol(T),output:Object.assign({},S)};return Y(bn(P,M=>M(N),{concurrency:f,batching:h,discard:!0}),()=>q(N))})}return q({es:T,output:S})}}case"Union":{const n=pee(e.types,t),r=gs(n.keys),s=r.length,o=e.types.length,a=new Map;for(let h=0;h<o;h++)a.set(e.types[h],ln(e.types[h],t));const u=my(e)??1,f=py(e);return(h,p)=>{const g=[];let k=0,T=[];if(s>0)if(PS(h))for(let E=0;E<s;E++){const S=r[E],_=n.keys[S].buckets;if(Object.prototype.hasOwnProperty.call(h,S)){const C=String(h[S]);if(Object.prototype.hasOwnProperty.call(_,C))T=T.concat(_[C]);else{const{candidates:$,literals:q}=n.keys[S],P=tn.make(q),N=$.length===o?new Tr([new Pt(S,P,!1,!0)],[]):tn.make($);g.push([k++,new Mt(N,h,new _n(S,h,new Kt(P,h[S])))])}}else{const{candidates:C,literals:$}=n.keys[S],q=new Pt(S,tn.make($),!1,!0),P=C.length===o?new Tr([q],[]):tn.make(C);g.push([k++,new Mt(P,h,new _n(S,h,new Zu(q)))])}}else{const E=n.candidates.length===o?e:tn.make(n.candidates);g.push([k++,new Kt(E,h)])}n.otherwise.length>0&&(T=T.concat(n.otherwise));let O;for(let E=0;E<T.length;E++){const S=T[E],_=a.get(S)(h,p);if(Pn(_)&&(!O||O.length===0)){if(ds(_))return _;g.push([k++,_.left])}else{const C=k++;O||(O=[]),O.push($=>pt(()=>"finalResult"in $?fe:Y(Ei(_),q=>(ds(q)?$.finalResult=q:$.es.push([C,q.left]),fe))))}}const D=E=>gh(E)?E.length===1&&E[0][1]._tag==="Type"?oe(E[0][1]):oe(new Mt(e,h,Lr(E))):oe(new Kt(e,h));if(O&&O.length>0){const E=O;return pt(()=>{const S={es:ol(g)};return Y(bn(E,_=>_(S),{concurrency:u,batching:f,discard:!0}),()=>"finalResult"in S?S.finalResult:D(S.es))})}return D(g)}}case"Suspend":{const n=V1(()=>ln(na(e.f(),e.annotations),t));return(r,s)=>n()(r,s)}}},er=(e,t)=>n=>t(n)?ce(n):oe(new Kt(e,n)),ll=(e,t)=>{switch(e._tag){case"Declaration":{const n=lu(e);if(ct(n))return ll(n.value,t);break}case"TypeLiteral":{const n=[];for(let r=0;r<e.propertySignatures.length;r++){const s=e.propertySignatures[r],o=t?My(s.type):Ft(s.type);wl(o)&&!s.isOptional&&n.push([s.name,o])}return n}case"TupleType":{const n=[];for(let r=0;r<e.elements.length;r++){const s=e.elements[r],o=t?My(s.type):Ft(s.type);wl(o)&&!s.isOptional&&n.push([r,o])}return n}case"Refinement":return ll(e.from,t);case"Suspend":return ll(e.f(),t);case"Transformation":return ll(t?e.from:e.to,t)}return[]},pee=(e,t)=>{const n={},r=[],s=[];for(let o=0;o<e.length;o++){const a=e[o],u=ll(a,t);if(u.length>0){s.push(a);for(let f=0;f<u.length;f++){const[h,p]=u[f],g=String(p.literal);n[h]=n[h]||{buckets:{},literals:[],candidates:[]};const k=n[h].buckets;if(Object.prototype.hasOwnProperty.call(k,g)){if(f<u.length-1)continue;k[g].push(a),n[h].literals.push(p),n[h].candidates.push(a)}else{k[g]=[a],n[h].literals.push(p),n[h].candidates.push(a);break}}}else r.push(a)}return{keys:n,otherwise:r,candidates:s}},Dx=e=>mc(e)?Dx(e.from):e,fl=(e,t,n,r)=>{if((r==null?void 0:r.isEffectAllowed)===!0||Pn(e))return e;const s=new oA,o=Ro(e,{scheduler:s});s.flush();const a=o.unsafePoll();if(a){if(Hc(a))return ce(a.value);const u=a.cause;return zA(u)?oe(u.error):oe(new Y$(t,n,Em(u)))}return oe(new Y$(t,n,"cannot be be resolved synchronously, this is caused by using runSync on an effect that performs async work"))},gee=([e],[t])=>e>t?1:e<t?-1:0;function Lr(e){return e.sort(gee).map(t=>t[1])}const _ee=(e,t)=>{switch(e._tag){case"FinalTransformation":return t?e.decode:e.encode;case"ComposeTransformation":return ce;case"TypeLiteralTransformation":return n=>{let r=ce(n);for(const s of e.propertySignatureTransformations){const[o,a]=t?[s.from,s.to]:[s.to,s.from],u=t?s.decode:s.encode;r=sr(r,h=>{const p=u(Object.prototype.hasOwnProperty.call(h,o)?W(h[o]):V());return delete h[o],ct(p)&&(h[a]=p.value),h})}return r}}},qn=(e,t=[])=>({value:e,forest:t}),Tl={formatIssue:e=>sr(tc(e),yee),formatIssueSync:e=>{const t=Tl.formatIssue(e);return Pn(t)?wL(t):bs(t)},formatError:e=>Tl.formatIssue(e.issue),formatErrorSync:e=>Tl.formatIssueSync(e.issue)},yee=e=>e.value+Mx(`
`,e.forest),Mx=(e,t)=>{let n="";const r=t.length;let s;for(let o=0;o<r;o++){s=t[o];const a=o===r-1;n+=e+(a?"":"")+" "+s.value,n+=Mx(e+(r>1&&!a?"  ":"   "),s.forest)}return n},bee=e=>{switch(e){case"Encoded":return"Encoded side transformation failure";case"Transformation":return"Transformation process failure";case"Type":return"Type side transformation failure"}},See=e=>{switch(e){case"From":return"From side refinement failure";case"Predicate":return"Predicate refinement failure"}},Lx=e=>"ast"in e?W(e.ast):V(),Yb=ce(void 0),wee=e=>Lx(e).pipe(uu(kj),rt({onNone:()=>Yb,onSome:t=>{const n=t(e);return Tn(n)?ce({message:n,override:!1}):qr(n)?Se(n,r=>({message:r,override:!1})):Tn(n.message)?ce({message:n.message,override:n.override}):Se(n.message,r=>({message:r,override:n.override}))}})),yE=e=>t=>t._tag===e,jx=yE("Composite"),eC=yE("Refinement"),tC=yE("Transformation"),Il=e=>Vo(wee(e),t=>t!==void 0?!t.override&&(jx(e)||eC(e)&&e.kind==="From"||tC(e)&&e.kind!=="Transformation")?tC(e)||eC(e)?Il(e.issue):Yb:ce(t.message):Yb),Ux=e=>Lx(e).pipe(uu(Ij),TL(t=>t(e)),or);function vee(e){return hR(e).pipe(Gs(()=>fR(e)),Gs(()=>dR(e)),Gs(()=>vp(e)),gt(()=>`{ ${e.from} | filter }`))}function Eee(e){return e.message!==void 0?e.message:`Expected ${mc(e.ast)?vee(e.ast):String(e.ast)}, actual ${Cr(e.actual)}`}const kee=e=>sr(Il(e),t=>t??Ux(e)??Eee(e)),sh=e=>Ux(e)??String(e.ast),$ee=e=>e.message??"is forbidden",Cee=e=>e.message??"is unexpected",Tee=e=>{const t=$j(e.ast);if(ct(t)){const n=t.value();return Tn(n)?ce(n):n}return ce(e.message??"is missing")},tc=e=>{switch(e._tag){case"Type":return sr(kee(e),qn);case"Forbidden":return ce(qn(sh(e),[qn($ee(e))]));case"Unexpected":return ce(qn(Cee(e)));case"Missing":return sr(Tee(e),qn);case"Transformation":return Vo(Il(e),t=>t!==void 0?ce(qn(t)):sr(tc(e.issue),n=>qn(sh(e),[qn(bee(e.kind),[n])])));case"Refinement":return Vo(Il(e),t=>t!==void 0?ce(qn(t)):sr(tc(e.issue),n=>qn(sh(e),[qn(See(e.kind),[n])])));case"Pointer":return sr(tc(e.issue),t=>qn(J1(e.path),[t]));case"Composite":return Vo(Il(e),t=>{if(t!==void 0)return ce(qn(t));const n=sh(e);return K1(e.issues)?sr(bn(e.issues,tc),r=>qn(n,r)):sr(tc(e.issues),r=>qn(n,[r]))})}},Iee=jQ,Ree=DQ,Oee=PA,qee=BW,Aee=FA,nC=Symbol.for("effect/Mailbox"),rC=Symbol.for("effect/Mailbox/ReadonlyMailbox"),Ti=_t(),sC=We(Ti),oh=We(!1),ih=We(!0),oC=[Ti,!0];var NI,DI;class Pee extends $o{constructor(n,r,s){super();d(this,"scheduler");d(this,"capacity");d(this,"strategy");d(this,DI,nC);d(this,NI,rC);d(this,"state",{_tag:"Open",takers:new Set,offers:new Set,awaiters:new Set});d(this,"messages",[]);d(this,"messagesChunk",_t());d(this,"shutdown",K(()=>{if(this.state._tag==="Done")return!0;this.messages=[],this.messagesChunk=Ti;const n=this.state.offers;if(this.finalize(this.state._tag==="Open"?$n:this.state.exit),n.size>0){for(const r of n)r._tag==="Single"?r.resume(oh):r.resume(We(jt(r.remaining.slice(r.offset))));n.clear()}return!0}));d(this,"end",this.done($n));d(this,"clear",he(()=>{if(this.state._tag==="Done")return kh(this.state.exit,Ti);const n=this.unsafeTakeAll();return this.releaseCapacity(),J(n)}));d(this,"takeAll",he(()=>{if(this.state._tag==="Done")return kh(this.state.exit,oC);const n=this.unsafeTakeAll();return n.length===0?Ct(this.awaitTake,this.takeAll):J([n,this.releaseCapacity()])}));d(this,"take",he(()=>this.unsafeTake()??Ct(this.awaitTake,this.take)));d(this,"await",zo(n=>this.state._tag==="Done"?n(this.state.exit):(this.state.awaiters.add(n),K(()=>{this.state._tag!=="Done"&&this.state.awaiters.delete(n)}))));d(this,"size",K(()=>this.unsafeSize()));d(this,"awaitTake",zo(n=>this.state._tag==="Done"?n(this.state.exit):(this.state.takers.add(n),K(()=>{this.state._tag!=="Done"&&this.state.takers.delete(n)}))));d(this,"scheduleRunning",!1);d(this,"releaseTaker",()=>{if(this.scheduleRunning=!1,this.state._tag==="Done")return;if(this.state.takers.size===0)return;const n=xL(this.state.takers);this.state.takers.delete(n),n($n)});this.scheduler=n,this.capacity=r,this.strategy=s}offer(n){return he(()=>{if(this.state._tag!=="Open")return oh;if(this.messages.length+this.messagesChunk.length>=this.capacity)switch(this.strategy){case"dropping":return oh;case"suspend":return this.capacity<=0&&this.state.takers.size>0?(this.messages.push(n),this.releaseTaker(),ih):this.offerRemainingSingle(n);case"sliding":return this.unsafeTake(),this.messages.push(n),ih}return this.messages.push(n),this.scheduleReleaseTaker(),ih})}unsafeOffer(n){return this.state._tag!=="Open"?!1:this.messages.length+this.messagesChunk.length>=this.capacity?this.strategy==="sliding"?(this.unsafeTake(),this.messages.push(n),!0):this.capacity<=0&&this.state.takers.size>0?(this.messages.push(n),this.releaseTaker(),!0):!1:(this.messages.push(n),this.scheduleReleaseTaker(),!0)}offerAll(n){return he(()=>{if(this.state._tag!=="Open")return J(ao(n));const r=this.unsafeOfferAllArray(n);return r.length===0?sC:this.strategy==="dropping"?J(jt(r)):this.offerRemainingArray(r)})}unsafeOfferAll(n){return jt(this.unsafeOfferAllArray(n))}unsafeOfferAllArray(n){if(this.state._tag!=="Open")return je(n);if(this.capacity===Number.POSITIVE_INFINITY||this.strategy==="sliding")return this.messages.length>0&&(this.messagesChunk=Tt(this.messagesChunk,jt(this.messages))),this.strategy==="sliding"?this.messagesChunk=this.messagesChunk.pipe(Tt(ao(n)),zU(this.capacity)):Li(n)?this.messagesChunk=Tt(this.messagesChunk,n):this.messages=je(n),this.scheduleReleaseTaker(),[];const r=this.capacity<=0?this.state.takers.size:this.capacity-this.messages.length-this.messagesChunk.length;if(r===0)return je(n);const s=[];let o=0;for(const a of n)o<r?this.messages.push(a):s.push(a),o++;return this.scheduleReleaseTaker(),s}fail(n){return this.done(Ql(n))}failCause(n){return this.done(nt(n))}unsafeDone(n){return this.state._tag!=="Open"?!1:this.state.offers.size===0&&this.messages.length===0&&this.messagesChunk.length===0?(this.finalize(n),!0):(this.state={...this.state,_tag:"Closing",exit:n},!0)}done(n){return K(()=>this.unsafeDone(n))}takeN(n){return he(()=>{if(this.state._tag==="Done")return kh(this.state.exit,oC);if(n<=0)return J([Ti,!1]);n=Math.min(n,this.capacity);let r;if(n<=this.messagesChunk.length)r=Oc(this.messagesChunk,n),this.messagesChunk=Bs(this.messagesChunk,n);else if(n<=this.messages.length+this.messagesChunk.length)this.messagesChunk=Tt(this.messagesChunk,jt(this.messages)),this.messages=[],r=Oc(this.messagesChunk,n),this.messagesChunk=Bs(this.messagesChunk,n);else return Ct(this.awaitTake,this.takeN(n));return J([r,this.releaseCapacity()])})}unsafeTake(){if(this.state._tag==="Done")return nq(this.state.exit,Ql(new Rg));let n;if(this.messagesChunk.length>0)n=qp(this.messagesChunk),this.messagesChunk=Bs(this.messagesChunk,1);else if(this.messages.length>0)n=this.messages[0],this.messagesChunk=Bs(jt(this.messages),1),this.messages=[];else return this.capacity<=0&&this.state.offers.size>0?(this.capacity=1,this.releaseCapacity(),this.capacity=0,this.messages.length>0?We(this.messages.pop()):void 0):void 0;return this.releaseCapacity(),We(n)}unsafeSize(){const n=this.messages.length+this.messagesChunk.length;return this.state._tag==="Done"?V():W(n)}commit(){return this.takeAll}pipe(){return Z(this,arguments)}toJSON(){return{_id:"effect/Mailbox",state:this.state._tag,size:this.unsafeSize().toJSON()}}toString(){return lt(this)}[(DI=nC,NI=rC,Ue)](){return lt(this)}offerRemainingSingle(n){return zo(r=>{if(this.state._tag!=="Open")return r(oh);const s={_tag:"Single",message:n,resume:r};return this.state.offers.add(s),K(()=>{this.state._tag==="Open"&&this.state.offers.delete(s)})})}offerRemainingArray(n){return zo(r=>{if(this.state._tag!=="Open")return r(We(jt(n)));const s={_tag:"Array",remaining:n,offset:0,resume:r};return this.state.offers.add(s),K(()=>{this.state._tag==="Open"&&this.state.offers.delete(s)})})}releaseCapacity(){if(this.state._tag==="Done")return this.state.exit._tag==="Success";if(this.state.offers.size===0)return this.state._tag==="Closing"&&this.messages.length===0&&this.messagesChunk.length===0?(this.finalize(this.state.exit),this.state.exit._tag==="Success"):!1;let n=this.capacity-this.messages.length-this.messagesChunk.length;for(const r of this.state.offers){if(n===0)return!1;if(r._tag==="Single")this.messages.push(r.message),n--,r.resume(ih),this.state.offers.delete(r);else{for(;r.offset<r.remaining.length;r.offset++){if(n===0)return!1;this.messages.push(r.remaining[r.offset]),n--}r.resume(sC),this.state.offers.delete(r)}}return!1}scheduleReleaseTaker(){this.scheduleRunning||(this.scheduleRunning=!0,this.scheduler.scheduleTask(this.releaseTaker,0))}unsafeTakeAll(){if(this.messagesChunk.length>0){const n=this.messages.length>0?Tt(this.messagesChunk,jt(this.messages)):this.messagesChunk;return this.messagesChunk=Ti,this.messages=[],n}else if(this.messages.length>0){const n=jt(this.messages);return this.messages=[],n}else if(this.state._tag!=="Done"&&this.state.offers.size>0)return this.capacity=1,this.releaseCapacity(),this.capacity=0,ut(this.messages.pop());return Ti}finalize(n){if(this.state._tag==="Done")return;const r=this.state;this.state={_tag:"Done",exit:n};for(const s of r.takers)s(n);r.takers.clear();for(const s of r.awaiters)s(n);r.awaiters.clear()}}const Fee=e=>Ae(t=>J(new Pee(t.currentScheduler,typeof e=="number"?e:(e==null?void 0:e.capacity)??Number.POSITIVE_INFINITY,typeof e=="number"?"suspend":(e==null?void 0:e.strategy)??"suspend"))),xee=Fee,Nee=Symbol.for("@effect/matcher/Matcher"),Dee={[Nee]:{_input:ie,_filters:ie,_result:ie,_return:ie},_tag:"ValueMatcher",add(e){return this.value._tag==="Right"?this:e._tag==="When"&&e.guard(this.provided)===!0?Xb(this.provided,ce(e.evaluate(this.provided))):e._tag==="Not"&&e.guard(this.provided)===!1?Xb(this.provided,ce(e.evaluate(this.provided))):this},pipe(){return Z(this,arguments)}};function Xb(e,t){const n=Object.create(Dee);return n.provided=e,n.value=t,n}const zx=(e,t)=>({_tag:"When",guard:e,evaluate:t}),Zb=e=>{if(typeof e=="function")return e;if(Array.isArray(e)){const t=e.map(Zb),n=t.length;return r=>{if(!Array.isArray(r))return!1;for(let s=0;s<n;s++)if(t[s](r[s])===!1)return!1;return!0}}else if(e!==null&&typeof e=="object"){const t=Object.entries(e).map(([r,s])=>[r,Zb(s)]),n=t.length;return r=>{if(typeof r!="object"||r===null)return!1;for(let s=0;s<n;s++){const[o,a]=t[s];if(!(o in r)||a(r[o])===!1)return!1}return!0}}return t=>t===e},Mee=e=>Xb(e,oe(e)),Lee=(e,t)=>n=>n.add(zx(Zb(e),t)),jee=e=>(...t)=>{const n=t[t.length-1],r=t.slice(0,-1),s=r.length===1?o=>o[e]===r[0]:o=>r.includes(o[e]);return o=>o.add(zx(s,n))},Uee=jee("_tag"),zee=e=>{if(e._tag==="ValueMatcher")return e.value;const t=e.cases.length;if(t===1){const n=e.cases[0];return r=>n._tag==="When"&&n.guard(r)===!0||n._tag==="Not"&&n.guard(r)===!1?ce(n.evaluate(r)):oe(r)}return n=>{for(let r=0;r<t;r++){const s=e.cases[r];if(s._tag==="When"&&s.guard(n)===!0)return ce(s.evaluate(n));if(s._tag==="Not"&&s.guard(n)===!1)return ce(s.evaluate(n))}return oe(n)}},iC="effect/Match/exhaustive: absurd",Bee=e=>{const t=zee(e);if(T1(t)){if(t._tag==="Right")return t.right;throw new Error(iC)}return n=>{const r=t(n);if(r._tag==="Right")return r.right;throw new Error(iC)}},Bx=Mee,gy=Lee,_y=Uee,Hx=Bee,aC=SZ,Vx=HY,Hee=ec,Vee=y(e=>qs(e[0]),(e,...t)=>{const n={};for(const r of t)r in e&&(n[r]=e[r]);return n}),Wee=y(e=>qs(e[0]),(e,...t)=>{const n={...e};for(const r of t)delete n[r];return n}),eu=Symbol.for("effect/Schema");function tt(e){var t,n,r;return n=eu,t=eu,r=class{constructor(){d(this,n,eS)}static annotations(o){return tt(Ar(this.ast,o))}static pipe(){return Z(this,arguments)}static toString(){return String(e)}},d(r,"ast",e),d(r,"Type"),d(r,"Encoded"),d(r,"Context"),d(r,t,eS),r}const eS={_A:e=>e,_I:e=>e,_R:e=>e},cC={schemaId:wj,message:X1,missingMessage:WS,identifier:KS,title:As,description:Vf,examples:Z1,default:eR,documentation:vj,jsonSchema:tR,arbitrary:nR,pretty:rR,equivalence:sR,concurrency:oR,batching:iR,parseIssueTitle:aR,parseOptions:cR,decodingFallback:uR},mi=e=>{if(!e)return{};const t={...e};for(const n in cC)if(n in e){const r=cC[n];t[r]=e[n],delete t[n]}return t},Ar=(e,t)=>na(e,mi(t));const Nd=e=>String(e.ast),bE=e=>tt(My(e.ast)),Cs=e=>tt(Ft(e.ast)),Wx=(e,t)=>{const n=Lu(e,t);return(r,s)=>Cl(n(r,s),Du)},Kee=(e,t)=>{const n=cee(e,t);return(r,s)=>Zi(n(r,s),Du)},ju=Wx,Kx=Kee,tu=(e,t)=>{const n=xd(e,t);return(r,s)=>Cl(n(r,s),Du)},Jx=(e,t)=>{const n=aee(e,t);return(r,s)=>Zi(n(r,s),Du)},Jee=tu,f_=Jx,Gee=(e,t)=>{const n=lee(e,t);return(r,s)=>Zi(n(r,s),Du)},Xr=e=>ne(e,eu)&&qs(e[eu]);function Qee(e){return JS(e)?tn.make(Zj(e,t=>new Xh(t))):new Xh(e[0])}function Gx(e,t=Qee(e)){var n;return n=class extends tt(t){static annotations(s){return Gx(this.literals,Ar(this.ast,s))}},d(n,"literals",[...e]),n}function xe(...e){return yt(e)?Gx(e):d_}const Yee=e=>tt(new mR(e)),Xee=e=>new Kj(Object.keys(e).filter(t=>typeof e[e[t]]!="number").map(t=>[t,e[t]])),Qx=(e,t=Xee(e))=>{var n;return n=class extends tt(t){static annotations(s){return Qx(this.enums,Ar(this.ast,s))}},d(n,"enums",{...e}),n},uC=e=>Qx(e),Zee=(e,t,n)=>SE(e,new kp(e.map(r=>r.ast),(...r)=>t.decode(...r.map(tt)),(...r)=>t.encode(...r.map(tt)),mi(n))),ete=(e,t)=>{const n=()=>(s,o,a)=>e(s)?Kr(s):Mu(new Kt(a,s)),r=n;return SE([],new kp([],n,r,mi(t)))};function SE(e,t){var n;return n=class extends tt(t){static annotations(s){return SE(this.typeParameters,Ar(this.ast,s))}},d(n,"typeParameters",[...e]),n}const Aa=function(){if(Array.isArray(arguments[0])){const n=arguments[0],r=arguments[1],s=arguments[2];return Zee(n,r,s)}const e=arguments[0],t=arguments[1];return ete(e,t)},lC=Symbol.for("effect/SchemaId/Brand"),Yx=(e,t)=>n=>$E(n,new Jf(n.ast,function(o,a,u){const f=e.either(o);return en(f)?W(new Kt(u,o,f.left.map(h=>h.message).join(", "))):V()},mi({schemaId:lC,[lC]:{constructor:e},...t})));class Xx extends tt(Rc){}class ps extends tt(Lj){}class wE extends tt(Nj){}class d_ extends tt($p){}class tS extends tt(pR){}class mn extends tt(gR){}class L extends tt(Py){}class st extends tt(xy){}class ga extends tt(Ny){}const tte=e=>tn.make(e.map(t=>t.ast));function Zx(e,t=tte(e)){var n;return n=class extends tt(t){static annotations(s){return Zx(this.members,Ar(this.ast,s))}},d(n,"members",[...e]),n}function we(...e){return JS(e)?Zx(e):yt(e)?e[0]:d_}const eN=e=>we(e,wE),h_=e=>we(e,Xx),nte=(e,t)=>new Kf(e.map(n=>Xr(n)?new ci(n.ast,!1):n.ast),t.map(n=>Xr(n)?new Wf(n.ast):n.ast),!0);function jm(e,t,n=nte(e,t)){var r;return r=class extends tt(n){static annotations(o){return jm(this.elements,this.rest,Ar(this.ast,o))}},d(r,"elements",[...e]),d(r,"rest",[...t]),r}function rte(...e){return Array.isArray(e[0])?jm(e[0],e.slice(1)):jm(e,[])}function tN(e,t){var n;return n=class extends jm([],[e],t){static annotations(s){return tN(this.value,Ar(this.ast,s))}},d(n,"value",e),n}const Oe=e=>tN(e),nS=e=>e?'"?:"':'":"';class m_ extends ci{constructor(n,r,s,o,a){super(n,r,o);d(this,"isReadonly");d(this,"defaultValue");d(this,"_tag","PropertySignatureDeclaration");this.isReadonly=s,this.defaultValue=a}toString(){const n=nS(this.isOptional),r=String(this.type);return`PropertySignature<${n}, ${r}, never, ${n}, ${r}>`}}class ste extends ci{constructor(n,r,s,o,a){super(n,r,o);d(this,"isReadonly");d(this,"fromKey");this.isReadonly=s,this.fromKey=a}}class Um extends ci{constructor(n,r,s,o,a){super(n,r,o);d(this,"isReadonly");d(this,"defaultValue");this.isReadonly=s,this.defaultValue=a}}const ote=e=>e===void 0?"never":Tn(e)?JSON.stringify(e):String(e);class zm{constructor(t,n,r,s){d(this,"from");d(this,"to");d(this,"decode");d(this,"encode");d(this,"_tag","PropertySignatureTransformation");this.from=t,this.to=n,this.decode=r,this.encode=s}toString(){return`PropertySignature<${nS(this.to.isOptional)}, ${this.to.type}, ${ote(this.from.fromKey)}, ${nS(this.from.isOptional)}, ${this.from.type}>`}}const nN=(e,t)=>{switch(e._tag){case"PropertySignatureDeclaration":return new m_(e.type,e.isOptional,e.isReadonly,{...e.annotations,...t},e.defaultValue);case"PropertySignatureTransformation":return new zm(e.from,new Um(e.to.type,e.to.isOptional,e.to.isReadonly,{...e.to.annotations,...t},e.to.defaultValue),e.decode,e.encode)}},rN=Symbol.for("effect/PropertySignature"),vE=e=>ne(e,rN);var MI,LI;LI=eu,MI=rN;const y0=class y0{constructor(t){d(this,"ast");d(this,LI);d(this,MI,null);d(this,"_TypeToken");d(this,"_Key");d(this,"_EncodedToken");d(this,"_HasDefault");this.ast=t}pipe(){return Z(this,arguments)}annotations(t){return new y0(nN(this.ast,mi(t)))}toString(){return String(this.ast)}};let Bm=y0;const Hm=e=>new Bm(e);class p_ extends Bm{constructor(n,r){super(n);d(this,"from");this.from=r}annotations(n){return new p_(nN(this.ast,mi(n)),this.from)}}const sN=e=>new p_(new m_(e.ast,!1,!0,{},void 0),e),EE=y(2,(e,t)=>{const n=e.ast;switch(n._tag){case"PropertySignatureDeclaration":return Hm(new m_(n.type,n.isOptional,n.isReadonly,n.annotations,t));case"PropertySignatureTransformation":return Hm(new zm(n.from,new Um(n.to.type,n.to.isOptional,n.to.isReadonly,n.to.annotations,t),n.decode,n.encode))}}),fC=(e,t)=>rt(e,{onNone:()=>W(t()),onSome:n=>W(n===void 0?t():n)}),Vm=e=>dU(e,Vm,t=>{const n=Vm(t.to);if(n)return new vr(t.from,n,t.transformation)}),ite=y(2,(e,t)=>{const n=e.ast;switch(n._tag){case"PropertySignatureDeclaration":{const r=Ft(n.type);return Hm(new zm(new ste(n.type,n.isOptional,n.isReadonly,n.annotations),new Um(Vm(r)??r,!1,!0,{},n.defaultValue),s=>fC(s,t),ie))}case"PropertySignatureTransformation":{const r=n.to.type;return Hm(new zm(n.from,new Um(Vm(r)??r,!1,n.to.isReadonly,n.to.annotations,n.to.defaultValue),s=>fC(n.decode(s),t),n.encode))}}}),oN=y(2,(e,t)=>e.pipe(ite(t.decoding),EE(t.constructor))),Yt=e=>{const t=e.ast===Rc||e.ast===$p?Rc:h_(e).ast;return new p_(new m_(t,!0,!0,{},void 0),e)},ate=$R([WS]),cte=(e,t)=>{const n=gs(e),r=[];if(n.length>0){const o=[],a=[],u=[];for(let f=0;f<n.length;f++){const h=n[f],p=e[h];if(vE(p)){const g=p.ast;switch(g._tag){case"PropertySignatureDeclaration":{const k=g.type,T=g.isOptional,O=g.annotations;o.push(new Pt(h,k,T,!0,ate(g))),a.push(new Pt(h,Ft(k),T,!0,O)),r.push(new Pt(h,k,T,!0,O));break}case"PropertySignatureTransformation":{const k=g.from.fromKey??h;o.push(new Pt(k,g.from.type,g.from.isOptional,!0,g.from.annotations)),a.push(new Pt(h,g.to.type,g.to.isOptional,!0,g.to.annotations)),u.push(new rU(k,h,g.decode,g.encode));break}}}else o.push(new Pt(h,p.ast,!1,!0)),a.push(new Pt(h,Ft(p.ast),!1,!0)),r.push(new Pt(h,p.ast,!1,!0))}if(yt(u)){const f=[],h=[];for(const p of t){const{indexSignatures:g,propertySignatures:k}=ok(p.key.ast,p.value.ast);k.forEach(T=>{o.push(T),a.push(new Pt(T.name,Ft(T.type),T.isOptional,T.isReadonly,T.annotations))}),g.forEach(T=>{f.push(T),h.push(new fu(T.parameter,Ft(T.type),T.isReadonly))})}return new vr(new Tr(o,f,{[hc]:"Struct (Encoded side)"}),new Tr(a,h,{[hc]:"Struct (Type side)"}),new Zh(u))}}const s=[];for(const o of t){const{indexSignatures:a,propertySignatures:u}=ok(o.key.ast,o.value.ast);u.forEach(f=>r.push(f)),a.forEach(f=>s.push(f))}return new Tr(r,s)},iN=(e,t)=>{const n=gs(e);for(const r of n){const s=e[r];if(t[r]===void 0&&vE(s)){const o=s.ast,a=o._tag==="PropertySignatureDeclaration"?o.defaultValue:o.to.defaultValue;a!==void 0&&(t[r]=a())}}return t};function kE(e,t,n=cte(e,t)){var r;return r=class extends tt(n){static annotations(o){return kE(this.fields,this.records,Ar(this.ast,o))}static pick(...o){return te(Vee(e,...o))}static omit(...o){return te(Wee(e,...o))}},d(r,"fields",{...e}),d(r,"records",[...t]),d(r,"make",(o,a)=>{const u=iN(e,{...o});return y_(a)?u:l_(r)(u)}),r}function te(e,...t){return kE(e,t)}const ute=e=>xe(e).pipe(sN,EE(()=>e)),me=(e,t)=>te({_tag:ute(e),...t});function aN(e,t,n){var r;return r=class extends kE({},[{key:e,value:t}],n){static annotations(o){return aN(e,t,Ar(this.ast,o))}},d(r,"key",e),d(r,"value",t),r}const Uu=e=>aN(e.key,e.value),yf=(...e)=>t=>tt(Ls(t.ast,e)),nu=y(2,(e,t)=>{const n=Ri(Ft(e.ast),t),r=tt(n.isOptional?Sh(n.type):n.type);return Pr(e.pipe(yf(t)),r,{strict:!0,decode:o=>o[t],encode:o=>n.isOptional&&o===void 0?{}:{[t]:o}})});function $E(e,t){var n;return n=class extends tt(t){static annotations(s){return $E(this.from,Ar(this.ast,s))}},d(n,"make",(s,o)=>y_(o)?s:l_(n)(s)),d(n,"from",e),n}const lte=(e,t)=>n=>{const r=rt(lR(n.ast),{onNone:()=>[e],onSome:o=>[...o,e]}),s=na(n.ast,mi({[Y1]:r,...t}));return $E(n,s)},Wm=e=>tt(il(e.ast)),fte=e=>tt(Qa(e.ast)),el=(e,t,n)=>{if(sk(e)&&sk(t)){const r=[...e.propertySignatures];for(const s of t.propertySignatures){const o=s.name,a=r.findIndex(u=>u.name===o);if(a===-1)r.push(s);else{const{isOptional:u,type:f}=r[a];r[a]=new Pt(o,Km(f,s.type,n.concat(o)),u,!0)}}return new Tr(r,e.indexSignatures.concat(t.indexSignatures))}throw new Error(G1(e,t,n))},dte=cU([KS]),tl=(e,t)=>t.map(n=>new Jf(n,e.filter,dte(e))),Km=(e,t,n)=>tn.make(js([e],[t],n)),yi=e=>GS(e)?e.types:[e],js=(e,t,n)=>Gh(e,r=>Gh(t,s=>{switch(s._tag){case"Literal":{if(Tn(s.literal)&&Fy(r)||oo(s.literal)&&tk(r)||Gi(s.literal)&&nk(r))return[s];break}case"StringKeyword":{if(s===Py){if(Fy(r)||wl(r)&&Tn(r.literal))return[r];if(mc(r))return tl(r,js(yi(r.from),[s],n))}else if(r===Py)return[s];break}case"NumberKeyword":{if(s===xy){if(tk(r)||wl(r)&&oo(r.literal))return[r];if(mc(r))return tl(r,js(yi(r.from),[s],n))}else if(r===xy)return[s];break}case"BooleanKeyword":{if(s===Ny){if(nk(r)||wl(r)&&Gi(r.literal))return[r];if(mc(r))return tl(r,js(yi(r.from),[s],n))}else if(r===Ny)return[s];break}case"Union":return js(yi(r),s.types,n);case"Suspend":return[new ta(()=>Km(r,s.f(),n))];case"Refinement":return tl(s,js(yi(r),yi(s.from),n));case"TypeLiteral":{switch(r._tag){case"Union":return js(r.types,[s],n);case"Suspend":return[new ta(()=>Km(r.f(),s,n))];case"Refinement":return tl(r,js(yi(r.from),[s],n));case"TypeLiteral":return[el(r,s,n)];case"Transformation":{const o=r.transformation,a=el(r.from,s,n),u=el(r.to,Ft(s),n);switch(o._tag){case"TypeLiteralTransformation":return[new vr(a,u,new Zh(o.propertySignatureTransformations))];case"ComposeTransformation":return[new vr(a,u,QS)];case"FinalTransformation":return[new vr(a,u,new SR((f,h,p,g)=>sr(o.decode(f,h,p,g),k=>({...f,...k})),(f,h,p,g)=>sr(o.encode(f,h,p,g),k=>({...f,...k}))))]}}}break}case"Transformation":{if(eU(r)){if(Dy(s.transformation)&&Dy(r.transformation))return[new vr(el(r.from,s.from,n),el(r.to,s.to,n),new Zh(s.transformation.propertySignatureTransformations.concat(r.transformation.propertySignatureTransformations)))]}else return js([s],[r],n);break}}throw new Error(G1(r,s,n))})),cN=y(2,(e,t)=>tt(Km(e.ast,t.ast,[]))),uN=y(e=>Xr(e[1]),(e,t)=>CE(e,t,lU(e.ast,t.ast))),bf=e=>tt(new ta(()=>e().ast)),lN=Symbol.for("effect/SchemaId/Refine");function fN(e,t,n){var r,s,o;return o=class extends(s=tt(n),r=lN,s){static annotations(u){return fN(this.from,this.filter,Ar(this.ast,u))}},d(o,r,e),d(o,"from",e),d(o,"filter",t),d(o,"make",(u,f)=>y_(f)?u:l_(o)(u)),o}const dC=(e,t,n)=>{if(Gi(e))return e?V():W(new Kt(t,n));if(Tn(e))return W(new Kt(t,n,e));if(e!==void 0){if("_tag"in e)return W(e);const r=new Kt(t,n,e.message);return W(yt(e.path)?new _n(e.path,n,r):r)}return V()},hte=(e,t,n)=>{if(fj(e))return dC(e,t,n);if(yt(e)){const r=U1(e,s=>dC(s,t,n));if(yt(r))return W(r.length===1?r[0]:new Mt(t,n,r))}return V()};function g_(e,t){return n=>{function r(o,a,u){return hte(e(o,a,u),u,o)}const s=new Jf(n.ast,r,mi(t));return fN(n,r,s)}}function CE(e,t,n){var r;return r=class extends tt(n){static annotations(o){return CE(this.from,this.to,Ar(this.ast,o))}},d(r,"from",e),d(r,"to",t),r}const _o=y(e=>Xr(e[0])&&Xr(e[1]),(e,t,n)=>CE(e,t,new vr(e.ast,t.ast,new SR(n.decode,n.encode)))),Pr=y(e=>Xr(e[0])&&Xr(e[1]),(e,t,n)=>_o(e,t,{strict:!0,decode:(r,s,o,a)=>Kr(n.decode(r,a)),encode:(r,s,o,a)=>Kr(n.encode(r,a))})),mte=y(2,(e,t)=>e.annotations(t)),hC=e=>e instanceof Error?e.message:String(e),pte=e=>_o(L.annotations({description:"a string to be decoded into JSON"}),tS,{strict:!0,decode:(t,n,r)=>Z$({try:()=>JSON.parse(t,e==null?void 0:e.reviver),catch:s=>new Kt(r,t,hC(s))}),encode:(t,n,r)=>Z$({try:()=>JSON.stringify(t,e==null?void 0:e.replacer,e==null?void 0:e.space),catch:s=>new Kt(r,t,hC(s))})}).annotations({title:"parseJson",schemaId:xj}),Ts=(e,t)=>Xr(e)?uN(Ts(t),e):pte(e),gte=yj,_te=(e,t)=>n=>n.pipe(g_(r=>r>=e,{schemaId:gte,title:`greaterThanOrEqualTo(${e})`,description:"a non-negative number",jsonSchema:{minimum:e},...t})),yte=bj,bte=e=>t=>t.pipe(g_(n=>Number.isSafeInteger(n),{schemaId:yte,title:"int",description:"an integer",jsonSchema:{type:"integer"},...e})),Ste=Sj,wte=(e,t,n)=>r=>r.pipe(g_(s=>s>=e&&s<=t,{schemaId:Ste,title:`between(${e}, ${t})`,description:`a number between ${e} and ${t}`,jsonSchema:{minimum:e,maximum:t},...n})),vte=e=>_te(0,{title:"nonNegative",...e});class _a extends st.pipe(bte({identifier:"Int"})){}class Ete extends st.pipe(vte({identifier:"NonNegative"})){}const TE=(e,t,n,r)=>iee(e,{onFailure:s=>new Mt(n,r,s),onSuccess:t});class kte extends Aa(ew,{identifier:"DurationFromSelf",pretty:()=>String,arbitrary:()=>t=>t.oneof(t.constant(jR),t.bigInt({min:0n}).map(n=>wh(n)),t.maxSafeNat().map(n=>sa(n))),equivalence:()=>BR}){}class $te extends Pr(Ete.annotations({description:"a non-negative number to be decoded into a Duration"}),kte,{strict:!0,decode:t=>sa(t),encode:t=>qc(t)}).annotations({identifier:"DurationFromMillis"}){}class __ extends Aa(LM,{identifier:"Uint8ArrayFromSelf",pretty:()=>t=>`new Uint8Array(${JSON.stringify(Array.from(t))})`,arbitrary:()=>t=>t.uint8Array(),equivalence:()=>Hf(de)}){}class Cte extends st.pipe(wte(0,255,{identifier:"Uint8",description:"a 8-bit unsigned integer"})){}class dN extends Pr(Oe(Cte).annotations({description:"an array of 8-bit unsigned integers to be decoded into a Uint8Array"}),__,{strict:!0,decode:t=>Uint8Array.from(t),encode:t=>Array.from(t)}).annotations({identifier:"Uint8Array"}){}const Tte=(e,t,n)=>_o(L.annotations({description:"a string to be decoded into a Uint8Array"}),__,{strict:!0,decode:(r,s,o)=>Zi(t(r),a=>new Kt(o,r,a.message)),encode:r=>Kr(n(r))}).annotations({identifier:e}),Ite=Tte("Uint8ArrayFromBase64",CZ,$Z),Rte=_o(L.annotations({description:"A string that is interpreted as being UriComponent-encoded and will be decoded into a UTF-8 string"}),L,{strict:!0,decode:(e,t,n)=>Zi(IZ(e),r=>new Kt(n,e,r.message)),encode:(e,t,n)=>Zi(TZ(e),r=>new Kt(n,e,r.message))}).annotations({identifier:"StringFromUriComponent"}),hN=e=>tt(bh(e.ast));function Ote(e){return Pr(e,gN(hN(Cs(e))),{strict:!1,decode:t=>dc(t),encode:t=>rt(t,{onNone:()=>[],onSome:rr})})}const dl=y(e=>Xr(e[0]),(e,t)=>_o(e,hN(Cs(e)),{strict:!0,decode:(n,r,s)=>n.length>0?Kr(n[0]):t?Kr(t()):Mu(new Kt(s,n,"Unable to retrieve the first element of an empty array")),encode:n=>Kr(rr(n))})),mC=Symbol.for("effect/SchemaId/ValidDate"),qte=e=>t=>t.pipe(g_(n=>!Number.isNaN(n.getTime()),{schemaId:mC,[mC]:{noInvalidDate:!0},title:"validDate",description:"a valid Date",...e})),pC=_j;class mN extends Aa(a1,{identifier:"DateFromSelf",schemaId:pC,[pC]:{noInvalidDate:!1},description:"a potentially invalid Date instance",pretty:()=>t=>`new Date(${JSON.stringify(t)})`,arbitrary:()=>t=>t.date({noInvalidDate:!1}),equivalence:()=>AM}){}class Ate extends Pr(L.annotations({description:"a string to be decoded into a Date"}),mN,{strict:!0,decode:t=>new Date(t),encode:t=>W1(t)}).annotations({identifier:"DateFromString"}){}class Jm extends Ate.pipe(qte({identifier:"Date"})){}const Pte=te({_tag:xe("None")}).annotations({description:"NoneEncoded"}),Fte=e=>te({_tag:xe("Some"),value:e}).annotations({description:`SomeEncoded<${Nd(e)}>`}),xte=e=>we(Pte,Fte(e)).annotations({description:`OptionEncoded<${Nd(e)}>`}),pN=e=>e._tag==="None"?V():W(e.value),Nte=(e,t)=>n=>n.oneof(t,n.record({_tag:n.constant("None")}),n.record({_tag:n.constant("Some"),value:e(n)})).map(pN),Dte=e=>rt({onNone:()=>"none()",onSome:t=>`some(${e(t)})`}),gC=e=>(t,n,r)=>kL(t)?At(t)?Kr(V()):TE(e(t.value,n),W,r,t):Mu(new Kt(r,t)),gN=e=>Aa([e],{decode:t=>gC(xd(t)),encode:t=>gC(Lu(t))},{description:`Option<${Nd(e)}>`,pretty:Dte,arbitrary:Nte,equivalence:RL}),Mte={_tag:"None"},Lte=e=>({_tag:"Some",value:e});function Wi(e){const t=e;return Pr(xte(t),gN(Cs(t)),{strict:!0,decode:r=>pN(r),encode:r=>rt(r,{onNone:()=>Mte,onSome:Lte})})}const jte=(e,t)=>n=>{const r=n.array(e(n));return(t.depthIdentifier!==void 0?n.oneof(t,n.constant([]),r):r).map(s=>new Set(s))},Ute=e=>t=>`new Set([${Array.from(t.values()).map(n=>e(n)).join(", ")}])`,zte=e=>{const t=Hf(e);return Lf((n,r)=>t(Array.from(n.values()),Array.from(r.values())))},_C=e=>(t,n,r)=>xM(t)?TE(e(Array.from(t.values()),n),s=>new Set(s),r,t):Mu(new Kt(r,t)),Bte=(e,t)=>Aa([e],{decode:n=>_C(xd(Oe(n))),encode:n=>_C(Lu(Oe(n)))},{description:t,pretty:Ute,arbitrary:jte,equivalence:zte}),Hte=e=>Bte(e,`ReadonlySet<${Nd(e)}>`);function Vte(e){return Pr(Oe(e),Hte(Cs(e)),{strict:!0,decode:t=>new Set(t),encode:t=>Array.from(t)})}const Wte=e=>Xr(e)||vE(e),_N=e=>gs(e).every(t=>Wte(e[t])),IE=e=>"fields"in e?e.fields:IE(e[lN]),RE=e=>_N(e)?te(e):Xr(e)?e:te(IE(e)),OE=e=>_N(e)?e:IE(e),Pa=e=>(t,n)=>$c({kind:"Class",identifier:e,schema:RE(t),fields:OE(t),Base:qJ,annotations:n}),yN=e=>EE(sN(xe(e)),()=>e),Fr=e=>(t,n,r)=>{class s extends Cv{}s.prototype.name=t;const o=OE(n),a=RE(n),u={_tag:yN(t)},f=Rl(u,o),h="message"in f;class p extends $c({kind:"TaggedError",identifier:t,schema:cN(a,te(u)),fields:f,Base:s,annotations:r,disableToString:!0}){}return d(p,"_tag",t),h||Object.defineProperty(p.prototype,"message",{get(){return`{ ${gs(o).map(g=>`${VS(g)}: ${Cr(this[g])}`).join(", ")} }`},enumerable:!1,configurable:!0}),p},Rl=(e,t)=>{const n={...e};for(const r of gs(t)){if(r in e)throw new Error(Q1(r));n[r]=t[r]}return n};function y_(e){return Gi(e)?e:(e==null?void 0:e.disableValidation)??!1}const yC=Ee("effect/Schema/astCache",()=>new WeakMap),Kte=e=>e===void 0?[]:Array.isArray(e)?e:[e],$c=({Base:e,annotations:t,disableToString:n,fields:r,identifier:s,kind:o,schema:a})=>{var C,$;const u=Symbol.for(`effect/Schema/${o}/${s}`),[f,h,p]=Kte(t),g=Cs(a),k=g.annotations({identifier:s,...f}),T=g.annotations({[hc]:`${s} (Type side)`,...f}),O=a.annotations({[hc]:`${s} (Constructor)`,...f}),D=a.annotations({[hc]:`${s} (Encoded side)`,...p}),E=a.annotations({[Ep]:s,...p,...f,...h}),S=q=>ne(q,u)&&kn(T)(q),_=($=class extends e{constructor(q={},P=!1){q={...q},o!=="Class"&&delete q._tag,q=iN(r,q),y_(P)||(q=l_(O)(q)),super(q,!0)}static get ast(){let q=yC.get(this);if(q)return q;const P=Aa([a],{decode:()=>(N,M,B)=>N instanceof this||S(N)?Kr(N):Mu(new Kt(B,N)),encode:()=>(N,M)=>N instanceof this?Kr(N):sr(Lu(T)(N,M),B=>new this(B,!0))},{identifier:s,pretty:N=>M=>`${s}(${N(M)})`,arbitrary:N=>M=>N(M).map(B=>new this(B)),equivalence:ie,[Yh]:k.ast,...f});return q=Pr(D,P,{strict:!0,decode:N=>new this(N,!0),encode:ie}).annotations({[Yh]:E.ast,...h}).ast,yC.set(this,q),q}static pipe(){return Z(this,arguments)}static annotations(q){return tt(this.ast).annotations(q)}static toString(){return`(${String(D)} <-> ${s})`}static make(...q){return new this(...q)}static extend(q){return(P,N)=>{const M=OE(P),B=RE(P),F=Rl(r,M);return $c({kind:o,identifier:q,schema:cN(a,B),fields:F,Base:this,annotations:N})}}static transformOrFail(q){return(P,N,M)=>{const B=Rl(r,P);return $c({kind:o,identifier:q,schema:_o(a,Cs(te(B)),N),fields:B,Base:this,annotations:M})}}static transformOrFailFrom(q){return(P,N,M)=>{const B=Rl(r,P);return $c({kind:o,identifier:q,schema:_o(bE(a),te(B),N),fields:B,Base:this,annotations:M})}}get[(C=eu,u)](){return u}},d($,C,eS),d($,"fields",{...r}),d($,"identifier",s),$);return n!==!0&&Object.defineProperty(_.prototype,"toString",{value(){return`${s}({ ${gs(r).map(q=>`${VS(q)}: ${Cr(this[q])}`).join(", ")} })`},configurable:!0,writable:!0}),_},Jte=te({_tag:xe("None")}).annotations({identifier:"FiberIdNoneEncoded"}),Gte=te({_tag:xe("Runtime"),id:_a,startTimeMillis:_a}).annotations({identifier:"FiberIdRuntimeEncoded"}),Qte=te({_tag:xe("Composite"),left:bf(()=>rS),right:bf(()=>rS)}).annotations({identifier:"FiberIdCompositeEncoded"}),rS=we(Jte,Gte,Qte).annotations({identifier:"FiberIdEncoded"}),Yte=e=>e.letrec(t=>({None:e.record({_tag:e.constant("None")}),Runtime:e.record({_tag:e.constant("Runtime"),id:e.integer(),startTimeMillis:e.integer()}),Composite:e.record({_tag:e.constant("Composite"),left:t("FiberId"),right:t("FiberId")}),FiberId:e.oneof(t("None"),t("Runtime"),t("Composite"))})).FiberId.map(Gm),sS=e=>{switch(e._tag){case"None":return"FiberId.none";case"Runtime":return`FiberId.runtime(${e.id}, ${e.startTimeMillis})`;case"Composite":return`FiberId.composite(${sS(e.right)}, ${sS(e.left)})`}},Gm=e=>{switch(e._tag){case"None":return Nn;case"Runtime":return Jz(e.id,e.startTimeMillis);case"Composite":return Gz(Gm(e.left),Gm(e.right))}},Xte=e=>te({_tag:xe("Die"),defect:e}),Zte=te({_tag:xe("Empty")}),ene=e=>te({_tag:xe("Fail"),error:e}),tne=te({_tag:xe("Interrupt"),fiberId:rS});let nne=0;const oS=(e,t)=>{const n=e,r=t,s=bf(()=>o),o=we(Zte,ene(n),Xte(r),tne,te({_tag:xe("Sequential"),left:s,right:s}),te({_tag:xe("Parallel"),left:s,right:s})).annotations({title:`CauseEncoded<${Nd(e)}>`,[Ep]:`CauseEncoded${nne++}`});return o},rne=(e,t)=>n=>n.letrec(r=>({Empty:n.record({_tag:n.constant("Empty")}),Fail:n.record({_tag:n.constant("Fail"),error:e(n)}),Die:n.record({_tag:n.constant("Die"),defect:t(n)}),Interrupt:n.record({_tag:n.constant("Interrupt"),fiberId:Yte(n)}),Sequential:n.record({_tag:n.constant("Sequential"),left:r("Cause"),right:r("Cause")}),Parallel:n.record({_tag:n.constant("Parallel"),left:r("Cause"),right:r("Cause")}),Cause:n.oneof(r("Empty"),r("Fail"),r("Die"),r("Interrupt"),r("Sequential"),r("Parallel"))})).Cause.map(Ni),sne=e=>t=>{const n=r=>{switch(r._tag){case"Empty":return"Cause.empty";case"Fail":return`Cause.fail(${e(r.error)})`;case"Die":return`Cause.die(${Em(r)})`;case"Interrupt":return`Cause.interrupt(${sS(r.fiberId)})`;case"Sequential":return`Cause.sequential(${n(r.left)}, ${n(r.right)})`;case"Parallel":return`Cause.parallel(${n(r.left)}, ${n(r.right)})`}};return n(t)},bC=e=>(t,n,r)=>Q8(t)?TE(e(cc(t),n),Ni,r,t):Mu(new Kt(r,t)),one=({defect:e,error:t})=>Aa([t,e],{decode:(n,r)=>bC(xd(oS(n,r))),encode:(n,r)=>bC(Lu(oS(n,r)))},{title:`Cause<${t.ast}>`,pretty:sne,arbitrary:rne});function Ni(e){switch(e._tag){case"Empty":return K8;case"Fail":return Tu(e.error);case"Die":return ma(e.defect);case"Interrupt":return Cg(Gm(e.fiberId));case"Sequential":return G8(Ni(e.left),Ni(e.right));case"Parallel":return J8(Ni(e.left),Ni(e.right))}}function cc(e){switch(e._tag){case"Empty":return{_tag:"Empty"};case"Fail":return{_tag:"Fail",error:e.error};case"Die":return{_tag:"Die",defect:e.defect};case"Interrupt":return{_tag:"Interrupt",fiberId:e.fiberId};case"Sequential":return{_tag:"Sequential",left:cc(e.left),right:cc(e.right)};case"Parallel":return{_tag:"Parallel",left:cc(e.left),right:cc(e.right)}}}const ine=({defect:e,error:t})=>{const n=t,r=e;return Pr(oS(n,r),one({error:Cs(n),defect:Cs(r)}),{strict:!1,decode:o=>Ni(o),encode:o=>cc(o)})};class ya extends Pr(tS,tS,{strict:!0,decode:t=>{if(qs(t)&&"message"in t&&typeof t.message=="string"){const n=new Error(t.message,{cause:t});return"name"in t&&typeof t.name=="string"&&(n.name=t.name),n.stack="stack"in t&&typeof t.stack=="string"?t.stack:"",n}return String(t)},encode:t=>t instanceof Error?{name:t.name,message:t.message}:AO(t)}).annotations({identifier:"Defect"}){}const ane=Symbol.for("effect/Schema/Serializable/symbol"),qE=Symbol.for("effect/Schema/Serializable/symbolResult"),cne=y(2,(e,t)=>ju(e[qE].failure)(t)),une=y(2,(e,t)=>ju(e[qE].success)(t)),An=e=>(t,n,r)=>{var o;const s=Rl({_tag:yN(t)},n.payload);return o=class extends $c({kind:"TaggedRequest",identifier:t,schema:te(s),fields:s,Base:oQ,annotations:r}){get[ane](){return this.constructor}get[qE](){return{failure:n.failure,success:n.success}}},d(o,"_tag",t),d(o,"success",n.success),d(o,"failure",n.failure),o},lne=OX,fne=qX,dne=xX,hne=NX,Is=DX,bN=MX,SN=LX,Sf=o_,mne=UX,Qm=wx,yo=gf,pne=WX,gne=vx,pi=_f,_ne=KX,yne=nee,bne=GX,Sne=XX,wne=ZX,vne=tZ,Ene=nZ,on=rZ,kne=kx,wN=pE,ru=iZ,Sn=aZ,$ne=uZ,Cne=fZ,vN=$x,EN=a_,Tne=mZ,Ine=pZ,AE=_Z,SC=Symbol.for("effect/Subscribable"),Rne=cP,One="effect/SubscriptionRef",qne=Symbol.for(One),Ane={_A:e=>e};var jI,UI,zI,BI,HI,VI;class Pne extends(VI=$o,HI=ti,BI=SC,zI=A5,UI=Rne,jI=qne,VI){constructor(n,r,s){super();d(this,"ref");d(this,"pubsub");d(this,"semaphore");d(this,HI,ti);d(this,BI,SC);d(this,zI,Kw);d(this,UI,uP);d(this,jI,Ane);d(this,"get");this.ref=n,this.pubsub=r,this.semaphore=s,this.get=zi(this.ref)}commit(){return this.get}get changes(){return v(zi(this.ref),Y(n=>Se(wx(this.pubsub,{scoped:!0}),r=>yx(vx(n),r))),this.semaphore.withPermits(1),a_)}modify(n){return this.modifyEffect(r=>Le(n(r)))}modifyEffect(n){return v(zi(this.ref),Y(n),Y(([r,s])=>v(Wc(this.ref,s),ro(r),Dv(Hg(this.pubsub,s)))),this.semaphore.withPermits(1))}}const Fne=e=>v(vd([Kv(),hi(e),Lg(1)]),Se(([t,n,r])=>new Pne(n,t,r))),xne=y(2,(e,t)=>v(Wc(e.ref,t),Dv(Hg(e.pubsub,t)),e.semaphore.withPermits(1))),wf=Fne,Er=xne,PE=QY,Nne=hx,FE=YY,Dne=XY,kN=e=>t=>_ne(t,n=>v(e(n),Se(()=>n))),wC=()=>Nne([]),hl=(e,t)=>Dne(e,n=>wp(n,t)),Mne=e=>FE(e,[]),$N=(e,t,n)=>Vx(function*(){const r=yield*PE(e);if(r.length<t)return yield*Hee;{const s=r.splice(0,Math.min(n,r.length));return yield*FE(e,r),s}}),Lne=(e,t)=>Vx(function*(){const n=yield*PE(e),[r,s]=j1(n,t);return yield*FE(e,s),r}),vC=e=>PE(e).pipe(Se(t=>t.length)),vf=y(2,(e,t)=>v(e.changes,Is(t),ru(1),Ene,Se(qp))),EC=Symbol.for("effect/Subscribable");var WI,KI,JI;class jne extends(JI=$o,KI=EC,WI=ti,JI){constructor(n,r){super();d(this,"get");d(this,"changes");d(this,KI,EC);d(this,WI,ti);this.get=n,this.changes=r}commit(){return this.get}}const b_=e=>new jne(e.get,e.changes);y(2,(e,t)=>b_({get:Se(e.get,t),changes:pi(e.changes,t)}));y(2,(e,t)=>b_({get:Y(e.get,t),changes:yne(e.changes,t)}));b_({get:Ov,changes:Sne});const Une=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}.${e.getMilliseconds().toString().padStart(3,"0")}`,zne=e=>Iee(Oee,qee({formatDate:t=>`${Une(t)} ${e}`})),Bne={};var Hne={};const S_=()=>typeof process<"u"&&Hne!==void 0||Bne!==void 0?!1:!!(typeof globalThis<"u"&&globalThis.__DEV__),Vne=e=>{const t=e==null?void 0:e.toString();if(t!=="[object Object]")return t;try{return JSON.stringify(e,null,2)}catch(n){return console.log(e),"Error while printing error: "+n}},iS=e=>e!==void 0&&e.toLowerCase()!=="false"&&e.toLowerCase()!=="0",$e=(e,...t)=>{if(console.error(e,...t),S_())debugger;throw new Error(`This should never happen: ${e}`)};var Wne=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},Di="1.9.0",kC=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function Kne(e){var t=new Set([e]),n=new Set,r=e.match(kC);if(!r)return function(){return!1};var s={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(s.prerelease!=null)return function(f){return f===e};function o(u){return n.add(u),!1}function a(u){return t.add(u),!0}return function(f){if(t.has(f))return!0;if(n.has(f))return!1;var h=f.match(kC);if(!h)return o(f);var p={major:+h[1],minor:+h[2],patch:+h[3],prerelease:h[4]};return p.prerelease!=null||s.major!==p.major?o(f):s.major===0?s.minor===p.minor&&s.patch<=p.patch?a(f):o(f):s.minor<=p.minor?a(f):o(f)}}var Jne=Kne(Di),Gne=Di.split(".")[0],Ef=Symbol.for("opentelemetry.js.api."+Gne),kf=Wne;function xE(e,t,n,r){var s;r===void 0&&(r=!1);var o=kf[Ef]=(s=kf[Ef])!==null&&s!==void 0?s:{version:Di};if(!r&&o[e]){var a=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return n.error(a.stack||a.message),!1}if(o.version!==Di){var a=new Error("@opentelemetry/api: Registration of version v"+o.version+" for "+e+" does not match previously registered API v"+Di);return n.error(a.stack||a.message),!1}return o[e]=t,n.debug("@opentelemetry/api: Registered a global for "+e+" v"+Di+"."),!0}function $f(e){var t,n,r=(t=kf[Ef])===null||t===void 0?void 0:t.version;if(!(!r||!Jne(r)))return(n=kf[Ef])===null||n===void 0?void 0:n[e]}function NE(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+Di+".");var n=kf[Ef];n&&delete n[e]}var Qne=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),s,o=[],a;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(u){a={error:u}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},Yne=function(e,t,n){if(n||arguments.length===2)for(var r=0,s=t.length,o;r<s;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},Xne=function(){function e(t){this._namespace=t.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return nl("debug",this._namespace,t)},e.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return nl("error",this._namespace,t)},e.prototype.info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return nl("info",this._namespace,t)},e.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return nl("warn",this._namespace,t)},e.prototype.verbose=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return nl("verbose",this._namespace,t)},e}();function nl(e,t,n){var r=$f("diag");if(r)return n.unshift(t),r[e].apply(r,Yne([],Qne(n),!1))}var nr;(function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"})(nr||(nr={}));function Zne(e,t){e<nr.NONE?e=nr.NONE:e>nr.ALL&&(e=nr.ALL),t=t||{};function n(r,s){var o=t[r];return typeof o=="function"&&e>=s?o.bind(t):function(){}}return{error:n("error",nr.ERROR),warn:n("warn",nr.WARN),info:n("info",nr.INFO),debug:n("debug",nr.DEBUG),verbose:n("verbose",nr.VERBOSE)}}var ere=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),s,o=[],a;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(u){a={error:u}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},tre=function(e,t,n){if(n||arguments.length===2)for(var r=0,s=t.length,o;r<s;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},nre="diag",Ym=function(){function e(){function t(s){return function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];var u=$f("diag");if(u)return u[s].apply(u,tre([],ere(o),!1))}}var n=this,r=function(s,o){var a,u,f;if(o===void 0&&(o={logLevel:nr.INFO}),s===n){var h=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return n.error((a=h.stack)!==null&&a!==void 0?a:h.message),!1}typeof o=="number"&&(o={logLevel:o});var p=$f("diag"),g=Zne((u=o.logLevel)!==null&&u!==void 0?u:nr.INFO,s);if(p&&!o.suppressOverrideMessage){var k=(f=new Error().stack)!==null&&f!==void 0?f:"<failed to generate stacktrace>";p.warn("Current logger will be overwritten from "+k),g.warn("Current logger will overwrite one already registered from "+k)}return xE("diag",g,n,!0)};n.setLogger=r,n.disable=function(){NE(nre,n)},n.createComponentLogger=function(s){return new Xne(s)},n.verbose=t("verbose"),n.debug=t("debug"),n.info=t("info"),n.warn=t("warn"),n.error=t("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}();function rre(e){return Symbol.for(e)}var sre=function(){function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(r){return n._currentContext.get(r)},n.setValue=function(r,s){var o=new e(n._currentContext);return o._currentContext.set(r,s),o},n.deleteValue=function(r){var s=new e(n._currentContext);return s._currentContext.delete(r),s}}return e}(),ore=new sre,ire=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),s,o=[],a;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(u){a={error:u}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},are=function(e,t,n){if(n||arguments.length===2)for(var r=0,s=t.length,o;r<s;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},cre=function(){function e(){}return e.prototype.active=function(){return ore},e.prototype.with=function(t,n,r){for(var s=[],o=3;o<arguments.length;o++)s[o-3]=arguments[o];return n.call.apply(n,are([r],ire(s),!1))},e.prototype.bind=function(t,n){return n},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),ure=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),s,o=[],a;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(u){a={error:u}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},lre=function(e,t,n){if(n||arguments.length===2)for(var r=0,s=t.length,o;r<s;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},yy="context",fre=new cre,DE=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(t){return xE(yy,t,Ym.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(t,n,r){for(var s,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return(s=this._getContextManager()).with.apply(s,lre([t,n,r],ure(o),!1))},e.prototype.bind=function(t,n){return this._getContextManager().bind(t,n)},e.prototype._getContextManager=function(){return $f(yy)||fre},e.prototype.disable=function(){this._getContextManager().disable(),NE(yy,Ym.instance())},e}(),su;(function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"})(su||(su={}));var CN="0000000000000000",TN="00000000000000000000000000000000",dre={traceId:TN,spanId:CN,traceFlags:su.NONE},Ol=function(){function e(t){t===void 0&&(t=dre),this._spanContext=t}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(t,n){return this},e.prototype.setAttributes=function(t){return this},e.prototype.addEvent=function(t,n){return this},e.prototype.addLink=function(t){return this},e.prototype.addLinks=function(t){return this},e.prototype.setStatus=function(t){return this},e.prototype.updateName=function(t){return this},e.prototype.end=function(t){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(t,n){},e}(),ME=rre("OpenTelemetry Context Key SPAN");function LE(e){return e.getValue(ME)||void 0}function hre(){return LE(DE.getInstance().active())}function jE(e,t){return e.setValue(ME,t)}function mre(e){return e.deleteValue(ME)}function pre(e,t){return jE(e,new Ol(t))}function IN(e){var t;return(t=LE(e))===null||t===void 0?void 0:t.spanContext()}var gre=/^([0-9a-f]{32})$/i,_re=/^[0-9a-f]{16}$/i;function yre(e){return gre.test(e)&&e!==TN}function bre(e){return _re.test(e)&&e!==CN}function RN(e){return yre(e.traceId)&&bre(e.spanId)}function Sre(e){return new Ol(e)}var by=DE.getInstance(),ON=function(){function e(){}return e.prototype.startSpan=function(t,n,r){r===void 0&&(r=by.active());var s=!!(n!=null&&n.root);if(s)return new Ol;var o=r&&IN(r);return wre(o)&&RN(o)?new Ol(o):new Ol},e.prototype.startActiveSpan=function(t,n,r,s){var o,a,u;if(!(arguments.length<2)){arguments.length===2?u=n:arguments.length===3?(o=n,u=r):(o=n,a=r,u=s);var f=a??by.active(),h=this.startSpan(t,o,f),p=jE(f,h);return by.with(p,u,void 0,h)}},e}();function wre(e){return typeof e=="object"&&typeof e.spanId=="string"&&typeof e.traceId=="string"&&typeof e.traceFlags=="number"}var vre=new ON,Ere=function(){function e(t,n,r,s){this._provider=t,this.name=n,this.version=r,this.options=s}return e.prototype.startSpan=function(t,n,r){return this._getTracer().startSpan(t,n,r)},e.prototype.startActiveSpan=function(t,n,r,s){var o=this._getTracer();return Reflect.apply(o.startActiveSpan,o,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):vre},e}(),kre=function(){function e(){}return e.prototype.getTracer=function(t,n,r){return new ON},e}(),$re=new kre,$C=function(){function e(){}return e.prototype.getTracer=function(t,n,r){var s;return(s=this.getDelegateTracer(t,n,r))!==null&&s!==void 0?s:new Ere(this,t,n,r)},e.prototype.getDelegate=function(){var t;return(t=this._delegate)!==null&&t!==void 0?t:$re},e.prototype.setDelegate=function(t){this._delegate=t},e.prototype.getDelegateTracer=function(t,n,r){var s;return(s=this._delegate)===null||s===void 0?void 0:s.getTracer(t,n,r)},e}(),Ii;(function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"})(Ii||(Ii={}));var uc;(function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"})(uc||(uc={}));var Sy=DE.getInstance(),wy="trace",Cre=function(){function e(){this._proxyTracerProvider=new $C,this.wrapSpanContext=Sre,this.isSpanContextValid=RN,this.deleteSpan=mre,this.getSpan=LE,this.getActiveSpan=hre,this.getSpanContext=IN,this.setSpan=jE,this.setSpanContext=pre}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(t){var n=xE(wy,this._proxyTracerProvider,Ym.instance());return n&&this._proxyTracerProvider.setDelegate(t),n},e.prototype.getTracerProvider=function(){return $f(wy)||this._proxyTracerProvider},e.prototype.getTracer=function(t,n){return this.getTracerProvider().getTracer(t,n)},e.prototype.disable=function(){NE(wy,Ym.instance()),this._proxyTracerProvider=new $C},e}(),aS=Cre.getInstance();const CC=1000000000n,vy=e=>[Number(e/CC),Number(e%CC)],Ey=e=>Object.entries(e).reduce((t,[n,r])=>(t[n]=qN(r),t),{}),qN=e=>typeof e=="string"||typeof e=="number"||typeof e=="boolean"?e:typeof e=="bigint"?Number(e):Qi(e),xh=Symbol.for("@effect/opentelemetry/Tracer/OtelSpan"),Tre={internal:Ii.INTERNAL,client:Ii.CLIENT,server:Ii.SERVER,producer:Ii.PRODUCER,consumer:Ii.CONSUMER};var GI;GI=xh;class AN{constructor(t,n,r,s,o,a,u,f){d(this,"name");d(this,"parent");d(this,"context");d(this,"links");d(this,"kind");d(this,GI);d(this,"_tag","Span");d(this,"span");d(this,"spanId");d(this,"traceId");d(this,"attributes",new Map);d(this,"sampled");d(this,"status");this.name=r,this.parent=s,this.context=o,this.links=a,this.kind=f,this[xh]=xh;const h=t.active();this.span=n.startSpan(r,{startTime:vy(u),links:a.length>0?a.map(g=>({context:cS(g.span),attributes:Ey(g.attributes)})):void 0,kind:Tre[this.kind]},s._tag==="Some"?FN(h,s.value,o):aS.deleteSpan(h));const p=this.span.spanContext();this.spanId=p.spanId,this.traceId=p.traceId,this.status={_tag:"Started",startTime:u},this.sampled=(p.traceFlags&su.SAMPLED)===su.SAMPLED}attribute(t,n){this.span.setAttribute(t,qN(n)),this.attributes.set(t,n)}addLinks(t){this.links.push(...t),this.span.addLinks(t.map(n=>({context:cS(n.span),attributes:Ey(n.attributes)})))}end(t,n){const r=vy(t);if(this.status={_tag:"Ended",endTime:t,exit:n,startTime:this.status.startTime},n._tag==="Success")this.span.setStatus({code:uc.OK});else if(no(n.cause))this.span.setStatus({code:uc.OK,message:Em(n.cause)}),this.span.setAttribute("span.label"," Interrupted"),this.span.setAttribute("status.interrupted",!0);else{const s=eJ(n.cause)[0];s?(s.stack=Em(n.cause,{renderErrorCause:!0}),this.span.recordException(s,r),this.span.setStatus({code:uc.ERROR,message:s.message})):this.span.setStatus({code:uc.OK})}this.span.end(r)}event(t,n,r){this.span.addEvent(t,r?Ey(r):void 0,vy(n))}}const PN=Yn("@effect/opentelemetry/Tracer/OtelTracer"),Ire=Se(PN,e=>Oq({span(t,n,r,s,o,a){return new AN(Sy,e,t,n,r,s.slice(),o,a)},context(t,n){const r=n.currentSpan;return r===void 0?t():Sy.with(FN(Sy.active(),r),t)}})),TC=Yn("@effect/opentelemetry/Tracer/OtelTraceFlags"),IC=Yn("@effect/opentelemetry/Tracer/OtelTraceState"),Rre=Y(jg,e=>xh in e?Le(e.span):Mn(new Rg)),FN=(e,t,n)=>t instanceof AN?aS.setSpan(e,t.span):aS.setSpanContext(e,cS(t,n)),cS=(e,t)=>({spanId:e.spanId,traceId:e.traceId,isRemote:e._tag==="ExternalSpan",traceFlags:gt(t?RC(e,t,TC):Or(e.context,TC),()=>su.SAMPLED),traceState:or(t?RC(e,t,IC):Or(e.context,IC))}),RC=(e,t,n)=>Gs(Or(t,n),()=>Or(e.context,n)),Ore=Ire,UE=Rre,qre=PN,ah=(e,t,n=" ")=>e.split(`
`).map(r=>n.repeat(t)+r).join(`
`),xN=e=>e!==void 0,Are=e=>e==null,OC={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_LIVESTORE_SYNC_URL:"http://localhost:8787"};var qC={};const Cf=e=>{if(typeof process<"u"&&qC!==void 0)return qC[e];if(OC!==void 0)return OC[e]},Js=Cf("LS_TRACE_VERBOSE")!==void 0||Cf("VITE_LS_TRACE_VERBOSE")!==void 0,Rs=iS(Cf("LS_DEV"))||iS(Cf("VITE_LS_DEV"));iS(Cf("CI"));const Pre=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],Fre=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],xre=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],Nre=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],AC=(e,t,n)=>{let r=e;return typeof t=="string"||Array.isArray(t)?r=e.toLocaleString(t,n):(t===!0||n!==void 0)&&(r=e.toLocaleString(void 0,n)),r};function Dre(e,t){if(!Number.isFinite(e))throw new TypeError(`Expected a finite number, got ${typeof e}: ${e}`);t={bits:!1,binary:!1,space:!0,...t};const n=t.bits?t.binary?Nre:xre:t.binary?Fre:Pre,r=t.space?" ":"";if(t.signed&&e===0)return` 0${r}${n[0]}`;const s=e<0,o=s?"-":t.signed?"+":"";s&&(e=-e);let a;if(t.minimumFractionDigits!==void 0&&(a={minimumFractionDigits:t.minimumFractionDigits}),t.maximumFractionDigits!==void 0&&(a={maximumFractionDigits:t.maximumFractionDigits,...a}),e<1){const p=AC(e,t.locale,a);return o+p+r+n[0]}const u=Math.min(Math.floor(t.binary?Math.log(e)/Math.log(1024):Math.log10(e)/3),n.length-1);e/=(t.binary?1024:1e3)**u,a||(e=e.toPrecision(3));const f=AC(Number(e),t.locale,a),h=n[u];return o+f+r+h}const NN=e=>Array.isArray(e);function bo(e){debugger;throw new Error(`A case was not handled for value: ${Mre(Vne(e),1e3)}`)}const Mre=(e,t)=>e.length>t?e.slice(0,t)+"...":e,Lre=e=>{const t=new Map;return(...n)=>{const r=JSON.stringify(n);if(t.has(r))return t.get(r);const s=e(...n);return t.set(r,s),s}},jre=e=>{const t=new Map;return n=>{if(t.has(n))return t.get(n);const r=e(n);return t.set(n,r),r}},Ure=e=>typeof(e==null?void 0:e.then)=="function",zu=e=>z(function*(){const t=yield*$v();return yield*Gn(n=>yn(t,n)),yield*e(t).pipe(Ev(t))}),ch=e=>To(()=>e()).pipe(Br(t=>qr(t)?t:Ure(t)?Fg(()=>t):Le(t))),wt=e=>Ou(e,t=>z(function*(){if(no(t))return;const n=yield*UE.pipe(qv("NoSuchElementException",s=>Le(void 0))),r=t.toString().split(`
`)[0];yield*Yc(r,t).pipe(s=>n===void 0?s:Sc({spanId:n.spanContext().spanId,traceId:n.spanContext().traceId})(s))})),uh=(e,t,n,r)=>z(function*(){const s=yield*Io(),o=a=>n(a).pipe(Cn(s),Ro);e.addEventListener(t,o,{once:!1}),yield*Gn(()=>Te(()=>e.removeEventListener(t,o)))}),Bn=(e,t)=>vQ(kQ(e).pipe(Sc(t??{})),FQ,()=>Lp(Aee)),zE=e=>t=>PP(Te(()=>performance.mark(`${e}:start`)),()=>t,()=>Te(()=>{performance.mark(`${e}:end`),performance.measure(e,`${e}:start`,`${e}:end`)})),DN=()=>{const e=EG();return e._tag==="None"||e.value.currentSpan===void 0?"No current fiber":""},zre=()=>console.log(DN());globalThis.getSpanTrace=DN;globalThis.logSpanTrace=zre;const MN=(e,t)=>{class n extends Cv{constructor(){super(...arguments);d(this,"_tag",t)}}return n.prototype[e]=e,n.prototype.name=t,n},PC=Symbol.for("@effect/platform/Cookies"),FC=Symbol.for("@effect/platform/Cookies/Cookie"),Bre={[PC]:PC,...yp,toJSON(){return{_id:"@effect/platform/Cookies",cookies:jL(this.cookies,e=>e.toJSON())}},pipe(){return Z(this,arguments)}},Hre=e=>{const t=Object.create(Bre);return t.cookies=e,t},Vre=e=>{const t={};for(const n of e)t[n.name]=n;return Hre(t)},Wre=e=>{const t=typeof e=="string"?[e]:e,n=[];for(const r of t){const s=Kre(r.trim());ct(s)&&n.push(s.value)}return Vre(n)};function Kre(e){const t=e.split(";").map(u=>u.trim()).filter(u=>u!=="");if(t.length===0)return V();const n=t[0].indexOf("=");if(n===-1)return V();const r=t[0].slice(0,n);if(!Jre.test(r))return V();const s=t[0].slice(n+1),o=Gre(s);if(t.length===1)return W(Object.assign(Object.create(xC),{name:r,value:o,valueEncoded:s}));const a={};for(let u=1;u<t.length;u++){const f=t[u],h=f.indexOf("="),p=h===-1?f:f.slice(0,h).trim(),g=h===-1?void 0:f.slice(h+1).trim();switch(p.toLowerCase()){case"domain":{if(g===void 0)break;const k=g.trim().replace(/^\./,"");k&&(a.domain=k);break}case"expires":{if(g===void 0)break;const k=new Date(g);isNaN(k.getTime())||(a.expires=k);break}case"max-age":{if(g===void 0)break;const k=parseInt(g,10);isNaN(k)||(a.maxAge=tw(k));break}case"path":{if(g===void 0)break;g[0]==="/"&&(a.path=g);break}case"priority":{if(g===void 0)break;switch(g.toLowerCase()){case"low":a.priority="low";break;case"medium":a.priority="medium";break;case"high":a.priority="high";break}break}case"httponly":{a.httpOnly=!0;break}case"secure":{a.secure=!0;break}case"partitioned":{a.partitioned=!0;break}case"samesite":{if(g===void 0)break;switch(g.toLowerCase()){case"lax":a.sameSite="lax";break;case"strict":a.sameSite="strict";break;case"none":a.sameSite="none";break}break}}}return W(Object.assign(Object.create(xC),{name:r,value:o,valueEncoded:s,options:Object.keys(a).length>0?a:void 0}))}const Jre=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,xC={[FC]:FC,...yp,toJSON(){return{_id:"@effect/platform/Cookies/Cookie",name:this.name,value:this.value,options:this.options}}},Gre=e=>{try{return decodeURIComponent(e)}catch{return e}},NC=Symbol.for("@effect/platform/Headers"),Tf=Object.assign(Object.create(null),{[NC]:NC,[bp](e){return lS(this,_g(e,jN))}}),w_=e=>Object.assign(Object.create(Tf),e),LN=Object.create(Tf),BE=e=>{if(e===void 0)return LN;if(Symbol.iterator in e){const n=Object.create(Tf);for(const[r,s]of e)n[r.toLowerCase()]=s;return n}const t=Object.create(Tf);for(const[n,r]of Object.entries(e))Array.isArray(r)?t[n.toLowerCase()]=r.join(", "):r!==void 0&&(t[n.toLowerCase()]=r);return t},Qre=e=>Object.setPrototypeOf(e,Tf),uS=y(3,(e,t,n)=>{const r=w_(e);return r[t.toLowerCase()]=n,r}),Yre=y(2,(e,t)=>w_({...e,...BE(t)})),Xre=y(2,(e,t)=>{const n=w_(e);return Object.assign(n,t),n}),Zre=y(2,(e,t)=>{const n=w_(e),r=s=>{if(typeof s=="string"){const o=s.toLowerCase();o in e&&delete n[o]}else for(const o in e)s.test(o)&&delete n[o]};if(Array.isArray(t))for(let s=0;s<t.length;s++)r(t[s]);else r(t);return n}),lS=y(2,(e,t)=>{const n={...e},r=s=>{if(typeof s=="string"){const o=s.toLowerCase();o in e&&(n[o]=aC(e[o]))}else for(const o in e)s.test(o)&&(n[o]=aC(e[o]))};if(Array.isArray(t))for(let s=0;s<t.length;s++)r(t[s]);else r(t);return n}),jN=Ee("@effect/platform/Headers/currentRedactedNames",()=>Mv(["authorization","cookie","set-cookie","x-api-key"])),ese=Symbol.for("@effect/platform/HttpClientError"),UN=ese;class zN extends MN(UN,"RequestError"){get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){return this.description?`${this.reason}: ${this.description} (${this.methodAndUrl})`:`${this.reason} error (${this.methodAndUrl})`}}class bi extends MN(UN,"ResponseError"){get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){const t=`${this.response.status} ${this.methodAndUrl}`;return this.description?`${this.reason}: ${this.description} (${t})`:`${this.reason} error (${t})`}}const v_=e=>{const t=BN(e),n=[];for(let r=0;r<t.length;r++)if(Array.isArray(t[r][0])){const[s,o]=t[r];n.push([`${s[0]}[${s.slice(1).join("][")}]`,o])}else n.push(t[r]);return n},BN=e=>{const t=Symbol.iterator in e?je(e):Object.entries(e),n=[];for(const[r,s]of t)if(Array.isArray(s))for(let o=0;o<s.length;o++)s[o]!==void 0&&n.push([r,String(s[o])]);else if(typeof s=="object"){const o=BN(s);for(const[a,u]of o)n.push([[r,...typeof a=="string"?[a]:a],u])}else s!==void 0&&n.push([r,String(s)]);return n},tse=[],nse=y(2,(e,t)=>{const n=v_(t),r=n.map(([s])=>s);return wp(z1(e,([s])=>r.includes(s)),n)}),rse=(e,t,n)=>{try{const r=new URL(e,ose());for(let s=0;s<t.length;s++){const[o,a]=t[s];a!==void 0&&r.searchParams.append(o,a)}return n._tag==="Some"&&(r.hash=n.value),ce(r)}catch(r){return oe(r)}},sse=e=>new URLSearchParams(e).toString(),ose=()=>{if("location"in globalThis&&globalThis.location!==void 0&&globalThis.location.origin!==void 0&&globalThis.location.pathname!==void 0)return location.origin+location.pathname},ql=Symbol.for("@effect/platform/HttpIncomingMessage"),ise=(e,t)=>{const n=e.headers["content-type"]??"";let r;if(n.includes("application/json"))try{r=bs(e.json)}catch{}else if(n.includes("text/")||n.includes("urlencoded"))try{r=bs(e.text)}catch{}const s={...t,headers:Yi(e.headers),remoteAddress:e.remoteAddress.toJSON()};return r!==void 0&&(s.body=r),s},ase=e=>Qre({b3:`${e.traceId}-${e.spanId}-${e.sampled?"1":"0"}${e.parent._tag==="Some"?`-${e.parent.value.spanId}`:""}`,traceparent:`00-${e.traceId}-${e.spanId}-${e.sampled?"01":"00"}`}),ky=Symbol.for("@effect/platform/HttpBody");var QI;class cse{constructor(){d(this,QI);this[ky]=ky}[(QI=ky,Ue)](){return this.toJSON()}toString(){return lt(this)}}class use extends cse{constructor(){super(...arguments);d(this,"_tag","Empty")}toJSON(){return{_id:"@effect/platform/HttpBody",_tag:"Empty"}}}const lse=new use,DC=Symbol.for("@effect/platform/HttpClientRequest"),fse={[DC]:DC,...yp,toJSON(){return{_id:"@effect/platform/HttpClientRequest",method:this.method,url:this.url,urlParams:this.urlParams,hash:this.hash,headers:Yi(this.headers),body:this.body.toJSON()}},pipe(){return Z(this,arguments)}};function So(e,t,n,r,s,o){const a=Object.create(fse);return a.method=e,a.url=t,a.urlParams=n,a.hash=r,a.headers=s,a.body=o,a}const dse=So("GET","",tse,V(),LN,lse),Fa=e=>(t,n)=>Sse(dse,{method:e,url:t,...n??void 0}),hse=Fa("GET"),mse=Fa("POST"),pse=Fa("PUT"),gse=Fa("PATCH"),_se=Fa("DELETE"),yse=Fa("HEAD"),bse=Fa("OPTIONS"),Sse=y(2,(e,t)=>{let n=e;return t.method&&(n=Ese(n,t.method)),t.url&&(n=kse(n,t.url)),t.headers&&(n=HN(n,t.headers)),t.urlParams&&(n=$se(n,t.urlParams)),t.hash&&(n=Cse(n,t.hash)),t.body&&(n=Tse(n,t.body)),t.accept&&(n=VN(n,t.accept)),t.acceptJson&&(n=vse(n)),n}),wse=y(3,(e,t,n)=>So(e.method,e.url,e.urlParams,e.hash,uS(e.headers,t,n),e.body)),HN=y(2,(e,t)=>So(e.method,e.url,e.urlParams,e.hash,Yre(e.headers,t),e.body)),VN=y(2,(e,t)=>wse(e,"Accept",t)),vse=VN("application/json"),Ese=y(2,(e,t)=>So(t,e.url,e.urlParams,e.hash,e.headers,e.body)),kse=y(2,(e,t)=>{if(typeof t=="string")return So(e.method,t,e.urlParams,e.hash,e.headers,e.body);const n=new URL(t.toString()),r=v_(n.searchParams),s=n.hash?W(n.hash.slice(1)):V();return n.search="",n.hash="",So(e.method,n.toString(),r,s,e.headers,e.body)}),$se=y(2,(e,t)=>So(e.method,e.url,nse(e.urlParams,t),e.hash,e.headers,e.body)),Cse=y(2,(e,t)=>So(e.method,e.url,e.urlParams,W(t),e.headers,e.body)),Tse=y(2,(e,t)=>{let n=e.headers;if(t._tag==="Empty"||t._tag==="FormData")n=Zre(n,["Content-type","Content-length"]);else{const r=t.contentType;r&&(n=uS(n,"content-type",r));const s=t.contentLength;s&&(n=uS(n,"content-length",s.toString()))}return So(e.method,e.url,e.urlParams,e.hash,n,t)}),Al=Symbol.for("@effect/platform/HttpClientResponse"),Ise=(e,t)=>new Rse(e,t);var YI,XI,ZI;class Rse extends(ZI=tL,XI=ql,YI=Al,ZI){constructor(n,r){super();d(this,"request");d(this,"source");d(this,XI);d(this,YI);d(this,"cachedCookies");d(this,"textBody");d(this,"formDataBody");d(this,"arrayBufferBody");this.request=n,this.source=r,this[ql]=ql,this[Al]=Al}toJSON(){return ise(this,{_id:"@effect/platform/HttpClientResponse",request:this.request.toJSON(),status:this.status})}get status(){return this.source.status}get headers(){return BE(this.source.headers)}get cookies(){return this.cachedCookies?this.cachedCookies:this.cachedCookies=Wre(this.source.headers.getSetCookie())}get remoteAddress(){return V()}get stream(){return this.source.body?pne(()=>this.source.body,n=>new bi({request:this.request,response:this,reason:"Decode",cause:n})):hne(new bi({request:this.request,response:this,reason:"EmptyBody",description:"can not create stream from empty body"}))}get json(){return cQ(this.text,{try:n=>n===""?null:JSON.parse(n),catch:n=>new bi({request:this.request,response:this,reason:"Decode",cause:n})})}get text(){return this.textBody??(this.textBody=El({try:()=>this.source.text(),catch:n=>new bi({request:this.request,response:this,reason:"Decode",cause:n})}).pipe(Z_,bs))}get urlParamsBody(){return Y(this.text,n=>To({try:()=>v_(new URLSearchParams(n)),catch:r=>new bi({request:this.request,response:this,reason:"Decode",cause:r})}))}get formData(){return this.formDataBody??(this.formDataBody=El({try:()=>this.source.formData(),catch:n=>new bi({request:this.request,response:this,reason:"Decode",cause:n})}).pipe(Z_,bs))}get arrayBuffer(){return this.arrayBufferBody??(this.arrayBufferBody=El({try:()=>this.source.arrayBuffer(),catch:n=>new bi({request:this.request,response:this,reason:"Decode",cause:n})}).pipe(Z_,bs))}}const MC=Symbol.for("@effect/platform/HttpClient"),HE=Yn("@effect/platform/HttpClient"),Ose=Ee(Symbol.for("@effect/platform/HttpClient/tracerDisabledWhen"),()=>Mv(Hn)),qse=Ee(Symbol.for("@effect/platform/HttpClient/currentTracerPropagation"),()=>Mv(!0)),Ase=du()("@effect/platform/HttpClient/SpanNameGenerator",{defaultValue:()=>e=>`http.client ${e.method}`}),Pse={[MC]:MC,pipe(){return Z(this,arguments)},...yp,toJSON(){return{_id:"@effect/platform/HttpClient"}},get(e,t){return this.execute(hse(e,t))},head(e,t){return this.execute(yse(e,t))},post(e,t){return this.execute(mse(e,t))},put(e,t){return this.execute(pse(e,t))},patch(e,t){return this.execute(gse(e,t))},del(e,t){return this.execute(_se(e,t))},options(e,t){return this.execute(bse(e,t))}},WN=(e,t)=>{const n=Object.create(Pse);return n.preprocess=t,n.postprocess=e,n.execute=function(r){return e(t(r))},n},Xm=Ee("@effect/platform/HttpClient/responseRegistry",()=>{if("FinalizationRegistry"in globalThis&&globalThis.FinalizationRegistry){const t=new FinalizationRegistry(n=>{n.abort()});return{register(n,r){t.register(n,r,n)},unregister(n){t.unregister(n)}}}const e=new Map;return{register(t,n){e.set(t,setTimeout(()=>n.abort(),5e3))},unregister(t){const n=e.get(t);n!==void 0&&(clearTimeout(n),e.delete(t))}}}),Fse=Ee("@effect/platform/HttpClient/scopedRequests",()=>new WeakMap),xse=e=>WN(t=>Y(t,n=>ks(r=>{const s=Fse.get(n),o=s??new AbortController,a=rse(n.url,n.urlParams,n.hash);if(a._tag==="Left")return Mn(new zN({request:n,reason:"InvalidUrl",cause:a.left}));const u=a.right;if(!r.getFiberRef(xQ)||r.getFiberRef(Ose)(n)){const p=e(n,u,o.signal,r);return s?p:si(g=>Sr(g(p),{onSuccess(k){return Xm.register(k,o),Le(new LC(k,o))},onFailure(k){return af(k)&&o.abort(),Wn(k)}}))}const h=Vn(r.currentContext,Ase);return OQ(h(n),{kind:"client",captureStackTrace:!1},p=>{p.attribute("http.request.method",n.method),p.attribute("server.address",u.origin),u.port!==""&&p.attribute("server.port",+u.port),p.attribute("url.full",u.toString()),p.attribute("url.path",u.pathname),p.attribute("url.scheme",u.protocol.slice(0,-1));const g=u.search.slice(1);g!==""&&p.attribute("url.query",g);const k=r.getFiberRef(jN),T=lS(n.headers,k);for(const O in T)p.attribute(`http.request.header.${O}`,String(T[O]));return n=r.getFiberRef(qse)?HN(n,ase(p)):n,si(O=>O(e(n,u,o.signal,r)).pipe(Pi(p),Sr({onSuccess:D=>{p.attribute("http.response.status_code",D.status);const E=lS(D.headers,k);for(const S in E)p.attribute(`http.response.header.${S}`,String(E[S]));return s?Le(D):(Xm.register(D,o),Le(new LC(D,o)))},onFailure(D){return!s&&af(D)&&o.abort(),Wn(D)}})))})})),Le);var e1,t1;class LC{constructor(t,n){d(this,"original");d(this,"controller");d(this,t1,Al);d(this,e1,ql);this.original=t,this.controller=n}applyInterrupt(t){return pt(()=>(Xm.unregister(this.original),lQ(t,()=>Te(()=>{this.controller.abort()}))))}get request(){return this.original.request}get status(){return this.original.status}get headers(){return this.original.headers}get cookies(){return this.original.cookies}get remoteAddress(){return this.original.remoteAddress}get formData(){return this.applyInterrupt(this.original.formData)}get text(){return this.applyInterrupt(this.original.text)}get json(){return this.applyInterrupt(this.original.json)}get urlParamsBody(){return this.applyInterrupt(this.original.urlParamsBody)}get arrayBuffer(){return this.applyInterrupt(this.original.arrayBuffer)}get stream(){return wN(()=>(Xm.unregister(this.original),dne(this.original.stream,t=>(G4(t)&&this.controller.abort(),fe))))}toJSON(){return this.original.toJSON()}[(t1=Al,e1=ql,Ue)](){return this.original[Ue]()}}const{del:Bce,execute:Hce,get:Vce,head:Wce,options:Kce,patch:Jce,post:Gce,put:Qce}=bQ(HE),Nse=y(2,(e,t)=>{const n=e;return WN(r=>t(n.postprocess(r)),n.preprocess)}),Dse=e=>UP(HE,Y(FP(),t=>Se(e,n=>Nse(n,yQ(r=>Eo(t,r)))))),Mse="@effect/platform/FetchHttpClient/Fetch",Lse="@effect/platform/FetchHttpClient/FetchOptions",jse=xse((e,t,n,r)=>{const s=r.getFiberRef(MP),o=s.unsafeMap.get(Mse)??globalThis.fetch,a=s.unsafeMap.get(Lse)??{},u=a.headers?Xre(BE(a.headers),e.headers):e.headers,f=h=>Se(El({try:()=>o(t,{...a,method:e.method,headers:u,body:h,duplex:e.body._tag==="Stream"?"half":void 0,signal:n}),catch:p=>new zN({request:e,reason:"Transport",cause:p})}),p=>Ise(e,p));switch(e.body._tag){case"Raw":case"Uint8Array":return f(e.body.body);case"FormData":return f(e.body.formData);case"Stream":return Y($ne(e.body.stream),f)}return f(void 0)}),Use=Dse(Le(jse)),zse=Use,Bse=HE;class Cc extends ZS("@effect/platform/Transferable/Collector")(){}const KN=()=>{let e=[];const t=s=>{e.push(...s)},n=()=>e,r=()=>{const s=e;return e=[],s};return Cc.of({unsafeAddAll:t,addAll:s=>Te(()=>t(s)),unsafeRead:n,read:Te(n),unsafeClear:r,clear:Te(r)})},Hse=Te(KN),Vse=e=>Y(SQ(Cc),rt({onNone:()=>fe,onSome:t=>t.addAll(e)})),JN=y(2,(e,t)=>_o(bE(e),e,{strict:!0,decode:Kr,encode:n=>ro(Vse(t(n)),n)})),E_=JN(mn,e=>[e]),Tc=JN(__,e=>[e.buffer]),Wse=Symbol.for("@effect/platform/WorkerError"),fS=Wse,Kse=e=>ne(e,fS);var n1,r1;const jo=class jo extends(r1=Fr()("WorkerError",{reason:xe("spawn","decode","send","unknown","encode"),cause:ya}),n1=fS,r1){constructor(){super(...arguments);d(this,n1,fS)}get message(){switch(this.reason){case"send":return"An error occurred calling .postMessage";case"spawn":return"An error occurred while spawning a worker";case"decode":return"An error occurred during decoding";case"encode":return"An error occurred during encoding";case"unknown":return"An unexpected error occurred"}}};d(jo,"Cause",ine({error:jo,defect:ya})),d(jo,"encodeCause",ms(jo.Cause)),d(jo,"decodeCause",_E(jo.Cause));let Ss=jo;const Jse=Symbol.for("@effect/platform/Runner/PlatformRunner"),GN=Yn("@effect/platform/Runner/PlatformRunner"),VE=du()("@effect/platform/WorkerRunner/CloseLatch",{defaultValue:()=>K4(Nn)}),QN=UP(VE,Me()),Gse=Rm(function*(e,t){const n=yield*ks(Le),r=yield*GN,s=yield*VE,o=yield*r.start(s),a=new Map;yield*zt(s).pipe(dQ(()=>(n.currentScheduler.scheduleTask(()=>{n.unsafeInterruptAsFork(n.id())},0),fe)),Vt),yield*o.run((u,[f,h,p,g])=>{if(h===1){const k=a.get(f);return k?Ir(k):fe}return ks(k=>(a.set(f,k),t!=null&&t.decode?t.decode(p):Le(p))).pipe(Y(k=>{const T=KN(),O=e(k);let D=qr(O)?Y(O,E=>v(t!=null&&t.encodeOutput?Rh(t.encodeOutput(k,E),Cc,T):Le(E),Y(S=>o.send(u,[f,0,[S]],T.unsafeRead())))):v(O,kne(E=>{if((t==null?void 0:t.encodeOutput)===void 0){const S=ar(E);return o.send(u,[f,0,S])}return T.unsafeClear(),v(bn(E,S=>t.encodeOutput(k,S)),Rh(Cc,T),Y(S=>o.send(u,[f,0,S],T.unsafeRead())))}),Br(o.send(u,[f,1])));return g&&(D=Pi(D,{_tag:"ExternalSpan",traceId:g[0],spanId:g[1],sampled:g[2],context:io()})),si(E=>E(D).pipe(aQ(Kse,S=>o.send(u,[f,3,Ss.encodeCause(Tu(S))])),ys(S=>rn(Tg(S),{onLeft:_=>(T.unsafeClear(),v(t!=null&&t.encodeError?Rh(t.encodeError(k,_),Cc,T):Le(_),Y(C=>o.send(u,[f,2,C],T.unsafeRead())),ys(C=>o.send(u,[f,3,Ss.encodeCause(C)])))),onRight:_=>o.send(u,[f,3,Ss.encodeCause(_)])}))))}),Ai(Te(()=>a.delete(f))))})}),Qse=(e,t)=>z(function*(){const n=yield*Ng;let r=io();const s=tu(e);return yield*Gse(o=>{const a=t[o._tag](o);return zQ(a)?Y(jP(a,n),u=>Te(()=>{r=Eo(r,u)})):qr(a)?Cn(a,r):vne(a,r)},{decode(o){return mo(s(o),a=>new Ss({reason:"decode",cause:a}))},encodeError(o,a){return mo(cne(o,a),u=>new Ss({reason:"encode",cause:u}))},encodeOutput(o,a){return ys(une(o,a),u=>new Ss({reason:"encode",cause:u}))}})}),Yse=(e,t)=>VQ(Qse(e,t)).pipe(jv(QN)),Xse=e=>Tm(Rm(function*(t){const n=yield*jP(zP(e,QN),t),r=Vn(n,VE);return yield*zt(r)})),jC=Jse,WE=GN,YN=Yse,XN=Xse,KE=e=>{try{return $t(JSON.stringify(e.ast,null,2))}catch{return console.warn("Schema hashing failed, falling back to hashing the shortend schema AST string. This is less reliable and may cause false positives."),Q(e.ast.toString())}},ZN=(e,t)=>(n,r)=>z(function*(){const s=yield*Hse;return[yield*ju(e,t)(n,r).pipe(Rh(Cc,s)),s.unsafeRead()]}),lh=(e,t)=>(n,r)=>{const s=Kx(e,t)(n,r);return s._tag==="Left"?$e("encodeSyncDebug failed:",s.left):s.right},Zse=e=>_o(Cs(e),bE(e),{decode:fee(e),encode:uee(e)});Zse(Ite);const wo=we(L,st,ga,wE,Oe(bf(()=>wo)),Uu({key:L,value:bf(()=>wo)})).annotations({title:"JsonValue"}),Qn=Symbol("WebChannel"),If=me("WebChannel.DebugPing",{message:L,payload:Yt(L)}),Zm=me("WebChannel.Ping",{requestId:L}),ep=me("WebChannel.Pong",{requestId:L}),eoe=we(Zm,ep),UC=e=>({send:we(e.send,If,Zm,ep),listen:we(e.listen,If,Zm,ep)}),k_=e=>ne(e,"send")&&ne(e,"listen")?UC(e):UC({send:e,listen:e}),JE=e=>t=>t.pipe(bN(Ug(function*(n){return n._tag==="Right"&&kn(If)(n.right)?(yield*cs(`WebChannel:ping [${e}] ${n.right.message}`,n.right.payload),!1):!0}))),toe=({channelName:e,schema:t})=>zu(n=>z(function*(){const r=k_(t),s=new BroadcastChannel(e);yield*Gn(()=>To(()=>s.close()).pipe(Ed));const o=h=>z(function*(){const p=yield*ju(r.send)(h);s.postMessage(p)}),a=AE(s,"message").pipe(pi(h=>f_(r.listen)(h.data)),JE(e)),u=yield*Me().pipe(ot(Ia(Jn))),f=!1;return{[Qn]:Qn,send:o,listen:a,closedDeferred:u,shutdown:yn(n,Ht("shutdown")),schema:r,supportsTransferables:f}}).pipe(Ie(`WebChannel:broadcastChannel(${e})`))),noe=({port:e,schema:t,debugId:n})=>zu(r=>z(function*(){const s=k_(t),o=n===void 0?"messagePort":`messagePort:${n}`,a=p=>z(function*(){const[g,k]=yield*ZN(s.send)(p);e.postMessage(g,k)}),u=AE(e,"message").pipe(pi(p=>f_(s.listen)(p.data)),JE(o));e.start();const f=yield*Me().pipe(ot(Ia(Jn))),h=!0;return yield*Gn(()=>To(()=>e.close()).pipe(Ed)),{[Qn]:Qn,send:a,listen:u,closedDeferred:f,shutdown:yn(r,Ht("shutdown")),schema:s,supportsTransferables:h}}).pipe(Ie("WebChannel:messagePortChannel")));Ee("livestore:sameThreadChannels",()=>new Map);const zC=({port:e,schema:t,debugId:n})=>zu(r=>z(function*(){const s=k_(t),o=n===void 0?"messagePort":`messagePort:${n}`,a=new Map,u=me("ChannelRequest",{id:L,payload:we(s.listen,s.send)}).annotations({title:"webmesh.ChannelRequest"}),f=me("ChannelRequestAck",{reqId:L}).annotations({title:"webmesh.ChannelRequestAck"}),h=we(u,f).annotations({title:"webmesh.ChannelMessage"}),p={sendTotal:0,sendPending:0,listenTotal:0,id:n},g=D=>z(function*(){p.sendTotal++,p.sendPending++;const E=crypto.randomUUID(),[S,_]=yield*ZN(h)({_tag:"ChannelRequest",id:E,payload:D}),C=yield*Me();a.set(E,C),e.postMessage(S,_),yield*C,a.delete(E),p.sendPending--}),k=AE(e,"message").pipe(pi(D=>f_(h)(D.data)),Sn(D=>z(function*(){D._tag==="Right"&&(D.right._tag==="ChannelRequestAck"?yield*at(a.get(D.right.reqId),void 0):D.right._tag==="ChannelRequest"&&(p.listenTotal++,e.postMessage(ms(h)({_tag:"ChannelRequestAck",reqId:D.right.id}))))})),SN(D=>D._tag==="Left"?W(D):D.right._tag==="ChannelRequest"?W(ce(D.right.payload)):V()),D=>D,JE(o));e.start();const T=yield*Me().pipe(ot(Ia(Jn))),O=!0;return yield*Gn(()=>To(()=>e.close()).pipe(Ed)),{[Qn]:Qn,send:g,listen:k,closedDeferred:T,shutdown:yn(r,Ht("shutdown")),schema:s,supportsTransferables:O,debugInfo:p}}).pipe(Ie("WebChannel:messagePortChannelWithAck"))),BC=(e,t)=>z(function*(){const n=yield*dn().pipe(ot(xt)),r={current:void 0};if(yield*e.listen.pipe(t!=null&&t.heartbeat?bN(Ug(function*(o){if(o._tag==="Right"&&kn(eoe)(o.right)){if(o.right._tag==="WebChannel.Ping")yield*e.send(ep.make({requestId:o.right.requestId}));else{const{deferred:a,requestId:u}=r.current??$e("No pending ping");u!==o.right.requestId&&$e("Received pong for unexpected requestId",u,o.right.requestId),yield*at(a,void 0)}return!1}return!0})):ie,kN(o=>Jv(n,o)),on,Vt),t!=null&&t.heartbeat){const{interval:o,timeout:a}=t.heartbeat;yield*z(function*(){for(;;){yield*Qc(o);const u=crypto.randomUUID();yield*e.send(Zm.make({requestId:u}));const f=yield*Me();r.current={deferred:f,requestId:u},yield*f.pipe(Mg(a),qv("TimeoutException",()=>e.shutdown))}}).pipe(Ie("WebChannel:heartbeat"),Vt)}const s=yo(n,{maxChunkSize:1});return{[Qn]:Qn,send:e.send,listen:s,closedDeferred:e.closedDeferred,shutdown:e.shutdown,schema:e.schema,supportsTransferables:e.supportsTransferables,debugInfo:{innerDebugInfo:e.debugInfo,listenQueueSize:n}}});class ml extends Fr()("WebSocketError",{cause:ya}){}const roe=({url:e,reconnect:t})=>z(function*(){yield*soe(e);const n=yield*OP((r,s)=>{try{const o=new globalThis.WebSocket(e);if(o.readyState===globalThis.WebSocket.OPEN){r(Le(o));return}s.addEventListener("abort",()=>{o.close(3e3,"abort signal")}),o.addEventListener("open",()=>r(Le(o)),{once:!0}),o.addEventListener("error",a=>{r(Mn(new ml({cause:a})))},{once:!0}),o.addEventListener("close",a=>r(Mn(new ml({cause:a}))),{once:!0})}catch(o){r(Mn(new ml({cause:o})))}}).pipe(wQ("WebSocketError",()=>ooe(e)),t?Pv(t):ie);return yield*Gn(Ug(function*(r){try{Ra(r)?n.close(3e3):n.close(1e3)}catch(s){yield*ri(new ml({cause:s}))}})),n}),soe=e=>To({try:()=>new URL(e),catch:t=>new ml({cause:t})}),ooe=e=>z(function*(){const n=yield*(yield*Bse).get(e),r=yield*n.text;yield*Yc(`Failed to connect to '${e}' (status: ${n.status}). Error:`,r)}).pipe(Av),ioe=e=>t=>{if(ne(console,"createTask")===!1)return t;const n=z(function*(){const s=yield*TQ;return Oq({span:(o,...a)=>{const u=s.span(o,...a),f=e(o);return u.runInTask=h=>f.run(h),u},context:(o,a)=>{const u=Or(x5)(a.currentContext);if(u._tag==="None")return s.context(o,a);const f=u.value;if(f._tag==="ExternalSpan")return s.context(o,a);const h=f;return"runInTask"in h&&typeof h.runInTask=="function"?h.runInTask(()=>s.context(o,a)):s.context(o,a)}})}),r=v(n,Se(HP),BP);return Cn(t,r)},dS=Ee("@effect/platform-browser/Worker/cachedPorts",()=>new Set);function aoe(e){dS.add(e.ports[0])}typeof self<"u"&&"onconnect"in self&&(self.onconnect=aoe);const e2=e=>WE.of({[jC]:jC,start:Rm(function*(t){const n=yield*xee();let r=0;const s=new Map,o=(u,f,h)=>Te(()=>{var p;(((p=s.get(u))==null?void 0:p[0])??e).postMessage([1,f],{transfer:h})}),a=Rm(function*(u){const f=yield*Ng,h=(yield*qt(Io())).pipe(Z7(AU(RJ))),p=yield*GZ(),g=KF(h);function k(_){_._tag==="Failure"&&!no(_.cause)&&Oi(t,Yl(bv(_.cause)))}function T(_){return function(C){const $=C.data;if($[0]===0){const q=u(_,$[1]);if(qr(q)){const P=g(q);P.addObserver(k),G$(p,P)}}else{const q=s.get(_);if(q){if(s.size===1)return Oi(t,Jn)}else return;s.delete(_),Ro(yn(q[1],Jn))}}}function O(_){Oi(t,new Ss({reason:"decode",cause:_.data}))}function D(_){Oi(t,new Ss({reason:"unknown",cause:_.data}))}function E(_){const C=kv(f,nf).pipe(Y($=>{const q=r++;s.set(q,[_,$]);const P=T(q);return _.addEventListener("message",P),_.addEventListener("messageerror",O),"start"in _&&_.start(),_.postMessage([0]),Go($,Te(()=>{_.removeEventListener("message",P),_.removeEventListener("messageerror",D),_.close()}))}),g);C.addObserver(k),G$(p,C)}e.addEventListener("error",D);let S;if("onconnect"in e){S=e.onconnect,e.onconnect=function(_){const C=_.ports[0];E(C)};for(const _ of dS)E(_);dS.clear(),yield*Go(f,Te(()=>e.close()))}else E(e);yield*Go(f,Te(()=>{e.removeEventListener("error",D),"onconnect"in e&&(e.onconnect=S)}))});return ie({run:a,send:o,disconnects:n})})}),coe=e=>Lv(WE,e2(e)),uoe=WQ(WE,()=>e2(self)),loe=uoe,foe=coe,doe=(e=ov)=>mW(t=>{const n=new MessageChannel;n.port1.postMessage(void 0),n.port2.onmessage=t},e),hoe=TR(),tp=Yx(hoe)(_a),moe=TR(),ou=Yx(moe)(_a),ai=0,vn=te({global:ou,client:tp}).annotations({title:"LiveStore.EventSequenceNumber"}),hS=(e,t)=>e.global!==t.global?e.global-t.global:e.client-t.client,lr=e=>e.client===0?`e${e.global}`:`e${e.global}+${e.client}`,$_=(e,t)=>e.global===t.global&&e.client===t.client,Jr={global:0,client:ai},Nh=(e,t)=>e.global>t.global||e.global===t.global&&e.client>t.client,ba=(e,t)=>e.global>t.global||e.global===t.global&&e.client>=t.client,t2=(e,t)=>e.global>t.global||e.global===t.global&&e.client>t.client?e:t,GE=(e,t)=>t?{seqNum:{global:e.global,client:e.client+1},parentSeqNum:e}:{seqNum:{global:e.global+1,client:ai},parentSeqNum:{global:e.global,client:ai}},n2=e=>{const t=["text","integer","real","blob"];return typeof e=="object"&&e!==null&&"columnType"in e&&t.includes(e.columnType)},QE=Symbol.for("NoDefault"),r2=e=>typeof e=="object"&&e!==null&&"sql"in e&&typeof e.sql=="string",Dd=e=>t=>{const n=(t==null?void 0:t.nullable)??!1,r=(t==null?void 0:t.schema)??o2(e),s=n===!0?eN(r):r,o=(t==null?void 0:t.default)===void 0||t.default===QE?V():W(t.default);return{columnType:e,schema:s,default:o,nullable:n,primaryKey:(t==null?void 0:t.primaryKey)??!1}},poe=e=>Dd(e),Hr=Dd("text"),ir=Dd("integer"),goe=Dd("real"),s2=Dd("blob"),C_=(e,t)=>n=>{const r=(n==null?void 0:n.nullable)??!1,s=t._tag==="baseSchemaFn"?t.baseSchemaFn(n==null?void 0:n.schema):t.baseSchema,o=r===!0?eN(s):s,a=(n==null?void 0:n.default)===void 0||n.default===QE?V():W(n.default);return{columnType:e,schema:o,default:a,nullable:r,primaryKey:(n==null?void 0:n.primaryKey)??!1}},YE=C_("text",{_tag:"baseSchemaFn",baseSchemaFn:e=>Ts(e??mn)}),_oe=C_("text",{_tag:"baseSchema",baseSchema:Jm}),yoe=C_("integer",{_tag:"baseSchema",baseSchema:Pr(st,mN,{decode:e=>new Date(e),encode:e=>e.getTime()})}),boe=C_("integer",{_tag:"baseSchema",baseSchema:Pr(st,ga,{decode:e=>e===1,encode:e=>e?1:0})}),o2=e=>{switch(e){case"text":return L;case"integer":return st;case"real":return st;case"blob":return __;default:return bo(e)}},Soe=e=>Array.isArray(e)?Object.fromEntries(e.map(t=>[t.name,t])):e,i2=(e,t,n)=>{const r={_tag:"table",name:e,columns:woe(t),indexes:voe(n??[])};return{name:e,columns:t,indexes:n,ast:r}},a2=e=>te(Object.fromEntries(e.ast.columns.map(t=>[t.name,t.schema]))).annotations({title:e.name}),c2=e=>te(Object.fromEntries(e.ast.columns.map(t=>[t.name,t.nullable===!0||t.default._tag==="Some"?Yt(t.schema):t.schema]))).annotations({title:e.name}),woe=e=>Object.entries(e).map(([t,n])=>({_tag:"column",name:t,schema:n.schema,default:n.default,nullable:n.nullable??!1,primaryKey:n.primaryKey??!1,type:{_tag:n.columnType}})),voe=e=>e.map(t=>({_tag:"index",columns:t.columns,name:t.name,unique:t.isUnique??!1}));var Eoe=Object.freeze({__proto__:null,NoDefault:QE,blob:s2,boolean:boe,column:poe,datetime:_oe,datetimeInteger:yoe,defaultSchemaForColumnType:o2,insertStructSchemaForTable:c2,integer:ir,isColumnDefinition:n2,isSqlDefaultValue:r2,json:YE,makeDbSchema:Soe,real:goe,structSchemaForTable:a2,table:i2,text:Hr});const koe=e=>{let t=0,n,r;if(e.length===0)return t;for(n=0;n<e.length;n++)r=e.charCodeAt(n),t=(t<<5)-t+r,t=Math.trunc(t);return t},XE=e=>koe(JSON.stringify(Dh(e))),Dh=e=>{switch(e._tag){case"table":return{_tag:"table",name:e.name,columns:e.columns.map(t=>Dh(t)),indexes:e.indexes.map(t=>Dh(t))};case"column":return{_tag:"column",name:e.name,type:e.type._tag,primaryKey:e.primaryKey,nullable:e.nullable,default:e.default};case"index":return{_tag:"index",columns:e.columns,name:e.name,unique:e.unique,primaryKey:e.primaryKey};case"foreignKey":return{_tag:"foreignKey",references:e.references,key:e.key,columns:e.columns};case"dbSchema":return{_tag:"dbSchema",tables:e.tables.map(Dh)};default:throw new Error(`Unreachable: ${e}`)}},Rf=Symbol.for("QueryBuilderAst"),Sa=Symbol.for("QueryBuilder"),T_=e=>ne(e,Sa),$oe=te({mergeCounter:st,eventNum:vn});te({fileName:L},{key:L,value:mn}).annotations({title:"LiveStore.PersistenceInfo"});const $y=te({done:st,total:st}),Coe=we(te({stage:xe("loading")}),te({stage:xe("migrating"),progress:$y}),te({stage:xe("rehydrating"),progress:$y}),te({stage:xe("syncing"),progress:$y}),te({stage:xe("done")})).annotations({title:"BootStatus"}),np=Symbol.for("@livestore/session-id"),Us=class Us extends Fr()("LiveStore.UnexpectedError",{cause:ya,note:Yt(L),payload:Yt(mn)}){};d(Us,"mapToUnexpectedError",t=>t.pipe(mo(n=>kn(Us)(n)?n:new Us({cause:n})),iQ(n=>new Us({cause:n})))),d(Us,"mapToUnexpectedErrorStream",t=>t.pipe(bne(n=>kn(Us)(n)?n:new Us({cause:n}))));let Ne=Us;class mS extends Fr()("LiveStore.IntentionalShutdownCause",{reason:xe("devtools-reset","devtools-import","adapter-reset","manual")}){}class Yce extends Fr()("LiveStore.StoreInterrupted",{reason:L}){}class lc extends Fr()("LiveStore.SqliteError",{query:Yt(te({sql:L,bindValues:we(Uu({key:L,value:mn}),Oe(mn))})),code:Yt(we(st,L)),cause:ya,note:Yt(L)}){}const Toe=te({tableName:L,hashes:te({expected:st,actual:Yt(st)})}),Ioe=te({migrations:Oe(Toe)}),fh=(e,t,n)=>e.length===0?"":`WHERE ${e.map(({col:s,op:o,value:a})=>{if(a===null){if(o!=="="&&o!=="!=")throw new Error(`Unsupported operator for NULL value: ${o}`);return`${s} ${o==="="?"IS":"IS NOT"} NULL`}const u=t.sqliteDef.columns[s];if(u===void 0)throw new Error(`Column ${s} not found`);if(o==="IN"||o==="NOT IN"){if(!Array.isArray(a))return $e(`Expected array value for ${o} operator but got`,a);if(a.length===0)return o==="IN"?"0=1":"1=1";const h=a.map(g=>ms(u.schema)(g));n.push(...h);const p=h.map(()=>"?").join(", ");return`${s} ${o} (${p})`}else{const h=ms(u.schema)(a);return n.push(h),`${s} ${o} ?`}}).join(" AND ")}`,Cy=e=>!e||e.length===0?"":` RETURNING ${e.join(", ")}`,HC=e=>{const t=[];if(e._tag==="InsertQuery"){const p=Object.keys(e.values),g=p.map(()=>"?").join(", "),k=ms(e.tableDef.insertSchema)(e.values);p.forEach(E=>{t.push(k[E])});let T="INSERT",O="";if(e.onConflict)if(e.onConflict.action._tag==="replace")T="INSERT OR REPLACE";else if(O=` ON CONFLICT (${e.onConflict.targets.join(", ")}) `,e.onConflict.action._tag==="ignore")O+="DO NOTHING";else{const E=e.onConflict.action.update,S=Object.keys(E);if(S.length===0)throw new Error("No update columns provided for ON CONFLICT DO UPDATE");const _=S.map(C=>E[C]===void 0?`${C} = excluded.${C}`:`${C} = ?`).join(", ");S.forEach(C=>{const $=E[C];if($!==void 0){const q=e.tableDef.sqliteDef.columns[C];if(q===void 0)throw new Error(`Column ${C} not found`);const P=ms(q.schema)($);t.push(P)}}),O+=`DO UPDATE SET ${_}`}let D=`${T} INTO '${e.tableDef.sqliteDef.name}' (${p.join(", ")}) VALUES (${g})`;return D+=O,D+=Cy(e.returning),{query:D,bindValues:t}}if(e._tag==="UpdateQuery"){const p=Object.keys(e.values);if(p.length===0)return console.warn(`UPDATE query requires at least one column to set (for table ${e.tableDef.sqliteDef.name}). Running no-op query instead to skip this update query.`),{query:"SELECT 1",bindValues:[]};const g=ms(Wm(e.tableDef.rowSchema))(e.values);p.forEach(O=>{t.push(g[O])});let k=`UPDATE '${e.tableDef.sqliteDef.name}' SET ${p.map(O=>`${O} = ?`).join(", ")}`;const T=fh(e.where,e.tableDef,t);return T&&(k+=` ${T}`),k+=Cy(e.returning),{query:k,bindValues:t}}if(e._tag==="DeleteQuery"){let p=`DELETE FROM '${e.tableDef.sqliteDef.name}'`;const g=fh(e.where,e.tableDef,t);return g&&(p+=` ${g}`),p+=Cy(e.returning),{query:p,bindValues:t}}if(e._tag==="CountQuery")return{query:[`SELECT COUNT(*) as count FROM '${e.tableDef.sqliteDef.name}'`,fh(e.where,e.tableDef,t)].filter(g=>g.length>0).join(" "),bindValues:t};if(e._tag==="RowQuery"){const p=e.tableDef.sqliteDef.columns.id;if(p===void 0)throw new Error("Column id not found for ROW query");const g=e.id===np?e.id:ms(p.schema)(e.id);return{query:`SELECT * FROM '${e.tableDef.sqliteDef.name}' WHERE id = ?`,bindValues:[g]}}const r=`SELECT ${e.select.columns.length===0?"*":e.select.columns.join(", ")}`,s=`FROM '${e.tableDef.sqliteDef.name}'`,o=fh(e.where,e.tableDef,t),a=e.orderBy.length>0?`ORDER BY ${e.orderBy.map(({col:p,direction:g})=>`${p} ${g}`).join(", ")}`:"",u=e.limit._tag==="Some"?"LIMIT ?":"",f=e.offset._tag==="Some"?"OFFSET ?":"";return e.offset._tag==="Some"&&t.push(e.offset.value),e.limit._tag==="Some"&&t.push(e.limit.value),{query:[r,s,o,a,f,u].map(p=>p.trim()).filter(p=>p.length>0).join(" "),bindValues:t}},En=(e,t=Roe(e))=>{const n={select(){rl(t);const r=[...arguments];if(r.length===1){const[o]=r;return En(e,{...t,resultSchemaSingle:t.resultSchemaSingle.pipe(nu(o)),select:{columns:[o]}})}const s=r;return En(e,{...t,resultSchemaSingle:s.length===0?t.resultSchemaSingle:t.resultSchemaSingle.pipe(yf(...s)),select:{columns:s}})},where:function(){if(t._tag==="InsertQuery")return sl("Cannot use where with insert");if(t._tag==="RowQuery")return sl("Cannot use where with row");if(arguments.length===1){const f=arguments[0],h=Object.entries(f).filter(([,p])=>p!==void 0).map(([p,g])=>ne(g,"op")&&ne(g,"value")?{col:p,op:g.op,value:g.value}:{col:p,op:"=",value:g});switch(t._tag){case"CountQuery":case"SelectQuery":case"UpdateQuery":case"DeleteQuery":return En(e,{...t,where:[...t.where,...h]});default:return bo(t)}}const[r,s,o]=arguments,a=o===void 0?"=":s,u=o===void 0?s:o;switch(t._tag){case"CountQuery":case"SelectQuery":case"UpdateQuery":case"DeleteQuery":return En(e,{...t,where:[...t.where,{col:r,op:a,value:u}]});default:return bo(t)}},orderBy(){if(rl(t),arguments.length===0||arguments.length>2)return sl();if(arguments.length===1){const o=arguments[0];return En(e,{...t,orderBy:[...t.orderBy,...o]})}const[r,s]=arguments;return En(e,{...t,orderBy:[...t.orderBy,{col:r,direction:s}]})},limit:r=>(rl(t),En(e,{...t,limit:W(r)})),offset:r=>(rl(t),En(e,{...t,offset:W(r)})),count:()=>Aoe(t)||t._tag==="InsertQuery"||t._tag==="UpdateQuery"||t._tag==="DeleteQuery"?sl():En(e,{_tag:"CountQuery",tableDef:e,where:t.where,resultSchema:te({count:st}).pipe(nu("count"),Oe,dl())}),first:r=>(rl(t),t.limit._tag==="Some"?sl(".first() can't be called after .limit()"):En(e,{...t,limit:W(1),pickFirst:(r==null?void 0:r.fallback)!==void 0&&r.fallback!=="throws"?{fallback:r.fallback}:"throws"})),insert:r=>{const s=Object.fromEntries(Object.entries(r).filter(([,o])=>o!==void 0));return En(e,{_tag:"InsertQuery",tableDef:e,values:s,onConflict:void 0,returning:void 0,resultSchema:ps})},onConflict:(r,s,o)=>{const a=Array.isArray(r)?r:[r];Ooe(t);const u=Bx(s).pipe(gy("ignore",()=>({targets:a,action:{_tag:"ignore"}})),gy("replace",()=>({targets:a,action:{_tag:"replace"}})),gy("update",()=>({targets:a,action:{_tag:"update",update:o}})),Hx);return En(e,{...t,onConflict:u})},returning:(...r)=>(qoe(t),En(e,{...t,returning:r,resultSchema:e.rowSchema.pipe(yf(...r),Oe)})),update:r=>{const s=Object.fromEntries(Object.entries(r).filter(([,o])=>o!==void 0));return En(e,{_tag:"UpdateQuery",tableDef:e,values:s,where:[],returning:void 0,resultSchema:ps})},delete:()=>En(e,{_tag:"DeleteQuery",tableDef:e,where:[],returning:void 0,resultSchema:ps})};return{[Sa]:Sa,[Rf]:t,ResultType:"only-for-type-inference",asSql:()=>HC(t),toString:()=>{try{return HC(t).query}catch(r){return console.debug("QueryBuilder.toString(): Error converting query builder to string",r,t),"Error converting query builder to string"}},...n}},Roe=e=>({_tag:"SelectQuery",columns:[],pickFirst:!1,select:{columns:[]},orderBy:[],offset:V(),limit:V(),tableDef:e,where:[],resultSchemaSingle:e.rowSchema});function rl(e){if(e._tag!=="SelectQuery")return $e("Expected SelectQuery but got "+e._tag)}function Ooe(e){if(e._tag!=="InsertQuery")return $e("Expected InsertQuery but got "+e._tag)}function qoe(e){if(e._tag!=="InsertQuery"&&e._tag!=="UpdateQuery"&&e._tag!=="DeleteQuery")return $e("Expected WriteQuery but got "+e._tag)}const Aoe=e=>e._tag==="RowQuery",sl=e=>$e("Invalid query builder"+(e?`: ${e}`:"")),u2=e=>{const t=e[Rf];switch(t._tag){case"SelectQuery":{const n=Oe(t.resultSchemaSingle);if(t.pickFirst===!1)return n;if(t.pickFirst==="throws")return n.pipe(dl());{const r=t.pickFirst.fallback();return we(n,rte(xe(r))).pipe(dl(()=>r))}}case"CountQuery":return te({count:st}).pipe(nu("count"),Oe,dl());case"InsertQuery":case"UpdateQuery":case"DeleteQuery":return t.returning&&t.returning.length>0?t.tableDef.rowSchema.pipe(yf(...t.returning),Oe):st;case"RowQuery":return t.tableDef.rowSchema.pipe(nu("value"),mte({title:`${t.tableDef.sqliteDef.name}.value`}),Oe,dl());default:bo(t)}},{datetime:VC,integer:Poe,json:Foe,text:pl}=Eoe,qo=e=>{const{name:t,columns:n,...r}=e,s=t,o={isClientDocumentTable:!1},a=n2(n)?{value:n}:n,u=i2(s,a,(r==null?void 0:r.indexes)??[]),f=a2(u),h=c2(u),p={sqliteDef:u,options:o,rowSchema:f,insertSchema:h},g=En(p);for(const k of Object.keys(g))p[k]=g[k];return p[Rf]=g[Rf],p[Sa]=g[Sa],p},I_="__livestore_schema",xoe=qo({name:I_,columns:{tableName:Hr({primaryKey:!0}),schemaHash:ir({nullable:!1}),updatedAt:Hr({nullable:!1})}}),rp="__livestore_schema_event_defs",l2=qo({name:rp,columns:{eventName:Hr({primaryKey:!0}),schemaHash:ir({nullable:!1}),updatedAt:Hr({nullable:!1})}}),Of="__livestore_session_changeset",sp=qo({name:Of,columns:{seqNumGlobal:ir({schema:ou}),seqNumClient:ir({schema:tp}),changeset:s2({nullable:!0}),debug:YE({nullable:!0})},indexes:[{columns:["seqNumGlobal","seqNumClient"],name:"idx_session_changeset_id"}]}),ZE="__livestore_leader_merge_counter",Noe=qo({name:ZE,columns:{id:ir({primaryKey:!0,schema:xe(0)}),mergeCounter:ir({primaryKey:!0})}}),qf=[xoe,l2,sp,Noe],Doe=e=>qf.some(t=>t.sqliteDef.name===e),Os="eventlog",Af=qo({name:Os,columns:{seqNumGlobal:ir({primaryKey:!0,schema:ou}),seqNumClient:ir({primaryKey:!0,schema:tp}),parentSeqNumGlobal:ir({schema:ou}),parentSeqNumClient:ir({schema:tp}),name:Hr({}),argsJson:Hr({schema:Ts(mn)}),clientId:Hr({}),sessionId:Hr({}),schemaHash:ir({}),syncMetadataJson:Hr({schema:Ts(Wi(wo))})},indexes:[{columns:["seqNumGlobal"],name:"idx_eventlog_seqNumGlobal"},{columns:["seqNumGlobal","seqNumClient"],name:"idx_eventlog_seqNum"}]}),Pf="__livestore_sync_status",Moe=qo({name:Pf,columns:{head:ir({primaryKey:!0})}}),Loe=[Af,Moe],WC=we(L,st,dN,wE);we(Oe(WC),Uu({key:L,value:WC})).pipe(lte("PreparedBindValues"));const vt=(e,...t)=>{let n="";for(const[r,s]of t.entries())n+=e[r]+String(s);return n+e[e.length-1]},Ki=(e,t)=>{if(Array.isArray(e))return e;const n={};for(const[r,s]of Object.entries(e))t.includes(r)&&(n[`$${r}`]=s);return n},Mh=(e,t,n)=>{const r=e.prepare(t),s=n?Ki(n,t):void 0;r.execute(s),r.finalize()},f2=(e,t,n)=>{const r=e.prepare(t),s=r.select(void 0);return r.finalize(),s},joe=(e,t)=>z(function*(){const n=t.getEventDefInfos(),r=n.filter(s=>!e.eventsDefsMap.has(s.eventName));r.length>0&&(yield*new Ne({cause:`Missing mutation definitions: ${r.map(s=>s.eventName).join(", ")}`}));for(const[,s]of e.eventsDefsMap){const o=n.find(a=>a.eventName===s.name);Uoe(s,t,o)}}),Uoe=(e,t,n)=>{const r=KE(e.schema);if(n===void 0){t.setEventDefInfo({schemaHash:r,eventName:e.name});return}r!==n.schemaHash&&t.setEventDefInfo({schemaHash:r,eventName:e.name})},zoe=Lre(()=>new Date().toISOString()),Boe=e=>z(function*(){return yield*op({db:e,tableAst:l2.sqliteDef.ast,behaviour:"create-if-not-exists"}),{getEventDefInfos:()=>f2(e,vt`SELECT * FROM ${rp}`),setEventDefInfo:t=>{Mh(e,vt`INSERT OR REPLACE INTO ${rp} (eventName, schemaHash, updatedAt) VALUES ($eventName, $schemaHash, $updatedAt)`,{eventName:t.eventName,schemaHash:t.schemaHash,updatedAt:new Date().toISOString()})}}}),Hoe=({db:e,schema:t,onProgress:n})=>z(function*(){for(const g of qf)yield*op({db:e,tableAst:g.sqliteDef.ast,behaviour:"create-if-not-exists"});const r=yield*Boe(e);yield*joe(t,r);const s=f2(e,vt`SELECT * FROM ${I_}`),o=Object.fromEntries(s.map(({tableName:g,schemaHash:k})=>[g,k])),a=[...qf,...Array.from(t.state.sqlite.tables.values()).filter(g=>!Doe(g.sqliteDef.name))],u=new Set,f=[];for(const g of a){const k=g.sqliteDef.ast,T=k.name,O=o[T],D=XE(k);D!==O&&(u.add({tableAst:k,schemaHash:D}),f.push({tableName:T,hashes:{expected:D,actual:O}}))}let h=0;const p=u.size;for(const{tableAst:g,schemaHash:k}of u)yield*op({db:e,tableAst:g,schemaHash:k,behaviour:"create-if-not-exists"}),n!==void 0&&(h++,yield*n({done:h,total:p}));return{migrations:f}}),op=({db:e,tableAst:t,schemaHash:n=XE(t),behaviour:r,skipMetaTable:s=!1})=>z(function*(){const o=t.name,a=Woe(t);Mh(e,vt`create table if not exists '${o}' (${a}) strict`);for(const u of t.indexes)Mh(e,Voe(o,u));if(s!==!0){const u=zoe();Mh(e,vt`
      INSERT INTO ${I_} (tableName, schemaHash, updatedAt) VALUES ($tableName, $schemaHash, $updatedAt)
        ON CONFLICT (tableName) DO UPDATE SET schemaHash = $schemaHash, updatedAt = $updatedAt;
    `,{tableName:o,schemaHash:n,updatedAt:u})}}).pipe(Ie("@livestore/common:migrateTable",{attributes:{"span.label":t.name,tableName:t.name}})),Voe=(e,t)=>{const n=t.unique?"UNIQUE":"";return vt`create ${n} index if not exists '${t.name}' on '${e}' (${t.columns.join(", ")})`},Woe=e=>{const t=e.columns.filter(r=>r.primaryKey).map(r=>`'${r.name}'`),n=e.columns.map(Koe);return t.length>0&&n.push(`PRIMARY KEY (${t.join(", ")})`),n.join(", ")},Koe=e=>{const t=e.type._tag,n=e.nullable===!1?"not null":"",r=(()=>{if(e.default._tag==="None")return"";if(e.default.value===null)return"default null";if(r2(e.default.value))return`default ${e.default.value.sql}`;const o=ms(e.schema)(e.default.value);return t==="text"?`default '${o}'`:`default ${o}`})();return`'${e.name}' ${t} ${n} ${r}`},e0=e=>{const{name:t,schema:n,...r}=e,s=o=>{const a=Gee(n)(o);return a._tag==="Left"&&$e(`Invalid event args for event '${t}':`,a.left.message,`
`),{name:t,args:o}};return Object.defineProperty(s,"name",{value:t}),Object.defineProperty(s,"schema",{value:n}),Object.defineProperty(s,"encoded",{value:o=>({name:t,args:o})}),Object.defineProperty(s,"options",{value:{clientOnly:(r==null?void 0:r.clientOnly)??!1,facts:r!=null&&r.facts?(o,a)=>{var f,h;const u=r.facts(o,a);return{modify:{set:(f=u.modify)!=null&&f.set?new Set(u.modify.set):new Set,unset:(h=u.modify)!=null&&h.unset?new Set(u.modify.unset):new Set},require:u.require?new Set(u.require):new Set}}:void 0,derived:(r==null?void 0:r.derived)??!1}}),s},t0=e=>e0({...e,clientOnly:!1}),d2=(e,t)=>t,Joe=(e,t)=>t,ip=e0({name:"livestore.RawSql",schema:te({sql:L,bindValues:Yt(Uu({key:L,value:mn})),writeTables:Yt(Vte(L))}),clientOnly:!0,derived:!0}),Goe=d2(ip,({sql:e,bindValues:t,writeTables:n})=>({sql:e,bindValues:t??{},writeTables:n})),Qoe=({name:e,schema:t,...n})=>{const r={partialSet:n.partialSet??!0,default:{id:n.default.id,value:n.default.value}},s={id:Hr({primaryKey:!0}),value:YE({schema:t})},o=qo({name:e,columns:s});o.options.isClientDocumentTable=!0;const{eventDef:a,materializer:u}=Xoe({name:e,valueSchema:t,defaultValue:r.default.value,partialSet:r.partialSet}),f=(...g)=>{const[k,T=r.default.id]=g;return a({id:T,value:k})};Object.defineProperty(f,"name",{value:`${e}Set`}),Object.defineProperty(f,"schema",{value:te({id:L,value:r.partialSet?Wm(t):t}).annotations({title:`${e}Set:Args`})}),Object.defineProperty(f,"options",{value:{derived:!0,clientOnly:!0,facts:void 0}});const h={get:Zoe(()=>p),set:f,Value:"only-for-type-inference",default:r.default,valueSchema:t,[Ff]:{derived:{setEventDef:a,setMaterializer:u},options:r}},p={...o,...h};return p},Yoe=(e,t)=>typeof e!="object"||typeof t!="object"||e===null||t===null?t:Object.keys(e).reduce((n,r)=>(n[r]=t[r]??e[r],n),{}),Xoe=({name:e,valueSchema:t,defaultValue:n,partialSet:r})=>{const s=e0({name:`${e}Set`,schema:te({id:we(L,Yee(np)),value:r?Wm(t):t}).annotations({title:`${e}Set:Args`}),clientOnly:!0,derived:!0}),o=d2(s,({id:a,value:u})=>{if(a===np)return $e("SessionIdSymbol needs to be replaced before materializing the set event");if(yh(t.ast).length===0||r===!1){const h=Ts(t),p=lh(h)(u??n),g=lh(h)(u);return{sql:`INSERT INTO '${e}' (id, value) VALUES (?, ?) ON CONFLICT (id) DO UPDATE SET value = ?`,bindValues:[a,p,g],writeTables:new Set([e])}}else{const h=Ts(Wm(t)),p=lh(h)(Yoe(n,u));let g="value";const k=[],T=Object.keys(u),O=t.pipe(yf(...T)),D=lh(O)(u);for(const _ in D){const C=D[_];C!==void 0&&(g=`json_set(${g}, ?, json(?))`,k.push(`$.${_}`,JSON.stringify(C)))}const E=k.length>0?`ON CONFLICT (id) DO UPDATE SET value = ${g}`:"ON CONFLICT (id) DO NOTHING";return{sql:`
      INSERT INTO '${e}' (id, value)
      VALUES (?, ?)
      ${E}
    `,bindValues:[a,p,...k],writeTables:new Set([e])}}});return{eventDef:s,materializer:o}},h2=e=>e.options.isClientDocumentTable===!0,Zoe=e=>(...t)=>{const n=e(),[r=n[Ff].options.default.id,s={}]=t,o=s.default??n[Ff].options.default.value,a={_tag:"RowQuery",tableDef:n,id:r,explicitDefaultValues:o},u=vt`SELECT * FROM '${n.sqliteDef.name}' WHERE id = ?`;return{[Sa]:Sa,[Rf]:a,ResultType:"only-for-type-inference",asSql:()=>({query:u,bindValues:[r]}),toString:()=>u.toString()}},Ff=Symbol("ClientDocumentTableDef"),eie=Symbol.for("livestore.LiveStoreSchema"),tie=e=>{var s;const t=e.state,n=e.state.sqlite.tables;for(const o of qf)n.set(o.sqliteDef.name,o);const r=new Map;if(NN(e.events))for(const o of e.events)r.set(o.name,o);else for(const o of Object.values(e.events??{}))r.has(o.name)&&$e(`Duplicate event name: ${o.name}. Please use unique names for events.`),r.set(o.name,o);r.set(ip.name,ip);for(const o of n.values())h2(o)&&r.has(o.set.name)===!1&&r.set(o.set.name,o.set);return{LiveStoreSchemaSymbol:eie,_DbSchemaType:Symbol.for("livestore.DbSchemaType"),_EventDefMapType:Symbol.for("livestore.EventDefMapType"),state:t,eventsDefsMap:r,devtools:{alias:((s=e.devtools)==null?void 0:s.alias)??"default"}}},Yo=(e,t)=>{const n=e.eventsDefsMap.get(t);if(n===void 0)return $e(`No mutation definition found for \`${t}\`.`);const r=e.state.materializers.get(t);return r===void 0?$e(`No materializer found for \`${t}\`.`):{eventDef:n,materializer:r}},m2=({eventDef:e,materializer:t,dbState:n,event:r})=>{var f;const s=r.decoded===void 0?Lm(e.schema)(r.encoded.args):r.decoded.args,o=Are((f=r.decoded)==null?void 0:f.args)?void 0:Nx(e.schema)(r.decoded.args);return p2(t(s,{eventDef:e,query:h=>{if(T_(h)){const{query:p,bindValues:g}=h.asSql(),k=n.select(p,Ki(g,p)),T=u2(h);return _E(T)(k)}else{const{query:p,bindValues:g}=h;return n.select(p,Ki(g,p))}},currentFacts:new Map})).map(h=>{const p=h.sql,g=typeof h=="string"?o:h.bindValues,k=typeof h=="string"?void 0:h.writeTables;return{statementSql:p,bindValues:Ki(g??{},p),writeTables:k}})},nie=({schema:e,dbState:t})=>n=>{if(S_()){const{eventDef:r,materializer:s}=Yo(e,n.name),o=m2({eventDef:r,materializer:s,dbState:t,event:{decoded:void 0,encoded:n}});return W($t(JSON.stringify(o)))}return V()},rie=e=>$t(JSON.stringify(e)),p2=e=>{if(NN(e))return e.flatMap(p2);if(T_(e)){const{query:t,bindValues:n}=e.asSql();return[{sql:t,bindValues:n,writeTables:void 0}]}else return typeof e=="string"?[{sql:e,bindValues:{},writeTables:void 0}]:[{sql:e.sql,bindValues:e.bindValues,writeTables:e.writeTables}]},sie=e=>{const t=Array.isArray(e.tables)?e.tables:Object.values(e.tables),n=new Map;for(const o of t){const a=o.sqliteDef;n.has(a.ast.name)&&$e(`Duplicate table name: ${a.ast.name}. Please use unique names for tables.`),n.set(a.ast.name,o)}for(const o of qf)n.set(o.sqliteDef.name,o);const r=new Map;for(const[o,a]of Object.entries(e.materializers))r.set(o,a);r.set(ip.name,Goe);for(const o of t)h2(o)&&r.set(o[Ff].derived.setEventDef.name,o[Ff].derived.setMaterializer);const s=XE({_tag:"dbSchema",tables:[...n.values()].map(o=>o.sqliteDef.ast)});return{sqlite:{tables:n,migrations:e.migrations??{strategy:"auto"},hash:s},materializers:r}};te({name:L,args:mn,seqNum:vn,parentSeqNum:vn,clientId:L,sessionId:L}).annotations({title:"LiveStoreEvent.AnyDecoded"});const oie=te({name:L,args:mn,seqNum:vn,parentSeqNum:vn,clientId:L,sessionId:L}).annotations({title:"LiveStoreEvent.AnyEncoded"}),n0=te({name:L,args:mn,seqNum:ou,parentSeqNum:ou,clientId:L,sessionId:L}).annotations({title:"LiveStoreEvent.AnyEncodedGlobal"}),iie=te({name:L,args:mn}),aie=e=>we(...[...e.eventsDefsMap.values()].map(t=>te({name:xe(t.name),args:t.schema,seqNum:vn,parentSeqNum:vn,clientId:L,sessionId:L}))).annotations({title:"EventDef"}),xl=class xl extends Pa("LiveStoreEvent.EncodedWithMeta")({name:L,args:mn,seqNum:vn,parentSeqNum:vn,clientId:L,sessionId:L,meta:te({sessionChangeset:we(me("sessionChangeset",{data:dN,debug:mn.pipe(Yt)}),me("no-op",{}),me("unset",{})),syncMetadata:Wi(wo),materializerHashLeader:Wi(st),materializerHashSession:Wi(st)}).pipe(fte,Yt,oN({constructor:()=>({sessionChangeset:{_tag:"unset"},syncMetadata:V(),materializerHashLeader:V(),materializerHashSession:V()}),decoding:()=>({sessionChangeset:{_tag:"unset"},syncMetadata:V(),materializerHashLeader:V(),materializerHashSession:V()})}))}){constructor(){super(...arguments);d(this,"toJSON",()=>({seqNum:`${lr(this.seqNum)}  ${lr(this.parentSeqNum)} (${this.clientId}, ${this.sessionId})`,name:this.name,args:this.args}));d(this,"rebase",(n,r)=>new xl({...this,...GE(n,r)}));d(this,"toGlobal",()=>({...this,seqNum:this.seqNum.global,parentSeqNum:this.parentSeqNum.global}))}};d(xl,"fromGlobal",(n,r)=>new xl({...n,seqNum:{global:n.seqNum,client:ai},parentSeqNum:{global:n.parentSeqNum,client:ai},meta:{sessionChangeset:{_tag:"unset"},syncMetadata:r.syncMetadata,materializerHashLeader:r.materializerHashLeader,materializerHashSession:r.materializerHashSession}}));let In=xl;const g2=(e,t)=>e.seqNum.global===t.seqNum.global&&e.seqNum.client===t.seqNum.client&&e.name===t.name&&e.clientId===t.clientId&&e.sessionId===t.sessionId&&JSON.stringify(e.args)===JSON.stringify(t.args),cie=({dbEventlog:e,schema:t,onProgress:n,materializeEvent:r})=>z(function*(){const s=e.select(`SELECT COUNT(*) AS count FROM ${Os}`)[0].count,o=jre(p=>KE(p.schema)),a=p=>z(function*(){const g=Yo(t,p.name);o(g.eventDef)!==p.schemaHash&&(yield*Ks(`Schema hash mismatch for event definition ${p.name}. Trying to materialize event anyway.`));const k=JSON.parse(p.argsJson);yield*tu(g.eventDef.schema)(k).pipe(mo(O=>Ne.make({cause:O,note:`There was an error during rematerializing from the eventlog while decoding
the persisted event args for event definition "${p.name}".
This likely means the schema has changed in an incompatible way.
`})));const T=In.make({seqNum:{global:p.seqNumGlobal,client:p.seqNumClient},parentSeqNum:{global:p.parentSeqNumGlobal,client:p.parentSeqNumClient},name:p.name,args:k,clientId:p.clientId,sessionId:p.sessionId});yield*r(T,{skipEventlog:!0})}).pipe(Ie("@livestore/common:rematerializeFromEventlog:processEvent")),f=e.prepare(vt`\
SELECT * FROM ${Os} 
WHERE seqNumGlobal > $seqNumGlobal OR (seqNumGlobal = $seqNumGlobal AND seqNumClient > $seqNumClient)
ORDER BY seqNumGlobal ASC, seqNumClient ASC
LIMIT ${100}
`);let h=0;yield*Cne({_tag:"Initial "},p=>{if(Li(p)&&p.length===0)return V();const g=Li(p)?jU(p).pipe(Wo(O=>({global:O.seqNumGlobal,client:O.seqNumClient})),gt(()=>Jr)):Jr,k=ao(f.select({$seqNumGlobal:g==null?void 0:g.global,$seqNumClient:g==null?void 0:g.client})),T=Li(p)?p:_t();return W([T,k])}).pipe(fne({capacity:2}),Sn(p=>z(function*(){yield*a(p),h++,yield*n({done:h,total:s})})),on)}).pipe(zE("@livestore/common:rematerializeFromEventlog"),Ie("@livestore/common:rematerializeFromEventlog"));class Xce extends Fr()("IsOfflineError",{}){}class uie extends Fr()("InvalidPushError",{reason:we(me("Unexpected",{message:L}),me("ServerAhead",{minimumExpectedNum:st,providedNum:st}))}){}class lie extends Fr()("InvalidPullError",{message:L}){}class r0 extends Fr()("LeaderAheadError",{minimumExpectedNum:vn,providedNum:vn}){}class fs extends Pa("SyncState")({pending:Oe(In),upstreamHead:vn,localHead:vn}){constructor(){super(...arguments);d(this,"toJSON",()=>({pending:this.pending.map(n=>n.toJSON()),upstreamHead:lr(this.upstreamHead),localHead:lr(this.localHead)}))}}class ap extends me("upstream-rebase",{rollbackEvents:Oe(In),newEvents:Oe(In)}){}class Ji extends me("upstream-advance",{newEvents:Oe(In)}){}class fie extends me("local-push",{newEvents:Oe(In)}){}class die extends we(ap,Ji,fie){}class _2 extends we(ap,Ji){}class R_ extends Pa("MergeContext")({payload:die,syncState:fs}){constructor(){super(...arguments);d(this,"toJSON",()=>({payload:Bx(this.payload).pipe(_y("local-push",()=>({_tag:"local-push",newEvents:this.payload.newEvents.map(r=>r.toJSON())})),_y("upstream-advance",()=>({_tag:"upstream-advance",newEvents:this.payload.newEvents.map(r=>r.toJSON())})),_y("upstream-rebase",r=>({_tag:"upstream-rebase",newEvents:r.newEvents.map(s=>s.toJSON()),rollbackEvents:r.rollbackEvents.map(s=>s.toJSON())})),Hx),syncState:this.syncState.toJSON()}))}}class gl extends Pa("MergeResultAdvance")({_tag:xe("advance"),newSyncState:fs,newEvents:Oe(In),confirmedEvents:Oe(In),mergeContext:R_}){constructor(){super(...arguments);d(this,"toJSON",()=>({_tag:this._tag,newSyncState:this.newSyncState.toJSON(),newEvents:this.newEvents.map(n=>n.toJSON()),confirmedEvents:this.confirmedEvents.map(n=>n.toJSON()),mergeContext:this.mergeContext.toJSON()}))}}class pS extends Pa("MergeResultRebase")({_tag:xe("rebase"),newSyncState:fs,newEvents:Oe(In),rollbackEvents:Oe(In),mergeContext:R_}){constructor(){super(...arguments);d(this,"toJSON",()=>({_tag:this._tag,newSyncState:this.newSyncState.toJSON(),newEvents:this.newEvents.map(n=>n.toJSON()),rollbackEvents:this.rollbackEvents.map(n=>n.toJSON()),mergeContext:this.mergeContext.toJSON()}))}}class y2 extends Pa("MergeResultReject")({_tag:xe("reject"),expectedMinimumId:vn,mergeContext:R_}){constructor(){super(...arguments);d(this,"toJSON",()=>({_tag:this._tag,expectedMinimumId:lr(this.expectedMinimumId),mergeContext:this.mergeContext.toJSON()}))}}class b2 extends Pa("MergeResultUnexpectedError")({_tag:xe("unexpected-error"),cause:Ne}){}class Zce extends we(gl,pS,y2,b2){}const gS=e=>{if(Rs)debugger;return b2.make({_tag:"unexpected-error",cause:new Ne({cause:e})})},S2=({syncState:e,payload:t,isClientEvent:n,isEqualEvent:r,ignoreClientEvents:s=!1})=>{var a,u,f;w2(e),hie(t);const o=R_.make({payload:t,syncState:e});switch(t._tag){case"upstream-rebase":{const h=[...t.rollbackEvents,...e.pending],p=((a=t.newEvents.at(-1))==null?void 0:a.seqNum)??e.upstreamHead,g=KC({events:e.pending,baseEventSequenceNumber:p,isClientEvent:n});return Si(pS.make({_tag:"rebase",newSyncState:new fs({pending:g,upstreamHead:p,localHead:((u=g.at(-1))==null?void 0:u.seqNum)??p}),newEvents:[...t.newEvents,...g],rollbackEvents:h,mergeContext:o}))}case"upstream-advance":{if(t.newEvents.length===0)return Si(gl.make({_tag:"advance",newSyncState:new fs({pending:e.pending,upstreamHead:e.upstreamHead,localHead:e.localHead}),newEvents:[],confirmedEvents:[],mergeContext:o}));for(let g=1;g<t.newEvents.length;g++)if(Nh(t.newEvents[g-1].seqNum,t.newEvents[g].seqNum))return gS(`Events must be sorted in ascending order by event number. Received: [${t.newEvents.map(k=>lr(k.seqNum)).join(", ")}]`);if(Nh(e.upstreamHead,t.newEvents[0].seqNum)||$_(e.upstreamHead,t.newEvents[0].seqNum))return gS(`Incoming events must be greater than upstream head. Expected greater than: ${lr(e.upstreamHead)}. Received: [${t.newEvents.map(g=>lr(g.seqNum)).join(", ")}]`);const h=t.newEvents.at(-1).seqNum,p=_S({existingEvents:e.pending,incomingEvents:t.newEvents,isEqualEvent:r,isClientEvent:n,ignoreClientEvents:s});if(p===-1){const g=new Set(e.pending.map(E=>`${E.seqNum.global},${E.seqNum.client}`)),k=t.newEvents.filter(E=>!g.has(`${E.seqNum.global},${E.seqNum.client}`));let T=0;const[O,D]=j1(e.pending,(E,S)=>{if(s&&n(E))return T++,!1;const _=t.newEvents.at(S-T);return _?r(E,_)===!1:!0});return Si(gl.make({_tag:"advance",newSyncState:new fs({pending:D,upstreamHead:h,localHead:((f=D.at(-1))==null?void 0:f.seqNum)??t2(e.localHead,h)}),newEvents:k,confirmedEvents:O,mergeContext:o}))}else{const g=e.pending.slice(p),k=KC({events:g,baseEventSequenceNumber:h,isClientEvent:n}),T=_S({existingEvents:t.newEvents,incomingEvents:e.pending,isEqualEvent:r,isClientEvent:n,ignoreClientEvents:s});return Si(pS.make({_tag:"rebase",newSyncState:new fs({pending:k,upstreamHead:h,localHead:k.at(-1).seqNum}),newEvents:[...t.newEvents.slice(T),...k],rollbackEvents:g,mergeContext:o}))}}case"local-push":{if(t.newEvents.length===0)return Si(gl.make({_tag:"advance",newSyncState:e,newEvents:[],confirmedEvents:[],mergeContext:o}));const h=t.newEvents.at(0);if(Nh(h.seqNum,e.localHead)===!1){const g=GE(e.localHead,!0).seqNum;return Si(y2.make({_tag:"reject",expectedMinimumId:g,mergeContext:o}))}else return Si(gl.make({_tag:"advance",newSyncState:new fs({pending:[...e.pending,...t.newEvents],upstreamHead:e.upstreamHead,localHead:t.newEvents.at(-1).seqNum}),newEvents:t.newEvents,confirmedEvents:[],mergeContext:o}))}default:bo(t)}},_S=({existingEvents:e,incomingEvents:t,isEqualEvent:n,isClientEvent:r,ignoreClientEvents:s})=>{if(s){const o=e.filter(f=>!r(f)),a=_S({existingEvents:o,incomingEvents:t,isEqualEvent:n,isClientEvent:r,ignoreClientEvents:!1});if(a===-1)return-1;const u=e[a].seqNum;return e.findIndex(f=>$_(f.seqNum,u))}return e.findIndex((o,a)=>{const u=t[a];return u&&!n(o,u)})},KC=({events:e,baseEventSequenceNumber:t,isClientEvent:n})=>{let r=t;return e.map(s=>{const o=n(s),a=s.rebase(r,o);return r=a.seqNum,a})},hie=e=>{for(let t=1;t<e.newEvents.length;t++)if(ba(e.newEvents[t-1].seqNum,e.newEvents[t].seqNum))return gS(`Events must be ordered in monotonically ascending order by eventNum. Received: [${e.newEvents.map(n=>lr(n.seqNum)).join(", ")}]`)},w2=e=>{for(let t=0;t<e.pending.length;t++){const n=e.pending[t],r=e.pending[t+1];if(r===void 0)break;ba(n.seqNum,r.seqNum)&&$e(`Events must be ordered in monotonically ascending order by eventNum. Received: [${e.pending.map(o=>lr(o.seqNum)).join(", ")}]`,{event:n,nextEvent:r}),r.seqNum.global>n.seqNum.global?r.seqNum.client!==0&&$e(`New global events must point to clientId 0 in the parentSeqNum. Received: (${lr(r.seqNum)})`,e.pending,{event:n,nextEvent:r}):$_(r.parentSeqNum,n.seqNum)===!1&&$e("Events must be linked in a continuous chain via the parentSeqNum",e.pending,{event:n,nextEvent:r})}},Si=e=>(e._tag==="unexpected-error"||e._tag==="reject"||(w2(e.newSyncState),Nh(e.newSyncState.upstreamHead,e.newSyncState.localHead)&&$e("Local head must be greater than or equal to upstream head",{localHead:e.newSyncState.localHead,upstreamHead:e.newSyncState.upstreamHead}),ba(e.newSyncState.localHead,e.mergeContext.syncState.localHead)===!1&&$e("New local head must be greater than or equal to the previous local head",{localHead:e.newSyncState.localHead,previousLocalHead:e.mergeContext.syncState.localHead}),ba(e.newSyncState.upstreamHead,e.mergeContext.syncState.upstreamHead)===!1&&$e("New upstream head must be greater than or equal to the previous upstream head",{upstreamHead:e.newSyncState.upstreamHead,previousUpstreamHead:e.mergeContext.syncState.upstreamHead})),e),mie="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let so=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=mie[n[e]&63];return t};const O_="0.3.1",JC=4,pie=te({isConnected:ga,timestampMs:st,latchClosed:ga}),Lh=L,gie=L,jh=xe(O_),v2=(e,t)=>me(e,{liveStoreVersion:jh,...t}).annotations({identifier:e}),_ie=(e,t)=>v2(e,{clientId:gie,...t}),Nt=(e,t)=>_ie(e,{requestId:Lh,...t}),s0=(e,t)=>{const n=me(`${e}.Response.Success`,{requestId:Lh,liveStoreVersion:jh,...t.success}).annotations({identifier:`${e}.Response.Success`}),r=t.error?me(`${e}.Response.Error`,{requestId:Lh,liveStoreVersion:jh,...t.error}).annotations({identifier:`${e}.Response.Error`}):d_;return{Request:me(`${e}.Request`,{requestId:Lh,liveStoreVersion:jh,...t.payload}).annotations({identifier:`${e}.Request`}),Response:we(n,r),Success:n,Error:r}};class eue extends Nt("LSD.Leader.ResetAllDataReq",{mode:xe("all-data","only-app-db")}){}class yie extends Nt("LSD.Leader.DatabaseFileInfoReq",{}){}class GC extends te({fileSize:st,persistenceInfo:te({fileName:L},{key:L,value:mn})}){}class E2 extends Nt("LSD.Leader.DatabaseFileInfoRes",{state:GC,eventlog:GC}){}class bie extends Nt("LSD.Leader.NetworkStatusSubscribe",{subscriptionId:L}){}class Sie extends Nt("LSD.Leader.NetworkStatusUnsubscribe",{subscriptionId:L}){}class k2 extends Nt("LSD.Leader.NetworkStatusRes",{networkStatus:pie,subscriptionId:L}){}class wie extends Nt("LSD.Leader.SyncingInfoReq",{}){}class $2 extends te({enabled:ga,metadata:Uu({key:L,value:mn})}){}class C2 extends Nt("LSD.Leader.SyncingInfoRes",{syncingInfo:$2}){}class vie extends Nt("LSD.Leader.SyncHistorySubscribe",{subscriptionId:L}){}class Eie extends Nt("LSD.Leader.SyncHistoryUnsubscribe",{subscriptionId:L}){}class T2 extends Nt("LSD.Leader.SyncHistoryRes",{eventEncoded:n0,metadata:Wi(wo),subscriptionId:L}){}class kie extends Nt("LSD.Leader.SyncHeadSubscribe",{subscriptionId:L}){}class $ie extends Nt("LSD.Leader.SyncHeadUnsubscribe",{subscriptionId:L}){}class I2 extends Nt("LSD.Leader.SyncHeadRes",{local:vn,upstream:vn,subscriptionId:L}){}class Cie extends Nt("LSD.Leader.SnapshotReq",{}){}class R2 extends Nt("LSD.Leader.SnapshotRes",{snapshot:Tc}){}const fc=s0("LSD.Leader.LoadDatabaseFile",{payload:{data:Tc},success:{},error:{cause:we(me("unsupported-file",{}),me("unsupported-database",{}),me("unexpected-error",{cause:ya}))}});class O2 extends v2("LSD.Leader.SyncPull",{payload:_2}){}class Tie extends Nt("LSD.Leader.CommitEventReq",{eventEncoded:iie}){}class q2 extends Nt("LSD.Leader.CommitEventRes",{}){}class Iie extends Nt("LSD.Leader.EventlogReq",{}){}class A2 extends Nt("LSD.Leader.EventlogRes",{eventlog:Tc}){}let Rie=class extends Nt("LSD.Leader.Ping",{}){},P2=class extends Nt("LSD.Leader.Pong",{}){};class F2 extends Nt("LSD.Leader.Disconnect",{}){}const o0=s0("LSD.Leader.SetSyncLatch",{payload:{closeLatch:ga},success:{}}),i0=s0("LSD.Leader.ResetAllData",{payload:{mode:xe("all-data","only-app-db")},success:{}}),x2=we(Cie,fc.Request,Iie,i0.Request,bie,Sie,F2,Tie,Rie,yie,vie,Eie,wie,kie,$ie,o0.Request).annotations({identifier:"LSD.Leader.MessageToApp"}),Oie=we(R2,fc.Response,A2,F2,O2,k2,q2,P2,E2,T2,C2,I2,i0.Success,o0.Success).annotations({identifier:"LSD.Leader.MessageFromApp"}),qie=we(me("node",{url:L}),me("web",{}),me("browser-extension",{}));qie.pipe(nu("_tag"),Cs);const Aie={client:{session:({storeId:e,clientId:t,sessionId:n})=>`client-session-${e}-${t}-${n}`,leader:({storeId:e,clientId:t})=>`client-leader-${e}-${t}`}},Pie={sessionInfo:()=>"session-info",devtoolsClientSession:({storeId:e,clientId:t,sessionId:n})=>`devtools-channel(client-session-${e}-${t}-${n})`,devtoolsClientLeader:({storeId:e,clientId:t,sessionId:n})=>`devtools-channel(client-leader-${e}-${t}-${n})`},Fie={devtoolsClientSession:(e,{storeId:t,clientId:n,sessionId:r})=>e===Pie.devtoolsClientSession({storeId:t,clientId:n,sessionId:r}),devtoolsClientLeader:(e,{storeId:t,clientId:n})=>e.startsWith(`devtools-channel(client-leader-${t}-${n}`)},Md=L.pipe(Yt,oN({constructor:()=>so(10),decoding:()=>so(10)})),xa={id:Md,target:L,source:L,channelName:L,hops:Oe(L)},N2=Xx.pipe(Yt);class Uh extends me("DirectChannelRequest",{...xa,remainingHops:Oe(L).pipe(Yt),channelVersion:st,reqId:h_(L),sourceId:L}){}class D2 extends me("DirectChannelResponseSuccess",{...xa,reqId:L,port:E_,remainingHops:Oe(L),channelVersion:st}){}class a0 extends me("DirectChannelResponseNoTransferables",{...xa,reqId:L,remainingHops:Oe(L)}){}class M2 extends me("ProxyChannelRequest",{...xa,remainingHops:N2,channelIdCandidate:L}){}class L2 extends me("ProxyChannelResponseSuccess",{...xa,reqId:L,remainingHops:Oe(L),combinedChannelId:L,channelIdCandidate:L}){}class j2 extends me("ProxyChannelPayload",{...xa,remainingHops:N2,payload:mn,combinedChannelId:L}){}class U2 extends me("ProxyChannelPayloadAck",{...xa,reqId:L,remainingHops:Oe(L),combinedChannelId:L}){}class yS extends me("NetworkEdgeAdded",{id:Md,source:L,target:L}){}class bS extends me("NetworkTopologyRequest",{id:Md,hops:Oe(L),source:L,target:xe("-")}){}class SS extends me("NetworkTopologyResponse",{id:Md,reqId:L,remainingHops:Oe(L),nodeName:L,edges:Oe(L),source:L,target:xe("-")}){}const zh=me("BroadcastChannelPacket",{id:Md,channelName:L,payload:mn,hops:Oe(L),source:L,target:xe("-")});class wS extends we(Uh,D2,a0){}class z2 extends we(M2,L2,j2,U2){}class B2 extends we(wS,z2,yS,bS,SS,zh){}class dh extends me("DirectChannelPing",{}){}class hh extends me("DirectChannelPong",{}){}class xie extends Fr()("EdgeAlreadyExistsError",{target:L}){}const Pl=e=>({packetId:e.id,"span.label":e.id+(ne(e,"reqId")&&e.reqId!==void 0?` for ${e.reqId}`:""),...e._tag!=="DirectChannelResponseSuccess"&&e._tag!=="ProxyChannelPayload"?{packet:e}:{}});te({channelName:L,source:L,mode:we(xe("proxy"),xe("direct"))});const Nie=Me,Die=({nodeName:e,incomingPacketsQueue:t,target:n,checkTransferableEdges:r,channelName:s,schema:o,sendPacket:a,channelVersion:u,scope:f,sourceId:h})=>z(function*(){const p=yield*Nie(),g=yield*UE.pipe(xg(()=>Le(void 0))),k={send:we(o.send,dh,hh),listen:we(o.listen,dh,hh)},T={current:{_tag:"Initial"}},O=({packet:_,respondToSender:C})=>z(function*(){const $=T.current;if(g==null||g.addEvent(`process:${_._tag}`,{channelState:$._tag,packetId:_.id,packetReqId:_.reqId,packetChannelVersion:ne("channelVersion")(_)?_.channelVersion:void 0}),$._tag==="Initial")return $e();if(_._tag==="DirectChannelResponseNoTransferables")return yield*Dw(p,_),"close";if(_.channelVersion>u)return g==null||g.addEvent(`incoming packet has higher version (${_.channelVersion}), closing channel`),yield*yn(f,Ht("higher-version-expected")),"close";if(_.channelVersion<u){const q=Uh.make({source:e,sourceId:h,target:n,channelName:s,channelVersion:u,hops:[],remainingHops:_.hops,reqId:void 0});g==null||g.addEvent(`incoming packet has lower version (${_.channelVersion}), sending request to reconnect (${q.id})`),yield*a(q);return}if($._tag==="Established"&&_._tag==="DirectChannelRequest")return _.sourceId===$.otherSourceId?void 0:(g==null||g.addEvent("force-new-channel"),yield*yn(f,Ht("force-new-channel")),"close");switch(_._tag){case"DirectChannelRequest":{if($._tag!=="RequestSent")return;if(_.reqId!==$.reqPacketId){const P=Uh.make({source:e,sourceId:h,target:n,channelName:s,channelVersion:u,hops:[],remainingHops:_.hops,reqId:_.id});g==null||g.addEvent(`Re-sending new request (${P.id}) for incoming request (${_.id})`),yield*a(P)}if(e>n){g==null||g.addEvent("winner side: creating direct channel and sending response");const P=new MessageChannel,N=yield*zC({port:P.port1,schema:k,debugId:u}).pipe(Br(BC));yield*C(D2.make({reqId:_.id,target:n,source:e,channelName:_.channelName,hops:[],remainingHops:_.hops.slice(0,-1),port:P.port2,channelVersion:u})),T.current={_tag:"winner:ResponseSent",channel:N,otherSourceId:_.sourceId},yield*N.listen.pipe(Sf(),Is(kn(dh)),ru(1),on),yield*N.send(hh.make({})),g==null||g.addEvent("winner side: established"),T.current={_tag:"Established",otherSourceId:_.sourceId},yield*at(p,N)}else g==null||g.addEvent("loser side: waiting for response"),T.current={_tag:"loser:WaitingForResponse",otherSourceId:_.sourceId};break}case"DirectChannelResponseSuccess":{if($._tag!=="loser:WaitingForResponse")return $e(`Expected to find direct channel response from ${n}, but was in ${$._tag} state`);const q=yield*zC({port:_.port,schema:k,debugId:u}).pipe(Br(BC)),P=yield*q.listen.pipe(Sf(),Is(kn(hh)),ru(1),on,Dg);yield*q.send(dh.make({})).pipe(Mg(10),Pv({times:2})),yield*P,g==null||g.addEvent("loser side: established"),T.current={_tag:"Established",otherSourceId:$.otherSourceId},yield*at(p,q);return}default:return bo(_)}}).pipe(Ie(`handleMessagePacket:${_._tag}:${_.source}${_.target}`,{attributes:Pl(_)}));yield*z(function*(){for(;;){const _=yield*go(t);if((yield*O(_))==="close")return}}).pipe(qt,wt,Vt);const D=T.current;return D._tag!=="Initial"?$e(`Expected channel to be in Initial state, but was in ${D._tag} state`):(yield*z(function*(){const _=Uh.make({source:e,sourceId:h,target:n,channelName:s,channelVersion:u,hops:[],reqId:void 0});T.current={_tag:"RequestSent",reqPacketId:_.id};const C=r(_);if(C!==void 0)return yield*Bn(`No transferable edges found for ${_.source}${_.target}`),yield*Mn(C);yield*a(_),g==null||g.addEvent(`initial edge request sent (${_.id})`)}),yield*p)}).pipe($d(`makeDirectChannel:${u}`)),Mie=({schema:e,newEdgeAvailablePubSub:t,channelName:n,checkTransferableEdges:r,nodeName:s,incomingPacketsQueue:o,target:a,sendPacket:u})=>zu(f=>z(function*(){const h=so(),p=yield*dn(),g=yield*pX(),k=yield*Me(),T={pendingSends:0,totalSends:0,connectCounter:0,isConnected:!1,innerChannelRef:{current:void 0}};yield*z(function*(){const C=yield*Me();for(;;){T.connectCounter++;const N=T.connectCounter;yield*Bn(`Connecting#${N}`);const M=yield*$v();yield*Gn(X=>yn(M,X));const B=yield*Qm(t).pipe(Sn(X=>Bn(`new-conn:${X}`)),ru(1),on,ro("new-edge"),Dg),F=Die({nodeName:s,sourceId:h,incomingPacketsQueue:o,target:a,checkTransferableEdges:r,channelName:n,schema:e,channelVersion:N,sendPacket:u,scope:M}).pipe(Ev(M),ur(M),$Q(V())),j=yield*NP(F,B.pipe(uQ));if(j==="new-edge")yield*yn(M,ld("new-edge"));else{const X=yield*j.pipe(Wt);if(X._tag==="Failure")yield*yn(M,X),zA(X.cause)&&kn(a0)(X.cause.error)&&(yield*B.pipe(Wt));else{const ye=X.value;yield*at(C,{channel:ye,makeDirectChannelScope:M,channelVersion:N});break}}}const{channel:$,makeDirectChannelScope:q,channelVersion:P}=yield*C;yield*Bn(`Connected#${P}`),T.isConnected=!0,T.innerChannelRef.current=$,yield*at(k,void 0),yield*$.listen.pipe(Sf(),kN(N=>Jv(p,N)),on,wt,ur(q)),yield*z(function*(){for(;;){const[N,M]=yield*hX(g);yield*$.send(N),yield*at(M,void 0),yield*mX(g)}}).pipe(ur(q)),yield*$.closedDeferred,yield*yn(q,Ht("channel-closed")),yield*Bn(`Disconnected#${P}`),T.isConnected=!1,T.innerChannelRef.current=void 0}).pipe(oi,ff,wt,Vt);const O=yield*jg.pipe(wr),D=C=>z(function*(){const $=yield*Me();T.pendingSends++,T.totalSends++,yield*dX(g,[C,$]),yield*$,T.pendingSends--}).pipe(oi,Pi(O)),E=yo(p,{maxChunkSize:1}).pipe(pi(ce)),S=yield*Me().pipe(ot(Ia(Jn)));return{webChannel:{[Qn]:Qn,send:D,listen:E,closedDeferred:S,supportsTransferables:!0,schema:e,debugInfo:T,shutdown:yn(f,Ht("shutdown"))},initialEdgeDeferred:k}})),Lie=({queue:e,nodeName:t,newEdgeAvailablePubSub:n,sendPacket:r,target:s,channelName:o,schema:a})=>zu(u=>z(function*(){const f={current:{_tag:"Initial"}},h={kind:"proxy-channel",pendingSends:0,totalSends:0,connectCounter:0,isConnected:!1},p=so(5);yield*Ob({channelIdCandidate:p});const g=yield*jg.pipe(wr),k=yield*wf(!1),T=z(function*(){return yield*vf(k,j=>j!==!1)}),O=F=>z(function*(){yield*Bn(`Connected (${F})`).pipe(Pi(g)),f.current={_tag:"Established",listenSchema:a.listen,listenQueue:C,ackMap:$,combinedChannelId:F},yield*Er(k,f.current),h.isConnected=!0}),D=pt(()=>r(M2.make({channelName:o,hops:[],source:t,target:s,channelIdCandidate:p}))),E=F=>[p,F].sort().join("_"),S=yield*dn().pipe(ot(xt)),_=({packet:F,respondToSender:j})=>z(function*(){const ye=`target:${F.source}, channelName:${F.channelName}`,G=f.current;switch(F._tag){case"ProxyChannelRequest":{const ve=E(F.channelIdCandidate);G._tag==="Established"?G.combinedChannelId===ve||(yield*Ks(`[${t}] Received ProxyChannelRequest with different channel ID (${ve}) while established with ${G.combinedChannelId}. Re-establishing.`),yield*Er(k,!1),f.current={_tag:"Pending",initiatedVia:"incoming-request"},yield*Bn("Reconnecting (received conflicting ProxyChannelRequest)").pipe(Pi(g)),h.isConnected=!1,h.connectCounter++,yield*D):G._tag==="Initial"&&(yield*Er(k,!1),f.current={_tag:"Pending",initiatedVia:"incoming-request"},yield*Bn("Connecting (received ProxyChannelRequest)").pipe(Pi(g)),h.isConnected=!1,h.connectCounter++),yield*j(L2.make({reqId:F.id,remainingHops:F.hops,hops:[],target:s,source:t,channelName:o,combinedChannelId:ve,channelIdCandidate:p}));return}case"ProxyChannelResponseSuccess":{if(G._tag!=="Pending"){if(G._tag==="Established"&&G.combinedChannelId!==F.combinedChannelId)return $e(`ProxyChannel[${ye}]: Expected proxy channel to have the same combinedChannelId as the packet:
${G.combinedChannelId} (channel) === ${F.combinedChannelId} (packet)`);if(G._tag==="Established")return;yield*Ks(`[${t}] Ignoring ResponseSuccess ${F.id} received in unexpected state ${G._tag}`);return}const ve=E(F.channelIdCandidate);if(ve!==F.combinedChannelId)return yield*ri(`ProxyChannel[${ye}]: Expected proxy channel to have the same combinedChannelId as the packet:
${ve} (channel) === ${F.combinedChannelId} (packet)`);yield*O(F.combinedChannelId);const Re=f.current;if(Re._tag==="Established"){const Be=yield*J9(S);for(const Xe of Be){if(Re.combinedChannelId!==Xe.combinedChannelId){yield*Ks(`[${t}] Discarding buffered payload ${Xe.id}: Combined channel ID mismatch during drain. Expected ${Re.combinedChannelId}, got ${Xe.combinedChannelId}`);continue}const He=yield*tu(Re.listenSchema)(Xe.payload);yield*Re.listenQueue.pipe(Qe(He))}}else yield*Yc(`[${t}] State is not Established immediately after setStateToEstablished was called. Cannot drain buffer. State: ${Re._tag}`);return}case"ProxyChannelPayload":{if(G._tag==="Established"&&G.combinedChannelId!==F.combinedChannelId)return yield*ri(`ProxyChannel[${ye}]: Expected proxy channel to have the same combinedChannelId as the packet:
${G.combinedChannelId} (channel) === ${F.combinedChannelId} (packet)`);if(yield*j(U2.make({reqId:F.id,remainingHops:F.hops,hops:[],target:s,source:t,channelName:o,combinedChannelId:G._tag==="Established"?G.combinedChannelId:F.combinedChannelId})),G._tag==="Established"){const ve=yield*tu(G.listenSchema)(F.payload);yield*G.listenQueue.pipe(Qe(ve))}else yield*Qe(S,F);return}case"ProxyChannelPayloadAck":{if(G._tag!=="Established"){yield*Bn(`Not yet connected to ${s}. dropping message`),yield*Ks(`[${t}] Received Ack but not established (State: ${G._tag}). Dropping Ack for ${F.reqId}`);return}const ve=G.ackMap.get(F.reqId)??$e(`[ProxyChannel[${ye}]] Expected ack for ${F.reqId}`);yield*at(ve,void 0),G.ackMap.delete(F.reqId);return}default:return bo(F)}}).pipe(Ie(`handleProxyPacket:${F._tag}:${F.source}->${F.target}`,{attributes:Pl(F)}));yield*yo(e).pipe(Sn(_),on,wt,Vt);const C=yield*dn();yield*Bn("Connecting");const $=new Map;{if(f.current._tag!=="Initial")return $e("Expected proxy channel to be Initial");f.current={_tag:"Pending",initiatedVia:"outgoing-request"},yield*D;const F=yield*Qm(n).pipe(Sn(()=>D),on,Vt),{combinedChannelId:j}=yield*T;yield*Ir(F),yield*O(j)}const q=F=>z(function*(){const j=yield*Wx(a.send)(F),X=yield*Ix(),ye=yield*Me();h.pendingSends++,h.totalSends++;const G=z(function*(){const{combinedChannelId:Re}=yield*vf(k,Xe=>Xe!==!1);yield*z(function*(){const Xe=yield*Me(),He=j2.make({channelName:o,payload:j,hops:[],source:t,target:s,combinedChannelId:Re});$.set(He.id,Xe),yield*r(He),yield*Xe,yield*at(ye,void 0),h.pendingSends--}).pipe(Mg(100),Pv(JF(10)),wr)}).pipe(Ou(Yc)),ve=yield*k.changes.pipe(Is(Re=>Re===!1),Sn(()=>Mm(X,G)),on,Dg);yield*Mm(X,G),yield*ye,yield*Ir(ve)}).pipe(oi,Ie("sendAckWithRetry:ProxyChannelPayload"),Pi(g)),P=yo(C).pipe(pi(ce)),N=yield*Me().pipe(ot(Ia(Jn))),M=yield*Io();return{[Qn]:Qn,send:q,listen:P,closedDeferred:N,supportsTransferables:!1,schema:a,shutdown:yn(u,Jn),debugInfo:h,debug:{ping:(F="ping")=>q(If.make({message:F})).pipe(Cn(M),wt,Ro)}}}).pipe($d("makeProxyChannel"))),up=class up{constructor({timeout:t}){d(this,"values",new Map);d(this,"timeoutHandle");d(this,"timeoutMs");d(this,"onShutdown",()=>clearTimeout(this.timeoutHandle));this.timeoutMs=qc(t)}add(t){this.values.set(t,Date.now()),this.scheduleCleanup()}has(t){return this.values.has(t)}delete(t){this.values.delete(t)}scheduleCleanup(){this.timeoutHandle===void 0&&(this.timeoutHandle=setTimeout(()=>{this.cleanup(),this.timeoutHandle=void 0},this.timeoutMs))}cleanup(){const t=Date.now();for(const[n,r]of this.values.entries())t-r>=this.timeoutMs&&this.values.delete(n)}};d(up,"make",t=>z(function*(){const n=new up({timeout:t});return yield*Gn(()=>Te(()=>n.onShutdown())),n}));let vS=up;const jie=e=>z(function*(){const t=new Map,n=yield*vS.make(UR(1)),r=yield*Kv().pipe(ot(qm)),s=new Map,o=yield*dn().pipe(ot(xt)),a=new Map,u=new Map,f=$=>{var q;if($._tag==="DirectChannelRequest"&&(t.size===0||((q=t.get($.target))==null?void 0:q.channel.supportsTransferables)===!1)||![...t.values()].some(P=>P.channel.supportsTransferables===!0))return a0.make({reqId:$.id,channelName:$.channelName,source:$.target,target:$.source,remainingHops:$.hops,hops:[]})},h=$=>z(function*(){var q,P;if(kn(yS)($)){yield*Bn("NetworkEdgeAdded",{packet:$,nodeName:e}),yield*Hg(r,$.target);const N=Array.from(t).filter(([M])=>M!==$.source).map(([M,B])=>B.channel);yield*bn(N,M=>M.send($),{concurrency:"unbounded"});return}if(kn(zh)($)){const N=Array.from(t).filter(([F])=>!$.hops.includes(F)).map(([F,j])=>j.channel),M={...$,hops:[...$.hops,e]};if(yield*bn(N,F=>F.send(M),{concurrency:"unbounded"}),$.source===e)return;const B=u.get($.channelName);B!==void 0&&(yield*Qe(B,$));return}if(kn(bS)($)){if($.source!==e){const B=$.hops.at(-1)??$e(`${e}: Expected hops for packet`,$),F=t.get(B).channel,j=SS.make({reqId:$.id,source:$.source,target:$.target,remainingHops:$.hops.slice(0,-1),nodeName:e,edges:Array.from(t.keys())});yield*F.send(j)}const N=Array.from(t).filter(([B])=>!$.hops.includes(B)).map(([B,F])=>F.channel),M={...$,hops:[...$.hops,e]};yield*bn(N,B=>B.send(M),{concurrency:"unbounded"});return}if(kn(SS)($)){if($.source===e)a.get($.reqId).set($.nodeName,new Set($.edges));else{const M=$.remainingHops.at(-1)??$e(`${e}: Expected remaining hops for packet`,$);yield*(((q=t.get(M))==null?void 0:q.channel)??$e(`${e}: Expected edge channel (${M}) for packet`,$,"Available edges:",Array.from(t.keys()))).send({...$,remainingHops:$.remainingHops.slice(0,-1)})}return}if(t.has($.target)){const N=t.get($.target).channel,M=$.source===e?[]:[...$.hops,e];yield*Ob({hasDirectEdge:!0}),yield*N.send({...$,hops:M})}else if($.remainingHops!==void 0){const N=$.remainingHops.at(-1)??$e(`${e}: Expected remaining hops for packet`,$),M=(P=t.get(N))==null?void 0:P.channel;if(M===void 0){yield*Ks(`${e}: Expected to find hop target ${N} in edges. Dropping packet.`,$);return}yield*M.send({...$,remainingHops:$.remainingHops.slice(0,-1),hops:[...$.hops,e]})}else{const N=$.source===e?[]:[...$.hops,e],M=Array.from(t).filter(([F])=>F!==$.source).map(([F,j])=>({name:F,channel:j.channel}));N.length===0&&M.length===0&&Rs&&(yield*Ks(e,"no route found to",$.target,$._tag,"TODO handle better"));const B={...$,hops:N};yield*Ob({edgesToForwardTo:M.map(({name:F})=>F)}),yield*bn(M,({channel:F})=>F.send(B),{concurrency:"unbounded"})}}).pipe(Ie(`sendPacket:${$._tag}:${$.source}${$.target}`,{attributes:Pl($)}),wr),p=({target:$,edgeChannel:q,replaceIfExists:P=!1})=>z(function*(){if(t.has($))if(P)yield*g($).pipe(wr);else return yield*new xie({target:$});const N=yield*q.listen.pipe(Sf(),Sn(B=>z(function*(){const F=yield*tu(B2)(B);if(!n.has(F.id))switch(n.add(F.id),F._tag){case"NetworkEdgeAdded":case"NetworkTopologyRequest":case"NetworkTopologyResponse":{yield*h(F);break}default:if(F.target===e){const j=`target:${F.source}, channelName:${F.channelName}`;if(!s.has(j)){const G=yield*dn().pipe(ot(xt));s.set(j,{queue:G,debugInfo:void 0})}const X=s.get(j).queue,ye=G=>q.send(G).pipe(Ie(`respondToSender:${G._tag}:${G.source}${G.target}`,{attributes:Pl(G)}),wr);kn(z2)(F)?yield*Qe(X,{packet:F,respondToSender:ye}):kn(wS)(F)&&(yield*Qe(X,{packet:F,respondToSender:ye})),(F._tag==="ProxyChannelRequest"||F._tag==="DirectChannelRequest")&&(yield*Qe(o,{channelName:F.channelName,source:F.source,mode:F._tag==="ProxyChannelRequest"?"proxy":"direct"}))}else{if(kn(wS)(F)){const j=f(F);if(j!==void 0)return yield*Bn(`No transferable edges found for ${F.source}${F.target}`),yield*q.send(j).pipe(Ie(`sendNoTransferableResponse:${F.source}${F.target}`,{attributes:Pl(j)}))}yield*h(F)}}})),on,qt,wr,wt,Vt);t.set($,{channel:q,listenFiber:N});const M=yS.make({source:e,target:$});yield*h(M).pipe(wr)}).pipe(Sc({"addEdge:target":$,nodeName:e}),Ie(`addEdge:${e}${$}`,{attributes:{supportsTransferables:q.supportsTransferables}})),g=$=>z(function*(){t.has($)||(yield*new Rg(`No edge found for ${$}`)),yield*Ir(t.get($).listenFiber),t.delete($)}),k=({target:$,channelName:q})=>Te(()=>s.has(`target:${$}, channelName:${q}`)),T=({target:$,channelName:q,schema:P,mode:N,timeout:M=tw(1),closeExisting:B=!1})=>z(function*(){var ye;const F=k_(P),j=`target:${$}, channelName:${q}`;if(s.has(j)){const G=(ye=s.get(j).debugInfo)==null?void 0:ye.channel;G&&(B?(yield*G.shutdown,s.delete(j)):$e(`Channel ${j} already exists`,G))}if(s.has(j)===!1){const G=yield*dn().pipe(ot(xt));s.set(j,{queue:G,debugInfo:void 0})}const X=s.get(j).queue;if(yield*Gn(()=>Te(()=>s.delete(j))),N==="direct"){const G=yield*dn().pipe(ot(xt));yield*XP(X,1,10).pipe(po(Be=>Jv(G,Be)),ff,qt,wt,Vt);const{webChannel:ve,initialEdgeDeferred:Re}=yield*Mie({nodeName:e,incomingPacketsQueue:G,newEdgeAvailablePubSub:r,target:$,channelName:q,schema:F,sendPacket:h,checkTransferableEdges:f});return s.set(j,{queue:X,debugInfo:{channel:ve,target:$}}),yield*Re,ve}else{const G=yield*Lie({nodeName:e,newEdgeAvailablePubSub:r,target:$,channelName:q,schema:F,queue:X,sendPacket:h});return s.set(j,{queue:X,debugInfo:{channel:G,target:$}}),G}}).pipe($d(`makeChannel:${e}${$}(${q})`,{attributes:{target:$,channelName:q,mode:N,timeout:M}}),Sc({nodeName:e,target:$,channelName:q}));let O=!1;const D=wN(()=>{if(O)return $e("listenForChannel already started");O=!0;const $=P=>`${P.channelName}:${P.source}:${P.mode}`,q=new Set;return yo(o).pipe(Is(P=>{const N=$(P);return q.has(N)?!1:(q.add(N),!0)}))}),E=({channelName:$,schema:q})=>zu(P=>z(function*(){if(u.has($))return $e(`Broadcast channel ${$} already exists`,u.get($));const N={},M=yield*dn().pipe(ot(xt));u.set($,M);const B=X=>z(function*(){const ye=yield*ju(q)(X),G=zh.make({channelName:$,payload:ye,source:e,target:"-",hops:[]});yield*h(G)}),F=yo(M).pipe(Is(kn(zh)),pi(X=>f_(q)(X.payload))),j=yield*Me().pipe(ot(Ia(Jn)));return{[Qn]:Qn,send:B,listen:F,closedDeferred:j,supportsTransferables:!1,schema:{listen:q,send:q},shutdown:yn(P,Jn),debugInfo:N}})),S=Te(()=>new Set(t.keys())),_=yield*Io();return{nodeName:e,addEdge:p,removeEdge:g,hasChannel:k,makeChannel:T,listenForChannel:D,makeBroadcastChannel:E,edgeKeys:S,debug:{print:()=>{var $,q,P,N;console.log("Webmesh debug info for node:",e),console.log("Edges:",t.size);for(const[M,B]of t)console.log(`  ${M}: supportsTransferables=${B.channel.supportsTransferables}`);console.log("Channels:",s.size);for(const[M,B]of s)console.log(ah(M,2),`
`,Object.entries({target:($=B.debugInfo)==null?void 0:$.target,supportsTransferables:(q=B.debugInfo)==null?void 0:q.channel.supportsTransferables,...(P=B.debugInfo)==null?void 0:P.channel.debugInfo}).map(([F,j])=>ah(`${F}=${j}`,4)).join(`
`),"    ",(N=B.debugInfo)==null?void 0:N.channel,`
`,ah(`Queue: ${B.queue.unsafeSize().pipe(or)}`,4),B.queue);console.log("Broadcast channels:",u.size);for(const[M,B]of u)console.log(ah(M,2))},ping:$=>{z(function*(){const q=P=>If.make({message:`ping from ${e} via ${P}`,payload:$});for(const[P,N]of t)yield*cs(`sending ping via edge ${P}`),yield*N.channel.send(q(`edge ${P}`));for(const[P,N]of s){if(N.debugInfo===void 0){yield*cs(`channel ${P} has no debug info`);continue}yield*cs(`sending ping via channel ${P}`),yield*N.debugInfo.channel.send(q(`channel ${P}`))}}).pipe(Cn(_),wt,Ro)},requestTopology:($=1e3)=>z(function*(){const q=bS.make({source:e,target:"-",hops:[]}),P=new Map;P.set(e,new Set(t.keys())),a.set(q.id,P),yield*h(q),yield*cs(`Waiting ${$}ms for topology response`),yield*Qc($),yield*cs(`Topology response (from ${e}):`);for(const[N,M]of P)yield*cs(`  node '${N}' has edge to: ${Array.from(M.values()).join(", ")}`)}).pipe(Cn(_),wt,DP)}}}).pipe(Ie(`makeMeshNode:${e}`),Sc({"makeMeshNode.nodeName":e})),Uie=e=>(...t)=>{const[n,r,s]=t;if(T_(n)){const{query:o,bindValues:a}=n.asSql();return e(o,a,r)}else return e(n,r,s)},zie=e=>(...t)=>{const[n,r]=t;if(T_(n)){const{query:s,bindValues:o}=n.asSql(),a=u2(n),u=e(s,o);return _E(a)(u)}else return e(n,r)},H2=(e,{foreignKeys:t,lockingMode:n})=>Ld(e,vt`
    -- disable WAL until we have it working properly
    -- PRAGMA journal_mode=WAL;
    PRAGMA page_size=8192;
    PRAGMA foreign_keys=${"ON"};
    ${n===void 0?"":vt`PRAGMA locking_mode=${n};`}
  `,{}),Ld=(e,t,n)=>{const r=Ki(n,t);return To({try:()=>e.execute(t,r),catch:s=>new lc({cause:s,query:{bindValues:r,sql:t},code:s.code})}).pipe($s,Ie("@livestore/common:execSql",{attributes:{"span.label":t,sql:t,bindValueKeys:Object.keys(r)}}))},Bie=(e,t,n)=>To({try:()=>e.execute(t,n),catch:r=>new lc({cause:r,query:{bindValues:n,sql:t},code:r.code})}).pipe($s,Ie("@livestore/common:execSqlPrepared",{attributes:{"span.label":t,sql:t,bindValueKeys:Object.keys(n)}})),Hie=me("Skip",{}),Vie=me("Blocking",{timeout:we($te,st)});we(Hie,Vie);class Ut extends ZS("LeaderThreadCtx")(){}class Wie extends we(mS,Ne){}const Kie=e=>z(function*(){if(e.enabled===!1)return;const{syncProcessor:t,extraIncomingMessagesQueue:n,clientId:r,storeId:s}=yield*Ut;yield*QC({incomingMessages:yo(n),sendMessage:()=>fe}).pipe(wt,Vt);const{node:o,persistenceInfo:a,mode:u}=yield*e.boot;yield*o.listenForChannel.pipe(Is(f=>Fie.devtoolsClientLeader(f.channelName,{storeId:s,clientId:r})&&f.mode===u),Sn(({channelName:f,source:h})=>z(function*(){const p=yield*o.makeChannel({target:h,channelName:f,schema:{listen:x2,send:Oie},mode:u}),g=O=>p.send(O).pipe(Ie("@livestore/common:leader-thread:devtools:sendToDevtools"),qt,Ed),k=yield*t.syncState,T=t.getMergeCounter();yield*t.pull({cursor:{mergeCounter:T,eventNum:k.localHead}}).pipe(Sn(({payload:O})=>g(O2.make({payload:O,liveStoreVersion:O_}))),on,Vt),yield*QC({incomingMessages:p.listen.pipe(Sf(),wne),sendMessage:g,persistenceInfo:a})}).pipe(wt,Vt)),on)}).pipe(Ie("@livestore/common:leader-thread:devtools:boot")),QC=({incomingMessages:e,sendMessage:t,persistenceInfo:n})=>z(function*(){const{syncBackend:r,makeSqliteDb:s,dbState:o,dbEventlog:a,shutdownStateSubRef:u,shutdownChannel:f,syncProcessor:h,clientId:p,devtools:g}=yield*Ut,k=yield*UZ(),T=new Set;yield*e.pipe(Sn(O=>z(function*(){const{requestId:D}=O,E={requestId:D,liveStoreVersion:O_,clientId:p};if(O._tag!=="LSD.Leader.Disconnect"&&!T.has(D))switch(T.add(D),O._tag){case"LSD.Leader.Ping":{yield*t(P2.make({...E}));return}case"LSD.Leader.SnapshotReq":{const S=o.export();yield*t(R2.make({snapshot:S,...E}));return}case"LSD.Leader.LoadDatabaseFile.Request":{const{data:S}=O;let _;try{const C=yield*s({_tag:"in-memory"});C.import(S);const $=C.select("select name from sqlite_master where type = 'table'");_=new Set($.map(q=>q.name)),C.close()}catch(C){yield*Yc("Error importing database file",C),yield*t(fc.Error.make({...E,cause:{_tag:"unexpected-error",cause:C}}));return}try{if(_.has(Os))yield*Er(u,"shutting-down"),a.import(S),o.destroy();else if(_.has(I_)&&_.has(rp))yield*Er(u,"shutting-down"),o.import(S),a.destroy();else{yield*t(fc.Error.make({...E,cause:{_tag:"unsupported-database"}}));return}yield*t(fc.Success.make({...E})),yield*f.send(mS.make({reason:"devtools-import"}))??fe;return}catch(C){yield*Yc("Error importing database file",C),yield*t(fc.Error.make({...E,cause:{_tag:"unexpected-error",cause:C}}));return}}case"LSD.Leader.ResetAllData.Request":{const{mode:S}=O;yield*Er(u,"shutting-down"),o.destroy(),S==="all-data"&&a.destroy(),yield*t(i0.Success.make({...E})),yield*f.send(mS.make({reason:"devtools-reset"}))??fe;return}case"LSD.Leader.DatabaseFileInfoReq":{if(n===void 0){console.log("[@livestore/common:leader-thread:devtools] persistenceInfo is required for this request");return}const S="SELECT page_count * page_size as size FROM pragma_page_count(), pragma_page_size();",_=o.select(S,void 0)[0].size,C=a.select(S,void 0)[0].size;yield*t(E2.make({state:{fileSize:_,persistenceInfo:n.state},eventlog:{fileSize:C,persistenceInfo:n.eventlog},...E}));return}case"LSD.Leader.EventlogReq":{const S=a.export();yield*t(A2.make({eventlog:S,...E}));return}case"LSD.Leader.CommitEventReq":{yield*h.pushPartial({event:O.eventEncoded,clientId:`devtools-${p}`,sessionId:`devtools-${p}`}),yield*t(q2.make({...E}));return}case"LSD.Leader.SyncHistorySubscribe":{const{subscriptionId:S}=O;r!==void 0&&(yield*r.pull(V()).pipe(pi(_=>_.batch),mne,Sn(({eventEncoded:_,metadata:C})=>t(T2.make({eventEncoded:_,metadata:C,subscriptionId:S,...E,requestId:so(10)}))),on,qt,wt,fy(k,S)));return}case"LSD.Leader.SyncHistoryUnsubscribe":{const{requestId:S}=O;console.log("LSD.SyncHistoryUnsubscribe",S),yield*ly(k,S);return}case"LSD.Leader.SyncingInfoReq":{const S=$2.make({enabled:r!==void 0,metadata:(r==null?void 0:r.metadata)??{}});yield*t(C2.make({syncingInfo:S,...E}));return}case"LSD.Leader.NetworkStatusSubscribe":{if(r!==void 0){const{subscriptionId:S}=O;yield*Qc(1e3),yield*Ine(r.isConnected.changes,g.enabled?g.syncBackendLatchState.changes:gne({latchClosed:!1})).pipe(Sn(([_,{latchClosed:C}])=>t(k2.make({networkStatus:{isConnected:_,timestampMs:Date.now(),latchClosed:C},subscriptionId:S,...E,requestId:so(10)}))),on,qt,wt,fy(k,S))}return}case"LSD.Leader.NetworkStatusUnsubscribe":{const{requestId:S}=O;yield*ly(k,S);return}case"LSD.Leader.SyncHeadSubscribe":{const{subscriptionId:S}=O;yield*h.syncState.changes.pipe(Sn(_=>t(I2.make({local:_.localHead,upstream:_.upstreamHead,subscriptionId:S,...E,requestId:so(10)}))),on,qt,wt,fy(k,S));return}case"LSD.Leader.SyncHeadUnsubscribe":{const{subscriptionId:S}=O;yield*ly(k,S);return}case"LSD.Leader.SetSyncLatch.Request":{const{closeLatch:S}=O;if(g.enabled===!1)return;S===!0?yield*g.syncBackendLatch.close:yield*g.syncBackendLatch.open,yield*Er(g.syncBackendLatchState,{latchClosed:S}),yield*t(o0.Success.make({...E}));return}default:yield*Ks("TODO implement devtools message",O)}}).pipe(Ie(`@livestore/common:leader-thread:onDevtoolsMessage:${O._tag}`))),Ne.mapToUnexpectedErrorStream,on)}),V2=e=>Object.entries(e),Jie=e=>[">","<","="].includes(e),W2=({tableName:e,columns:t,values:n,options:r={orReplace:!1}})=>[Gie({tableName:e,columns:t,options:{orReplace:r==null?void 0:r.orReplace,keys:Object.keys(n)}}),ES({columns:t,values:n})],Gie=({tableName:e,columns:t,options:n={orReplace:!1}})=>{const r=(n==null?void 0:n.keys)??Object.keys(t),s=r.join(", "),o=r.map(a=>`$${a}`).join(", ");return vt`INSERT ${n.orReplace?"OR REPLACE ":""}INTO ${e} (${s}) VALUES (${o})`},Qie=({columns:e,tableName:t,updateValues:n,where:r})=>{const s=Xie(n);if(Object.keys(s).length===0)return[vt`select 1`,{}];const o=Object.keys(s).map(h=>`${h} = $update_${h}`).join(", "),a={...ES({columns:e,values:s,variablePrefix:"update_"}),...ES({columns:e,values:r,variablePrefix:"where_",skipNil:!0})},u=Yie({where:r}),f=u===""?"":`WHERE ${u}`;return[vt`UPDATE ${t} SET ${o} ${f}`,a]},ES=({columns:e,values:t,variablePrefix:n="",skipNil:r})=>{const s=v(e,V2,Qs(([o,a])=>[o,u=>{if(a.nullable===!0&&u==null)return null;const f=Kx(a.schema)(u);if(f._tag==="Left"){const h=Tl.formatErrorSync(f.left),p=String(a.schema.ast);console.error(`Error making bind values for SQL query for column "${o}".

Expected schema: ${p}

Error: ${h}

Value:`,u);debugger;throw f.left}else return f.right}]),Object.fromEntries);return v(Object.entries(t).filter(([,o])=>r!==!0||o!=null).flatMap(([o,a])=>{const u=s[o]??$e(`No codec found for column "${o}"`);if(typeof a=="object"&&a!==null&&"op"in a)switch(a.op){case"in":return a.val.map((f,h)=>[`${n}${o}_${h}`,u(f)]);case"=":case">":case"<":return[[`${n}${o}`,u(a.val)]];default:throw new Error(`Unknown op: ${a.op}`)}else return[[`${n}${o}`,u(a)]]}),Object.fromEntries)},Yie=({where:e})=>{const t=(n,r)=>r===null?"IS NULL":typeof r=="object"&&typeof r.op=="string"&&Jie(r.op)?`${r.op} $where_${n}`:typeof r=="object"&&typeof r.op=="string"&&r.op==="in"?`in (${r.val.map((s,o)=>`$where_${n}_${o}`).join(", ")})`:`= $where_${n}`;return v(e,V2,Qs(([n,r])=>`${n} ${t(n,r)}`),va(" AND "))},Xie=e=>Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0)),Zie=e=>z(function*(){for(const t of Loe)yield*op({db:e,behaviour:"create-if-not-exists",tableAst:t.sqliteDef.ast,skipMetaTable:!0});yield*Ld(e,vt`INSERT INTO ${Pf} (head)
          SELECT ${Jr.global}
          WHERE NOT EXISTS (SELECT 1 FROM ${Pf})`,{})}),eae=e=>z(function*(){const{dbEventlog:t,dbState:n}=yield*Ut,r=Af.where("seqNumGlobal",">=",e.global).asSql(),s=t.select(r.query,Ki(r.bindValues,r.query)),o=Lm(Af.rowSchema.pipe(Oe))(s),a=sp.where("seqNumGlobal",">=",e.global).asSql(),u=n.select(a.query,Ki(a.bindValues,a.query)),f=Lm(sp.rowSchema.pipe(Oe))(u);return o.map(h=>{const p=f.find(g=>g.seqNumGlobal===h.seqNumGlobal&&g.seqNumClient===h.seqNumClient);return In.make({name:h.name,args:h.argsJson,seqNum:{global:h.seqNumGlobal,client:h.seqNumClient},parentSeqNum:{global:h.parentSeqNumGlobal,client:h.parentSeqNumClient},clientId:h.clientId,sessionId:h.sessionId,meta:{sessionChangeset:p&&p.changeset!==null?{_tag:"sessionChangeset",data:p.changeset,debug:p.debug}:{_tag:"unset"},syncMetadata:h.syncMetadataJson,materializerHashLeader:V(),materializerHashSession:V()}})}).filter(h=>hS(h.seqNum,e)>0).sort((h,p)=>hS(h.seqNum,p.seqNum))}),K2=e=>{const t=e.select(vt`select seqNumGlobal, seqNumClient from ${Os} order by seqNumGlobal DESC, seqNumClient DESC limit 1`)[0];return t?{global:t.seqNumGlobal,client:t.seqNumClient}:Jr},tae=e=>{var t;return((t=e.select(vt`select head from ${Pf}`)[0])==null?void 0:t.head)??Jr.global},nae=(e,t)=>e.execute(vt`UPDATE ${Pf} SET head = ${t.global}`),rae=(e,t,n,r,s)=>z(function*(){Rs&&e.parentSeqNum.global!==Jr.global&&t.select(`SELECT COUNT(*) as count FROM ${Os} WHERE seqNumGlobal = ? AND seqNumClient = ?`,[e.parentSeqNum.global,e.parentSeqNum.client])[0].count===1===!1&&$e(`Parent mutation ${e.parentSeqNum.global},${e.parentSeqNum.client} does not exist`),yield*Ld(t,...W2({tableName:Os,columns:Af.sqliteDef.columns,values:{seqNumGlobal:e.seqNum.global,seqNumClient:e.seqNum.client,parentSeqNumGlobal:e.parentSeqNum.global,parentSeqNumClient:e.parentSeqNum.client,name:e.name,argsJson:e.args??{},clientId:r,sessionId:s,schemaHash:n,syncMetadataJson:e.meta.syncMetadata}}))}),sae=e=>z(function*(){const{dbEventlog:t}=yield*Ut;for(let n=0;n<e.length;n++){const r=e[n];yield*Ld(t,...Qie({tableName:Os,columns:Af.sqliteDef.columns,where:{seqNumGlobal:r.seqNum.global,seqNumClient:r.seqNum.client},updateValues:{syncMetadataJson:r.meta.syncMetadata}}))}}),oae=e=>z(function*(){const{dbEventlog:t}=yield*Ut;if(e===Jr.global)return V();const n=te({syncMetadataJson:Ts(Wi(wo))}).pipe(nu("syncMetadataJson"),Oe,Ote),r=yield*Te(()=>t.select(vt`SELECT syncMetadataJson FROM ${Os} WHERE seqNumGlobal = ${e} ORDER BY seqNumClient ASC LIMIT 1`)).pipe(Br(Jee(n)),Se(IL),wr);return W({cursor:{global:e,client:ai},metadata:r})}).pipe(Ie("@livestore/common:eventlog:getSyncBackendCursorInfo",{attributes:{remoteHead:e}})),iae=({schema:e,dbState:t,dbEventlog:n})=>z(function*(){const r=new Map([...e.eventsDefsMap.entries()].map(([s,o])=>[s,KE(o.schema)]));return(s,o)=>z(function*(){const a=(o==null?void 0:o.skipEventlog)??!1,u=s.name,{eventDef:f,materializer:h}=Yo(e,u),p=m2({eventDef:f,materializer:h,dbState:t,event:{decoded:void 0,encoded:s}}),g=S_()?W(rie(p)):V();g._tag==="Some"&&s.meta.materializerHashSession._tag==="Some"&&s.meta.materializerHashSession.value!==g.value&&(yield*Ne.make({cause:`Materializer hash mismatch detected for event "${s.name}".`,note:"Please make sure your event materializer is a pure function without side effects."}));const k=t.session();for(const{statementSql:O,bindValues:D}of p)yield*Bie(t,O,D);const T=k.changeset();if(k.finish(),yield*Ld(t,...W2({tableName:Of,columns:sp.sqliteDef.columns,values:{seqNumGlobal:s.seqNum.global,seqNumClient:s.seqNum.client,changeset:T??null,debug:Rs?p:null}})),a===!1){const O=s.name,D=r.get(O)??$e(`Unknown event definition: ${O}`);yield*rae(s,n,D,s.clientId,s.sessionId)}return{sessionChangeset:T?{_tag:"sessionChangeset",data:T,debug:Rs?p:null}:{_tag:"no-op"},hash:g}}).pipe(Ie("@livestore/common:leader-thread:materializeEvent",{attributes:{eventName:s.name,eventNum:s.seqNum,"span.label":`${lr(s.seqNum)} ${s.name}`}}))}),aae=({dbState:e,dbEventlog:t,eventNumsToRollback:n})=>z(function*(){const r=e.select(vt`SELECT * FROM ${Of} WHERE (seqNumGlobal, seqNumClient) IN (${n.map(o=>`(${o.global}, ${o.client})`).join(", ")})`).map(o=>({seqNum:{global:o.seqNumGlobal,client:o.seqNumClient},changeset:o.changeset,debug:o.debug})).toSorted((o,a)=>hS(o.seqNum,a.seqNum));for(let o=r.length-1;o>=0;o--){const{changeset:a}=r[o];a!==null&&e.makeChangeset(a).invert().apply()}const s=oj(100)(n.map(o=>`(${o.global}, ${o.client})`));for(const o of s)e.execute(vt`DELETE FROM ${Of} WHERE (seqNumGlobal, seqNumClient) IN (${o.join(", ")})`);for(const o of s)t.execute(vt`DELETE FROM ${Os} WHERE (seqNumGlobal, seqNumClient) IN (${o.join(", ")})`)}).pipe(Ie("@livestore/common:LeaderSyncProcessor:rollback",{attributes:{count:n.length}})),cae=({schema:e,dbEventlogMissing:t,dbEventlog:n,dbState:r,dbStateMissing:s,initialBlockingSyncContext:o,onError:a,params:u,testing:f})=>z(function*(){const h=yield*wC(),p=u.localPushBatchSize??10,g=u.backendPushBatchSize??50,k=yield*wf(void 0),T=G=>{const{eventDef:ve}=Yo(e,G.name);return ve.options.clientOnly},O=yield*hae,D={current:0},E={current:s?0:yield*mae(r)},S=new Map,_={current:void 0},C=yield*wC(),$=yield*Rb(!0),q=yield*Rb(!0),P={current:Jr},N=G=>{P.current=t2(P.current,G)},M=(G,ve)=>{var Re;return z(function*(){if(G.length===0)return;yield*pae(G,P.current),N(G.at(-1).seqNum);const Be=(ve==null?void 0:ve.waitForProcessing)??!1,Xe=D.current;if(Be){const He=yield*bn(G,()=>Me()),Dt=G.map((On,Bu)=>[On,He[Bu],Xe]);yield*hl(C,Dt),yield*vd(He)}else{const He=G.map(Dt=>[Dt,void 0,Xe]);yield*hl(C,He)}}).pipe(Ie("@livestore/common:LeaderSyncProcessor:push",{attributes:{batchSize:G.length,batch:Js?G:void 0},links:(Re=_.current)!=null&&Re.span?[{_tag:"SpanLink",span:_.current.span,attributes:{}}]:void 0}))},B=({event:{name:G,args:ve},clientId:Re,sessionId:Be})=>z(function*(){const Xe=yield*k;if(Xe===void 0)return $e("Not initialized");const{eventDef:He}=Yo(e,G),Dt=new In({name:G,args:ve,clientId:Re,sessionId:Be,...GE(Xe.localHead,He.options.clientOnly)});yield*M([Dt])}).pipe(qv("LeaderAheadError",wr)),F=z(function*(){var es,Ao,A_;const G=yield*jg.pipe(wr),ve=yield*UE.pipe(xg(()=>Le(void 0))),{devtools:Re,shutdownChannel:Be}=yield*Ut,Xe=yield*Io();_.current={otelSpan:ve,span:G,devtoolsLatch:Re.enabled?Re.syncBackendLatch:void 0,runtime:Xe};const He=t?Jr:K2(n),Dt=t?Jr.global:tae(n);if(Dt>He.global)return $e(`During boot the backend head (${Dt}) should never be greater than the local head (${He.global})`);const On=t?[]:yield*eae({global:Dt,client:ai}),Bu=new fs({pending:On,upstreamHead:{global:Dt,client:ai},localHead:He});if(yield*Er(k,Bu),On.length>0){const xr=On.filter(Na=>{const{eventDef:ts}=Yo(e,Na.name);return ts.options.clientOnly===!1});xr.length>0&&(yield*hl(h,xr))}const Hu=xr=>z(function*(){a==="shutdown"&&(yield*Be.send(Ne.make({cause:xr})),yield*ri(xr))});yield*uae({localPushesLatch:$,localPushesQueue:C,pullLatch:q,syncStateSref:k,syncBackendPushQueue:h,schema:e,isClientEvent:T,otelSpan:ve,currentLocalPushGenerationRef:D,connectedClientSessionPullQueues:O,mergeCounterRef:E,mergePayloads:S,localPushBatchSize:p,testing:{delay:(es=f==null?void 0:f.delays)==null?void 0:es.localPushProcessing}}).pipe(wt,ys(Hu),Vt);const Vu=yield*Ix(),Ud=fae({syncBackendPushQueue:h,otelSpan:ve,devtoolsLatch:(Ao=_.current)==null?void 0:Ao.devtoolsLatch,backendPushBatchSize:g}).pipe(wt,ys(Hu));return yield*Mm(Vu,Ud),yield*lae({initialBackendHead:Dt,isClientEvent:T,restartBackendPushing:xr=>z(function*(){yield*NZ(Vu),yield*Mne(h),yield*hl(h,xr),yield*Mm(Vu,Ud)}),syncStateSref:k,localPushesLatch:$,pullLatch:q,dbState:r,otelSpan:ve,initialBlockingSyncContext:o,devtoolsLatch:(A_=_.current)==null?void 0:A_.devtoolsLatch,connectedClientSessionPullQueues:O,mergeCounterRef:E,mergePayloads:S,advancePushHead:N}).pipe(wt,ys(Hu),Vt),{initialLeaderHead:He}}).pipe($d("@livestore/common:LeaderSyncProcessor:boot")),j=({cursor:G})=>z(function*(){const ve=yield*X({cursor:G});return yo(ve)}).pipe(EN),X=({cursor:G})=>{var Re;const ve=((Re=_.current)==null?void 0:Re.runtime)??$e("Not initialized");return z(function*(){const Be=yield*O.makeQueue,Xe=Array.from(S.entries()).map(([He,Dt])=>({payload:Dt,mergeCounter:He})).filter(({mergeCounter:He})=>He>G.mergeCounter).toSorted((He,Dt)=>He.mergeCounter-Dt.mergeCounter).map(({payload:He,mergeCounter:Dt})=>He._tag==="upstream-advance"?{payload:{_tag:"upstream-advance",newEvents:ZL(He.newEvents,On=>ba(G.eventNum,On.seqNum))},mergeCounter:Dt}:{payload:He,mergeCounter:Dt});return yield*Be.offerAll(Xe),Be}).pipe(Cn(ve))},ye=b_({get:z(function*(){const G=yield*k;return G===void 0?$e("Not initialized"):G}),changes:k.changes.pipe(Is(xN))});return{pull:j,pullQueue:X,push:M,pushPartial:B,boot:F,syncState:ye,getMergeCounter:()=>E.current}}),uae=({localPushesLatch:e,localPushesQueue:t,pullLatch:n,syncStateSref:r,syncBackendPushQueue:s,schema:o,isClientEvent:a,otelSpan:u,currentLocalPushGenerationRef:f,connectedClientSessionPullQueues:h,mergeCounterRef:p,mergePayloads:g,localPushBatchSize:k,testing:T})=>z(function*(){for(;;){T.delay!==void 0&&(yield*T.delay.pipe(Ie("localPushProcessingDelay")));const O=yield*$N(t,1,k);yield*e.await,yield*n.close;const D=O.filter(([P,N,M])=>M===f.current).map(([P,N])=>[P,N]);if(D.length===0){yield*n.open;continue}const[E,S]=nj(D),_=yield*r;if(_===void 0)return $e("Not initialized");const C=S2({syncState:_,payload:{_tag:"local-push",newEvents:E},isClientEvent:a,isEqualEvent:g2}),$=yield*G2(p);switch(C._tag){case"unexpected-error":return u==null||u.addEvent(`[${$}]:push:unexpected-error`,{batchSize:E.length,newEvents:Js?JSON.stringify(E):void 0}),yield*Mn(C.cause);case"rebase":return $e("The leader thread should never have to rebase due to a local push");case"reject":{u==null||u.addEvent(`[${$}]:push:reject`,{batchSize:E.length,mergeResult:Js?JSON.stringify(C):void 0}),f.current++;const P=f.current,N=E.at(0).seqNum,M=yield*Lne(t,F=>F[2]>=P);if(Rs&&(yield*vC(t))>0){console.log("localPushesQueue is not empty",yield*vC(t));debugger}const B=[...S,...M.map(([F,j])=>j)].filter(xN);yield*bn(B,F=>Dw(F,r0.make({minimumExpectedNum:C.expectedMinimumId,providedNum:N}))),yield*n.open;continue}case"advance":break;default:bo(C)}yield*Er(r,C.newSyncState),yield*h.offer({payload:Ji.make({newEvents:C.newEvents}),mergeCounter:$}),g.set($,Ji.make({newEvents:C.newEvents})),u==null||u.addEvent(`[${$}]:push:advance`,{batchSize:E.length,mergeResult:Js?JSON.stringify(C):void 0});const q=C.newEvents.filter(P=>{const{eventDef:N}=Yo(o,P.name);return N.options.clientOnly===!1});yield*hl(s,q),yield*J2({batchItems:C.newEvents,deferreds:S}),yield*n.open}}),J2=({batchItems:e,deferreds:t})=>z(function*(){const{dbState:n,dbEventlog:r,materializeEvent:s}=yield*Ut;n.execute("BEGIN TRANSACTION",void 0),r.execute("BEGIN TRANSACTION",void 0),yield*Gn(o=>z(function*(){Hc(o)||(n.execute("ROLLBACK",void 0),r.execute("ROLLBACK",void 0))}));for(let o=0;o<e.length;o++){const{sessionChangeset:a,hash:u}=yield*s(e[o]);e[o].meta.sessionChangeset=a,e[o].meta.materializerHashLeader=u,(t==null?void 0:t[o])!==void 0&&(yield*at(t[o],void 0))}n.execute("COMMIT",void 0),r.execute("COMMIT",void 0)}).pipe(Bo,oi,Ie("@livestore/common:LeaderSyncProcessor:materializeEventItems",{attributes:{batchSize:e.length}}),wt,Ne.mapToUnexpectedError),lae=({initialBackendHead:e,isClientEvent:t,restartBackendPushing:n,otelSpan:r,dbState:s,syncStateSref:o,localPushesLatch:a,pullLatch:u,devtoolsLatch:f,initialBlockingSyncContext:h,connectedClientSessionPullQueues:p,mergeCounterRef:g,mergePayloads:k,advancePushHead:T})=>z(function*(){const{syncBackend:O,dbState:D,dbEventlog:E,schema:S}=yield*Ut;if(O===void 0)return;const _=(q,P)=>z(function*(){if(q.length===0)return;f!==void 0&&(yield*f.await),yield*a.close,yield*u.await;const N=yield*o;if(N===void 0)return $e("Not initialized");const M=S2({syncState:N,payload:Ji.make({newEvents:q}),isClientEvent:t,isEqualEvent:g2,ignoreClientEvents:!0}),B=yield*G2(g);if(M._tag==="reject")return $e("The leader thread should never reject upstream advances");if(M._tag==="unexpected-error")return r==null||r.addEvent(`[${B}]:pull:unexpected-error`,{newEventsCount:q.length,newEvents:Js?JSON.stringify(q):void 0}),yield*Mn(M.cause);const F=q.at(-1).seqNum;if(nae(E,F),M._tag==="rebase"){r==null||r.addEvent(`[${B}]:pull:rebase`,{newEventsCount:q.length,newEvents:Js?JSON.stringify(q):void 0,rollbackCount:M.rollbackEvents.length,mergeResult:Js?JSON.stringify(M):void 0});const j=M.newSyncState.pending.filter(X=>{const{eventDef:ye}=Yo(S,X.name);return ye.options.clientOnly===!1});yield*n(j),M.rollbackEvents.length>0&&(yield*aae({dbState:D,dbEventlog:E,eventNumsToRollback:M.rollbackEvents.map(X=>X.seqNum)})),yield*p.offer({payload:ap.make({newEvents:M.newEvents,rollbackEvents:M.rollbackEvents}),mergeCounter:B}),k.set(B,ap.make({newEvents:M.newEvents,rollbackEvents:M.rollbackEvents}))}else if(r==null||r.addEvent(`[${B}]:pull:advance`,{newEventsCount:q.length,mergeResult:Js?JSON.stringify(M):void 0}),yield*p.offer({payload:Ji.make({newEvents:M.newEvents}),mergeCounter:B}),k.set(B,Ji.make({newEvents:M.newEvents})),M.confirmedEvents.length>0){const j=q.filter(X=>M.confirmedEvents.some(ye=>$_(X.seqNum,ye.seqNum)));yield*sae(j)}dae(D,F),T(M.newSyncState.localHead),yield*J2({batchItems:M.newEvents,deferreds:void 0}),yield*Er(o,M.newSyncState),P===0&&(yield*a.open)}),C=yield*oae(e),$=nie({schema:S,dbState:s});yield*O.pull(C).pipe(Sn(({batch:q,remaining:P})=>z(function*(){yield*vf(O.isConnected,N=>N===!0),yield*_(q.map(N=>In.fromGlobal(N.eventEncoded,{syncMetadata:N.metadata,materializerHashLeader:$(N.eventEncoded),materializerHashSession:V()})),P),yield*h.update({processed:q.length,remaining:P})})),on,qt)}).pipe(Ie("@livestore/common:LeaderSyncProcessor:backend-pulling")),fae=({syncBackendPushQueue:e,otelSpan:t,devtoolsLatch:n,backendPushBatchSize:r})=>z(function*(){const{syncBackend:s}=yield*Ut;if(s!==void 0)for(;;){yield*vf(s.isConnected,u=>u===!0);const o=yield*$N(e,1,r);yield*vf(s.isConnected,u=>u===!0),n!==void 0&&(yield*n.await),t==null||t.addEvent("backend-push",{batchSize:o.length,batch:Js?JSON.stringify(o):void 0});const a=yield*s.push(o.map(u=>u.toGlobal())).pipe(Ei);if(a._tag==="Left")return Rs&&(yield*cs("handled backend-push-error",{error:a.left.toString()})),t==null||t.addEvent("backend-push-error",{error:a.left.toString()}),yield*Ov}}).pipe(qt,Ie("@livestore/common:LeaderSyncProcessor:backend-pushing")),dae=(e,t)=>{e.execute(vt`DELETE FROM ${Of} WHERE seqNumGlobal < ${t.global}`)},hae=z(function*(){const e=new Set;return yield*Gn(()=>z(function*(){for(const r of e)yield*xt(r);e.clear()})),{makeQueue:z(function*(){const r=yield*dn().pipe(ot(xt));return yield*Gn(()=>Te(()=>e.delete(r))),e.add(r),r}),offer:r=>z(function*(){if(!(r.payload._tag==="upstream-advance"&&r.payload.newEvents.length===0))for(const s of e)yield*Qe(s,r)})}}),G2=e=>z(function*(){const{dbState:t}=yield*Ut;return e.current++,t.execute(vt`INSERT OR REPLACE INTO ${ZE} (id, mergeCounter) VALUES (0, ${e.current})`),e.current}),mae=e=>z(function*(){var n;return((n=e.select(vt`SELECT mergeCounter FROM ${ZE} WHERE id = 0`)[0])==null?void 0:n.mergeCounter)??0}),pae=(e,t)=>z(function*(){if(e.length!==0){for(let n=1;n<e.length;n++)ba(e[n-1].seqNum,e[n].seqNum)&&$e(`Events must be ordered in monotonically ascending order by eventNum. Received: [${e.map(r=>lr(r.seqNum)).join(", ")}]`);if(ba(t,e[0].seqNum))return yield*r0.make({minimumExpectedNum:t,providedNum:e[0].seqNum})}}),gae=z(function*(){const{dbState:e,dbEventlog:t,schema:n,bootStatusQueue:r,materializeEvent:s}=yield*Ut,o=n.state.sqlite.migrations;let a;yield*Gn(Ug("recreateDb:finalizer")(function*(h){h._tag==="Failure"&&e.destroy()}));const u=e;yield*H2(u,{foreignKeys:!0});const f=h=>z(function*(){yield*ch(()=>{var g;return(g=h==null?void 0:h.init)==null?void 0:g.call(h,u)}).pipe(Ne.mapToUnexpectedError);const p=yield*Hoe({db:u,schema:n,onProgress:({done:g,total:k})=>Qe(r,{stage:"migrating",progress:{done:g,total:k}})});return yield*ch(()=>{var g;return(g=h==null?void 0:h.pre)==null?void 0:g.call(h,u)}).pipe(Ne.mapToUnexpectedError),{migrationsReport:p,tmpDb:u}});switch(o.strategy){case"auto":{const h=o.hooks,p=yield*f(h);a=p.migrationsReport,yield*cie({dbEventlog:t,schema:n,materializeEvent:s,onProgress:({done:g,total:k})=>Qe(r,{stage:"rehydrating",progress:{done:g,total:k}})}),yield*ch(()=>{var g;return(g=h==null?void 0:h.post)==null?void 0:g.call(h,p.tmpDb)}).pipe(Ne.mapToUnexpectedError);break}case"manual":{const h=e.export();a={migrations:[]};const p=yield*ch(()=>o.migrate(h)).pipe(Ne.mapToUnexpectedError);u.import(p);break}default:bo(o)}return{migrationsReport:a}}).pipe(oi,Ie("@livestore/common:leader-thread:recreateDb"),zE("@livestore/common:leader-thread:recreateDb")),_ae=({schema:e,storeId:t,clientId:n,syncPayload:r,makeSqliteDb:s,syncOptions:o,dbState:a,dbEventlog:u,devtoolsOptions:f,shutdownChannel:h,params:p,testing:g})=>z(function*(){var N;const k=yield*dn().pipe(ot(xt)),T=u.select(vt`select count(*) as count from sqlite_master`)[0].count===0,O=a.select(vt`select count(*) as count from sqlite_master`)[0].count===0,D=(o==null?void 0:o.backend)===void 0?void 0:yield*o.backend({storeId:t,clientId:n,payload:r});D!==void 0&&(yield*D.connect.pipe(wt,Vt));const E=yield*yae({initialSyncOptions:(o==null?void 0:o.initialSyncOptions)??{_tag:"Skip"},bootStatusQueue:k}),S=yield*cae({schema:e,dbEventlogMissing:T,dbEventlog:u,dbState:a,dbStateMissing:O,initialBlockingSyncContext:E,onError:(o==null?void 0:o.onSyncError)??"ignore",params:{localPushBatchSize:p==null?void 0:p.localPushBatchSize,backendPushBatchSize:p==null?void 0:p.backendPushBatchSize},testing:{delays:(N=g==null?void 0:g.syncProcessor)==null?void 0:N.delays}}),_=yield*dn().pipe(ot(xt)),C=f.enabled?{enabled:!0,syncBackendLatch:yield*Rb(!0),syncBackendLatchState:yield*wf({latchClosed:!1})}:{enabled:!1},$=yield*iae({schema:e,dbState:a,dbEventlog:u}),q={schema:e,bootStatusQueue:k,storeId:t,clientId:n,dbState:a,dbEventlog:u,makeSqliteDb:s,eventSchema:aie(e),shutdownStateSubRef:yield*wf("running"),shutdownChannel:h,syncBackend:D,syncProcessor:S,materializeEvent:$,extraIncomingMessagesQueue:_,devtools:C,initialState:{}};globalThis.__leaderThreadCtx=q;const P=Lv(Ut,q);return q.initialState=yield*bae({dbStateMissing:O,initialBlockingSyncContext:E,devtoolsOptions:f}).pipe(Cn(P)),P}).pipe(Ie("@livestore/common:leader-thread:boot"),$d("@livestore/common:leader-thread"),Ne.mapToUnexpectedError,wt,Uv),yae=({initialSyncOptions:e,bootStatusQueue:t})=>z(function*(){const n={isDone:!1,processedEvents:0,total:-1},r=e._tag==="Blocking"?yield*Me():void 0;return r!==void 0&&e._tag==="Blocking"&&(yield*at(r,void 0).pipe(_Q(e.timeout),Vt)),{blockingDeferred:r,update:({processed:s,remaining:o})=>z(function*(){n.isDone!==!0&&(n.total===-1&&(n.total=o+s),n.processedEvents+=s,yield*Qe(t,{stage:"syncing",progress:{done:n.processedEvents,total:n.total}}),o===0&&r!==void 0&&(yield*at(r,void 0),n.isDone=!0))})}}),bae=({dbStateMissing:e,initialBlockingSyncContext:t,devtoolsOptions:n})=>z(function*(){const{dbEventlog:r,bootStatusQueue:s,syncProcessor:o}=yield*Ut;yield*Zie(r);const{migrationsReport:a}=e?yield*gae:{migrationsReport:{migrations:[]}},{initialLeaderHead:u}=yield*o.boot;return t.blockingDeferred!==void 0&&(yield*Qe(s,{stage:"syncing",progress:{done:0,total:-1}}),yield*t.blockingDeferred.pipe(Ie("@livestore/common:leader-thread:initial-sync-blocking"))),yield*Qe(s,{stage:"done"}),yield*Kie(n).pipe(wt,Vt),{migrationsReport:a,leaderHead:u}});let c0=class extends An()("DevtoolsWebCommon.CreateConnection",{payload:{from:L,port:E_},success:te({}),failure:d_}){};class sue extends we(c0){}const lp=class lp extends ZS("@livestore/devtools-web-common:CacheService")(){};d(lp,"layer",({nodeName:t})=>z(function*(){const n=yield*jie(t);return globalThis.__debugWebmeshNode=n,{node:n}}).pipe(HQ(lp)));let xf=lp;const Sae=({from:e,port:t})=>lne(n=>z(function*(){const{node:r}=yield*xf,s=yield*noe({port:t,schema:B2});yield*r.addEdge({target:e,edgeChannel:s,replaceIfExists:!0}),Rs&&(yield*cs(`@livestore/devtools-web-common: accepted edge: ${r.nodeName}  ${e}`)),n.single({}),yield*Bn({connectedTo:[...r.edgeKeys]})}).pipe(wr)).pipe(Tne(`@livestore/devtools-web-common:worker:create-connection:${e}`)),re=0,wae=1,Nf=10,u0=12,jd=14,Do=21,Ty=25,vae=27,kS=100,Eae=101,q_=522,Q2=778,YC=2,cp=4,$S=8,Y2=64,kae=256,$ae=2048,Cae=16384,Tae=524288,Iae=2048,XC=1,ZC=2,eT=3,tT=4,nT=5,Rae=512;class X2{constructor(t,n){d(this,"name");d(this,"mxPathname",64);d(this,"_module");this.name=t,this._module=n}close(){}isReady(){return!0}hasAsyncMethod(t){return!1}xOpen(t,n,r,s,o){return jd}xDelete(t,n,r){return re}xAccess(t,n,r,s){return re}xFullPathname(t,n,r,s){return re}xGetLastError(t,n,r){return re}xClose(t){return re}xRead(t,n,r,s,o){return re}xWrite(t,n,r,s,o){return re}xTruncate(t,n,r){return re}xSync(t,n){return re}xFileSize(t,n){return re}xLock(t,n){return re}xUnlock(t,n){return re}xCheckReservedLock(t,n){return re}xFileControl(t,n,r){return u0}xSectorSize(t){return Rae}xDeviceCharacteristics(t){return 0}}const Oae=Object.getPrototypeOf(async function(){}).constructor;var kr,_l,CS,Z2,s1;let qae=(s1=class extends X2{constructor(n,r){super(n,r);Mr(this,kr)}hasAsyncMethod(n){const r=`j${n.slice(1)}`;return this[r]instanceof Oae}getFilename(n){throw new Error("unimplemented")}jOpen(n,r,s,o){return jd}jDelete(n,r){return re}jAccess(n,r,s){return re}jFullPathname(n,r){const{read:s,written:o}=new TextEncoder().encodeInto(n,r);return s<n.length||o>=r.length?Nf:(r[o]=0,re)}jGetLastError(n){return re}jClose(n){return re}jRead(n,r,s){return r.fill(0),q_}jWrite(n,r,s){return Q2}jTruncate(n,r){return re}jSync(n,r){return re}jFileSize(n,r){return re}jLock(n,r){return re}jUnlock(n,r){return re}jCheckReservedLock(n,r){return r.setInt32(0,0,!0),re}jFileControl(n,r,s){return u0}jSectorSize(n){return super.xSectorSize(n)}jDeviceCharacteristics(n){return 0}xOpen(n,r,s,o,a){var h;const u=Ze(this,kr,Z2).call(this,r,o),f=Ze(this,kr,_l).call(this,"Int32",a);return(h=this.log)==null||h.call(this,"jOpen",u,s,"0x"+o.toString(16)),this.jOpen(u,s,o,f)}xDelete(n,r,s){var a;const o=this._module.UTF8ToString(r);return(a=this.log)==null||a.call(this,"jDelete",o,s),this.jDelete(o,s)}xAccess(n,r,s,o){var f;const a=this._module.UTF8ToString(r),u=Ze(this,kr,_l).call(this,"Int32",o);return(f=this.log)==null||f.call(this,"jAccess",a,s),this.jAccess(a,s,u)}xFullPathname(n,r,s,o){var f;const a=this._module.UTF8ToString(r),u=this._module.HEAPU8.subarray(o,o+s);return(f=this.log)==null||f.call(this,"jFullPathname",a,s),this.jFullPathname(a,u)}xGetLastError(n,r,s){var a;const o=this._module.HEAPU8.subarray(s,s+r);return(a=this.log)==null||a.call(this,"jGetLastError",r),this.jGetLastError(o)}xClose(n){var r;return(r=this.log)==null||r.call(this,"jClose",n),this.jClose(n)}xRead(n,r,s,o,a){var h;const u=Ze(this,kr,CS).call(this,r,s),f=Iy(o,a);return(h=this.log)==null||h.call(this,"jRead",n,s,f),this.jRead(n,u,f)}xWrite(n,r,s,o,a){var h;const u=Ze(this,kr,CS).call(this,r,s),f=Iy(o,a);return(h=this.log)==null||h.call(this,"jWrite",n,u,f),this.jWrite(n,u,f)}xTruncate(n,r,s){var a;const o=Iy(r,s);return(a=this.log)==null||a.call(this,"jTruncate",n,o),this.jTruncate(n,o)}xSync(n,r){var s;return(s=this.log)==null||s.call(this,"jSync",n,r),this.jSync(n,r)}xFileSize(n,r){var o;const s=Ze(this,kr,_l).call(this,"BigInt64",r);return(o=this.log)==null||o.call(this,"jFileSize",n),this.jFileSize(n,s)}xLock(n,r){var s;return(s=this.log)==null||s.call(this,"jLock",n,r),this.jLock(n,r)}xUnlock(n,r){var s;return(s=this.log)==null||s.call(this,"jUnlock",n,r),this.jUnlock(n,r)}xCheckReservedLock(n,r){var o;const s=Ze(this,kr,_l).call(this,"Int32",r);return(o=this.log)==null||o.call(this,"jCheckReservedLock",n),this.jCheckReservedLock(n,s)}xFileControl(n,r,s){var a;const o=new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+s);return(a=this.log)==null||a.call(this,"jFileControl",n,r,o),this.jFileControl(n,r,o)}xSectorSize(n){var r;return(r=this.log)==null||r.call(this,"jSectorSize",n),this.jSectorSize(n)}xDeviceCharacteristics(n){var r;return(r=this.log)==null||r.call(this,"jDeviceCharacteristics",n),this.jDeviceCharacteristics(n)}},kr=new WeakSet,_l=function(n,r){const s=n==="Int32"?4:8,o=`get${n}`,a=`set${n}`,u=()=>new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+r,s);let f=u();return new Proxy(f,{get(h,p){if(f.buffer.byteLength===0&&(f=u()),p===o)return function(k,T){if(!T)throw new Error("must be little endian");return f[p](k,T)};if(p===a)return function(k,T,O){if(!O)throw new Error("must be little endian");return f[p](k,T,O)};if(typeof p=="string"&&p.match(/^(get)|(set)/))throw new Error("invalid type");const g=f[p];return typeof g=="function"?g.bind(f):g}})},CS=function(n,r){let s=this._module.HEAPU8.subarray(n,n+r);return new Proxy(s,{get:(o,a,u)=>{s.buffer.byteLength===0&&(s=this._module.HEAPU8.subarray(n,n+r));const f=s[a];return typeof f=="function"?f.bind(s):f}})},Z2=function(n,r){if(r&Y2){let s=n,o=1;const a=[];for(;o;){const u=this._module.HEAPU8[s++];if(u)a.push(u);else switch(this._module.HEAPU8[s]||(o=null),o){case 1:a.push(63),o=2;break;case 2:a.push(61),o=3;break;case 3:a.push(38),o=2;break}}return new TextDecoder().decode(new Uint8Array(a))}return n?this._module.UTF8ToString(n):null},s1);function Iy(e,t){return t*4294967296+e+(e<0?2**32:0)}class l0 extends qae{constructor(n,r){super(n,r);d(this,"mapNameToFile",new Map);d(this,"mapIdToFile",new Map)}static async create(n,r){const s=new l0(n,r);return await s.isReady(),s}close(){for(const n of this.mapIdToFile.keys())this.jClose(n)}jOpen(n,r,s,o){const u=new URL(n||Math.random().toString(36).slice(2),"file://").pathname;let f=this.mapNameToFile.get(u);if(!f)if(s&cp)f={pathname:u,flags:s,size:0,data:new ArrayBuffer(0)},this.mapNameToFile.set(u,f);else return jd;return this.mapIdToFile.set(r,f),o.setInt32(0,s,!0),re}jClose(n){const r=this.mapIdToFile.get(n);return this.mapIdToFile.delete(n),r.flags&$S&&this.mapNameToFile.delete(r.pathname),re}jRead(n,r,s){const o=this.mapIdToFile.get(n),a=Math.min(s,o.size),f=Math.min(s+r.byteLength,o.size)-a;return f&&r.set(new Uint8Array(o.data,a,f)),f<r.byteLength?(r.fill(0,f),q_):re}jWrite(n,r,s){const o=this.mapIdToFile.get(n);if(s+r.byteLength>o.data.byteLength){const a=Math.max(s+r.byteLength,2*o.data.byteLength),u=new ArrayBuffer(a);new Uint8Array(u).set(new Uint8Array(o.data,0,o.size)),o.data=u}return new Uint8Array(o.data,s,r.byteLength).set(r),o.size=Math.max(o.size,s+r.byteLength),re}jTruncate(n,r){const s=this.mapIdToFile.get(n);return s.size=Math.min(s.size,r),re}jFileSize(n,r){const s=this.mapIdToFile.get(n);return r.setBigInt64(0,BigInt(s.size),!0),re}jDelete(n,r){const o=new URL(n,"file://").pathname;return this.mapNameToFile.delete(o),re}jAccess(n,r,s){const a=new URL(n,"file://").pathname,u=this.mapNameToFile.get(a);return s.setInt32(0,u?1:0,!0),re}}let rT;const e3=e=>{if(e.vfs_registered.has("memory-vfs")===!1){const r=new l0("memory-vfs",e.module);e.vfs_register(r,!1),rT=r}return{dbPointer:e.open_v2Sync(":memory:",void 0,"memory-vfs"),vfs:rT}},sT=({sqlite3:e,metadata:t})=>{const n=[],{dbPointer:r}=t;let s=!1;const o={_tag:"SqliteDb",metadata:t,prepare:a=>{try{const u=e.statements(r,a.trim(),{unscoped:!0});let f=!1;const h={execute:(p,g)=>{for(const k of u){p!==void 0&&Object.keys(p).length>0&&e.bind_collection(k,p);try{e.step(k)}finally{g!=null&&g.onRowsChanged&&g.onRowsChanged(e.changes(r)),e.reset(k)}}},select:p=>{if(u.length!==1)throw new lc({query:{bindValues:p,sql:a},code:-1,cause:"Expected only one statement when using `select`"});const g=u[0];p!==void 0&&Object.keys(p).length>0&&e.bind_collection(g,p);const k=[];try{let T;try{T=e.column_names(g)}catch{}for(;e.step(g)===kS;)if(T!==void 0){const O={};for(let D=0;D<T.length;D++)O[T[D]]=e.column(g,D);k.push(O)}}catch(T){throw new lc({query:{bindValues:p,sql:a},code:T.code,cause:T})}finally{e.reset(g)}return k},finalize:()=>{if(!f){f=!0;for(const p of u)e.finalize(p)}},sql:a};return n.push(h),h}catch(u){throw new lc({query:{sql:a,bindValues:{}},code:u.code,cause:u})}},export:()=>e.serialize(r,"main"),execute:Uie((a,u,f)=>{const h=o.prepare(a);h.execute(u,f),h.finalize()}),select:zie((a,u)=>{const f=o.prepare(a),h=f.select(u);return f.finalize(),h}),destroy:()=>{o.close(),t.deleteDb()},close:()=>{if(!s){for(const a of n)a.finalize();e.close(r),s=!0}},import:a=>{if(a instanceof Uint8Array){const h=e3(e);e.deserialize(h.dbPointer,"main",a,a.length,a.length,3),e.backup(r,"main",h.dbPointer,"main"),e.close(h.dbPointer)}else e.backup(r,"main",a.metadata.dbPointer,"main");t.configureDb(o)},session:()=>{const a=e.session_create(r,"main");return e.session_attach(a,null),{changeset:()=>e.session_changeset(a).changeset??void 0,finish:()=>{e.session_delete(a)}}},makeChangeset:a=>({invert:()=>{const f=e.changeset_invert(a);return o.makeChangeset(f)},apply:()=>{try{e.changeset_apply(r,a),a=void 0}catch(f){throw new lc({code:f.code??-1,cause:f,note:"Failed calling makeChangeset.apply"})}}})};return t.configureDb(o),o},Aae=Object.getPrototypeOf(async()=>{}).constructor;var $r,yl,TS,t3;class Pae extends X2{constructor(n,r){super(n,r);Mr(this,$r)}hasAsyncMethod(n){const r=`j${n.slice(1)}`;return this[r]instanceof Aae}getFilename(n){throw new Error("unimplemented")}jOpen(n,r,s,o){return jd}jDelete(n,r){return re}jAccess(n,r,s){return re}jFullPathname(n,r){const{read:s,written:o}=new TextEncoder().encodeInto(n,r);return s<n.length||o>=r.length?Nf:(r[o]=0,re)}jGetLastError(n){return re}jClose(n){return re}jRead(n,r,s){return r.fill(0),q_}jWrite(n,r,s){return Q2}jTruncate(n,r){return re}jSync(n,r){return re}jFileSize(n,r){return re}jLock(n,r){return re}jUnlock(n,r){return re}jCheckReservedLock(n,r){return r.setInt32(0,0,!0),re}jFileControl(n,r,s){return u0}jSectorSize(n){return super.xSectorSize(n)}jDeviceCharacteristics(n){return 0}xOpen(n,r,s,o,a){var h;const u=Ze(this,$r,t3).call(this,r,o),f=Ze(this,$r,yl).call(this,"Int32",a);return(h=this.log)==null||h.call(this,"jOpen",u,s,"0x"+o.toString(16)),this.jOpen(u,s,o,f)}xDelete(n,r,s){var a;const o=this._module.UTF8ToString(r);return(a=this.log)==null||a.call(this,"jDelete",o,s),this.jDelete(o,s)}xAccess(n,r,s,o){var f;const a=this._module.UTF8ToString(r),u=Ze(this,$r,yl).call(this,"Int32",o);return(f=this.log)==null||f.call(this,"jAccess",a,s),this.jAccess(a,s,u)}xFullPathname(n,r,s,o){var f;const a=this._module.UTF8ToString(r),u=this._module.HEAPU8.subarray(o,o+s);return(f=this.log)==null||f.call(this,"jFullPathname",a,s),this.jFullPathname(a,u)}xGetLastError(n,r,s){var a;const o=this._module.HEAPU8.subarray(s,s+r);return(a=this.log)==null||a.call(this,"jGetLastError",r),this.jGetLastError(o)}xClose(n){var r;return(r=this.log)==null||r.call(this,"jClose",n),this.jClose(n)}xRead(n,r,s,o,a){var h;const u=Ze(this,$r,TS).call(this,r,s),f=Ry(o,a);return(h=this.log)==null||h.call(this,"jRead",n,s,f),this.jRead(n,u,f)}xWrite(n,r,s,o,a){var h;const u=Ze(this,$r,TS).call(this,r,s),f=Ry(o,a);return(h=this.log)==null||h.call(this,"jWrite",n,u,f),this.jWrite(n,u,f)}xTruncate(n,r,s){var a;const o=Ry(r,s);return(a=this.log)==null||a.call(this,"jTruncate",n,o),this.jTruncate(n,o)}xSync(n,r){var s;return(s=this.log)==null||s.call(this,"jSync",n,r),this.jSync(n,r)}xFileSize(n,r){var o;const s=Ze(this,$r,yl).call(this,"BigInt64",r);return(o=this.log)==null||o.call(this,"jFileSize",n),this.jFileSize(n,s)}xLock(n,r){var s;return(s=this.log)==null||s.call(this,"jLock",n,r),this.jLock(n,r)}xUnlock(n,r){var s;return(s=this.log)==null||s.call(this,"jUnlock",n,r),this.jUnlock(n,r)}xCheckReservedLock(n,r){var o;const s=Ze(this,$r,yl).call(this,"Int32",r);return(o=this.log)==null||o.call(this,"jCheckReservedLock",n),this.jCheckReservedLock(n,s)}xFileControl(n,r,s){var a;const o=new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+s);return(a=this.log)==null||a.call(this,"jFileControl",n,r,o),this.jFileControl(n,r,o)}xSectorSize(n){var r;return(r=this.log)==null||r.call(this,"jSectorSize",n),this.jSectorSize(n)}xDeviceCharacteristics(n){var r;return(r=this.log)==null||r.call(this,"jDeviceCharacteristics",n),this.jDeviceCharacteristics(n)}}$r=new WeakSet,yl=function(n,r){const s=n==="Int32"?4:8,o=`get${n}`,a=`set${n}`,u=()=>new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+r,s);let f=u();return new Proxy(f,{get(h,p){if(f.buffer.byteLength===0&&(f=u()),p===o)return function(k,T){if(!T)throw new Error("must be little endian");return f[p](k,T)};if(p===a)return function(k,T,O){if(!O)throw new Error("must be little endian");return f[p](k,T,O)};if(typeof p=="string"&&/^(get)|(set)/.test(p))throw new Error("invalid type");const g=f[p];return typeof g=="function"?g.bind(f):g}})},TS=function(n,r){let s=this._module.HEAPU8.subarray(n,n+r);return new Proxy(s,{get:(o,a,u)=>{s.buffer.byteLength===0&&(s=this._module.HEAPU8.subarray(n,n+r));const f=s[a];return typeof f=="function"?f.bind(s):f}})},t3=function(n,r){if(r&Y2){let s=n,o=1;const a=[];for(;o;){const u=this._module.HEAPU8[s++];if(u)a.push(u);else switch(this._module.HEAPU8[s]||(o=null),o){case 1:{a.push(63),o=2;break}case 2:{a.push(61),o=3;break}case 3:{a.push(38),o=2;break}}}return new TextDecoder().decode(new Uint8Array(a))}return n?this._module.UTF8ToString(n):null};function Ry(e,t){return t*4294967296+e+(e<0?2**32:0)}const n3=4096,f0=512,Fae=4,xae=8,IS=f0+Fae,oT=f0,iT=IS,wi=n3,Nae=kae|$ae|Cae|Tae,Dae=6;var Mf,Uo,jr,tr,os,Ur,St,r3,s3,o3,nc,OS,rc,qS;const b0=class b0 extends Pae{constructor(n,r,s){super(n,s);Mr(this,St);d(this,"log",null);Mr(this,Mf);Mr(this,Uo);Mr(this,jr,new Map);Mr(this,tr,new Map);Mr(this,os,new Set);Mr(this,Ur,new Map);Vd(this,Mf,r)}static async create(n,r,s){const o=new b0(n,r,s);return await o.isReady(),o}getOpfsFileName(n){const r=Ze(this,St,rc).call(this,n),s=Pe(this,tr).get(r);return Pe(this,jr).get(s)}resetAccessHandle(n){const r=Ze(this,St,rc).call(this,n);Pe(this,tr).get(r).truncate(wi)}jOpen(n,r,s,o){try{const a=n?Ze(this,St,rc).call(this,n):Math.random().toString(36);let u=Pe(this,tr).get(a);if(!u&&s&cp)if(this.getSize()<this.getCapacity())[u]=Pe(this,os).keys(),Ze(this,St,nc).call(this,u,a,s);else throw new Error("cannot create file");if(!u)throw new Error("file not found");const f={path:a,flags:s,accessHandle:u};return Pe(this,Ur).set(r,f),o.setInt32(0,s,!0),re}catch(a){return console.error(a.message),jd}}jClose(n){const r=Pe(this,Ur).get(n);return r&&(r.accessHandle.flush(),Pe(this,Ur).delete(n),r.flags&$S&&Ze(this,St,qS).call(this,r.path)),re}jRead(n,r,s){const a=Pe(this,Ur).get(n).accessHandle.read(r.subarray(),{at:wi+s});return a<r.byteLength?(r.fill(0,a,r.byteLength),q_):re}jWrite(n,r,s){return Pe(this,Ur).get(n).accessHandle.write(r.subarray(),{at:wi+s})===r.byteLength?re:Nf}jTruncate(n,r){return Pe(this,Ur).get(n).accessHandle.truncate(wi+r),re}jSync(n,r){return Pe(this,Ur).get(n).accessHandle.flush(),re}jFileSize(n,r){const o=Pe(this,Ur).get(n).accessHandle.getSize()-wi;return r.setBigInt64(0,BigInt(o),!0),re}jSectorSize(n){return n3}jDeviceCharacteristics(n){return Iae}jAccess(n,r,s){const o=Ze(this,St,rc).call(this,n);return s.setInt32(0,Pe(this,tr).has(o)?1:0,!0),re}jDelete(n,r){const s=Ze(this,St,rc).call(this,n);return Ze(this,St,qS).call(this,s),re}async close(){Ze(this,St,s3).call(this)}async isReady(){if(!Pe(this,Uo)){let n=await navigator.storage.getDirectory();for(const r of Pe(this,Mf).split("/"))r&&(n=await n.getDirectoryHandle(r,{create:!0}));Vd(this,Uo,n),await Ze(this,St,r3).call(this),this.getCapacity()===0&&await this.addCapacity(Dae)}return!0}getSize(){return Pe(this,tr).size}getCapacity(){return Pe(this,jr).size}async addCapacity(n){for(let r=0;r<n;++r){const s=Math.random().toString(36).replace("0.",""),a=await(await Pe(this,Uo).getFileHandle(s,{create:!0})).createSyncAccessHandle();Pe(this,jr).set(a,s),Ze(this,St,nc).call(this,a,"",0)}return n}async removeCapacity(n){let r=0;for(const s of Array.from(Pe(this,os))){if(r==n||this.getSize()===this.getCapacity())return r;const o=Pe(this,jr).get(s);s.close(),await Pe(this,Uo).removeEntry(o),Pe(this,jr).delete(s),Pe(this,os).delete(s),++r}return r}};Mf=new WeakMap,Uo=new WeakMap,jr=new WeakMap,tr=new WeakMap,os=new WeakMap,Ur=new WeakMap,St=new WeakSet,r3=async function(){const n=[];for await(const[r,s]of Pe(this,Uo))s.kind==="file"&&n.push([r,s]);await Promise.all(n.map(async([r,s])=>{const o=await s.createSyncAccessHandle();Pe(this,jr).set(o,r);const a=Ze(this,St,o3).call(this,o);a?Pe(this,tr).set(a,o):Pe(this,os).add(o)}))},s3=function(){for(const n of Pe(this,jr).keys())n.close();Pe(this,jr).clear(),Pe(this,tr).clear(),Pe(this,os).clear()},o3=function(n){const r=new Uint8Array(IS);n.read(r,{at:0});const o=new DataView(r.buffer,r.byteOffset).getUint32(oT);if(r[0]&&(o&$S||(o&Nae)===0))return console.warn(`Remove file with unexpected flags ${o.toString(16)}`),Ze(this,St,nc).call(this,n,"",0),"";const a=new Uint32Array(xae/4);n.read(a,{at:iT});const u=Ze(this,St,OS).call(this,r);if(a.every((f,h)=>f===u[h])){const f=r.indexOf(0);return f===0&&n.truncate(wi),new TextDecoder().decode(r.subarray(0,f))}else return console.warn("Disassociating file with bad digest."),Ze(this,St,nc).call(this,n,"",0),""},nc=function(n,r,s){const o=new Uint8Array(IS);if(new TextEncoder().encodeInto(r,o).written>=f0)throw new Error("path too long");new DataView(o.buffer,o.byteOffset).setUint32(oT,s);const f=Ze(this,St,OS).call(this,o);n.write(o,{at:0}),n.write(f,{at:iT}),n.flush(),r?(Pe(this,tr).set(r,n),Pe(this,os).delete(n)):(n.truncate(wi),Pe(this,os).add(n))},OS=function(n){if(!n[0])return new Uint32Array([4274806656,2899230775]);let r=3735928559,s=1103547991;for(const o of n)r=Math.imul(r^o,2654435761),s=Math.imul(s^o,1597334677);return r=Math.imul(r^r>>>16,2246822507)^Math.imul(s^s>>>13,3266489909),s=Math.imul(s^s>>>16,2246822507)^Math.imul(r^r>>>13,3266489909),new Uint32Array([r>>>0,s>>>0])},rc=function(n){return(typeof n=="string"?new URL(n,"file://localhost/"):n).pathname},qS=function(n){const r=Pe(this,tr).get(n);r&&(Pe(this,tr).delete(n),Ze(this,St,nc).call(this,r,"",0))};let RS=b0;const Mae=Lg(1).pipe(bs),aT=new Map,Lae=({sqlite3:e,directory:t,fileName:n})=>z(function*(){const r=t.replaceAll(/["*/:<>?\\|]/g,"_"),o=`opfs${r.length===0?"":`-${r}`}`;if(e.vfs_registered.has(o)===!1){const f=yield*Fg(()=>RS.create(o,t,e.module));e.vfs_register(f,!1),aT.set(o,f)}const a=e.open_v2Sync(n,void 0,o),u=aT.get(o);return{dbPointer:a,vfs:u}}).pipe(Mae.withPermits(1));new TextDecoder;const jae=({sqlite3:e})=>t=>z(function*(){if(t._tag==="in-memory"){const{dbPointer:a,vfs:u}=e3(e);return sT({sqlite3:e,metadata:{_tag:"in-memory",vfs:u,dbPointer:a,deleteDb:()=>{},configureDb:t.configureDb??(()=>{}),persistenceInfo:{fileName:":memory:"}}})}const n=60;let r=t.fileName;t.fileName.length>n&&(yield*Ks(`dbFilename too long: '${t.fileName}'. Max ${n} chars, got ${t.fileName.length}. Hashing...`),r=`hash-${$t(t.fileName)}.db`);const{dbPointer:s,vfs:o}=yield*Lae({sqlite3:e,directory:t.opfsDirectory,fileName:r});return sT({sqlite3:e,metadata:{_tag:"opfs",vfs:o,dbPointer:s,deleteDb:()=>o.resetAccessHandle(t.fileName),configureDb:t.configureDb??(()=>{}),persistenceInfo:{fileName:r,opfsDirectory:t.opfsDirectory,opfsFileName:o.getOpfsFileName(r)}}})}),cT=0x7fffffffffffffffn,uT=-0x8000000000000000n;class pr extends Error{constructor(t,n){super(t),this.code=n}}const Ga=!1;function Uae(e){const t={};e.retryOps=[];const n=e._getSqliteFree(),r=e._malloc(8),s=[r,r+4];function o(E){if(typeof E!="string")return 0;const S=new TextEncoder().encode(E),_=e._sqlite3_malloc(S.byteLength+1);return e.HEAPU8.set(S,_),e.HEAPU8[_+S.byteLength]=0,_}function a(E,S){return BigInt(S)<<32n|BigInt(E)&0xffffffffn}const u=function(){const E=BigInt(Number.MAX_SAFE_INTEGER)>>32n,S=BigInt(Number.MIN_SAFE_INTEGER)>>32n;return function(_,C){return C>E||C<S?a(_,C):C*4294967296+(_&2147483647)-(_&2147483648)}}(),f=new Set;function h(E){if(!f.has(E))throw new pr("not a database",Do)}const p=new Map;function g(E){if(!p.has(E))throw new pr("not a statement",Do)}t.bind_collection=function(E,S){g(E);const _=Array.isArray(S),C=t.bind_parameter_count(E);for(let $=1;$<=C;++$){const q=_?$-1:t.bind_parameter_name(E,$),P=S[q];P!==void 0&&t.bind(E,$,P)}return re},t.bind=function(E,S,_){switch(g(E),typeof _){case"number":return _===(_|0)?t.bind_int(E,S,_):t.bind_double(E,S,_);case"string":return t.bind_text(E,S,_);default:return _ instanceof Uint8Array||Array.isArray(_)?t.bind_blob(E,S,_):_===null?t.bind_null(E,S):typeof _=="bigint"?t.bind_int64(E,S,_):_===void 0?vae:(console.warn("unknown binding converted to null",_),t.bind_null(E,S))}},t.bind_blob=function(){const E="sqlite3_bind_blob",S=e.cwrap(E,...se("nnnnn:n"));return function(_,C,$){g(_);const q=$.byteLength??$.length,P=e._sqlite3_malloc(q);e.HEAPU8.subarray(P).set($);const N=S(_,C,P,q,n);return O(E,N,p.get(_))}}(),t.bind_parameter_count=function(){const S=e.cwrap("sqlite3_bind_parameter_count",...se("n:n"));return function(_){return g(_),S(_)}}(),t.bind_double=function(){const E="sqlite3_bind_double",S=e.cwrap(E,...se("nnn:n"));return function(_,C,$){g(_);const q=S(_,C,$);return O(E,q,p.get(_))}}(),t.bind_int=function(){const E="sqlite3_bind_int",S=e.cwrap(E,...se("nnn:n"));return function(_,C,$){if(g(_),$>2147483647||$<-2147483648)return Ty;const q=S(_,C,$);return O(E,q,p.get(_))}}(),t.bind_int64=function(){const E="sqlite3_bind_int64",S=e.cwrap(E,...se("nnnn:n"));return function(_,C,$){if(g(_),$>cT||$<uT)return Ty;const q=$&0xffffffffn,P=$>>32n,N=S(_,C,Number(q),Number(P));return O(E,N,p.get(_))}}(),t.bind_null=function(){const E="sqlite3_bind_null",S=e.cwrap(E,...se("nn:n"));return function(_,C){g(_);const $=S(_,C);return O(E,$,p.get(_))}}(),t.bind_parameter_name=function(){const S=e.cwrap("sqlite3_bind_parameter_name",...se("n:s"));return function(_,C){return g(_),S(_,C)}}(),t.bind_text=function(){const E="sqlite3_bind_text",S=e.cwrap(E,...se("nnnnn:n"));return function(_,C,$){g(_);const q=o($),P=S(_,C,q,-1,n);return O(E,P,p.get(_))}}(),t.changes=function(){const S=e.cwrap("sqlite3_changes",...se("n:n"));return function(_){return h(_),S(_)}}(),t.deserialize=function(){const S=e.cwrap("sqlite3_deserialize",...se("nnnnnn:n"));return function(_,C,$,q,P,N){h(_);const M=e._sqlite3_malloc(q);return e.HEAPU8.subarray(M).set($),S(_,C,M,q,P,N)}}();const k=1;t.serialize=function(){const S=e.cwrap("sqlite3_serialize",...se("nsnn:n"));return function(_,C){h(_);const $=s[0];let q=S(_,C,$,0);if(q===0){q=S(_,C,$,k);const P=e.getValue($,"*"),N=e.HEAPU8.subarray(q,q+P);return new Uint8Array(N.slice())}else{const P=e.getValue($,"*"),N=e.HEAPU8.subarray(q,q+P);return new Uint8Array(N)}}}(),t.backup=function(){const E=e.cwrap("sqlite3_backup_init",...se("nsns:n")),S=e.cwrap("sqlite3_backup_step",...se("nn:n")),_=e.cwrap("sqlite3_backup_finish",...se("n:n"));return function(C,$,q,P){h(C),h(q);const N=E(C,$,q,P);if(N===0){const M=e.ccall("sqlite3_errmsg","string",["number"],[C]);throw new pr(`backup failed: ${M}`,wae)}return S(N,-1),_(N)}}(),t.clear_bindings=function(){const E="sqlite3_clear_bindings",S=e.cwrap(E,...se("n:n"));return function(_){g(_);const C=S(_);return O(E,C,p.get(_))}}(),t.close=function(){const E="sqlite3_close",S=e.cwrap(E,...se("n:n"),{async:Ga});return function(_){h(_);const C=S(_);return f.delete(_),O(E,C,_)}}(),t.column=function(E,S){g(E);const _=t.column_type(E,S);switch(_){case tT:return t.column_blob(E,S);case ZC:return t.column_double(E,S);case XC:const C=t.column_int(E,S),$=e.getTempRet0();return u(C,$);case nT:return null;case eT:return t.column_text(E,S);default:throw new pr("unknown type",_)}},t.column_blob=function(){const S=e.cwrap("sqlite3_column_blob",...se("nn:n"));return function(_,C){g(_);const $=t.column_bytes(_,C),q=S(_,C);if(q===0)return null;const P=e.HEAPU8.subarray(q,q+$);return new Uint8Array(P)}}(),t.column_bytes=function(){const S=e.cwrap("sqlite3_column_bytes",...se("nn:n"));return function(_,C){return g(_),S(_,C)}}(),t.column_count=function(){const S=e.cwrap("sqlite3_column_count",...se("n:n"));return function(_){return g(_),S(_)}}(),t.column_double=function(){const S=e.cwrap("sqlite3_column_double",...se("nn:n"));return function(_,C){return g(_),S(_,C)}}(),t.column_int=function(){const S=e.cwrap("sqlite3_column_int64",...se("nn:n"));return function(_,C){return g(_),S(_,C)}}(),t.column_int64=function(){const S=e.cwrap("sqlite3_column_int64",...se("nn:n"));return function(_,C){g(_);const $=S(_,C),q=e.getTempRet0();return a($,q)}}(),t.column_name=function(){const S=e.cwrap("sqlite3_column_name",...se("nn:s"));return function(_,C){return g(_),S(_,C)}}(),t.column_names=function(E){const S=[],_=t.column_count(E);for(let C=0;C<_;++C)S.push(t.column_name(E,C));return S},t.column_text=function(){const S=e.cwrap("sqlite3_column_text",...se("nn:s"));return function(_,C){return g(_),S(_,C)}}(),t.column_type=function(){const S=e.cwrap("sqlite3_column_type",...se("nn:n"));return function(_,C){return g(_),S(_,C)}}(),t.create_function=function(E,S,_,C,$,q,P,N){h(E);function M(F){return(j,X,ye)=>F(j,e.HEAP32.subarray(ye/4,ye/4+X))}const B=e.create_function(E,S,_,C,$,q&&M(q),P&&M(P),N);return O("sqlite3_create_function",B,E)},t.data_count=function(){const S=e.cwrap("sqlite3_data_count",...se("n:n"));return function(_){return g(_),S(_)}}(),t.exec=function(E,S,_){const C=t.statements(E,S,{unscoped:!0});for(const $ of C){let q;for(;t.step($)===kS;)if(_){q=q??t.column_names($);const P=t.row($);_(P,q),_(P,q)}}for(const $ of C)t.finalize($);return re},t.finalize=function(){const S=e.cwrap("sqlite3_finalize",...se("n:n"),{async:Ga});return function(_){const C=S(_);return p.delete(_),C}}(),t.get_autocommit=function(){const S=e.cwrap("sqlite3_get_autocommit",...se("n:n"));return function(_){return S(_)}}(),t.libversion=function(){const S=e.cwrap("sqlite3_libversion",...se(":s"));return function(){return S()}}(),t.libversion_number=function(){const S=e.cwrap("sqlite3_libversion_number",...se(":n"));return function(){return S()}}(),t.limit=function(){const S=e.cwrap("sqlite3_limit",...se("nnn:n"));return function(_,C,$){return S(_,C,$)}}(),t.open_v2=function(){const E="sqlite3_open_v2",S=e.cwrap(E,...se("snnn:n"),{async:Ga});return async function(_,C,$){C=C||cp|YC,$=o($);try{const q=await D(()=>S(_,s[0],C,$)),P=e.getValue(s[0],"*");return f.add(P),e.ccall("RegisterExtensionFunctions","void",["number"],[P]),O(E,q,P),P}finally{e._sqlite3_free($)}}}(),t.open_v2Sync=function(){const E="sqlite3_open_v2",S=e.cwrap(E,...se("snnn:n"),{async:Ga});return function(_,C,$){C=C||cp|YC,$=o($);try{const q=S(_,s[0],C,$),P=e.getValue(s[0],"*");return f.add(P),e.ccall("RegisterExtensionFunctions","void",["number"],[P]),O(E,q,P),P}finally{e._sqlite3_free($)}}}(),t.progress_handler=function(E,S,_,C){h(E),e.progress_handler(E,S,_,C)},t.reset=function(){const E="sqlite3_reset",S=e.cwrap(E,...se("n:n"),{async:Ga});return function(_){g(_);const C=S(_);return O(E,C,p.get(_))}}(),t.result=function(E,S){switch(typeof S){case"number":S===(S|0)?t.result_int(E,S):t.result_double(E,S);break;case"string":t.result_text(E,S);break;default:if(S instanceof Uint8Array||Array.isArray(S))t.result_blob(E,S);else if(S===null)t.result_null(E);else{if(typeof S=="bigint")return t.result_int64(E,S);console.warn("unknown result converted to null",S),t.result_null(E)}break}},t.result_blob=function(){const S=e.cwrap("sqlite3_result_blob",...se("nnnn:n"));return function(_,C){const $=C.byteLength??C.length,q=e._sqlite3_malloc($);e.HEAPU8.subarray(q).set(C),S(_,q,$,n)}}(),t.result_double=function(){const S=e.cwrap("sqlite3_result_double",...se("nn:n"));return function(_,C){S(_,C)}}(),t.result_int=function(){const S=e.cwrap("sqlite3_result_int",...se("nn:n"));return function(_,C){S(_,C)}}(),t.result_int64=function(){const S=e.cwrap("sqlite3_result_int64",...se("nnn:n"));return function(_,C){if(C>cT||C<uT)return Ty;const $=C&0xffffffffn,q=C>>32n;S(_,Number($),Number(q))}}(),t.result_null=function(){const S=e.cwrap("sqlite3_result_null",...se("n:n"));return function(_){S(_)}}(),t.result_text=function(){const S=e.cwrap("sqlite3_result_text",...se("nnnn:n"));return function(_,C){const $=o(C);S(_,$,-1,n)}}(),t.row=function(E){const S=[],_=t.data_count(E);for(let C=0;C<_;++C){const $=t.column(E,C);S.push(($==null?void 0:$.buffer)===e.HEAPU8.buffer?$.slice():$)}return S},t.set_authorizer=function(E,S,_){h(E);function C(P,N,M,B,F,j){return[P,N,e.UTF8ToString(M),e.UTF8ToString(B),e.UTF8ToString(F),e.UTF8ToString(j)]}function $(P){return(N,M,B,F,j,X)=>P(...C(N,M,B,F,j,X))}const q=e.set_authorizer(E,$(S),_);return O("sqlite3_set_authorizer",q,E)},t.sql=function(){const S=e.cwrap("sqlite3_sql",...se("n:s"));return function(_){return g(_),S(_)}}(),t.statements=function(E,S,_={}){const C=e.cwrap("sqlite3_prepare_v3","number",["number","number","number","number","number","number"],{async:!1}),$=[],q=new TextEncoder().encode(S),P=q.byteLength-q.byteLength%4+12,N=e._sqlite3_malloc(P),M=N+q.byteLength+1;e.HEAPU8.set(q,N),e.HEAPU8[M-1]=0;const B=N+P-8,F=N+P-4;let j;function X(){j&&!_.unscoped&&t.finalize(j),j=0}e.setValue(F,N,"*");do{X();const ye=e.getValue(F,"*"),G=C(E,ye,M-F,_.flags||0,B,F);G!==re&&O("sqlite3_prepare_v3",G,E),j=e.getValue(B,"*"),j&&(p.set(j,E),$.push(j))}while(j);return $},t.step=function(){const E="sqlite3_step",S=e.cwrap(E,...se("n:n"),{async:Ga});return function(_){g(_);const C=S(_);return O(E,C,p.get(_),[kS,Eae])}}(),t.commit_hook=function(E,S){h(E),e.commit_hook(E,S)},t.update_hook=function(E,S){h(E);function _($,q,P,N,M){return[$,e.UTF8ToString(q),e.UTF8ToString(P),a(N,M)]}function C($){return(q,P,N,M,B)=>$(..._(q,P,N,M,B))}e.update_hook(E,C(S))},t.session_create=function(){const E="sqlite3session_create",S=e.cwrap(E,...se("nsn:n"));return function(_,C){h(_);const $=e._malloc(4),q=S(_,C,$);return q!==re&&O(E,q,_),e.getValue($,"i32")}}(),t.session_attach=function(){const E="sqlite3session_attach",S=e.cwrap(E,...se("ns:n"));return function(_,C){if(typeof _!="number")throw new pr("Invalid session object",Do);const $=S(_,C);return O(E,$)}}(),t.session_enable=function(){const S=e.cwrap("sqlite3session_enable",...se("nn:n"));return function(_,C){const $=C?1:0;if(typeof _!="number")throw new pr("Invalid session object",Do);if(S(_,$)!==$)throw new pr("Failed to enable session",Do)}}(),t.session_changeset=function(){const E="sqlite3session_changeset",S=e.cwrap(E,...se("nnn:n"));return function(_){if(typeof _!="number")throw new pr("Invalid session object",Do);const C=e._malloc(4),$=e._malloc(4);try{const q=S(_,C,$);if(q===re){const P=e.getValue(C,"i32"),N=e.getValue($,"i32");if(N===0)return{result:q,size:0,changeset:null};const M=new Uint8Array(e.HEAPU8.subarray(N,N+P));return e._sqlite3_free(N),{result:q,size:P,changeset:M}}return O(E,q)}finally{e._free(C),e._free($)}}}(),t.session_delete=function(){const S=e.cwrap("sqlite3session_delete",...se("n:v"));return function(_){if(typeof _!="number")throw new pr("Invalid session object",Do);return S(_)}}(),t.changeset_start=function(){const E="sqlite3changeset_start",S=e.cwrap(E,...se("nnn:n"));return function(_){const C=e._sqlite3_malloc(_.length);e.HEAPU8.subarray(C).set(_);const $=e._malloc(4);try{const q=S($,_.length,C);return q!==re&&O(E,q),e.getValue($,"i32")}finally{e._sqlite3_free(C),e._free($)}}}(),t.changeset_finalize=function(){const S=e.cwrap("sqlite3changeset_finalize",...se("n:n"));return function(_){return S(_)}}(),t.changeset_invert=function(){const E="sqlite3changeset_invert",S=e.cwrap(E,...se("nn:nn"));return function(_){const C=e._sqlite3_malloc(_.length);e.HEAPU8.subarray(C).set(_);const $=e._malloc(4),q=e._malloc(4),P=S(_.length,C,$,q);P!==re&&O(E,P);const N=e.getValue($,"i32"),M=e.getValue(q,"i32"),B=new Uint8Array(e.HEAPU8.buffer,M,N).slice();return e._sqlite3_free(C),e._sqlite3_free(M),B}}(),t.session_changeset_inverted=function(){const E="sqlite3session_changeset",S=e.cwrap(E,...se("nnn:n")),_="sqlite3changeset_invert",C=e.cwrap(_,...se("nn:nn"));return function($){if(typeof $!="number")throw new pr("Invalid session object",Do);const q=e._malloc(4),P=e._malloc(4),N=e._malloc(4),M=e._malloc(4);try{const B=S($,q,P);if(B!==re)return O(E,B);const F=e.getValue(q,"i32"),j=e.getValue(P,"i32"),X=C(F,j,N,M);if(X!==re)return O(_,X);const ye=e.getValue(N,"i32"),G=e.getValue(M,"i32"),ve=new Uint8Array(e.HEAPU8.buffer,G,ye);return e._sqlite3_free(j),e._sqlite3_free(G),{result:B,size:F,changeset:new Uint8Array(ve)}}finally{e._free(q),e._free(P),e._free(N),e._free(M)}}}(),t.changeset_apply=function(){const E="sqlite3changeset_apply",S=e.cwrap(E,...se("nnnnnn:n"));return function(_,C,$){const q=e._sqlite3_malloc(C.length);e.HEAPU8.subarray(q).set(C);const P=1,N=()=>P,M=S(_,C.length,q,null,N,null);return e._sqlite3_free(q),M!==re&&O(E,M),M}}(),t.value=function(E){const S=t.value_type(E);switch(S){case tT:return t.value_blob(E);case ZC:return t.value_double(E);case XC:const _=t.value_int(E),C=e.getTempRet0();return u(_,C);case nT:return null;case eT:return t.value_text(E);default:throw new pr("unknown type",S)}},t.value_blob=function(){const S=e.cwrap("sqlite3_value_blob",...se("n:n"));return function(_){const C=t.value_bytes(_),$=S(_);return e.HEAPU8.subarray($,$+C)}}(),t.value_bytes=function(){const S=e.cwrap("sqlite3_value_bytes",...se("n:n"));return function(_){return S(_)}}(),t.value_double=function(){const S=e.cwrap("sqlite3_value_double",...se("n:n"));return function(_){return S(_)}}(),t.value_int=function(){const S=e.cwrap("sqlite3_value_int64",...se("n:n"));return function(_){return S(_)}}(),t.value_int64=function(){const S=e.cwrap("sqlite3_value_int64",...se("n:n"));return function(_){const C=S(_),$=e.getTempRet0();return a(C,$)}}(),t.value_text=function(){const S=e.cwrap("sqlite3_value_text",...se("n:s"));return function(_){return S(_)}}(),t.value_type=function(){const S=e.cwrap("sqlite3_value_type",...se("n:n"));return function(_){return S(_)}}();const T=new Set;t.vfs_register=function(E,S){if(T.has(E.name))return;const _=e.vfs_register(E,S),C=O("sqlite3_vfs_register",_);return T.add(E.name),C},t.vfs_registered=T;function O(E,S,_=null,C=[re]){if(C.includes(S))return S;const $=_?e.ccall("sqlite3_errmsg","string",["number"],[_]):E;throw new pr($,S)}async function D(E){let S;do e.retryOps.length&&(await Promise.all(e.retryOps),e.retryOps=[]),S=await E();while(S&&e.retryOps.length);return S}return t}function se(e){const t=[],n=e.match(/([ns@]*):([nsv@])/);switch(n[2]){case"n":t.push("number");break;case"s":t.push("string");break;case"v":t.push(null);break}const r=[];for(let s of n[1])switch(s){case"n":r.push("number");break;case"s":r.push("string");break}return t.push(r),t}var zae=(()=>{var e=import.meta.url;return function(t={}){var n,r=t,s,o,a=new Promise((i,c)=>{s=i,o=c}),u=typeof window=="object",f=typeof WorkerGlobalScope<"u";typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";var h=Object.assign({},r),p="./this.program",g=(i,c)=>{throw c},k="";function T(i){return r.locateFile?r.locateFile(i,k):k+i}var O,D;(u||f)&&(f?k=self.location.href:typeof document<"u"&&document.currentScript&&(k=document.currentScript.src),e&&(k=e),k.startsWith("blob:")?k="":k=k.substr(0,k.replace(/[?#].*/,"").lastIndexOf("/")+1),f&&(D=i=>{var c=new XMLHttpRequest;return c.open("GET",i,!1),c.responseType="arraybuffer",c.send(null),new Uint8Array(c.response)}),O=i=>fetch(i,{credentials:"same-origin"}).then(c=>c.ok?c.arrayBuffer():Promise.reject(new Error(c.status+" : "+c.url))));var E=r.print||console.log.bind(console),S=r.printErr||console.error.bind(console);Object.assign(r,h),h=null,r.arguments&&r.arguments,r.thisProgram&&(p=r.thisProgram);var _=r.wasmBinary,C,$=!1,q,P,N,M,B,F,j,X,ye;function G(){var i=C.buffer;r.HEAP8=P=new Int8Array(i),r.HEAP16=M=new Int16Array(i),r.HEAPU8=N=new Uint8Array(i),r.HEAPU16=B=new Uint16Array(i),r.HEAP32=F=new Int32Array(i),r.HEAPU32=j=new Uint32Array(i),r.HEAPF32=X=new Float32Array(i),r.HEAPF64=ye=new Float64Array(i)}var ve=[],Re=[],Be=[],Xe=[];function He(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)Hu(r.preRun.shift());zd(ve)}function Dt(){!r.noFSInit&&!b.initialized&&b.init(),b.ignorePermissions=!1,zd(Re)}function On(){zd(Be)}function Bu(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)Ud(r.postRun.shift());zd(Xe)}function Hu(i){ve.unshift(i)}function Vu(i){Re.unshift(i)}function Ud(i){Xe.unshift(i)}var es=0,Ao=null;function A_(i){return i}function xr(i){var c;es++,(c=r.monitorRunDependencies)==null||c.call(r,es)}function Na(i){var l;if(es--,(l=r.monitorRunDependencies)==null||l.call(r,es),es==0&&Ao){var c=Ao;Ao=null,c()}}function ts(i){var l;(l=r.onAbort)==null||l.call(r,i),i="Aborted("+i+")",S(i),$=!0,i+=". Build with -sASSERTIONS for more info.";var c=new WebAssembly.RuntimeError(i);throw o(c),c}var b3="data:application/octet-stream;base64,",S0=i=>i.startsWith(b3);function S3(){if(r.locateFile){var i="wa-sqlite.wasm";return S0(i)?i:T(i)}return new URL("/assets/wa-sqlite-CWx0VZcQ.wasm",import.meta.url).href}var P_;function w0(i){if(i==P_&&_)return new Uint8Array(_);if(D)return D(i);throw"both async and sync fetching of the wasm failed"}function w3(i){return _?Promise.resolve().then(()=>w0(i)):O(i).then(c=>new Uint8Array(c),()=>w0(i))}function v0(i,c,l){return w3(i).then(m=>WebAssembly.instantiate(m,c)).then(l,m=>{S(`failed to asynchronously prepare wasm: ${m}`),ts(m)})}function v3(i,c,l,m){return!i&&typeof WebAssembly.instantiateStreaming=="function"&&!S0(c)&&typeof fetch=="function"?fetch(c,{credentials:"same-origin"}).then(w=>{var R=WebAssembly.instantiateStreaming(w,l);return R.then(m,function(A){return S(`wasm streaming compile failed: ${A}`),S("falling back to ArrayBuffer instantiation"),v0(c,l,m)})}):v0(c,l,m)}function E3(){return{a:kM}}function k3(){function i(m,w){return I=m.exports,C=I.la,G(),ja=I.of,Vu(I.ma),Na(),I}xr();function c(m){i(m.instance)}var l=E3();if(r.instantiateWasm)try{return r.instantiateWasm(l,i)}catch(m){S(`Module.instantiateWasm callback failed with error: ${m}`),o(m)}return P_??(P_=S3()),v3(_,P_,l,c).catch(o),{}}var be,Ot;class E0{constructor(c){d(this,"name","ExitStatus");this.message=`Program terminated with exit(${c})`,this.status=c}}var zd=i=>{for(;i.length>0;)i.shift()(r)};function k0(i,c="i8"){switch(c.endsWith("*")&&(c="*"),c){case"i1":return P[i];case"i8":return P[i];case"i16":return M[i>>1];case"i32":return F[i>>2];case"i64":ts("to do getValue(i64) use WASM_BIGINT");case"float":return X[i>>2];case"double":return ye[i>>3];case"*":return j[i>>2];default:ts(`invalid type for getValue: ${c}`)}}r.noExitRuntime;function Da(i,c,l="i8"){switch(l.endsWith("*")&&(l="*"),l){case"i1":P[i]=c;break;case"i8":P[i]=c;break;case"i16":M[i>>1]=c;break;case"i32":F[i>>2]=c;break;case"i64":ts("to do setValue(i64) use WASM_BIGINT");case"float":X[i>>2]=c;break;case"double":ye[i>>3]=c;break;case"*":j[i>>2]=c;break;default:ts(`invalid type for setValue: ${l}`)}}var $3=i=>j0(i),C3=()=>z0(),$0=typeof TextDecoder<"u"?new TextDecoder:void 0,Ma=(i,c=0,l=NaN)=>{for(var m=c+l,w=c;i[w]&&!(w>=m);)++w;if(w-c>16&&i.buffer&&$0)return $0.decode(i.subarray(c,w));for(var R="";c<w;){var A=i[c++];if(!(A&128)){R+=String.fromCharCode(A);continue}var x=i[c++]&63;if((A&224)==192){R+=String.fromCharCode((A&31)<<6|x);continue}var H=i[c++]&63;if((A&240)==224?A=(A&15)<<12|x<<6|H:A=(A&7)<<18|x<<12|H<<6|i[c++]&63,A<65536)R+=String.fromCharCode(A);else{var ee=A-65536;R+=String.fromCharCode(55296|ee>>10,56320|ee&1023)}}return R},gi=(i,c)=>i?Ma(N,i,c):"",T3=(i,c,l,m)=>ts(`Assertion failed: ${gi(i)}, at: `+[c?gi(c):"unknown filename",l,m?gi(m):"unknown function"]),ft={isAbs:i=>i.charAt(0)==="/",splitPath:i=>{var c=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return c.exec(i).slice(1)},normalizeArray:(i,c)=>{for(var l=0,m=i.length-1;m>=0;m--){var w=i[m];w==="."?i.splice(m,1):w===".."?(i.splice(m,1),l++):l&&(i.splice(m,1),l--)}if(c)for(;l;l--)i.unshift("..");return i},normalize:i=>{var c=ft.isAbs(i),l=i.substr(-1)==="/";return i=ft.normalizeArray(i.split("/").filter(m=>!!m),!c).join("/"),!i&&!c&&(i="."),i&&l&&(i+="/"),(c?"/":"")+i},dirname:i=>{var c=ft.splitPath(i),l=c[0],m=c[1];return!l&&!m?".":(m&&(m=m.substr(0,m.length-1)),l+m)},basename:i=>{if(i==="/")return"/";i=ft.normalize(i),i=i.replace(/\/$/,"");var c=i.lastIndexOf("/");return c===-1?i:i.substr(c+1)},join:(...i)=>ft.normalize(i.join("/")),join2:(i,c)=>ft.normalize(i+"/"+c)},I3=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return i=>crypto.getRandomValues(i);ts("initRandomDevice")},C0=i=>(C0=I3())(i),Po={resolve:(...i)=>{for(var c="",l=!1,m=i.length-1;m>=-1&&!l;m--){var w=m>=0?i[m]:b.cwd();if(typeof w!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!w)return"";c=w+"/"+c,l=ft.isAbs(w)}return c=ft.normalizeArray(c.split("/").filter(R=>!!R),!l).join("/"),(l?"/":"")+c||"."},relative:(i,c)=>{i=Po.resolve(i).substr(1),c=Po.resolve(c).substr(1);function l(ee){for(var Ce=0;Ce<ee.length&&ee[Ce]==="";Ce++);for(var qe=ee.length-1;qe>=0&&ee[qe]==="";qe--);return Ce>qe?[]:ee.slice(Ce,qe-Ce+1)}for(var m=l(i.split("/")),w=l(c.split("/")),R=Math.min(m.length,w.length),A=R,x=0;x<R;x++)if(m[x]!==w[x]){A=x;break}for(var H=[],x=A;x<m.length;x++)H.push("..");return H=H.concat(w.slice(A)),H.join("/")}},F_=[],La=i=>{for(var c=0,l=0;l<i.length;++l){var m=i.charCodeAt(l);m<=127?c++:m<=2047?c+=2:m>=55296&&m<=57343?(c+=4,++l):c+=3}return c},x_=(i,c,l,m)=>{if(!(m>0))return 0;for(var w=l,R=l+m-1,A=0;A<i.length;++A){var x=i.charCodeAt(A);if(x>=55296&&x<=57343){var H=i.charCodeAt(++A);x=65536+((x&1023)<<10)|H&1023}if(x<=127){if(l>=R)break;c[l++]=x}else if(x<=2047){if(l+1>=R)break;c[l++]=192|x>>6,c[l++]=128|x&63}else if(x<=65535){if(l+2>=R)break;c[l++]=224|x>>12,c[l++]=128|x>>6&63,c[l++]=128|x&63}else{if(l+3>=R)break;c[l++]=240|x>>18,c[l++]=128|x>>12&63,c[l++]=128|x>>6&63,c[l++]=128|x&63}}return c[l]=0,l-w};function N_(i,c,l){var m=l>0?l:La(i)+1,w=new Array(m),R=x_(i,w,0,w.length);return c&&(w.length=R),w}var R3=()=>{if(!F_.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"&&(i=window.prompt("Input: "),i!==null&&(i+=`
`)),!i)return null;F_=N_(i,!0)}return F_.shift()},_i={ttys:[],init(){},shutdown(){},register(i,c){_i.ttys[i]={input:[],output:[],ops:c},b.registerDevice(i,_i.stream_ops)},stream_ops:{open(i){var c=_i.ttys[i.node.rdev];if(!c)throw new b.ErrnoError(43);i.tty=c,i.seekable=!1},close(i){i.tty.ops.fsync(i.tty)},fsync(i){i.tty.ops.fsync(i.tty)},read(i,c,l,m,w){if(!i.tty||!i.tty.ops.get_char)throw new b.ErrnoError(60);for(var R=0,A=0;A<m;A++){var x;try{x=i.tty.ops.get_char(i.tty)}catch{throw new b.ErrnoError(29)}if(x===void 0&&R===0)throw new b.ErrnoError(6);if(x==null)break;R++,c[l+A]=x}return R&&(i.node.timestamp=Date.now()),R},write(i,c,l,m,w){if(!i.tty||!i.tty.ops.put_char)throw new b.ErrnoError(60);try{for(var R=0;R<m;R++)i.tty.ops.put_char(i.tty,c[l+R])}catch{throw new b.ErrnoError(29)}return m&&(i.node.timestamp=Date.now()),R}},default_tty_ops:{get_char(i){return R3()},put_char(i,c){c===null||c===10?(E(Ma(i.output)),i.output=[]):c!=0&&i.output.push(c)},fsync(i){i.output&&i.output.length>0&&(E(Ma(i.output)),i.output=[])},ioctl_tcgets(i){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(i,c,l){return 0},ioctl_tiocgwinsz(i){return[24,80]}},default_tty1_ops:{put_char(i,c){c===null||c===10?(S(Ma(i.output)),i.output=[]):c!=0&&i.output.push(c)},fsync(i){i.output&&i.output.length>0&&(S(Ma(i.output)),i.output=[])}}},O3=(i,c)=>{N.fill(0,i,i+c)},T0=(i,c)=>Math.ceil(i/c)*c,I0=i=>{i=T0(i,65536);var c=M0(65536,i);return c&&O3(c,i),c},ke={ops_table:null,mount(i){return ke.createNode(null,"/",16895,0)},createNode(i,c,l,m){if(b.isBlkdev(l)||b.isFIFO(l))throw new b.ErrnoError(63);ke.ops_table||(ke.ops_table={dir:{node:{getattr:ke.node_ops.getattr,setattr:ke.node_ops.setattr,lookup:ke.node_ops.lookup,mknod:ke.node_ops.mknod,rename:ke.node_ops.rename,unlink:ke.node_ops.unlink,rmdir:ke.node_ops.rmdir,readdir:ke.node_ops.readdir,symlink:ke.node_ops.symlink},stream:{llseek:ke.stream_ops.llseek}},file:{node:{getattr:ke.node_ops.getattr,setattr:ke.node_ops.setattr},stream:{llseek:ke.stream_ops.llseek,read:ke.stream_ops.read,write:ke.stream_ops.write,allocate:ke.stream_ops.allocate,mmap:ke.stream_ops.mmap,msync:ke.stream_ops.msync}},link:{node:{getattr:ke.node_ops.getattr,setattr:ke.node_ops.setattr,readlink:ke.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ke.node_ops.getattr,setattr:ke.node_ops.setattr},stream:b.chrdev_stream_ops}});var w=b.createNode(i,c,l,m);return b.isDir(w.mode)?(w.node_ops=ke.ops_table.dir.node,w.stream_ops=ke.ops_table.dir.stream,w.contents={}):b.isFile(w.mode)?(w.node_ops=ke.ops_table.file.node,w.stream_ops=ke.ops_table.file.stream,w.usedBytes=0,w.contents=null):b.isLink(w.mode)?(w.node_ops=ke.ops_table.link.node,w.stream_ops=ke.ops_table.link.stream):b.isChrdev(w.mode)&&(w.node_ops=ke.ops_table.chrdev.node,w.stream_ops=ke.ops_table.chrdev.stream),w.timestamp=Date.now(),i&&(i.contents[c]=w,i.timestamp=w.timestamp),w},getFileDataAsTypedArray(i){return i.contents?i.contents.subarray?i.contents.subarray(0,i.usedBytes):new Uint8Array(i.contents):new Uint8Array(0)},expandFileStorage(i,c){var l=i.contents?i.contents.length:0;if(!(l>=c)){var m=1024*1024;c=Math.max(c,l*(l<m?2:1.125)>>>0),l!=0&&(c=Math.max(c,256));var w=i.contents;i.contents=new Uint8Array(c),i.usedBytes>0&&i.contents.set(w.subarray(0,i.usedBytes),0)}},resizeFileStorage(i,c){if(i.usedBytes!=c)if(c==0)i.contents=null,i.usedBytes=0;else{var l=i.contents;i.contents=new Uint8Array(c),l&&i.contents.set(l.subarray(0,Math.min(c,i.usedBytes))),i.usedBytes=c}},node_ops:{getattr(i){var c={};return c.dev=b.isChrdev(i.mode)?i.id:1,c.ino=i.id,c.mode=i.mode,c.nlink=1,c.uid=0,c.gid=0,c.rdev=i.rdev,b.isDir(i.mode)?c.size=4096:b.isFile(i.mode)?c.size=i.usedBytes:b.isLink(i.mode)?c.size=i.link.length:c.size=0,c.atime=new Date(i.timestamp),c.mtime=new Date(i.timestamp),c.ctime=new Date(i.timestamp),c.blksize=4096,c.blocks=Math.ceil(c.size/c.blksize),c},setattr(i,c){c.mode!==void 0&&(i.mode=c.mode),c.timestamp!==void 0&&(i.timestamp=c.timestamp),c.size!==void 0&&ke.resizeFileStorage(i,c.size)},lookup(i,c){throw ke.doesNotExistError},mknod(i,c,l,m){return ke.createNode(i,c,l,m)},rename(i,c,l){if(b.isDir(i.mode)){var m;try{m=b.lookupNode(c,l)}catch{}if(m)for(var w in m.contents)throw new b.ErrnoError(55)}delete i.parent.contents[i.name],i.parent.timestamp=Date.now(),i.name=l,c.contents[l]=i,c.timestamp=i.parent.timestamp},unlink(i,c){delete i.contents[c],i.timestamp=Date.now()},rmdir(i,c){var l=b.lookupNode(i,c);for(var m in l.contents)throw new b.ErrnoError(55);delete i.contents[c],i.timestamp=Date.now()},readdir(i){var c=[".",".."];for(var l of Object.keys(i.contents))c.push(l);return c},symlink(i,c,l){var m=ke.createNode(i,c,41471,0);return m.link=l,m},readlink(i){if(!b.isLink(i.mode))throw new b.ErrnoError(28);return i.link}},stream_ops:{read(i,c,l,m,w){var R=i.node.contents;if(w>=i.node.usedBytes)return 0;var A=Math.min(i.node.usedBytes-w,m);if(A>8&&R.subarray)c.set(R.subarray(w,w+A),l);else for(var x=0;x<A;x++)c[l+x]=R[w+x];return A},write(i,c,l,m,w,R){if(c.buffer===P.buffer&&(R=!1),!m)return 0;var A=i.node;if(A.timestamp=Date.now(),c.subarray&&(!A.contents||A.contents.subarray)){if(R)return A.contents=c.subarray(l,l+m),A.usedBytes=m,m;if(A.usedBytes===0&&w===0)return A.contents=c.slice(l,l+m),A.usedBytes=m,m;if(w+m<=A.usedBytes)return A.contents.set(c.subarray(l,l+m),w),m}if(ke.expandFileStorage(A,w+m),A.contents.subarray&&c.subarray)A.contents.set(c.subarray(l,l+m),w);else for(var x=0;x<m;x++)A.contents[w+x]=c[l+x];return A.usedBytes=Math.max(A.usedBytes,w+m),m},llseek(i,c,l){var m=c;if(l===1?m+=i.position:l===2&&b.isFile(i.node.mode)&&(m+=i.node.usedBytes),m<0)throw new b.ErrnoError(28);return m},allocate(i,c,l){ke.expandFileStorage(i.node,c+l),i.node.usedBytes=Math.max(i.node.usedBytes,c+l)},mmap(i,c,l,m,w){if(!b.isFile(i.node.mode))throw new b.ErrnoError(43);var R,A,x=i.node.contents;if(!(w&2)&&x&&x.buffer===P.buffer)A=!1,R=x.byteOffset;else{if(A=!0,R=I0(c),!R)throw new b.ErrnoError(48);x&&((l>0||l+c<x.length)&&(x.subarray?x=x.subarray(l,l+c):x=Array.prototype.slice.call(x,l,l+c)),P.set(x,R))}return{ptr:R,allocated:A}},msync(i,c,l,m,w){return ke.stream_ops.write(i,c,0,m,l,!1),0}}},q3=(i,c,l,m)=>{var w=`al ${i}`;O(i).then(R=>{c(new Uint8Array(R)),w&&Na()},R=>{if(l)l();else throw`Loading data file "${i}" failed.`}),w&&xr()},A3=(i,c,l,m,w,R)=>{b.createDataFile(i,c,l,m,w,R)},P3=r.preloadPlugins||[],F3=(i,c,l,m)=>{typeof Browser<"u"&&Browser.init();var w=!1;return P3.forEach(R=>{w||R.canHandle(c)&&(R.handle(i,c,l,m),w=!0)}),w},x3=(i,c,l,m,w,R,A,x,H,ee)=>{var Ce=c?Po.resolve(ft.join2(i,c)):i;function qe(Ge){function ae(le){ee==null||ee(),x||A3(i,c,le,m,w,H),R==null||R(),Na()}F3(Ge,Ce,ae,()=>{A==null||A(),Na()})||ae(Ge)}xr(),typeof l=="string"?q3(l,qe,A):qe(l)},N3=i=>{var c={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},l=c[i];if(typeof l>"u")throw new Error(`Unknown file open mode: ${i}`);return l},D_=(i,c)=>{var l=0;return i&&(l|=365),c&&(l|=146),l},b={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class{constructor(i){d(this,"name","ErrnoError");this.errno=i}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{constructor(){d(this,"shared",{})}get object(){return this.node}set object(i){this.node=i}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(i){this.shared.flags=i}get position(){return this.shared.position}set position(i){this.shared.position=i}},FSNode:class{constructor(i,c,l,m){d(this,"node_ops",{});d(this,"stream_ops",{});d(this,"readMode",365);d(this,"writeMode",146);d(this,"mounted",null);i||(i=this),this.parent=i,this.mount=i.mount,this.id=b.nextInode++,this.name=c,this.mode=l,this.rdev=m}get read(){return(this.mode&this.readMode)===this.readMode}set read(i){i?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(i){i?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return b.isDir(this.mode)}get isDevice(){return b.isChrdev(this.mode)}},lookupPath(i,c={}){if(i=Po.resolve(i),!i)return{path:"",node:null};var l={follow_mount:!0,recurse_count:0};if(c=Object.assign(l,c),c.recurse_count>8)throw new b.ErrnoError(32);for(var m=i.split("/").filter(qe=>!!qe),w=b.root,R="/",A=0;A<m.length;A++){var x=A===m.length-1;if(x&&c.parent)break;if(w=b.lookupNode(w,m[A]),R=ft.join2(R,m[A]),b.isMountpoint(w)&&(!x||x&&c.follow_mount)&&(w=w.mounted.root),!x||c.follow)for(var H=0;b.isLink(w.mode);){var ee=b.readlink(R);R=Po.resolve(ft.dirname(R),ee);var Ce=b.lookupPath(R,{recurse_count:c.recurse_count+1});if(w=Ce.node,H++>40)throw new b.ErrnoError(32)}}return{path:R,node:w}},getPath(i){for(var c;;){if(b.isRoot(i)){var l=i.mount.mountpoint;return c?l[l.length-1]!=="/"?`${l}/${c}`:l+c:l}c=c?`${i.name}/${c}`:i.name,i=i.parent}},hashName(i,c){for(var l=0,m=0;m<c.length;m++)l=(l<<5)-l+c.charCodeAt(m)|0;return(i+l>>>0)%b.nameTable.length},hashAddNode(i){var c=b.hashName(i.parent.id,i.name);i.name_next=b.nameTable[c],b.nameTable[c]=i},hashRemoveNode(i){var c=b.hashName(i.parent.id,i.name);if(b.nameTable[c]===i)b.nameTable[c]=i.name_next;else for(var l=b.nameTable[c];l;){if(l.name_next===i){l.name_next=i.name_next;break}l=l.name_next}},lookupNode(i,c){var l=b.mayLookup(i);if(l)throw new b.ErrnoError(l);for(var m=b.hashName(i.id,c),w=b.nameTable[m];w;w=w.name_next){var R=w.name;if(w.parent.id===i.id&&R===c)return w}return b.lookup(i,c)},createNode(i,c,l,m){var w=new b.FSNode(i,c,l,m);return b.hashAddNode(w),w},destroyNode(i){b.hashRemoveNode(i)},isRoot(i){return i===i.parent},isMountpoint(i){return!!i.mounted},isFile(i){return(i&61440)===32768},isDir(i){return(i&61440)===16384},isLink(i){return(i&61440)===40960},isChrdev(i){return(i&61440)===8192},isBlkdev(i){return(i&61440)===24576},isFIFO(i){return(i&61440)===4096},isSocket(i){return(i&49152)===49152},flagsToPermissionString(i){var c=["r","w","rw"][i&3];return i&512&&(c+="w"),c},nodePermissions(i,c){return b.ignorePermissions?0:c.includes("r")&&!(i.mode&292)||c.includes("w")&&!(i.mode&146)||c.includes("x")&&!(i.mode&73)?2:0},mayLookup(i){if(!b.isDir(i.mode))return 54;var c=b.nodePermissions(i,"x");return c||(i.node_ops.lookup?0:2)},mayCreate(i,c){var l;try{return l=b.lookupNode(i,c),20}catch{}return b.nodePermissions(i,"wx")},mayDelete(i,c,l){var m;try{m=b.lookupNode(i,c)}catch(R){return R.errno}var w=b.nodePermissions(i,"wx");if(w)return w;if(l){if(!b.isDir(m.mode))return 54;if(b.isRoot(m)||b.getPath(m)===b.cwd())return 10}else if(b.isDir(m.mode))return 31;return 0},mayOpen(i,c){return i?b.isLink(i.mode)?32:b.isDir(i.mode)&&(b.flagsToPermissionString(c)!=="r"||c&512)?31:b.nodePermissions(i,b.flagsToPermissionString(c)):44},MAX_OPEN_FDS:4096,nextfd(){for(var i=0;i<=b.MAX_OPEN_FDS;i++)if(!b.streams[i])return i;throw new b.ErrnoError(33)},getStreamChecked(i){var c=b.getStream(i);if(!c)throw new b.ErrnoError(8);return c},getStream:i=>b.streams[i],createStream(i,c=-1){return i=Object.assign(new b.FSStream,i),c==-1&&(c=b.nextfd()),i.fd=c,b.streams[c]=i,i},closeStream(i){b.streams[i]=null},dupStream(i,c=-1){var m,w;var l=b.createStream(i,c);return(w=(m=l.stream_ops)==null?void 0:m.dup)==null||w.call(m,l),l},chrdev_stream_ops:{open(i){var l,m;var c=b.getDevice(i.node.rdev);i.stream_ops=c.stream_ops,(m=(l=i.stream_ops).open)==null||m.call(l,i)},llseek(){throw new b.ErrnoError(70)}},major:i=>i>>8,minor:i=>i&255,makedev:(i,c)=>i<<8|c,registerDevice(i,c){b.devices[i]={stream_ops:c}},getDevice:i=>b.devices[i],getMounts(i){for(var c=[],l=[i];l.length;){var m=l.pop();c.push(m),l.push(...m.mounts)}return c},syncfs(i,c){typeof i=="function"&&(c=i,i=!1),b.syncFSRequests++,b.syncFSRequests>1&&S(`warning: ${b.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var l=b.getMounts(b.root.mount),m=0;function w(A){return b.syncFSRequests--,c(A)}function R(A){if(A)return R.errored?void 0:(R.errored=!0,w(A));++m>=l.length&&w(null)}l.forEach(A=>{if(!A.type.syncfs)return R(null);A.type.syncfs(A,i,R)})},mount(i,c,l){var m=l==="/",w=!l,R;if(m&&b.root)throw new b.ErrnoError(10);if(!m&&!w){var A=b.lookupPath(l,{follow_mount:!1});if(l=A.path,R=A.node,b.isMountpoint(R))throw new b.ErrnoError(10);if(!b.isDir(R.mode))throw new b.ErrnoError(54)}var x={type:i,opts:c,mountpoint:l,mounts:[]},H=i.mount(x);return H.mount=x,x.root=H,m?b.root=H:R&&(R.mounted=x,R.mount&&R.mount.mounts.push(x)),H},unmount(i){var c=b.lookupPath(i,{follow_mount:!1});if(!b.isMountpoint(c.node))throw new b.ErrnoError(28);var l=c.node,m=l.mounted,w=b.getMounts(m);Object.keys(b.nameTable).forEach(A=>{for(var x=b.nameTable[A];x;){var H=x.name_next;w.includes(x.mount)&&b.destroyNode(x),x=H}}),l.mounted=null;var R=l.mount.mounts.indexOf(m);l.mount.mounts.splice(R,1)},lookup(i,c){return i.node_ops.lookup(i,c)},mknod(i,c,l){var m=b.lookupPath(i,{parent:!0}),w=m.node,R=ft.basename(i);if(!R||R==="."||R==="..")throw new b.ErrnoError(28);var A=b.mayCreate(w,R);if(A)throw new b.ErrnoError(A);if(!w.node_ops.mknod)throw new b.ErrnoError(63);return w.node_ops.mknod(w,R,c,l)},statfs(i){var c={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:b.nextInode,ffree:b.nextInode-1,fsid:42,flags:2,namelen:255},l=b.lookupPath(i,{follow:!0}).node;return l!=null&&l.node_ops.statfs&&Object.assign(c,l.node_ops.statfs(l.mount.opts.root)),c},create(i,c=438){return c&=4095,c|=32768,b.mknod(i,c,0)},mkdir(i,c=511){return c&=1023,c|=16384,b.mknod(i,c,0)},mkdirTree(i,c){for(var l=i.split("/"),m="",w=0;w<l.length;++w)if(l[w]){m+="/"+l[w];try{b.mkdir(m,c)}catch(R){if(R.errno!=20)throw R}}},mkdev(i,c,l){return typeof l>"u"&&(l=c,c=438),c|=8192,b.mknod(i,c,l)},symlink(i,c){if(!Po.resolve(i))throw new b.ErrnoError(44);var l=b.lookupPath(c,{parent:!0}),m=l.node;if(!m)throw new b.ErrnoError(44);var w=ft.basename(c),R=b.mayCreate(m,w);if(R)throw new b.ErrnoError(R);if(!m.node_ops.symlink)throw new b.ErrnoError(63);return m.node_ops.symlink(m,w,i)},rename(i,c){var l=ft.dirname(i),m=ft.dirname(c),w=ft.basename(i),R=ft.basename(c),A,x,H;if(A=b.lookupPath(i,{parent:!0}),x=A.node,A=b.lookupPath(c,{parent:!0}),H=A.node,!x||!H)throw new b.ErrnoError(44);if(x.mount!==H.mount)throw new b.ErrnoError(75);var ee=b.lookupNode(x,w),Ce=Po.relative(i,m);if(Ce.charAt(0)!==".")throw new b.ErrnoError(28);if(Ce=Po.relative(c,l),Ce.charAt(0)!==".")throw new b.ErrnoError(55);var qe;try{qe=b.lookupNode(H,R)}catch{}if(ee!==qe){var Ge=b.isDir(ee.mode),ae=b.mayDelete(x,w,Ge);if(ae)throw new b.ErrnoError(ae);if(ae=qe?b.mayDelete(H,R,Ge):b.mayCreate(H,R),ae)throw new b.ErrnoError(ae);if(!x.node_ops.rename)throw new b.ErrnoError(63);if(b.isMountpoint(ee)||qe&&b.isMountpoint(qe))throw new b.ErrnoError(10);if(H!==x&&(ae=b.nodePermissions(x,"w"),ae))throw new b.ErrnoError(ae);b.hashRemoveNode(ee);try{x.node_ops.rename(ee,H,R),ee.parent=H}catch(le){throw le}finally{b.hashAddNode(ee)}}},rmdir(i){var c=b.lookupPath(i,{parent:!0}),l=c.node,m=ft.basename(i),w=b.lookupNode(l,m),R=b.mayDelete(l,m,!0);if(R)throw new b.ErrnoError(R);if(!l.node_ops.rmdir)throw new b.ErrnoError(63);if(b.isMountpoint(w))throw new b.ErrnoError(10);l.node_ops.rmdir(l,m),b.destroyNode(w)},readdir(i){var c=b.lookupPath(i,{follow:!0}),l=c.node;if(!l.node_ops.readdir)throw new b.ErrnoError(54);return l.node_ops.readdir(l)},unlink(i){var c=b.lookupPath(i,{parent:!0}),l=c.node;if(!l)throw new b.ErrnoError(44);var m=ft.basename(i),w=b.lookupNode(l,m),R=b.mayDelete(l,m,!1);if(R)throw new b.ErrnoError(R);if(!l.node_ops.unlink)throw new b.ErrnoError(63);if(b.isMountpoint(w))throw new b.ErrnoError(10);l.node_ops.unlink(l,m),b.destroyNode(w)},readlink(i){var c=b.lookupPath(i),l=c.node;if(!l)throw new b.ErrnoError(44);if(!l.node_ops.readlink)throw new b.ErrnoError(28);return l.node_ops.readlink(l)},stat(i,c){var l=b.lookupPath(i,{follow:!c}),m=l.node;if(!m)throw new b.ErrnoError(44);if(!m.node_ops.getattr)throw new b.ErrnoError(63);return m.node_ops.getattr(m)},lstat(i){return b.stat(i,!0)},chmod(i,c,l){var m;if(typeof i=="string"){var w=b.lookupPath(i,{follow:!l});m=w.node}else m=i;if(!m.node_ops.setattr)throw new b.ErrnoError(63);m.node_ops.setattr(m,{mode:c&4095|m.mode&-4096,timestamp:Date.now()})},lchmod(i,c){b.chmod(i,c,!0)},fchmod(i,c){var l=b.getStreamChecked(i);b.chmod(l.node,c)},chown(i,c,l,m){var w;if(typeof i=="string"){var R=b.lookupPath(i,{follow:!m});w=R.node}else w=i;if(!w.node_ops.setattr)throw new b.ErrnoError(63);w.node_ops.setattr(w,{timestamp:Date.now()})},lchown(i,c,l){b.chown(i,c,l,!0)},fchown(i,c,l){var m=b.getStreamChecked(i);b.chown(m.node,c,l)},truncate(i,c){if(c<0)throw new b.ErrnoError(28);var l;if(typeof i=="string"){var m=b.lookupPath(i,{follow:!0});l=m.node}else l=i;if(!l.node_ops.setattr)throw new b.ErrnoError(63);if(b.isDir(l.mode))throw new b.ErrnoError(31);if(!b.isFile(l.mode))throw new b.ErrnoError(28);var w=b.nodePermissions(l,"w");if(w)throw new b.ErrnoError(w);l.node_ops.setattr(l,{size:c,timestamp:Date.now()})},ftruncate(i,c){var l=b.getStreamChecked(i);if((l.flags&2097155)===0)throw new b.ErrnoError(28);b.truncate(l.node,c)},utime(i,c,l){var m=b.lookupPath(i,{follow:!0}),w=m.node;w.node_ops.setattr(w,{timestamp:Math.max(c,l)})},open(i,c,l=438){if(i==="")throw new b.ErrnoError(44);c=typeof c=="string"?N3(c):c,c&64?l=l&4095|32768:l=0;var m;if(typeof i=="object")m=i;else{i=ft.normalize(i);try{var w=b.lookupPath(i,{follow:!(c&131072)});m=w.node}catch{}}var R=!1;if(c&64)if(m){if(c&128)throw new b.ErrnoError(20)}else m=b.mknod(i,l,0),R=!0;if(!m)throw new b.ErrnoError(44);if(b.isChrdev(m.mode)&&(c&=-513),c&65536&&!b.isDir(m.mode))throw new b.ErrnoError(54);if(!R){var A=b.mayOpen(m,c);if(A)throw new b.ErrnoError(A)}c&512&&!R&&b.truncate(m,0),c&=-131713;var x=b.createStream({node:m,path:b.getPath(m),flags:c,seekable:!0,position:0,stream_ops:m.stream_ops,ungotten:[],error:!1});return x.stream_ops.open&&x.stream_ops.open(x),r.logReadFiles&&!(c&1)&&(i in b.readFiles||(b.readFiles[i]=1)),x},close(i){if(b.isClosed(i))throw new b.ErrnoError(8);i.getdents&&(i.getdents=null);try{i.stream_ops.close&&i.stream_ops.close(i)}catch(c){throw c}finally{b.closeStream(i.fd)}i.fd=null},isClosed(i){return i.fd===null},llseek(i,c,l){if(b.isClosed(i))throw new b.ErrnoError(8);if(!i.seekable||!i.stream_ops.llseek)throw new b.ErrnoError(70);if(l!=0&&l!=1&&l!=2)throw new b.ErrnoError(28);return i.position=i.stream_ops.llseek(i,c,l),i.ungotten=[],i.position},read(i,c,l,m,w){if(m<0||w<0)throw new b.ErrnoError(28);if(b.isClosed(i))throw new b.ErrnoError(8);if((i.flags&2097155)===1)throw new b.ErrnoError(8);if(b.isDir(i.node.mode))throw new b.ErrnoError(31);if(!i.stream_ops.read)throw new b.ErrnoError(28);var R=typeof w<"u";if(!R)w=i.position;else if(!i.seekable)throw new b.ErrnoError(70);var A=i.stream_ops.read(i,c,l,m,w);return R||(i.position+=A),A},write(i,c,l,m,w,R){if(m<0||w<0)throw new b.ErrnoError(28);if(b.isClosed(i))throw new b.ErrnoError(8);if((i.flags&2097155)===0)throw new b.ErrnoError(8);if(b.isDir(i.node.mode))throw new b.ErrnoError(31);if(!i.stream_ops.write)throw new b.ErrnoError(28);i.seekable&&i.flags&1024&&b.llseek(i,0,2);var A=typeof w<"u";if(!A)w=i.position;else if(!i.seekable)throw new b.ErrnoError(70);var x=i.stream_ops.write(i,c,l,m,w,R);return A||(i.position+=x),x},allocate(i,c,l){if(b.isClosed(i))throw new b.ErrnoError(8);if(c<0||l<=0)throw new b.ErrnoError(28);if((i.flags&2097155)===0)throw new b.ErrnoError(8);if(!b.isFile(i.node.mode)&&!b.isDir(i.node.mode))throw new b.ErrnoError(43);if(!i.stream_ops.allocate)throw new b.ErrnoError(138);i.stream_ops.allocate(i,c,l)},mmap(i,c,l,m,w){if((m&2)!==0&&(w&2)===0&&(i.flags&2097155)!==2)throw new b.ErrnoError(2);if((i.flags&2097155)===1)throw new b.ErrnoError(2);if(!i.stream_ops.mmap)throw new b.ErrnoError(43);if(!c)throw new b.ErrnoError(28);return i.stream_ops.mmap(i,c,l,m,w)},msync(i,c,l,m,w){return i.stream_ops.msync?i.stream_ops.msync(i,c,l,m,w):0},ioctl(i,c,l){if(!i.stream_ops.ioctl)throw new b.ErrnoError(59);return i.stream_ops.ioctl(i,c,l)},readFile(i,c={}){if(c.flags=c.flags||0,c.encoding=c.encoding||"binary",c.encoding!=="utf8"&&c.encoding!=="binary")throw new Error(`Invalid encoding type "${c.encoding}"`);var l,m=b.open(i,c.flags),w=b.stat(i),R=w.size,A=new Uint8Array(R);return b.read(m,A,0,R,0),c.encoding==="utf8"?l=Ma(A):c.encoding==="binary"&&(l=A),b.close(m),l},writeFile(i,c,l={}){l.flags=l.flags||577;var m=b.open(i,l.flags,l.mode);if(typeof c=="string"){var w=new Uint8Array(La(c)+1),R=x_(c,w,0,w.length);b.write(m,w,0,R,void 0,l.canOwn)}else if(ArrayBuffer.isView(c))b.write(m,c,0,c.byteLength,void 0,l.canOwn);else throw new Error("Unsupported data type");b.close(m)},cwd:()=>b.currentPath,chdir(i){var c=b.lookupPath(i,{follow:!0});if(c.node===null)throw new b.ErrnoError(44);if(!b.isDir(c.node.mode))throw new b.ErrnoError(54);var l=b.nodePermissions(c.node,"x");if(l)throw new b.ErrnoError(l);b.currentPath=c.path},createDefaultDirectories(){b.mkdir("/tmp"),b.mkdir("/home"),b.mkdir("/home/web_user")},createDefaultDevices(){b.mkdir("/dev"),b.registerDevice(b.makedev(1,3),{read:()=>0,write:(m,w,R,A,x)=>A,llseek:()=>0}),b.mkdev("/dev/null",b.makedev(1,3)),_i.register(b.makedev(5,0),_i.default_tty_ops),_i.register(b.makedev(6,0),_i.default_tty1_ops),b.mkdev("/dev/tty",b.makedev(5,0)),b.mkdev("/dev/tty1",b.makedev(6,0));var i=new Uint8Array(1024),c=0,l=()=>(c===0&&(c=C0(i).byteLength),i[--c]);b.createDevice("/dev","random",l),b.createDevice("/dev","urandom",l),b.mkdir("/dev/shm"),b.mkdir("/dev/shm/tmp")},createSpecialDirectories(){b.mkdir("/proc");var i=b.mkdir("/proc/self");b.mkdir("/proc/self/fd"),b.mount({mount(){var c=b.createNode(i,"fd",16895,73);return c.node_ops={lookup(l,m){var w=+m,R=b.getStreamChecked(w),A={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>R.path}};return A.parent=A,A}},c}},{},"/proc/self/fd")},createStandardStreams(i,c,l){i?b.createDevice("/dev","stdin",i):b.symlink("/dev/tty","/dev/stdin"),c?b.createDevice("/dev","stdout",null,c):b.symlink("/dev/tty","/dev/stdout"),l?b.createDevice("/dev","stderr",null,l):b.symlink("/dev/tty1","/dev/stderr"),b.open("/dev/stdin",0),b.open("/dev/stdout",1),b.open("/dev/stderr",1)},staticInit(){b.nameTable=new Array(4096),b.mount(ke,{},"/"),b.createDefaultDirectories(),b.createDefaultDevices(),b.createSpecialDirectories(),b.filesystems={MEMFS:ke}},init(i,c,l){b.initialized=!0,i??(i=r.stdin),c??(c=r.stdout),l??(l=r.stderr),b.createStandardStreams(i,c,l)},quit(){b.initialized=!1;for(var i=0;i<b.streams.length;i++){var c=b.streams[i];c&&b.close(c)}},findObject(i,c){var l=b.analyzePath(i,c);return l.exists?l.object:null},analyzePath(i,c){try{var l=b.lookupPath(i,{follow:!c});i=l.path}catch{}var m={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var l=b.lookupPath(i,{parent:!0});m.parentExists=!0,m.parentPath=l.path,m.parentObject=l.node,m.name=ft.basename(i),l=b.lookupPath(i,{follow:!c}),m.exists=!0,m.path=l.path,m.object=l.node,m.name=l.node.name,m.isRoot=l.path==="/"}catch(w){m.error=w.errno}return m},createPath(i,c,l,m){i=typeof i=="string"?i:b.getPath(i);for(var w=c.split("/").reverse();w.length;){var R=w.pop();if(R){var A=ft.join2(i,R);try{b.mkdir(A)}catch{}i=A}}return A},createFile(i,c,l,m,w){var R=ft.join2(typeof i=="string"?i:b.getPath(i),c),A=D_(m,w);return b.create(R,A)},createDataFile(i,c,l,m,w,R){var A=c;i&&(i=typeof i=="string"?i:b.getPath(i),A=c?ft.join2(i,c):i);var x=D_(m,w),H=b.create(A,x);if(l){if(typeof l=="string"){for(var ee=new Array(l.length),Ce=0,qe=l.length;Ce<qe;++Ce)ee[Ce]=l.charCodeAt(Ce);l=ee}b.chmod(H,x|146);var Ge=b.open(H,577);b.write(Ge,l,0,l.length,0,R),b.close(Ge),b.chmod(H,x)}},createDevice(i,c,l,m){var x;var w=ft.join2(typeof i=="string"?i:b.getPath(i),c),R=D_(!!l,!!m);(x=b.createDevice).major??(x.major=64);var A=b.makedev(b.createDevice.major++,0);return b.registerDevice(A,{open(H){H.seekable=!1},close(H){var ee;(ee=m==null?void 0:m.buffer)!=null&&ee.length&&m(10)},read(H,ee,Ce,qe,Ge){for(var ae=0,le=0;le<qe;le++){var dt;try{dt=l()}catch{throw new b.ErrnoError(29)}if(dt===void 0&&ae===0)throw new b.ErrnoError(6);if(dt==null)break;ae++,ee[Ce+le]=dt}return ae&&(H.node.timestamp=Date.now()),ae},write(H,ee,Ce,qe,Ge){for(var ae=0;ae<qe;ae++)try{m(ee[Ce+ae])}catch{throw new b.ErrnoError(29)}return qe&&(H.node.timestamp=Date.now()),ae}}),b.mkdev(w,R,A)},forceLoadFile(i){if(i.isDevice||i.isFolder||i.link||i.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{i.contents=D(i.url),i.usedBytes=i.contents.length}catch{throw new b.ErrnoError(29)}},createLazyFile(i,c,l,m,w){class R{constructor(){d(this,"lengthKnown",!1);d(this,"chunks",[])}get(ae){if(!(ae>this.length-1||ae<0)){var le=ae%this.chunkSize,dt=ae/this.chunkSize|0;return this.getter(dt)[le]}}setDataGetter(ae){this.getter=ae}cacheLength(){var ae=new XMLHttpRequest;if(ae.open("HEAD",l,!1),ae.send(null),!(ae.status>=200&&ae.status<300||ae.status===304))throw new Error("Couldn't load "+l+". Status: "+ae.status);var le=Number(ae.getResponseHeader("Content-length")),dt,Un=(dt=ae.getResponseHeader("Accept-Ranges"))&&dt==="bytes",Zn=(dt=ae.getResponseHeader("Content-Encoding"))&&dt==="gzip",Nr=1024*1024;Un||(Nr=le);var Dr=(ns,za)=>{if(ns>za)throw new Error("invalid range ("+ns+", "+za+") or no bytes requested!");if(za>le-1)throw new Error("only "+le+" bytes available! programmer error!");var gn=new XMLHttpRequest;if(gn.open("GET",l,!1),le!==Nr&&gn.setRequestHeader("Range","bytes="+ns+"-"+za),gn.responseType="arraybuffer",gn.overrideMimeType&&gn.overrideMimeType("text/plain; charset=x-user-defined"),gn.send(null),!(gn.status>=200&&gn.status<300||gn.status===304))throw new Error("Couldn't load "+l+". Status: "+gn.status);return gn.response!==void 0?new Uint8Array(gn.response||[]):N_(gn.responseText||"",!0)},Ju=this;Ju.setDataGetter(ns=>{var za=ns*Nr,gn=(ns+1)*Nr-1;if(gn=Math.min(gn,le-1),typeof Ju.chunks[ns]>"u"&&(Ju.chunks[ns]=Dr(za,gn)),typeof Ju.chunks[ns]>"u")throw new Error("doXHR failed!");return Ju.chunks[ns]}),(Zn||!le)&&(Nr=le=1,le=this.getter(0).length,Nr=le,E("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=le,this._chunkSize=Nr,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!f)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var A=new R,x={isDevice:!1,contents:A}}else var x={isDevice:!1,url:l};var H=b.createFile(i,c,x,m,w);x.contents?H.contents=x.contents:x.url&&(H.contents=null,H.url=x.url),Object.defineProperties(H,{usedBytes:{get:function(){return this.contents.length}}});var ee={},Ce=Object.keys(H.stream_ops);Ce.forEach(Ge=>{var ae=H.stream_ops[Ge];ee[Ge]=(...le)=>(b.forceLoadFile(H),ae(...le))});function qe(Ge,ae,le,dt,Un){var Zn=Ge.node.contents;if(Un>=Zn.length)return 0;var Nr=Math.min(Zn.length-Un,dt);if(Zn.slice)for(var Dr=0;Dr<Nr;Dr++)ae[le+Dr]=Zn[Un+Dr];else for(var Dr=0;Dr<Nr;Dr++)ae[le+Dr]=Zn.get(Un+Dr);return Nr}return ee.read=(Ge,ae,le,dt,Un)=>(b.forceLoadFile(H),qe(Ge,ae,le,dt,Un)),ee.mmap=(Ge,ae,le,dt,Un)=>{b.forceLoadFile(H);var Zn=I0(ae);if(!Zn)throw new b.ErrnoError(48);return qe(Ge,P,Zn,ae,le),{ptr:Zn,allocated:!0}},H.stream_ops=ee,H}},De={DEFAULT_POLLMASK:5,calculateAt(i,c,l){if(ft.isAbs(c))return c;var m;if(i===-100)m=b.cwd();else{var w=De.getStreamFromFD(i);m=w.path}if(c.length==0){if(!l)throw new b.ErrnoError(44);return m}return ft.join2(m,c)},doStat(i,c,l){var m=i(c);F[l>>2]=m.dev,F[l+4>>2]=m.mode,j[l+8>>2]=m.nlink,F[l+12>>2]=m.uid,F[l+16>>2]=m.gid,F[l+20>>2]=m.rdev,Ot=[m.size>>>0,(be=m.size,+Math.abs(be)>=1?be>0?+Math.floor(be/4294967296)>>>0:~~+Math.ceil((be-+(~~be>>>0))/4294967296)>>>0:0)],F[l+24>>2]=Ot[0],F[l+28>>2]=Ot[1],F[l+32>>2]=4096,F[l+36>>2]=m.blocks;var w=m.atime.getTime(),R=m.mtime.getTime(),A=m.ctime.getTime();return Ot=[Math.floor(w/1e3)>>>0,(be=Math.floor(w/1e3),+Math.abs(be)>=1?be>0?+Math.floor(be/4294967296)>>>0:~~+Math.ceil((be-+(~~be>>>0))/4294967296)>>>0:0)],F[l+40>>2]=Ot[0],F[l+44>>2]=Ot[1],j[l+48>>2]=w%1e3*1e3*1e3,Ot=[Math.floor(R/1e3)>>>0,(be=Math.floor(R/1e3),+Math.abs(be)>=1?be>0?+Math.floor(be/4294967296)>>>0:~~+Math.ceil((be-+(~~be>>>0))/4294967296)>>>0:0)],F[l+56>>2]=Ot[0],F[l+60>>2]=Ot[1],j[l+64>>2]=R%1e3*1e3*1e3,Ot=[Math.floor(A/1e3)>>>0,(be=Math.floor(A/1e3),+Math.abs(be)>=1?be>0?+Math.floor(be/4294967296)>>>0:~~+Math.ceil((be-+(~~be>>>0))/4294967296)>>>0:0)],F[l+72>>2]=Ot[0],F[l+76>>2]=Ot[1],j[l+80>>2]=A%1e3*1e3*1e3,Ot=[m.ino>>>0,(be=m.ino,+Math.abs(be)>=1?be>0?+Math.floor(be/4294967296)>>>0:~~+Math.ceil((be-+(~~be>>>0))/4294967296)>>>0:0)],F[l+88>>2]=Ot[0],F[l+92>>2]=Ot[1],0},doMsync(i,c,l,m,w){if(!b.isFile(c.node.mode))throw new b.ErrnoError(43);if(m&2)return 0;var R=N.slice(i,i+l);b.msync(c,R,w,l,m)},getStreamFromFD(i){var c=b.getStreamChecked(i);return c},varargs:void 0,getStr(i){var c=gi(i);return c}};function D3(i,c){try{return i=De.getStr(i),b.chmod(i,c),0}catch(l){if(typeof b>"u"||l.name!=="ErrnoError")throw l;return-l.errno}}function M3(i,c,l,m){try{if(c=De.getStr(c),c=De.calculateAt(i,c),l&-8)return-28;var w=b.lookupPath(c,{follow:!0}),R=w.node;if(!R)return-44;var A="";return l&4&&(A+="r"),l&2&&(A+="w"),l&1&&(A+="x"),A&&b.nodePermissions(R,A)?-2:0}catch(x){if(typeof b>"u"||x.name!=="ErrnoError")throw x;return-x.errno}}function L3(i,c){try{return b.fchmod(i,c),0}catch(l){if(typeof b>"u"||l.name!=="ErrnoError")throw l;return-l.errno}}function j3(i,c,l){try{return b.fchown(i,c,l),0}catch(m){if(typeof b>"u"||m.name!=="ErrnoError")throw m;return-m.errno}}var Bd=()=>{var i=F[+De.varargs>>2];return De.varargs+=4,i},U3=Bd;function z3(i,c,l){De.varargs=l;try{var m=De.getStreamFromFD(i);switch(c){case 0:{var w=Bd();if(w<0)return-28;for(;b.streams[w];)w++;var R;return R=b.dupStream(m,w),R.fd}case 1:case 2:return 0;case 3:return m.flags;case 4:{var w=Bd();return m.flags|=w,0}case 12:{var w=U3(),A=0;return M[w+A>>1]=2,0}case 13:case 14:return 0}return-28}catch(x){if(typeof b>"u"||x.name!=="ErrnoError")throw x;return-x.errno}}function B3(i,c){try{var l=De.getStreamFromFD(i);return De.doStat(b.stat,l.path,c)}catch(m){if(typeof b>"u"||m.name!=="ErrnoError")throw m;return-m.errno}}var Wu=(i,c)=>c+2097152>>>0<4194305-!!i?(i>>>0)+c*4294967296:NaN;function H3(i,c,l){var m=Wu(c,l);try{return isNaN(m)?61:(b.ftruncate(i,m),0)}catch(w){if(typeof b>"u"||w.name!=="ErrnoError")throw w;return-w.errno}}var Fo=(i,c,l)=>x_(i,N,c,l);function V3(i,c){try{if(c===0)return-28;var l=b.cwd(),m=La(l)+1;return c<m?-68:(Fo(l,i,c),m)}catch(w){if(typeof b>"u"||w.name!=="ErrnoError")throw w;return-w.errno}}function W3(i,c){try{return i=De.getStr(i),De.doStat(b.lstat,i,c)}catch(l){if(typeof b>"u"||l.name!=="ErrnoError")throw l;return-l.errno}}function K3(i,c,l){try{return c=De.getStr(c),c=De.calculateAt(i,c),c=ft.normalize(c),c[c.length-1]==="/"&&(c=c.substr(0,c.length-1)),b.mkdir(c,l,0),0}catch(m){if(typeof b>"u"||m.name!=="ErrnoError")throw m;return-m.errno}}function J3(i,c,l,m){try{c=De.getStr(c);var w=m&256,R=m&4096;return m=m&-6401,c=De.calculateAt(i,c,R),De.doStat(w?b.lstat:b.stat,c,l)}catch(A){if(typeof b>"u"||A.name!=="ErrnoError")throw A;return-A.errno}}function G3(i,c,l,m){De.varargs=m;try{c=De.getStr(c),c=De.calculateAt(i,c);var w=m?Bd():0;return b.open(c,l,w).fd}catch(R){if(typeof b>"u"||R.name!=="ErrnoError")throw R;return-R.errno}}function Q3(i,c,l,m){try{if(c=De.getStr(c),c=De.calculateAt(i,c),m<=0)return-28;var w=b.readlink(c),R=Math.min(m,La(w)),A=P[l+R];return Fo(w,l,m+1),P[l+R]=A,R}catch(x){if(typeof b>"u"||x.name!=="ErrnoError")throw x;return-x.errno}}function Y3(i){try{return i=De.getStr(i),b.rmdir(i),0}catch(c){if(typeof b>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}function X3(i,c){try{return i=De.getStr(i),De.doStat(b.stat,i,c)}catch(l){if(typeof b>"u"||l.name!=="ErrnoError")throw l;return-l.errno}}function Z3(i,c,l){try{return c=De.getStr(c),c=De.calculateAt(i,c),l===0?b.unlink(c):l===512?b.rmdir(c):ts("Invalid flags passed to unlinkat"),0}catch(m){if(typeof b>"u"||m.name!=="ErrnoError")throw m;return-m.errno}}var R0=i=>j[i>>2]+F[i+4>>2]*4294967296;function eD(i,c,l,m){try{c=De.getStr(c),c=De.calculateAt(i,c,!0);var w=Date.now(),R,A;if(!l)R=w,A=w;else{var x=R0(l),H=F[l+8>>2];H==1073741823?R=w:H==1073741822?R=-1:R=x*1e3+H/(1e3*1e3),l+=16,x=R0(l),H=F[l+8>>2],H==1073741823?A=w:H==1073741822?A=-1:A=x*1e3+H/(1e3*1e3)}return(A!=-1||R!=-1)&&b.utime(c,R,A),0}catch(ee){if(typeof b>"u"||ee.name!=="ErrnoError")throw ee;return-ee.errno}}var tD=i=>i%4===0&&(i%100!==0||i%400===0),nD=[0,31,60,91,121,152,182,213,244,274,305,335],rD=[0,31,59,90,120,151,181,212,243,273,304,334],sD=i=>{var c=tD(i.getFullYear()),l=c?nD:rD,m=l[i.getMonth()]+i.getDate()-1;return m};function oD(i,c,l){var m=Wu(i,c),w=new Date(m*1e3);F[l>>2]=w.getSeconds(),F[l+4>>2]=w.getMinutes(),F[l+8>>2]=w.getHours(),F[l+12>>2]=w.getDate(),F[l+16>>2]=w.getMonth(),F[l+20>>2]=w.getFullYear()-1900,F[l+24>>2]=w.getDay();var R=sD(w)|0;F[l+28>>2]=R,F[l+36>>2]=-(w.getTimezoneOffset()*60);var A=new Date(w.getFullYear(),0,1),x=new Date(w.getFullYear(),6,1).getTimezoneOffset(),H=A.getTimezoneOffset(),ee=(x!=H&&w.getTimezoneOffset()==Math.min(H,x))|0;F[l+32>>2]=ee}function iD(i,c,l,m,w,R,A,x){var H=Wu(w,R);try{if(isNaN(H))return 61;var ee=De.getStreamFromFD(m),Ce=b.mmap(ee,i,H,c,l),qe=Ce.ptr;return F[A>>2]=Ce.allocated,j[x>>2]=qe,0}catch(Ge){if(typeof b>"u"||Ge.name!=="ErrnoError")throw Ge;return-Ge.errno}}function aD(i,c,l,m,w,R,A){var x=Wu(R,A);try{var H=De.getStreamFromFD(w);l&2&&De.doMsync(i,H,c,m,x)}catch(ee){if(typeof b>"u"||ee.name!=="ErrnoError")throw ee;return-ee.errno}}var cD=(i,c,l,m)=>{var w=new Date().getFullYear(),R=new Date(w,0,1),A=new Date(w,6,1),x=R.getTimezoneOffset(),H=A.getTimezoneOffset(),ee=Math.max(x,H);j[i>>2]=ee*60,F[c>>2]=+(x!=H);var Ce=ae=>{var le=ae>=0?"-":"+",dt=Math.abs(ae),Un=String(Math.floor(dt/60)).padStart(2,"0"),Zn=String(dt%60).padStart(2,"0");return`UTC${le}${Un}${Zn}`},qe=Ce(x),Ge=Ce(H);H<x?(Fo(qe,l,17),Fo(Ge,m,17)):(Fo(qe,m,17),Fo(Ge,l,17))},uD=()=>Date.now(),lD=()=>performance.now(),fD=()=>2147483648,dD=i=>{var c=C.buffer,l=(i-c.byteLength+65535)/65536|0;try{return C.grow(l),G(),1}catch{}},hD=i=>{var c=N.length;i>>>=0;var l=fD();if(i>l)return!1;for(var m=1;m<=4;m*=2){var w=c*(1+.2/m);w=Math.min(w,i+100663296);var R=Math.min(l,T0(Math.max(i,w),65536)),A=dD(R);if(A)return!0}return!1},M_={},mD=()=>p||"./this.program",Ku=()=>{if(!Ku.strings){var i=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",c={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:i,_:mD()};for(var l in M_)M_[l]===void 0?delete c[l]:c[l]=M_[l];var m=[];for(var l in c)m.push(`${l}=${c[l]}`);Ku.strings=m}return Ku.strings},pD=(i,c)=>{for(var l=0;l<i.length;++l)P[c++]=i.charCodeAt(l);P[c]=0},gD=(i,c)=>{var l=0;return Ku().forEach((m,w)=>{var R=c+l;j[i+w*4>>2]=R,pD(m,R),l+=m.length+1}),0},_D=(i,c)=>{var l=Ku();j[i>>2]=l.length;var m=0;return l.forEach(w=>m+=w.length+1),j[c>>2]=m,0};function yD(i){try{var c=De.getStreamFromFD(i);return b.close(c),0}catch(l){if(typeof b>"u"||l.name!=="ErrnoError")throw l;return l.errno}}function bD(i,c){try{var l=0,m=0,w=0,R=De.getStreamFromFD(i),A=R.tty?2:b.isDir(R.mode)?3:b.isLink(R.mode)?7:4;return P[c]=A,M[c+2>>1]=w,Ot=[l>>>0,(be=l,+Math.abs(be)>=1?be>0?+Math.floor(be/4294967296)>>>0:~~+Math.ceil((be-+(~~be>>>0))/4294967296)>>>0:0)],F[c+8>>2]=Ot[0],F[c+12>>2]=Ot[1],Ot=[m>>>0,(be=m,+Math.abs(be)>=1?be>0?+Math.floor(be/4294967296)>>>0:~~+Math.ceil((be-+(~~be>>>0))/4294967296)>>>0:0)],F[c+16>>2]=Ot[0],F[c+20>>2]=Ot[1],0}catch(x){if(typeof b>"u"||x.name!=="ErrnoError")throw x;return x.errno}}var SD=(i,c,l,m)=>{for(var w=0,R=0;R<l;R++){var A=j[c>>2],x=j[c+4>>2];c+=8;var H=b.read(i,P,A,x,m);if(H<0)return-1;if(w+=H,H<x)break}return w};function wD(i,c,l,m){try{var w=De.getStreamFromFD(i),R=SD(w,c,l);return j[m>>2]=R,0}catch(A){if(typeof b>"u"||A.name!=="ErrnoError")throw A;return A.errno}}function vD(i,c,l,m,w){var R=Wu(c,l);try{if(isNaN(R))return 61;var A=De.getStreamFromFD(i);return b.llseek(A,R,m),Ot=[A.position>>>0,(be=A.position,+Math.abs(be)>=1?be>0?+Math.floor(be/4294967296)>>>0:~~+Math.ceil((be-+(~~be>>>0))/4294967296)>>>0:0)],F[w>>2]=Ot[0],F[w+4>>2]=Ot[1],A.getdents&&R===0&&m===0&&(A.getdents=null),0}catch(x){if(typeof b>"u"||x.name!=="ErrnoError")throw x;return x.errno}}function ED(i){var l;try{var c=De.getStreamFromFD(i);return(l=c.stream_ops)!=null&&l.fsync?c.stream_ops.fsync(c):0}catch(m){if(typeof b>"u"||m.name!=="ErrnoError")throw m;return m.errno}}var kD=(i,c,l,m)=>{for(var w=0,R=0;R<l;R++){var A=j[c>>2],x=j[c+4>>2];c+=8;var H=b.write(i,P,A,x,m);if(H<0)return-1;if(w+=H,H<x)break}return w};function $D(i,c,l,m){try{var w=De.getStreamFromFD(i),R=kD(w,c,l);return j[m>>2]=R,0}catch(A){if(typeof b>"u"||A.name!=="ErrnoError")throw A;return A.errno}}var Ve=function(){const i=typeof Asyncify=="object"?Asyncify.handleAsync.bind(Asyncify):null;r.handleAsync=i;const c=new Map;r.setCallback=(l,m)=>c.set(l,m),r.getCallback=l=>c.get(l),r.deleteCallback=l=>c.delete(l),Ve=function(l,m,...w){const R=c.get(m);let A=null;const x=typeof R=="function"?R:R[A=gi(w.shift())];if(l){if(i)return i(()=>x.apply(R,w));throw new Error("Synchronous WebAssembly cannot call async function")}const H=x.apply(R,w);if(typeof(H==null?void 0:H.then)=="function")throw console.error("unexpected Promise",x),new Error(`${A} unexpectedly returned a Promise`);return H}};function CD(...i){return Ve(!1,...i)}function TD(...i){return Ve(!0,...i)}function ID(...i){return Ve(!1,...i)}function RD(...i){return Ve(!0,...i)}function OD(...i){return Ve(!1,...i)}function qD(...i){return Ve(!0,...i)}function AD(...i){return Ve(!1,...i)}function PD(...i){return Ve(!0,...i)}function FD(...i){return Ve(!1,...i)}function xD(...i){return Ve(!0,...i)}function ND(...i){return Ve(!1,...i)}function DD(...i){return Ve(!0,...i)}function MD(...i){return Ve(!1,...i)}function LD(...i){return Ve(!0,...i)}function jD(...i){return Ve(!1,...i)}function UD(...i){return Ve(!0,...i)}function zD(...i){return Ve(!1,...i)}function BD(...i){return Ve(!0,...i)}function HD(...i){return Ve(!1,...i)}function VD(...i){return Ve(!0,...i)}function WD(...i){return Ve(!1,...i)}function KD(...i){return Ve(!0,...i)}function JD(...i){return Ve(!1,...i)}function GD(...i){return Ve(!0,...i)}function QD(...i){return Ve(!1,...i)}function YD(...i){return Ve(!0,...i)}function XD(...i){return Ve(!1,...i)}function ZD(...i){return Ve(!0,...i)}function eM(...i){return Ve(!1,...i)}function tM(...i){return Ve(!0,...i)}function nM(...i){return Ve(!1,...i)}function rM(...i){return Ve(!0,...i)}var sM=i=>{q=i,g(i,new E0(i))},oM=(i,c)=>{q=i,sM(i)},iM=i=>{if(i instanceof E0||i=="unwind")return q;g(1,i)},O0=(i,c)=>{i<128?c.push(i):c.push(i%128|128,i>>7)},aM=i=>{for(var c={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},l={parameters:[],results:i[0]=="v"?[]:[c[i[0]]]},m=1;m<i.length;++m)l.parameters.push(c[i[m]]);return l},cM=(i,c)=>{var l=i.slice(0,1),m=i.slice(1),w={i:127,p:127,j:126,f:125,d:124,e:111};c.push(96),O0(m.length,c);for(var R=0;R<m.length;++R)c.push(w[m[R]]);l=="v"?c.push(0):c.push(1,w[l])},uM=(i,c)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(aM(c),i);var l=[1];cM(c,l);var m=[0,97,115,109,1,0,0,0,1];O0(l.length,m),m.push(...l),m.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var w=new WebAssembly.Module(new Uint8Array(m)),R=new WebAssembly.Instance(w,{e:{f:i}}),A=R.exports.f;return A},ja,lM=i=>ja.get(i),fM=(i,c)=>{if(Ua)for(var l=i;l<i+c;l++){var m=lM(l);m&&Ua.set(m,l)}},Ua,dM=i=>(Ua||(Ua=new WeakMap,fM(0,ja.length)),Ua.get(i)||0),q0=[],hM=()=>{if(q0.length)return q0.pop();try{ja.grow(1)}catch(i){throw i instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":i}return ja.length-1},A0=(i,c)=>ja.set(i,c),mM=(i,c)=>{var l=dM(i);if(l)return l;var m=hM();try{A0(m,i)}catch(R){if(!(R instanceof TypeError))throw R;var w=uM(i,c);A0(m,w)}return Ua.set(i,m),m},P0=i=>{var c=r["_"+i];return c},F0=(i,c)=>{P.set(i,c)},x0=i=>U0(i),pM=i=>{var c=La(i)+1,l=x0(c);return Fo(i,l,c),l},xo=(i,c,l,m,w)=>{var R={string:le=>{var dt=0;return le!=null&&le!==0&&(dt=pM(le)),dt},array:le=>{var dt=x0(le.length);return F0(le,dt),dt}};function A(le){return c==="string"?gi(le):c==="boolean"?!!le:le}var x=P0(i),H=[],ee=0;if(m)for(var Ce=0;Ce<m.length;Ce++){var qe=R[l[Ce]];qe?(ee===0&&(ee=C3()),H[Ce]=qe(m[Ce])):H[Ce]=m[Ce]}var Ge=x(...H);function ae(le){return ee!==0&&$3(ee),A(le)}return Ge=ae(Ge),Ge},gM=(i,c,l,m)=>{var w=!l||l.every(A=>A==="number"||A==="boolean"),R=c!=="string";return R&&w&&!m?P0(i):(...A)=>xo(i,c,l,A)},_M=i=>L0(),yM=(i,c,l)=>{if(l??(l=2147483647),l<2)return 0;l-=2;for(var m=c,w=l<i.length*2?l/2:i.length,R=0;R<w;++R){var A=i.charCodeAt(R);M[c>>1]=A,c+=2}return M[c>>1]=0,c-m},bM=(i,c,l)=>{if(l??(l=2147483647),l<4)return 0;for(var m=c,w=m+l-4,R=0;R<i.length;++R){var A=i.charCodeAt(R);if(A>=55296&&A<=57343){var x=i.charCodeAt(++R);A=65536+((A&1023)<<10)|x&1023}if(F[c>>2]=A,c+=4,c+4>w)break}return F[c>>2]=0,c-m},SM=i=>{for(var c="";;){var l=N[i++];if(!l)return c;c+=String.fromCharCode(l)}},N0=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,wM=(i,c)=>{for(var l=i,m=l>>1,w=m+c/2;!(m>=w)&&B[m];)++m;if(l=m<<1,l-i>32&&N0)return N0.decode(N.subarray(i,l));for(var R="",A=0;!(A>=c/2);++A){var x=M[i+A*2>>1];if(x==0)break;R+=String.fromCharCode(x)}return R},vM=(i,c)=>{for(var l=0,m="";!(l>=c/4);){var w=F[i+l*4>>2];if(w==0)break;if(++l,w>=65536){var R=w-65536;m+=String.fromCharCode(55296|R>>10,56320|R&1023)}else m+=String.fromCharCode(w)}return m};function EM(i){for(var c=[],l=0;l<i.length;l++){var m=i[l];m>255&&(m&=255),c.push(String.fromCharCode(m))}return c.join("")}b.createPreloadedFile=x3,b.staticInit(),ke.doesNotExistError=new b.ErrnoError(44),ke.doesNotExistError.stack="<generic error, no stack>",Ve();var kM={a:T3,Y:D3,$:M3,Z:L3,X:j3,b:z3,W:B3,y:H3,Q:V3,U:W3,N:K3,S:J3,L:G3,J:Q3,I:Y3,V:X3,G:Z3,F:eD,w:oD,u:iD,v:aD,M:cD,n:uD,m:lD,D:hD,O:gD,P:_D,o:yD,E:bD,K:wD,x:vD,R:ED,H:$D,s:CD,t:TD,ga:ID,ka:RD,i:OD,j:qD,c:AD,d:PD,ca:FD,da:xD,ea:ND,fa:DD,g:MD,h:LD,z:jD,A:UD,e:zD,f:BD,aa:HD,ba:VD,B:WD,C:KD,p:JD,q:GD,ha:QD,ia:YD,ja:XD,r:ZD,k:eM,l:tM,T:nM,_:rM},I=k3();r._sqlite3_status64=(i,c,l,m)=>(r._sqlite3_status64=I.na)(i,c,l,m),r._sqlite3_status=(i,c,l,m)=>(r._sqlite3_status=I.oa)(i,c,l,m),r._sqlite3_db_status=(i,c,l,m,w)=>(r._sqlite3_db_status=I.pa)(i,c,l,m,w),r._sqlite3_msize=i=>(r._sqlite3_msize=I.qa)(i),r._sqlite3_vfs_find=i=>(r._sqlite3_vfs_find=I.ra)(i),r._sqlite3_vfs_register=(i,c)=>(r._sqlite3_vfs_register=I.sa)(i,c),r._sqlite3_vfs_unregister=i=>(r._sqlite3_vfs_unregister=I.ta)(i),r._sqlite3_release_memory=i=>(r._sqlite3_release_memory=I.ua)(i),r._sqlite3_soft_heap_limit64=(i,c)=>(r._sqlite3_soft_heap_limit64=I.va)(i,c),r._sqlite3_memory_used=()=>(r._sqlite3_memory_used=I.wa)(),r._sqlite3_hard_heap_limit64=(i,c)=>(r._sqlite3_hard_heap_limit64=I.xa)(i,c),r._sqlite3_memory_highwater=i=>(r._sqlite3_memory_highwater=I.ya)(i),r._sqlite3_malloc=i=>(r._sqlite3_malloc=I.za)(i),r._sqlite3_malloc64=(i,c)=>(r._sqlite3_malloc64=I.Aa)(i,c),r._sqlite3_free=i=>(r._sqlite3_free=I.Ba)(i),r._sqlite3_realloc=(i,c)=>(r._sqlite3_realloc=I.Ca)(i,c),r._sqlite3_realloc64=(i,c,l)=>(r._sqlite3_realloc64=I.Da)(i,c,l),r._sqlite3_str_vappendf=(i,c,l)=>(r._sqlite3_str_vappendf=I.Ea)(i,c,l),r._sqlite3_str_append=(i,c,l)=>(r._sqlite3_str_append=I.Fa)(i,c,l),r._sqlite3_str_appendchar=(i,c,l)=>(r._sqlite3_str_appendchar=I.Ga)(i,c,l),r._sqlite3_str_appendall=(i,c)=>(r._sqlite3_str_appendall=I.Ha)(i,c),r._sqlite3_str_appendf=(i,c,l)=>(r._sqlite3_str_appendf=I.Ia)(i,c,l),r._sqlite3_str_finish=i=>(r._sqlite3_str_finish=I.Ja)(i),r._sqlite3_str_errcode=i=>(r._sqlite3_str_errcode=I.Ka)(i),r._sqlite3_str_length=i=>(r._sqlite3_str_length=I.La)(i),r._sqlite3_str_value=i=>(r._sqlite3_str_value=I.Ma)(i),r._sqlite3_str_reset=i=>(r._sqlite3_str_reset=I.Na)(i),r._sqlite3_str_new=i=>(r._sqlite3_str_new=I.Oa)(i),r._sqlite3_vmprintf=(i,c)=>(r._sqlite3_vmprintf=I.Pa)(i,c),r._sqlite3_mprintf=(i,c)=>(r._sqlite3_mprintf=I.Qa)(i,c),r._sqlite3_vsnprintf=(i,c,l,m)=>(r._sqlite3_vsnprintf=I.Ra)(i,c,l,m),r._sqlite3_snprintf=(i,c,l,m)=>(r._sqlite3_snprintf=I.Sa)(i,c,l,m),r._sqlite3_log=(i,c,l)=>(r._sqlite3_log=I.Ta)(i,c,l),r._sqlite3_randomness=(i,c)=>(r._sqlite3_randomness=I.Ua)(i,c),r._sqlite3_stricmp=(i,c)=>(r._sqlite3_stricmp=I.Va)(i,c),r._sqlite3_strnicmp=(i,c,l)=>(r._sqlite3_strnicmp=I.Wa)(i,c,l),r._sqlite3_os_init=()=>(r._sqlite3_os_init=I.Xa)(),r._sqlite3_os_end=()=>(r._sqlite3_os_end=I.Ya)(),r._sqlite3_serialize=(i,c,l,m)=>(r._sqlite3_serialize=I.Za)(i,c,l,m),r._sqlite3_prepare_v2=(i,c,l,m,w)=>(r._sqlite3_prepare_v2=I._a)(i,c,l,m,w),r._sqlite3_step=i=>(r._sqlite3_step=I.$a)(i),r._sqlite3_column_int64=(i,c)=>(r._sqlite3_column_int64=I.ab)(i,c),r._sqlite3_reset=i=>(r._sqlite3_reset=I.bb)(i),r._sqlite3_exec=(i,c,l,m,w)=>(r._sqlite3_exec=I.cb)(i,c,l,m,w),r._sqlite3_column_int=(i,c)=>(r._sqlite3_column_int=I.db)(i,c),r._sqlite3_finalize=i=>(r._sqlite3_finalize=I.eb)(i),r._sqlite3_deserialize=(i,c,l,m,w,R,A,x)=>(r._sqlite3_deserialize=I.fb)(i,c,l,m,w,R,A,x),r._sqlite3_database_file_object=i=>(r._sqlite3_database_file_object=I.gb)(i),r._sqlite3_backup_init=(i,c,l,m)=>(r._sqlite3_backup_init=I.hb)(i,c,l,m),r._sqlite3_backup_step=(i,c)=>(r._sqlite3_backup_step=I.ib)(i,c),r._sqlite3_backup_finish=i=>(r._sqlite3_backup_finish=I.jb)(i),r._sqlite3_backup_remaining=i=>(r._sqlite3_backup_remaining=I.kb)(i),r._sqlite3_backup_pagecount=i=>(r._sqlite3_backup_pagecount=I.lb)(i),r._sqlite3_clear_bindings=i=>(r._sqlite3_clear_bindings=I.mb)(i),r._sqlite3_value_blob=i=>(r._sqlite3_value_blob=I.nb)(i),r._sqlite3_value_text=i=>(r._sqlite3_value_text=I.ob)(i),r._sqlite3_value_bytes=i=>(r._sqlite3_value_bytes=I.pb)(i),r._sqlite3_value_bytes16=i=>(r._sqlite3_value_bytes16=I.qb)(i),r._sqlite3_value_double=i=>(r._sqlite3_value_double=I.rb)(i),r._sqlite3_value_int=i=>(r._sqlite3_value_int=I.sb)(i),r._sqlite3_value_int64=i=>(r._sqlite3_value_int64=I.tb)(i),r._sqlite3_value_subtype=i=>(r._sqlite3_value_subtype=I.ub)(i),r._sqlite3_value_pointer=(i,c)=>(r._sqlite3_value_pointer=I.vb)(i,c),r._sqlite3_value_text16=i=>(r._sqlite3_value_text16=I.wb)(i),r._sqlite3_value_text16be=i=>(r._sqlite3_value_text16be=I.xb)(i),r._sqlite3_value_text16le=i=>(r._sqlite3_value_text16le=I.yb)(i),r._sqlite3_value_type=i=>(r._sqlite3_value_type=I.zb)(i),r._sqlite3_value_encoding=i=>(r._sqlite3_value_encoding=I.Ab)(i),r._sqlite3_value_nochange=i=>(r._sqlite3_value_nochange=I.Bb)(i),r._sqlite3_value_frombind=i=>(r._sqlite3_value_frombind=I.Cb)(i),r._sqlite3_value_dup=i=>(r._sqlite3_value_dup=I.Db)(i),r._sqlite3_value_free=i=>(r._sqlite3_value_free=I.Eb)(i),r._sqlite3_result_blob=(i,c,l,m)=>(r._sqlite3_result_blob=I.Fb)(i,c,l,m),r._sqlite3_result_blob64=(i,c,l,m,w)=>(r._sqlite3_result_blob64=I.Gb)(i,c,l,m,w),r._sqlite3_result_double=(i,c)=>(r._sqlite3_result_double=I.Hb)(i,c),r._sqlite3_result_error=(i,c,l)=>(r._sqlite3_result_error=I.Ib)(i,c,l),r._sqlite3_result_error16=(i,c,l)=>(r._sqlite3_result_error16=I.Jb)(i,c,l),r._sqlite3_result_int=(i,c)=>(r._sqlite3_result_int=I.Kb)(i,c),r._sqlite3_result_int64=(i,c,l)=>(r._sqlite3_result_int64=I.Lb)(i,c,l),r._sqlite3_result_null=i=>(r._sqlite3_result_null=I.Mb)(i),r._sqlite3_result_pointer=(i,c,l,m)=>(r._sqlite3_result_pointer=I.Nb)(i,c,l,m),r._sqlite3_result_subtype=(i,c)=>(r._sqlite3_result_subtype=I.Ob)(i,c),r._sqlite3_result_text=(i,c,l,m)=>(r._sqlite3_result_text=I.Pb)(i,c,l,m),r._sqlite3_result_text64=(i,c,l,m,w,R)=>(r._sqlite3_result_text64=I.Qb)(i,c,l,m,w,R),r._sqlite3_result_text16=(i,c,l,m)=>(r._sqlite3_result_text16=I.Rb)(i,c,l,m),r._sqlite3_result_text16be=(i,c,l,m)=>(r._sqlite3_result_text16be=I.Sb)(i,c,l,m),r._sqlite3_result_text16le=(i,c,l,m)=>(r._sqlite3_result_text16le=I.Tb)(i,c,l,m),r._sqlite3_result_value=(i,c)=>(r._sqlite3_result_value=I.Ub)(i,c),r._sqlite3_result_error_toobig=i=>(r._sqlite3_result_error_toobig=I.Vb)(i),r._sqlite3_result_zeroblob=(i,c)=>(r._sqlite3_result_zeroblob=I.Wb)(i,c),r._sqlite3_result_zeroblob64=(i,c,l)=>(r._sqlite3_result_zeroblob64=I.Xb)(i,c,l),r._sqlite3_result_error_code=(i,c)=>(r._sqlite3_result_error_code=I.Yb)(i,c),r._sqlite3_result_error_nomem=i=>(r._sqlite3_result_error_nomem=I.Zb)(i),r._sqlite3_user_data=i=>(r._sqlite3_user_data=I._b)(i),r._sqlite3_context_db_handle=i=>(r._sqlite3_context_db_handle=I.$b)(i),r._sqlite3_vtab_nochange=i=>(r._sqlite3_vtab_nochange=I.ac)(i),r._sqlite3_vtab_in_first=(i,c)=>(r._sqlite3_vtab_in_first=I.bc)(i,c),r._sqlite3_vtab_in_next=(i,c)=>(r._sqlite3_vtab_in_next=I.cc)(i,c),r._sqlite3_aggregate_context=(i,c)=>(r._sqlite3_aggregate_context=I.dc)(i,c),r._sqlite3_get_auxdata=(i,c)=>(r._sqlite3_get_auxdata=I.ec)(i,c),r._sqlite3_set_auxdata=(i,c,l,m)=>(r._sqlite3_set_auxdata=I.fc)(i,c,l,m),r._sqlite3_column_count=i=>(r._sqlite3_column_count=I.gc)(i),r._sqlite3_data_count=i=>(r._sqlite3_data_count=I.hc)(i),r._sqlite3_column_blob=(i,c)=>(r._sqlite3_column_blob=I.ic)(i,c),r._sqlite3_column_bytes=(i,c)=>(r._sqlite3_column_bytes=I.jc)(i,c),r._sqlite3_column_bytes16=(i,c)=>(r._sqlite3_column_bytes16=I.kc)(i,c),r._sqlite3_column_double=(i,c)=>(r._sqlite3_column_double=I.lc)(i,c),r._sqlite3_column_text=(i,c)=>(r._sqlite3_column_text=I.mc)(i,c),r._sqlite3_column_value=(i,c)=>(r._sqlite3_column_value=I.nc)(i,c),r._sqlite3_column_text16=(i,c)=>(r._sqlite3_column_text16=I.oc)(i,c),r._sqlite3_column_type=(i,c)=>(r._sqlite3_column_type=I.pc)(i,c),r._sqlite3_column_name=(i,c)=>(r._sqlite3_column_name=I.qc)(i,c),r._sqlite3_column_name16=(i,c)=>(r._sqlite3_column_name16=I.rc)(i,c),r._sqlite3_bind_blob=(i,c,l,m,w)=>(r._sqlite3_bind_blob=I.sc)(i,c,l,m,w),r._sqlite3_bind_blob64=(i,c,l,m,w,R)=>(r._sqlite3_bind_blob64=I.tc)(i,c,l,m,w,R),r._sqlite3_bind_double=(i,c,l)=>(r._sqlite3_bind_double=I.uc)(i,c,l),r._sqlite3_bind_int=(i,c,l)=>(r._sqlite3_bind_int=I.vc)(i,c,l),r._sqlite3_bind_int64=(i,c,l,m)=>(r._sqlite3_bind_int64=I.wc)(i,c,l,m),r._sqlite3_bind_null=(i,c)=>(r._sqlite3_bind_null=I.xc)(i,c),r._sqlite3_bind_pointer=(i,c,l,m,w)=>(r._sqlite3_bind_pointer=I.yc)(i,c,l,m,w),r._sqlite3_bind_text=(i,c,l,m,w)=>(r._sqlite3_bind_text=I.zc)(i,c,l,m,w),r._sqlite3_bind_text64=(i,c,l,m,w,R,A)=>(r._sqlite3_bind_text64=I.Ac)(i,c,l,m,w,R,A),r._sqlite3_bind_text16=(i,c,l,m,w)=>(r._sqlite3_bind_text16=I.Bc)(i,c,l,m,w),r._sqlite3_bind_value=(i,c,l)=>(r._sqlite3_bind_value=I.Cc)(i,c,l),r._sqlite3_bind_zeroblob=(i,c,l)=>(r._sqlite3_bind_zeroblob=I.Dc)(i,c,l),r._sqlite3_bind_zeroblob64=(i,c,l,m)=>(r._sqlite3_bind_zeroblob64=I.Ec)(i,c,l,m),r._sqlite3_bind_parameter_count=i=>(r._sqlite3_bind_parameter_count=I.Fc)(i),r._sqlite3_bind_parameter_name=(i,c)=>(r._sqlite3_bind_parameter_name=I.Gc)(i,c),r._sqlite3_bind_parameter_index=(i,c)=>(r._sqlite3_bind_parameter_index=I.Hc)(i,c),r._sqlite3_db_handle=i=>(r._sqlite3_db_handle=I.Ic)(i),r._sqlite3_stmt_readonly=i=>(r._sqlite3_stmt_readonly=I.Jc)(i),r._sqlite3_stmt_isexplain=i=>(r._sqlite3_stmt_isexplain=I.Kc)(i),r._sqlite3_stmt_explain=(i,c)=>(r._sqlite3_stmt_explain=I.Lc)(i,c),r._sqlite3_stmt_busy=i=>(r._sqlite3_stmt_busy=I.Mc)(i),r._sqlite3_next_stmt=(i,c)=>(r._sqlite3_next_stmt=I.Nc)(i,c),r._sqlite3_stmt_status=(i,c,l)=>(r._sqlite3_stmt_status=I.Oc)(i,c,l),r._sqlite3_sql=i=>(r._sqlite3_sql=I.Pc)(i),r._sqlite3_expanded_sql=i=>(r._sqlite3_expanded_sql=I.Qc)(i),r._sqlite3_value_numeric_type=i=>(r._sqlite3_value_numeric_type=I.Rc)(i),r._sqlite3_blob_open=(i,c,l,m,w,R,A,x)=>(r._sqlite3_blob_open=I.Sc)(i,c,l,m,w,R,A,x),r._sqlite3_blob_close=i=>(r._sqlite3_blob_close=I.Tc)(i),r._sqlite3_blob_read=(i,c,l,m)=>(r._sqlite3_blob_read=I.Uc)(i,c,l,m),r._sqlite3_blob_write=(i,c,l,m)=>(r._sqlite3_blob_write=I.Vc)(i,c,l,m),r._sqlite3_blob_bytes=i=>(r._sqlite3_blob_bytes=I.Wc)(i),r._sqlite3_blob_reopen=(i,c,l)=>(r._sqlite3_blob_reopen=I.Xc)(i,c,l),r._sqlite3_set_authorizer=(i,c,l)=>(r._sqlite3_set_authorizer=I.Yc)(i,c,l),r._sqlite3_strglob=(i,c)=>(r._sqlite3_strglob=I.Zc)(i,c),r._sqlite3_strlike=(i,c,l)=>(r._sqlite3_strlike=I._c)(i,c,l),r._sqlite3_errmsg=i=>(r._sqlite3_errmsg=I.$c)(i),r._sqlite3_auto_extension=i=>(r._sqlite3_auto_extension=I.ad)(i),r._sqlite3_cancel_auto_extension=i=>(r._sqlite3_cancel_auto_extension=I.bd)(i),r._sqlite3_reset_auto_extension=()=>(r._sqlite3_reset_auto_extension=I.cd)(),r._sqlite3_prepare=(i,c,l,m,w)=>(r._sqlite3_prepare=I.dd)(i,c,l,m,w),r._sqlite3_prepare_v3=(i,c,l,m,w,R)=>(r._sqlite3_prepare_v3=I.ed)(i,c,l,m,w,R),r._sqlite3_prepare16=(i,c,l,m,w)=>(r._sqlite3_prepare16=I.fd)(i,c,l,m,w),r._sqlite3_prepare16_v2=(i,c,l,m,w)=>(r._sqlite3_prepare16_v2=I.gd)(i,c,l,m,w),r._sqlite3_prepare16_v3=(i,c,l,m,w,R)=>(r._sqlite3_prepare16_v3=I.hd)(i,c,l,m,w,R),r._sqlite3_get_table=(i,c,l,m,w,R)=>(r._sqlite3_get_table=I.id)(i,c,l,m,w,R),r._sqlite3_free_table=i=>(r._sqlite3_free_table=I.jd)(i),r._sqlite3_create_module=(i,c,l,m)=>(r._sqlite3_create_module=I.kd)(i,c,l,m),r._sqlite3_create_module_v2=(i,c,l,m,w)=>(r._sqlite3_create_module_v2=I.ld)(i,c,l,m,w),r._sqlite3_drop_modules=(i,c)=>(r._sqlite3_drop_modules=I.md)(i,c),r._sqlite3_declare_vtab=(i,c)=>(r._sqlite3_declare_vtab=I.nd)(i,c),r._sqlite3_vtab_on_conflict=i=>(r._sqlite3_vtab_on_conflict=I.od)(i),r._sqlite3_vtab_config=(i,c,l)=>(r._sqlite3_vtab_config=I.pd)(i,c,l),r._sqlite3_vtab_collation=(i,c)=>(r._sqlite3_vtab_collation=I.qd)(i,c),r._sqlite3_vtab_in=(i,c,l)=>(r._sqlite3_vtab_in=I.rd)(i,c,l),r._sqlite3_vtab_rhs_value=(i,c,l)=>(r._sqlite3_vtab_rhs_value=I.sd)(i,c,l),r._sqlite3_vtab_distinct=i=>(r._sqlite3_vtab_distinct=I.td)(i),r._sqlite3_keyword_name=(i,c,l)=>(r._sqlite3_keyword_name=I.ud)(i,c,l),r._sqlite3_keyword_count=()=>(r._sqlite3_keyword_count=I.vd)(),r._sqlite3_keyword_check=(i,c)=>(r._sqlite3_keyword_check=I.wd)(i,c),r._sqlite3_complete=i=>(r._sqlite3_complete=I.xd)(i),r._sqlite3_complete16=i=>(r._sqlite3_complete16=I.yd)(i),r._sqlite3_libversion=()=>(r._sqlite3_libversion=I.zd)(),r._sqlite3_libversion_number=()=>(r._sqlite3_libversion_number=I.Ad)(),r._sqlite3_threadsafe=()=>(r._sqlite3_threadsafe=I.Bd)(),r._sqlite3_initialize=()=>(r._sqlite3_initialize=I.Cd)(),r._sqlite3_shutdown=()=>(r._sqlite3_shutdown=I.Dd)(),r._sqlite3_config=(i,c)=>(r._sqlite3_config=I.Ed)(i,c),r._sqlite3_db_mutex=i=>(r._sqlite3_db_mutex=I.Fd)(i),r._sqlite3_db_release_memory=i=>(r._sqlite3_db_release_memory=I.Gd)(i),r._sqlite3_db_cacheflush=i=>(r._sqlite3_db_cacheflush=I.Hd)(i),r._sqlite3_db_config=(i,c,l)=>(r._sqlite3_db_config=I.Id)(i,c,l),r._sqlite3_last_insert_rowid=i=>(r._sqlite3_last_insert_rowid=I.Jd)(i),r._sqlite3_set_last_insert_rowid=(i,c,l)=>(r._sqlite3_set_last_insert_rowid=I.Kd)(i,c,l),r._sqlite3_changes64=i=>(r._sqlite3_changes64=I.Ld)(i),r._sqlite3_changes=i=>(r._sqlite3_changes=I.Md)(i),r._sqlite3_total_changes64=i=>(r._sqlite3_total_changes64=I.Nd)(i),r._sqlite3_total_changes=i=>(r._sqlite3_total_changes=I.Od)(i),r._sqlite3_txn_state=(i,c)=>(r._sqlite3_txn_state=I.Pd)(i,c),r._sqlite3_close=i=>(r._sqlite3_close=I.Qd)(i),r._sqlite3_close_v2=i=>(r._sqlite3_close_v2=I.Rd)(i),r._sqlite3_busy_handler=(i,c,l)=>(r._sqlite3_busy_handler=I.Sd)(i,c,l),r._sqlite3_progress_handler=(i,c,l,m)=>(r._sqlite3_progress_handler=I.Td)(i,c,l,m),r._sqlite3_busy_timeout=(i,c)=>(r._sqlite3_busy_timeout=I.Ud)(i,c),r._sqlite3_interrupt=i=>(r._sqlite3_interrupt=I.Vd)(i),r._sqlite3_is_interrupted=i=>(r._sqlite3_is_interrupted=I.Wd)(i),r._sqlite3_create_function=(i,c,l,m,w,R,A,x)=>(r._sqlite3_create_function=I.Xd)(i,c,l,m,w,R,A,x),r._sqlite3_create_function_v2=(i,c,l,m,w,R,A,x,H)=>(r._sqlite3_create_function_v2=I.Yd)(i,c,l,m,w,R,A,x,H),r._sqlite3_create_window_function=(i,c,l,m,w,R,A,x,H,ee)=>(r._sqlite3_create_window_function=I.Zd)(i,c,l,m,w,R,A,x,H,ee),r._sqlite3_create_function16=(i,c,l,m,w,R,A,x)=>(r._sqlite3_create_function16=I._d)(i,c,l,m,w,R,A,x),r._sqlite3_overload_function=(i,c,l)=>(r._sqlite3_overload_function=I.$d)(i,c,l),r._sqlite3_trace_v2=(i,c,l,m)=>(r._sqlite3_trace_v2=I.ae)(i,c,l,m),r._sqlite3_commit_hook=(i,c,l)=>(r._sqlite3_commit_hook=I.be)(i,c,l),r._sqlite3_update_hook=(i,c,l)=>(r._sqlite3_update_hook=I.ce)(i,c,l),r._sqlite3_rollback_hook=(i,c,l)=>(r._sqlite3_rollback_hook=I.de)(i,c,l),r._sqlite3_autovacuum_pages=(i,c,l,m)=>(r._sqlite3_autovacuum_pages=I.ee)(i,c,l,m),r._sqlite3_wal_autocheckpoint=(i,c)=>(r._sqlite3_wal_autocheckpoint=I.fe)(i,c),r._sqlite3_wal_hook=(i,c,l)=>(r._sqlite3_wal_hook=I.ge)(i,c,l),r._sqlite3_wal_checkpoint_v2=(i,c,l,m,w)=>(r._sqlite3_wal_checkpoint_v2=I.he)(i,c,l,m,w),r._sqlite3_wal_checkpoint=(i,c)=>(r._sqlite3_wal_checkpoint=I.ie)(i,c),r._sqlite3_error_offset=i=>(r._sqlite3_error_offset=I.je)(i),r._sqlite3_errmsg16=i=>(r._sqlite3_errmsg16=I.ke)(i),r._sqlite3_errcode=i=>(r._sqlite3_errcode=I.le)(i),r._sqlite3_extended_errcode=i=>(r._sqlite3_extended_errcode=I.me)(i),r._sqlite3_system_errno=i=>(r._sqlite3_system_errno=I.ne)(i),r._sqlite3_errstr=i=>(r._sqlite3_errstr=I.oe)(i),r._sqlite3_limit=(i,c,l)=>(r._sqlite3_limit=I.pe)(i,c,l),r._sqlite3_open=(i,c)=>(r._sqlite3_open=I.qe)(i,c),r._sqlite3_open_v2=(i,c,l,m)=>(r._sqlite3_open_v2=I.re)(i,c,l,m),r._sqlite3_open16=(i,c)=>(r._sqlite3_open16=I.se)(i,c),r._sqlite3_create_collation=(i,c,l,m,w)=>(r._sqlite3_create_collation=I.te)(i,c,l,m,w),r._sqlite3_create_collation_v2=(i,c,l,m,w,R)=>(r._sqlite3_create_collation_v2=I.ue)(i,c,l,m,w,R),r._sqlite3_create_collation16=(i,c,l,m,w)=>(r._sqlite3_create_collation16=I.ve)(i,c,l,m,w),r._sqlite3_collation_needed=(i,c,l)=>(r._sqlite3_collation_needed=I.we)(i,c,l),r._sqlite3_collation_needed16=(i,c,l)=>(r._sqlite3_collation_needed16=I.xe)(i,c,l),r._sqlite3_get_clientdata=(i,c)=>(r._sqlite3_get_clientdata=I.ye)(i,c),r._sqlite3_set_clientdata=(i,c,l,m)=>(r._sqlite3_set_clientdata=I.ze)(i,c,l,m),r._sqlite3_get_autocommit=i=>(r._sqlite3_get_autocommit=I.Ae)(i),r._sqlite3_table_column_metadata=(i,c,l,m,w,R,A,x,H)=>(r._sqlite3_table_column_metadata=I.Be)(i,c,l,m,w,R,A,x,H),r._sqlite3_sleep=i=>(r._sqlite3_sleep=I.Ce)(i),r._sqlite3_extended_result_codes=(i,c)=>(r._sqlite3_extended_result_codes=I.De)(i,c),r._sqlite3_file_control=(i,c,l,m)=>(r._sqlite3_file_control=I.Ee)(i,c,l,m),r._sqlite3_test_control=(i,c)=>(r._sqlite3_test_control=I.Fe)(i,c),r._sqlite3_create_filename=(i,c,l,m,w)=>(r._sqlite3_create_filename=I.Ge)(i,c,l,m,w),r._sqlite3_free_filename=i=>(r._sqlite3_free_filename=I.He)(i),r._sqlite3_uri_parameter=(i,c)=>(r._sqlite3_uri_parameter=I.Ie)(i,c),r._sqlite3_uri_key=(i,c)=>(r._sqlite3_uri_key=I.Je)(i,c),r._sqlite3_uri_boolean=(i,c,l)=>(r._sqlite3_uri_boolean=I.Ke)(i,c,l),r._sqlite3_uri_int64=(i,c,l,m)=>(r._sqlite3_uri_int64=I.Le)(i,c,l,m),r._sqlite3_filename_database=i=>(r._sqlite3_filename_database=I.Me)(i),r._sqlite3_filename_journal=i=>(r._sqlite3_filename_journal=I.Ne)(i),r._sqlite3_filename_wal=i=>(r._sqlite3_filename_wal=I.Oe)(i),r._sqlite3_db_name=(i,c)=>(r._sqlite3_db_name=I.Pe)(i,c),r._sqlite3_db_filename=(i,c)=>(r._sqlite3_db_filename=I.Qe)(i,c),r._sqlite3_db_readonly=(i,c)=>(r._sqlite3_db_readonly=I.Re)(i,c),r._sqlite3_compileoption_used=i=>(r._sqlite3_compileoption_used=I.Se)(i),r._sqlite3_compileoption_get=i=>(r._sqlite3_compileoption_get=I.Te)(i),r._sqlite3session_create=(i,c,l)=>(r._sqlite3session_create=I.Ue)(i,c,l),r._sqlite3session_delete=i=>(r._sqlite3session_delete=I.Ve)(i),r._sqlite3session_attach=(i,c)=>(r._sqlite3session_attach=I.We)(i,c),r._sqlite3session_changeset=(i,c,l)=>(r._sqlite3session_changeset=I.Xe)(i,c,l),r._sqlite3session_enable=(i,c)=>(r._sqlite3session_enable=I.Ye)(i,c),r._sqlite3changeset_start=(i,c,l)=>(r._sqlite3changeset_start=I.Ze)(i,c,l),r._sqlite3changeset_finalize=i=>(r._sqlite3changeset_finalize=I._e)(i),r._sqlite3changeset_invert=(i,c,l,m)=>(r._sqlite3changeset_invert=I.$e)(i,c,l,m),r._sqlite3changeset_apply=(i,c,l,m,w,R)=>(r._sqlite3changeset_apply=I.af)(i,c,l,m,w,R),r._sqlite3_sourceid=()=>(r._sqlite3_sourceid=I.bf)(),r._malloc=i=>(r._malloc=I.cf)(i),r._free=i=>(r._free=I.df)(i),r._RegisterExtensionFunctions=i=>(r._RegisterExtensionFunctions=I.ef)(i),r._getSqliteFree=()=>(r._getSqliteFree=I.ff)();var D0=r._main=(i,c)=>(D0=r._main=I.gf)(i,c);r._libauthorizer_set_authorizer=(i,c,l)=>(r._libauthorizer_set_authorizer=I.hf)(i,c,l),r._libfunction_create_function=(i,c,l,m,w,R,A,x)=>(r._libfunction_create_function=I.jf)(i,c,l,m,w,R,A,x),r._libhook_commit_hook=(i,c,l)=>(r._libhook_commit_hook=I.kf)(i,c,l),r._libhook_update_hook=(i,c,l)=>(r._libhook_update_hook=I.lf)(i,c,l),r._libprogress_progress_handler=(i,c,l,m)=>(r._libprogress_progress_handler=I.mf)(i,c,l,m),r._libvfs_vfs_register=(i,c,l,m,w,R)=>(r._libvfs_vfs_register=I.nf)(i,c,l,m,w,R);var M0=(i,c)=>(M0=I.pf)(i,c),L0=()=>(L0=I.qf)(),j0=i=>(j0=I.rf)(i),U0=i=>(U0=I.sf)(i),z0=()=>(z0=I.tf)();r._sqlite3_version=5472,r.getTempRet0=_M,r.ccall=xo,r.cwrap=gM,r.addFunction=mM,r.setValue=Da,r.getValue=k0,r.UTF8ToString=gi,r.stringToUTF8=Fo,r.lengthBytesUTF8=La,r.intArrayFromString=N_,r.intArrayToString=EM,r.AsciiToString=SM,r.UTF16ToString=wM,r.stringToUTF16=yM,r.UTF32ToString=vM,r.stringToUTF32=bM,r.writeArrayToMemory=F0;var Hd;Ao=function i(){Hd||B0(),Hd||(Ao=i)};function $M(){var i=D0,c=0,l=0;try{var m=i(c,l);return oM(m,!0),m}catch(w){return iM(w)}}function B0(){if(es>0||(He(),es>0))return;function i(){var c;Hd||(Hd=!0,r.calledRun=!0,!$&&(Dt(),On(),s(r),(c=r.onRuntimeInitialized)==null||c.call(r),H0&&$M(),Bu()))}r.setStatus?(r.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>r.setStatus(""),1),i()},1)):i()}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();var H0=!0;return r.noInitialRun&&(H0=!1),B0(),function(){const i=Object.getPrototypeOf(async function(){}).constructor;let c=0;r.set_authorizer=function(l,m,w){c&&(r.deleteCallback(c),r._sqlite3_free(c),c=0),c=r._sqlite3_malloc(4),Da(c,m instanceof i?1:0,"i32");const R=xo("libauthorizer_set_authorizer","number",["number","number","number"],[l,m?1:0,c]);return!R&&m&&r.setCallback(c,(A,x,H,ee,Ce,qe)=>m(w,x,H,ee,Ce,qe)),R}}(),function(){const i=Object.getPrototypeOf(async function(){}).constructor,c=["xFunc","xStep","xFinal"],l=new Map;r.create_function=function(m,w,R,A,x,H,ee,Ce){const qe=r._sqlite3_malloc(4),Ge={xFunc:H,xStep:ee,xFinal:Ce};Da(qe,c.reduce((le,dt,Un)=>Ge[dt]instanceof i?le|1<<Un:le,0),"i32");const ae=xo("libfunction_create_function","number",["number","string","number","number","number","number","number","number"],[m,w,R,A,qe,H?1:0,ee?1:0,Ce?1:0]);if(!ae){if(l.has(w)){const le=l.get(w);r.deleteCallback(le)}l.set(w,qe),r.setCallback(qe,{xFunc:H,xStep:ee,xFinal:Ce})}return ae}}(),function(){const i=Object.getPrototypeOf(async function(){}).constructor;let c=0;r.update_hook=function(l,m){c&&(r.deleteCallback(c),r._sqlite3_free(c),c=0),c=r._sqlite3_malloc(4),Da(c,m instanceof i?1:0,"i32"),xo("libhook_update_hook","void",["number","number","number"],[l,m?1:0,c]),m&&r.setCallback(c,(w,R,A,x,H,ee)=>m(R,A,x,H,ee))}}(),function(){const i=Object.getPrototypeOf(async function(){}).constructor;let c=0;r.commit_hook=function(l,m){c&&(r.deleteCallback(c),r._sqlite3_free(c),c=0),c=r._sqlite3_malloc(4),Da(c,m instanceof i?1:0,"i32"),xo("libhook_commit_hook","void",["number","number","number"],[l,m?1:0,c]),m&&r.setCallback(c,w=>m())}}(),function(){const i=Object.getPrototypeOf(async function(){}).constructor;let c=0;r.progress_handler=function(l,m,w,R){c&&(r.deleteCallback(c),r._sqlite3_free(c),c=0),c=r._sqlite3_malloc(4),Da(c,w instanceof i?1:0,"i32"),xo("libprogress_progress_handler","number",["number","number","number","number"],[l,m,w?1:0,c]),w&&r.setCallback(c,A=>w(R))}}(),function(){const i=["xOpen","xDelete","xAccess","xFullPathname","xRandomness","xSleep","xCurrentTime","xGetLastError","xCurrentTimeInt64","xClose","xRead","xWrite","xTruncate","xSync","xFileSize","xLock","xUnlock","xCheckReservedLock","xFileControl","xSectorSize","xDeviceCharacteristics","xShmMap","xShmLock","xShmBarrier","xShmUnmap"],c=new Map;r.vfs_register=function(l,m){let w=0,R=0;i.forEach((x,H)=>{l[x]&&(w|=1<<H,l.hasAsyncMethod(x)&&(R|=1<<H))});const A=r._sqlite3_malloc(4);try{const x=xo("libvfs_vfs_register","number",["string","number","number","number","number","number"],[l.name,l.mxPathname,w,R,m?1:0,A]);if(!x){if(c.has(l.name)){const ee=c.get(l.name);r.deleteCallback(ee)}const H=k0(A,"*");c.set(l.name,H),r.setCallback(H,l)}return x}finally{r._sqlite3_free(A)}}}(),n=a,n}})();const Bae=async()=>{const e=await zae(),t=Uae(e);return t.module=e,t},d0=typeof navigator>"u"||navigator.storage===void 0?new Proxy({},{get:()=>Promise.reject(new Error("Can't get OPFS root handle in this environment as navigator.storage is undefined"))}):navigator.storage.getDirectory(),Hae=async e=>{const t=await d0;if(e===void 0)return t;let n=t;const r=e==null?void 0:e.split("/").filter(Boolean);for(;r.length>0;)n=await n.getDirectoryHandle(r.shift());return n},i3=async(e=d0,t=Number.POSITIVE_INFINITY,n="")=>{if(t<0)return;const r=await e,s=r.values();for await(const o of s){const a=o.kind==="directory",u=o.kind==="file"?await o.getFile().then(f=>Dre(f.size)):void 0;if(console.log(`${n}${a?"":""} ${o.name} ${u?`(${u})`:""}`),a){const f=await r.getDirectoryHandle(o.name);await i3(f,t-1,`${n}  `)}}},Vae=async e=>{if(e.kind==="directory")for await(const t of e.keys())await e.removeEntry(t,{recursive:!0})};var Wae=Object.freeze({__proto__:null,deleteAll:Vae,getDirHandle:Hae,printTree:i3,rootHandlePromise:d0});class iue extends Fr()("PersistedSqliteError",{cause:ya}){}const Kae=(e,t)=>{if(e===void 0||e===""||e==="/")return`livestore-${t}@${JC}`;if(e.includes("/"))throw new Error(`@livestore/adapter-web:worker:sanitizeOpfsDir: Nested directories are not yet supported ('${e}')`);return`${e}@${JC}`},Jae=e=>`state${e.state.sqlite.migrations.strategy==="manual"?"fixed":e.state.sqlite.hash.toString()}.db`,Gae=e=>toe({channelName:`livestore.shutdown.${e}`,schema:Wie}),Qae=te({type:xe("opfs"),directory:Yt(L)}),Yae=we(Qae);Uu({key:L,value:wo});var AS;(function(e){class t extends An()("InitialMessage",{payload:{port:E_,storeId:L,clientId:L},success:ps,failure:Ne}){}e.InitialMessage=t;class n extends we(t){}e.Request=n})(AS||(AS={}));var zn;(function(e){class t extends An()("InitialMessage",{payload:{storageOptions:Yae,devtoolsEnabled:ga,storeId:L,clientId:L,debugInstanceId:L,syncPayload:h_(wo)},success:ps,failure:Ne}){}e.InitialMessage=t;class n extends An()("BootStatusStream",{payload:{},success:Coe,failure:Ne}){}e.BootStatusStream=n;class r extends An()("PushToLeader",{payload:{batch:Oe(oie)},success:ps,failure:we(Ne,r0)}){}e.PushToLeader=r;class s extends An()("PullStream",{payload:{cursor:$oe},success:te({payload:_2,mergeCounter:st}),failure:Ne}){}e.PullStream=s;class o extends An()("Export",{payload:{},success:Tc,failure:Ne}){}e.Export=o;class a extends An()("ExportEventlog",{payload:{},success:Tc,failure:Ne}){}e.ExportEventlog=a;class u extends An()("GetRecreateSnapshot",{payload:{},success:te({snapshot:Tc,migrationsReport:Ioe}),failure:Ne}){}e.GetRecreateSnapshot=u;class f extends An()("GetLeaderHead",{payload:{},success:vn,failure:Ne}){}e.GetLeaderHead=f;class h extends An()("GetLeaderSyncState",{payload:{},success:fs,failure:Ne}){}e.GetLeaderSyncState=h;class p extends An()("Shutdown",{payload:{},success:ps,failure:Ne}){}e.Shutdown=p;class g extends An()("ExtraDevtoolsMessage",{payload:{message:x2},success:ps,failure:Ne}){}e.ExtraDevtoolsMessage=g,e.Request=we(t,n,r,s,o,a,u,f,h,p,g,c0)})(zn||(zn={}));var lT;(function(e){class t extends me("FromClientSession",{initialMessage:zn.InitialMessage}){}e.InitialMessagePayloadFromClientSession=t;class n extends An()("InitialMessage",{payload:{payload:we(t,me("FromWebBridge",{})),liveStoreVersion:xe(O_)},success:ps,failure:Ne}){}e.InitialMessage=n;class r extends An()("UpdateMessagePort",{payload:{port:E_},success:ps,failure:Ne}){}e.UpdateMessagePort=r;class s extends we(n,r,zn.BootStatusStream,zn.PushToLeader,zn.PullStream,zn.Export,zn.GetRecreateSnapshot,zn.ExportEventlog,zn.GetLeaderHead,zn.GetLeaderSyncState,zn.Shutdown,zn.ExtraDevtoolsMessage,c0){}e.Request=s})(lT||(lT={}));S_()&&(globalThis.__debugLiveStoreUtils={opfs:Wae,blobUrl:e=>URL.createObjectURL(new Blob([e],{type:"application/octet-stream"})),runSync:e=>bs(e),runFork:e=>Ro(e)});const Xae=e=>{Zae(e).pipe(Ro)},Zae=e=>{var n;const t=(n=e.otelOptions)!=null&&n.tracer?BP(Se(Ore,HP)).pipe(zP(Lv(qre,e.otelOptions.tracer))):void 0;return ece(e).pipe(jv(loe),XN,oi,wt,Sc({thread:self.name}),Cn(zne(self.name)),Cn(zse),Rs?ioe(r=>console.createTask(r)):ie,t?Cn(t):ie,mQ(doe()),pQ(4096),Ree(Hw))},ece=e=>YN(AS.InitialMessage,{InitialMessage:({port:t,storeId:n,clientId:r})=>z(function*(){return yield*tce(e).pipe(jv(foe(t)),XN,oi,Ie("@livestore/adapter-web:worker:wrapper:InitialMessage:innerFiber"),wt,Cn(xf.layer({nodeName:Aie.client.leader({storeId:n,clientId:r})})),Vt),BQ}).pipe(Ie("@livestore/adapter-web:worker:wrapper:InitialMessage"),Uv)}),tce=({schema:e,sync:t})=>YN(zn.Request,{InitialMessage:({storageOptions:n,storeId:r,clientId:s,devtoolsEnabled:o,debugInstanceId:a,syncPayload:u})=>z(function*(){const f=yield*Fg(()=>Bae()),h=jae({sqlite3:f}),p=yield*Io(),g=E=>h({_tag:"opfs",opfsDirectory:Kae(n.directory,r),fileName:E==="state"?Jae(e):"eventlog.db",configureDb:S=>H2(S,{foreignKeys:!0}).pipe(Cn(p),bs)}).pipe(ot(S=>To(()=>S.close()).pipe(Ed))),[k,T]=yield*vd([g("state"),g("eventlog")],{concurrency:2}),O=yield*nce({devtoolsEnabled:o,dbState:k,dbEventlog:T}),D=yield*Gae(r);return _ae({schema:e,storeId:r,clientId:s,makeSqliteDb:h,syncOptions:t,dbState:k,dbEventlog:T,devtoolsOptions:O,shutdownChannel:D,syncPayload:u})}).pipe(wt,Ne.mapToUnexpectedError,zE("@livestore/adapter-web:worker:InitialMessage"),Ie("@livestore/adapter-web:worker:InitialMessage"),IQ({debugInstanceId:a}),Uv),GetRecreateSnapshot:()=>z(function*(){const n=yield*Ut;return{snapshot:n.dbState.export(),migrationsReport:n.initialState.migrationsReport}}).pipe(Ne.mapToUnexpectedError,Ie("@livestore/adapter-web:worker:GetRecreateSnapshot")),PullStream:({cursor:n})=>z(function*(){const{syncProcessor:r}=yield*Ut;return r.pull({cursor:n})}).pipe(EN),PushToLeader:({batch:n})=>Br(Ut,({syncProcessor:r})=>r.push(n.map(s=>new In(s)),{waitForProcessing:!0})).pipe(Bo,Ie("@livestore/adapter-web:worker:PushToLeader")),Export:()=>Br(Ut,n=>n.dbState.export()).pipe(Ne.mapToUnexpectedError,Ie("@livestore/adapter-web:worker:Export")),ExportEventlog:()=>Br(Ut,n=>n.dbEventlog.export()).pipe(Ne.mapToUnexpectedError,Ie("@livestore/adapter-web:worker:ExportEventlog")),BootStatusStream:()=>Br(Ut,n=>yo(n.bootStatusQueue)).pipe(vN),GetLeaderHead:()=>z(function*(){const n=yield*Ut;return K2(n.dbEventlog)}).pipe(Ne.mapToUnexpectedError,Ie("@livestore/adapter-web:worker:GetLeaderHead")),GetLeaderSyncState:()=>z(function*(){return yield*(yield*Ut).syncProcessor.syncState}).pipe(Ne.mapToUnexpectedError,Ie("@livestore/adapter-web:worker:GetLeaderSyncState")),Shutdown:()=>z(function*(){yield*cs("[@livestore/adapter-web:worker] Shutdown"),yield*Qc(300)}).pipe(Ne.mapToUnexpectedError,Ie("@livestore/adapter-web:worker:Shutdown")),ExtraDevtoolsMessage:({message:n})=>Br(Ut,r=>r.extraIncomingMessagesQueue.offer(n)).pipe(Ne.mapToUnexpectedError,Ie("@livestore/adapter-web:worker:ExtraDevtoolsMessage")),"DevtoolsWebCommon.CreateConnection":Sae}),nce=({devtoolsEnabled:e,dbState:t,dbEventlog:n})=>z(function*(){if(e===!1)return{enabled:!1};const{node:r}=yield*xf;return{enabled:!0,boot:z(function*(){const s={state:t.metadata.persistenceInfo,eventlog:n.metadata.persistenceInfo};return{node:r,persistenceInfo:s,mode:"direct"}})}}),h0=me("WSMessage.PullReq",{requestId:L,cursor:Yt(st)}).annotations({title:"@livestore/sync-cf:PullReq"}),rce=te({createdAt:L}).annotations({title:"@livestore/sync-cf:SyncMetadata"}),a3=me("WSMessage.PullRes",{batch:Oe(te({eventEncoded:n0,metadata:Wi(rce)})),requestId:te({context:xe("pull","push"),requestId:L}),remaining:st}).annotations({title:"@livestore/sync-cf:PullRes"}),m0=me("WSMessage.PushReq",{requestId:L,batch:Oe(n0)}).annotations({title:"@livestore/sync-cf:PushReq"}),c3=me("WSMessage.PushAck",{requestId:L}).annotations({title:"@livestore/sync-cf:PushAck"}),u3=me("WSMessage.Error",{requestId:L,message:L}).annotations({title:"@livestore/sync-cf:Error"}),l3=me("WSMessage.Ping",{requestId:xe("ping")}).annotations({title:"@livestore/sync-cf:Ping"}),f3=me("WSMessage.Pong",{requestId:xe("ping")}).annotations({title:"@livestore/sync-cf:Pong"}),d3=me("WSMessage.AdminResetRoomReq",{requestId:L,adminSecret:L}).annotations({title:"@livestore/sync-cf:AdminResetRoomReq"}),h3=me("WSMessage.AdminResetRoomRes",{requestId:L}).annotations({title:"@livestore/sync-cf:AdminResetRoomRes"}),m3=me("WSMessage.AdminInfoReq",{requestId:L,adminSecret:L}).annotations({title:"@livestore/sync-cf:AdminInfoReq"}),p3=me("WSMessage.AdminInfoRes",{requestId:L,info:te({durableObjectId:L})}).annotations({title:"@livestore/sync-cf:AdminInfoRes"}),sce=we(h0,a3,m0,c3,u3,l3,f3,d3,h3,m3,p3).annotations({title:"@livestore/sync-cf:Message"}),oce=we(a3,c3,h3,p3,u3,f3);we(h0,m0,d3,m3,l3);const ice=te({storeId:L,payload:uN(Rte,Ts(wo)).pipe(h_)}),ace=e=>({storeId:t,payload:n})=>z(function*(){const r=yield*ju(ice)({storeId:t,payload:n}).pipe(Ne.mapToUnexpectedError),s=v_(r),o=`${e.url}/websocket?${sse(s)}`,{isConnected:a,incomingMessages:u,send:f}=yield*cce(o),h=[];let p=!1;return{isConnected:a,connect:fe,pull:k=>z(function*(){var E;if(p)return $e("Pull already started for this sync backend.");p=!0;let T=!1;const O=so(),D=(E=or(k))==null?void 0:E.cursor.global;return yield*f(h0.make({cursor:D,requestId:O})),Qm(u).pipe(Sn(S=>S._tag==="WSMessage.Error"&&S.requestId===O?new lie({message:S.message}):fe),SN(S=>{var _;if(S._tag==="WSMessage.PullRes")if(S.requestId.context==="pull")if(S.requestId.requestId===O)if(T=!0,h.length>0&&S.remaining===0){const C=((_=S.batch.at(-1))==null?void 0:_.eventEncoded.seqNum)??Jr.global,$=h.findIndex(N=>N.eventEncoded.seqNum>C),q=$===-1?[]:h.slice($),P=[...S.batch,...q];return W({...S,batch:P,remaining:0})}else return W(S);else return V();else return T?W(S):(h.push(...S.batch),V());return V()}))}).pipe(vN),push:k=>z(function*(){const T=yield*Me(),O=so();yield*Qm(u).pipe(Sn(D=>D._tag==="WSMessage.Error"&&D.requestId===O?Dw(T,new uie({reason:{_tag:"Unexpected",message:D.message}})):fe),Is(D=>D._tag==="WSMessage.PushAck"&&D.requestId===O),ru(1),Sn(()=>at(T,void 0)),on,wt,Dg),yield*f(m0.make({batch:k,requestId:O})),yield*T}),metadata:{name:"@livestore/cf-sync",description:"LiveStore sync backend implementation using Cloudflare Workers & Durable Objects",protocol:"ws",url:e.url}}}),cce=e=>z(function*(){const t=yield*wf(!1),n={current:void 0},r=yield*Kv().pipe(ot(qm)),s=t.changes.pipe(Is(Boolean),ru(1),on),o=u=>z(function*(){yield*s,n.current.send(ms(Ts(sce))(u)),Rs&&(yield*Bn(`Sent message: ${u._tag}`,u._tag==="WSMessage.PushReq"?{seqNum:u.batch[0].seqNum,parentSeqNum:u.batch[0].parentSeqNum,batchLength:u.batch.length}:u._tag==="WSMessage.PullReq"?{cursor:u.cursor??"-"}:{}))});return yield*z(function*(){for(;typeof navigator<"u"&&navigator.onLine===!1;)yield*Qc(1e3);const u=yield*roe({url:e,reconnect:JF(100)});yield*Er(t,!0),n.current=u;const f=yield*Me(),h=yield*dn().pipe(ot(xt));yield*uh(u,"message",g=>z(function*(){const k=Jx(Ts(oce))(g.data);if(k._tag==="Left"){console.error("Sync: Invalid message received",k.left);return}else k.right._tag==="WSMessage.Pong"?yield*Qe(h,k.right):yield*Hg(r,k.right)})),yield*uh(u,"close",()=>at(f,void 0)),yield*uh(u,"error",()=>z(function*(){u.close(3e3,"Sync: WebSocket error"),yield*at(f,void 0)})),typeof self<"u"&&typeof self.addEventListener=="function"&&(yield*uh(self,"offline",()=>at(f,void 0))),yield*Gn(()=>z(function*(){n.current=void 0,yield*Er(t,!1)}));const p=z(function*(){yield*o({_tag:"WSMessage.Ping",requestId:"ping"}),yield*go(h).pipe(Mg(5e3)),yield*Qc(25e3)}).pipe(Ie("@livestore/sync-cf:connect:checkPingPong"),Av);yield*s.pipe(Br(p.pipe(ff)),Ou(()=>at(f,void 0)),Vt),yield*f}).pipe(oi,Ie("@livestore/sync-cf:connect")).pipe(ff,qt,wt,Vt),{isConnected:t,incomingMessages:r,send:o}});var g3=(e=>(e.DINE_IN="DINE_IN",e.TAKE_AWAY="TAKE_AWAY",e.DELIVERY="DELIVERY",e))(g3||{}),_3=(e=>(e.NEW="NEW",e.PREPARING="PREPARING",e.READY="READY",e.SERVED="SERVED",e.CANCELLED="CANCELLED",e.CLOSED="CLOSED",e))(_3||{});const p0=te({id:_a,name:L,price:st,quantity:_a}),uce=te({items:Oe(p0)}),lce=te({type:uC(g3),id:L,items:Oe(p0),createdAt:Jm,updatedAt:Jm,status:uC(_3),omsId:L,accountId:_a}),fce=t0({name:"v1.OrderCreated",schema:lce}),dce=t0({name:"v1.OMSCreated",schema:te({id:L})}),hce=t0({name:"v1.OrderUpdated",schema:te({id:L,status:Yt(L),updatedAt:Yt(Jm),items:Yt(Oe(p0))})}),mce=qo({name:"orders",columns:{id:pl({primaryKey:!0}),type:pl(),status:pl(),items:Foe(),createdAt:VC(),updatedAt:VC(),omsId:pl(),accountId:Poe()}}),pce=qo({name:"oms",columns:{id:pl({primaryKey:!0})}}),gce=Qoe({name:"orderDraft",schema:uce,default:{id:np,value:{items:[]}}}),Fl={orders:mce,oms:pce,orderDraft:gce},y3={OMSCreated:dce,orderCreated:fce,orderUpdated:hce,orderDraftSet:Fl.orderDraft.set},_ce=Joe(y3,{"v1.OMSCreated":({id:e})=>Fl.oms.insert({id:e}),"v1.OrderCreated":e=>Fl.orders.insert(e),"v1.OrderUpdated":e=>Fl.orders.update(e)}),yce=sie({tables:Fl,materializers:_ce}),bce=tie({events:y3,state:yce});Xae({schema:bce,sync:{backend:ace({url:"http://localhost:8787"}),initialSyncOptions:{_tag:"Blocking",timeout:5e3}}});
